/*! For license information please see voyager-explorer.min.js.LICENSE.txt */
!function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=84)}([,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.or=t.and=t.not=t.CodeGen=t.operators=t.varKinds=t.ValueScopeName=t.ValueScope=t.Scope=t.Name=t.stringify=t.getProperty=t.nil=t.strConcat=t.str=t._=void 0;const i=n(12),s=n(16);var r=n(12);Object.defineProperty(t,"_",{enumerable:!0,get:function(){return r._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return r.str}}),Object.defineProperty(t,"strConcat",{enumerable:!0,get:function(){return r.strConcat}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return r.nil}}),Object.defineProperty(t,"getProperty",{enumerable:!0,get:function(){return r.getProperty}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return r.stringify}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return r.Name}});var o=n(16);Object.defineProperty(t,"Scope",{enumerable:!0,get:function(){return o.Scope}}),Object.defineProperty(t,"ValueScope",{enumerable:!0,get:function(){return o.ValueScope}}),Object.defineProperty(t,"ValueScopeName",{enumerable:!0,get:function(){return o.ValueScopeName}}),Object.defineProperty(t,"varKinds",{enumerable:!0,get:function(){return o.varKinds}}),t.operators={GT:new i._Code(">"),GTE:new i._Code(">="),LT:new i._Code("<"),LTE:new i._Code("<="),EQ:new i._Code("==="),NEQ:new i._Code("!=="),NOT:new i._Code("!"),OR:new i._Code("||"),AND:new i._Code("&&"),ADD:new i._Code("+")};class a{optimizeNodes(){return this}optimizeNames(e,t){return this}}class l extends a{constructor(e,t,n){super(),this.varKind=e,this.name=t,this.rhs=n}render({es5:e,_n:t}){const n=e?s.varKinds.var:this.varKind,i=void 0===this.rhs?"":" = "+this.rhs;return`${n} ${this.name}${i};`+t}optimizeNames(e,t){if(e[this.name.str])return this.rhs&&(this.rhs=R(this.rhs,e,t)),this}get names(){return this.rhs instanceof i._CodeOrName?this.rhs.names:{}}}class c extends a{constructor(e,t,n){super(),this.lhs=e,this.rhs=t,this.sideEffects=n}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,t){if(!(this.lhs instanceof i.Name)||e[this.lhs.str]||this.sideEffects)return this.rhs=R(this.rhs,e,t),this}get names(){return L(this.lhs instanceof i.Name?{}:{...this.lhs.names},this.rhs)}}class h extends c{constructor(e,t,n,i){super(e,n,i),this.op=t}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}}class u extends a{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return this.label+":"+e}}class d extends a{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?" "+this.label:""};`+e}}class p extends a{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}}class f extends a{constructor(e){super(),this.code=e}render({_n:e}){return this.code+";"+e}optimizeNodes(){return""+this.code?this:void 0}optimizeNames(e,t){return this.code=R(this.code,e,t),this}get names(){return this.code instanceof i._CodeOrName?this.code.names:{}}}class m extends a{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((t,n)=>t+n.render(e),"")}optimizeNodes(){const{nodes:e}=this;let t=e.length;for(;t--;){const n=e[t].optimizeNodes();Array.isArray(n)?e.splice(t,1,...n):n?e[t]=n:e.splice(t,1)}return e.length>0?this:void 0}optimizeNames(e,t){const{nodes:n}=this;let i=n.length;for(;i--;){const s=n[i];s.optimizeNames(e,t)||(N(e,s.names),n.splice(i,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((e,t)=>P(e,t.names),{})}}class g extends m{render(e){return"{"+e._n+super.render(e)+"}"+e._n}}class v extends m{}class y extends g{}y.kind="else";class b extends g{constructor(e,t){super(t),this.condition=e}render(e){let t=`if(${this.condition})`+super.render(e);return this.else&&(t+="else "+this.else.render(e)),t}optimizeNodes(){super.optimizeNodes();const e=this.condition;if(!0===e)return this.nodes;let t=this.else;if(t){const e=t.optimizeNodes();t=this.else=Array.isArray(e)?new y(e):e}return t?!1===e?t instanceof b?t:t.nodes:this.nodes.length?this:new b(D(e),t instanceof b?[t]:t.nodes):!1!==e&&this.nodes.length?this:void 0}optimizeNames(e,t){var n;if(this.else=null===(n=this.else)||void 0===n?void 0:n.optimizeNames(e,t),super.optimizeNames(e,t)||this.else)return this.condition=R(this.condition,e,t),this}get names(){const e=super.names;return L(e,this.condition),this.else&&P(e,this.else.names),e}}b.kind="if";class x extends g{}x.kind="for";class _ extends x{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,t){if(super.optimizeNames(e,t))return this.iteration=R(this.iteration,e,t),this}get names(){return P(super.names,this.iteration.names)}}class w extends x{constructor(e,t,n,i){super(),this.varKind=e,this.name=t,this.from=n,this.to=i}render(e){const t=e.es5?s.varKinds.var:this.varKind,{name:n,from:i,to:r}=this;return`for(${t} ${n}=${i}; ${n}<${r}; ${n}++)`+super.render(e)}get names(){const e=L(super.names,this.from);return L(e,this.to)}}class S extends x{constructor(e,t,n,i){super(),this.loop=e,this.varKind=t,this.name=n,this.iterable=i}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,t){if(super.optimizeNames(e,t))return this.iterable=R(this.iterable,e,t),this}get names(){return P(super.names,this.iterable.names)}}class M extends g{constructor(e,t,n){super(),this.name=e,this.args=t,this.async=n}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}}M.kind="func";class E extends m{render(e){return"return "+super.render(e)}}E.kind="return";class T extends g{render(e){let t="try"+super.render(e);return this.catch&&(t+=this.catch.render(e)),this.finally&&(t+=this.finally.render(e)),t}optimizeNodes(){var e,t;return super.optimizeNodes(),null===(e=this.catch)||void 0===e||e.optimizeNodes(),null===(t=this.finally)||void 0===t||t.optimizeNodes(),this}optimizeNames(e,t){var n,i;return super.optimizeNames(e,t),null===(n=this.catch)||void 0===n||n.optimizeNames(e,t),null===(i=this.finally)||void 0===i||i.optimizeNames(e,t),this}get names(){const e=super.names;return this.catch&&P(e,this.catch.names),this.finally&&P(e,this.finally.names),e}}class C extends g{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}}C.kind="catch";class A extends g{render(e){return"finally"+super.render(e)}}A.kind="finally";function P(e,t){for(const n in t)e[n]=(e[n]||0)+(t[n]||0);return e}function L(e,t){return t instanceof i._CodeOrName?P(e,t.names):e}function R(e,t,n){return e instanceof i.Name?r(e):(s=e)instanceof i._Code&&s._items.some(e=>e instanceof i.Name&&1===t[e.str]&&void 0!==n[e.str])?new i._Code(e._items.reduce((e,t)=>(t instanceof i.Name&&(t=r(t)),t instanceof i._Code?e.push(...t._items):e.push(t),e),[])):e;var s;function r(e){const i=n[e.str];return void 0===i||1!==t[e.str]?e:(delete t[e.str],i)}}function N(e,t){for(const n in t)e[n]=(e[n]||0)-(t[n]||0)}function D(e){return"boolean"==typeof e||"number"==typeof e||null===e?!e:i._`!${z(e)}`}t.CodeGen=class{constructor(e,t={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...t,_n:t.lines?"\n":""},this._extScope=e,this._scope=new s.Scope({parent:e}),this._nodes=[new v]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,t){const n=this._extScope.value(e,t);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(e,t){return this._extScope.getValue(e,t)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,t,n,i){const s=this._scope.toName(t);return void 0!==n&&i&&(this._constants[s.str]=n),this._leafNode(new l(e,s,n)),s}const(e,t,n){return this._def(s.varKinds.const,e,t,n)}let(e,t,n){return this._def(s.varKinds.let,e,t,n)}var(e,t,n){return this._def(s.varKinds.var,e,t,n)}assign(e,t,n){return this._leafNode(new c(e,t,n))}add(e,n){return this._leafNode(new h(e,t.operators.ADD,n))}code(e){return"function"==typeof e?e():e!==i.nil&&this._leafNode(new f(e)),this}object(...e){const t=["{"];for(const[n,s]of e)t.length>1&&t.push(","),t.push(n),(n!==s||this.opts.es5)&&(t.push(":"),i.addCodeArg(t,s));return t.push("}"),new i._Code(t)}if(e,t,n){if(this._blockNode(new b(e)),t&&n)this.code(t).else().code(n).endIf();else if(t)this.code(t).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new b(e))}else(){return this._elseNode(new y)}endIf(){return this._endBlockNode(b,y)}_for(e,t){return this._blockNode(e),t&&this.code(t).endFor(),this}for(e,t){return this._for(new _(e),t)}forRange(e,t,n,i,r=(this.opts.es5?s.varKinds.var:s.varKinds.let)){const o=this._scope.toName(e);return this._for(new w(r,o,t,n),()=>i(o))}forOf(e,t,n,r=s.varKinds.const){const o=this._scope.toName(e);if(this.opts.es5){const e=t instanceof i.Name?t:this.var("_arr",t);return this.forRange("_i",0,i._`${e}.length`,t=>{this.var(o,i._`${e}[${t}]`),n(o)})}return this._for(new S("of",r,o,t),()=>n(o))}forIn(e,t,n,r=(this.opts.es5?s.varKinds.var:s.varKinds.const)){if(this.opts.ownProperties)return this.forOf(e,i._`Object.keys(${t})`,n);const o=this._scope.toName(e);return this._for(new S("in",r,o,t),()=>n(o))}endFor(){return this._endBlockNode(x)}label(e){return this._leafNode(new u(e))}break(e){return this._leafNode(new d(e))}return(e){const t=new E;if(this._blockNode(t),this.code(e),1!==t.nodes.length)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(E)}try(e,t,n){if(!t&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');const i=new T;if(this._blockNode(i),this.code(e),t){const e=this.name("e");this._currNode=i.catch=new C(e),t(e)}return n&&(this._currNode=i.finally=new A,this.code(n)),this._endBlockNode(C,A)}throw(e){return this._leafNode(new p(e))}block(e,t){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(t),this}endBlock(e){const t=this._blockStarts.pop();if(void 0===t)throw new Error("CodeGen: not in self-balancing block");const n=this._nodes.length-t;if(n<0||void 0!==e&&n!==e)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${e} expected`);return this._nodes.length=t,this}func(e,t=i.nil,n,s){return this._blockNode(new M(e,t,n)),s&&this.code(s).endFunc(),this}endFunc(){return this._endBlockNode(M)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,t){const n=this._currNode;if(n instanceof e||t&&n instanceof t)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${t?`${e.kind}/${t.kind}`:e.kind}"`)}_elseNode(e){const t=this._currNode;if(!(t instanceof b))throw new Error('CodeGen: "else" without "if"');return this._currNode=t.else=e,this}get _root(){return this._nodes[0]}get _currNode(){const e=this._nodes;return e[e.length-1]}set _currNode(e){const t=this._nodes;t[t.length-1]=e}},t.not=D;const O=I(t.operators.AND);t.and=function(...e){return e.reduce(O)};const k=I(t.operators.OR);function I(e){return(t,n)=>t===i.nil?n:n===i.nil?t:i._`${z(t)} ${e} ${z(n)}`}function z(e){return e instanceof i.Name?e:i._`(${e})`}t.or=function(...e){return e.reduce(k)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.func=t.setEvaluated=t.evaluatedPropsToName=t.mergeEvaluated=t.eachItem=t.unescapeJsonPointer=t.escapeJsonPointer=t.escapeFragment=t.unescapeFragment=t.schemaRefOrVal=t.schemaHasRulesButRef=t.schemaHasRules=t.checkUnknownRules=t.alwaysValidSchema=t.toHash=void 0;const i=n(1),s=n(3);function r(e,t=e.schema){const{opts:n,self:i}=e;if(!n.strict)return;if("boolean"==typeof t)return;const r=i.RULES.keywords;for(const n in t)r[n]||s.checkStrictMode(e,`unknown keyword: "${n}"`)}function o(e,t){if("boolean"==typeof e)return!e;for(const n in e)if(t[n])return!0;return!1}function a(e){return"number"==typeof e?""+e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function l(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function c({mergeNames:e,mergeToName:t,mergeValues:n,resultToName:s}){return(r,o,a,l)=>{const c=void 0===a?o:a instanceof i.Name?(o instanceof i.Name?e(r,o,a):t(r,o,a),a):o instanceof i.Name?(t(r,a,o),o):n(o,a);return l!==i.Name||c instanceof i.Name?c:s(r,c)}}function h(e,t){if(!0===t)return e.var("props",!0);const n=e.var("props",i._`{}`);return void 0!==t&&u(e,n,t),n}function u(e,t,n){Object.keys(n).forEach(n=>e.assign(i._`${t}${i.getProperty(n)}`,!0))}t.toHash=function(e){const t={};for(const n of e)t[n]=!0;return t},t.alwaysValidSchema=function(e,t){return"boolean"==typeof t?t:0===Object.keys(t).length||(r(e,t),!o(t,e.self.RULES.all))},t.checkUnknownRules=r,t.schemaHasRules=o,t.schemaHasRulesButRef=function(e,t){if("boolean"==typeof e)return!e;for(const n in e)if("$ref"!==n&&t.all[n])return!0;return!1},t.schemaRefOrVal=function({topSchemaRef:e,schemaPath:t},n,s,r){if(!r){if("number"==typeof n||"boolean"==typeof n)return n;if("string"==typeof n)return i._`${n}`}return i._`${e}${t}${i.getProperty(s)}`},t.unescapeFragment=function(e){return l(decodeURIComponent(e))},t.escapeFragment=function(e){return encodeURIComponent(a(e))},t.escapeJsonPointer=a,t.unescapeJsonPointer=l,t.eachItem=function(e,t){if(Array.isArray(e))for(const n of e)t(n);else t(e)},t.mergeEvaluated={props:c({mergeNames:(e,t,n)=>e.if(i._`${n} !== true && ${t} !== undefined`,()=>{e.if(i._`${t} === true`,()=>e.assign(n,!0),()=>e.code(i._`Object.assign(${n}, ${t})`))}),mergeToName:(e,t,n)=>e.if(i._`${n} !== true`,()=>{!0===t?e.assign(n,!0):(e.assign(n,i._`${n} || {}`),u(e,n,t))}),mergeValues:(e,t)=>!0===e||{...e,...t},resultToName:h}),items:c({mergeNames:(e,t,n)=>e.if(i._`${n} !== true && ${t} !== undefined`,()=>e.assign(n,i._`${t} === true ? true : ${n} > ${t} ? ${n} : ${t}`)),mergeToName:(e,t,n)=>e.if(i._`${n} !== true`,()=>e.assign(n,!0===t||i._`${n} > ${t} ? ${n} : ${t}`)),mergeValues:(e,t)=>!0===e||Math.max(e,t),resultToName:(e,t)=>e.var("items",t)})},t.evaluatedPropsToName=h,t.setEvaluated=u,t.func=function(e,t){return e.scopeValue("func",{ref:t,code:t.code})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkStrictMode=t.schemaCxtHasRules=t.subschemaCode=t.validateFunctionCode=void 0;const i=n(43),s=n(7),r=n(44),o=n(1),a=n(4),l=n(10),c=n(2);function h({gen:e,validateName:t,schema:n,schemaEnv:i,opts:s},r){s.code.es5?e.func(t,o._`${a.default.data}, ${a.default.valCxt}`,i.$async,()=>{e.code(o._`"use strict"; ${u(n,s)}`),function(e,t){e.if(a.default.valCxt,()=>{e.var(a.default.dataPath,o._`${a.default.valCxt}.${a.default.dataPath}`),e.var(a.default.parentData,o._`${a.default.valCxt}.${a.default.parentData}`),e.var(a.default.parentDataProperty,o._`${a.default.valCxt}.${a.default.parentDataProperty}`),e.var(a.default.rootData,o._`${a.default.valCxt}.${a.default.rootData}`),t.dynamicRef&&e.var(a.default.dynamicAnchors,o._`${a.default.valCxt}.${a.default.dynamicAnchors}`)},()=>{e.var(a.default.dataPath,o._`""`),e.var(a.default.parentData,o._`undefined`),e.var(a.default.parentDataProperty,o._`undefined`),e.var(a.default.rootData,a.default.data),t.dynamicRef&&e.var(a.default.dynamicAnchors,o._`{}`)})}(e,s),e.code(r)}):e.func(t,o._`${a.default.data}, ${function(e){return o._`{${a.default.dataPath}="", ${a.default.parentData}, ${a.default.parentDataProperty}, ${a.default.rootData}=${a.default.data}${e.dynamicRef?o._`, ${a.default.dynamicAnchors}={}`:o.nil}}={}`}(s)}`,i.$async,()=>e.code(u(n,s)).code(r))}function u(e,t){return"object"==typeof e&&e.$id&&(t.code.source||t.code.process)?o._`/*# sourceURL=${e.$id} */`:o.nil}function d({schema:e,self:t}){if("boolean"==typeof e)return!e;for(const n in e)if(t.RULES.all[n])return!0;return!1}function p(e){return"boolean"!=typeof e.schema}function f(e){c.checkUnknownRules(e),function(e){const{schema:t,errSchemaPath:n,opts:i,self:s}=e;t.$ref&&i.ignoreKeywordsWithRef&&c.schemaHasRulesButRef(t,s.RULES)&&s.logger.warn(`$ref: keywords ignored in schema at path "${n}"`)}(e)}function m(e,t){if(e.opts.jtd)return r.schemaKeywords(e,[],!1,t);const n=s.getSchemaTypes(e.schema),i=s.coerceAndCheckDataType(e,n);r.schemaKeywords(e,n,!i,t)}function g({gen:e,schemaEnv:t,schema:n,errSchemaPath:i,opts:s}){const r=n.$comment;if(!0===s.$comment)e.code(o._`${a.default.self}.logger.log(${r})`);else if("function"==typeof s.$comment){const n=o.str`${i}/$comment`,s=e.scopeValue("root",{ref:t.root});e.code(o._`${a.default.self}.opts.$comment(${r}, ${n}, ${s}.schema)`)}}function v(e,t,n=e.opts.strict){if(n){if(t="strict mode: "+t,!0===n)throw new Error(t);e.self.logger.warn(t)}}t.validateFunctionCode=function(e){p(e)&&(f(e),d(e))?function(e){const{schema:t,opts:n,gen:i}=e;h(e,()=>{n.$comment&&t.$comment&&g(e),function(e){const{schema:t,opts:n}=e;void 0!==t.default&&n.useDefaults&&n.strict&&v(e,"default is ignored in the schema root")}(e),i.let(a.default.vErrors,null),i.let(a.default.errors,0),n.unevaluated&&function(e){const{gen:t,validateName:n}=e;e.evaluated=t.const("evaluated",o._`${n}.evaluated`),t.if(o._`${e.evaluated}.dynamicProps`,()=>t.assign(o._`${e.evaluated}.props`,o._`undefined`)),t.if(o._`${e.evaluated}.dynamicItems`,()=>t.assign(o._`${e.evaluated}.items`,o._`undefined`))}(e),m(e),function(e){const{gen:t,schemaEnv:n,validateName:i,ValidationError:s,opts:r}=e;n.$async?t.if(o._`${a.default.errors} === 0`,()=>t.return(a.default.data),()=>t.throw(o._`new ${s}(${a.default.vErrors})`)):(t.assign(o._`${i}.errors`,a.default.vErrors),r.unevaluated&&function({gen:e,evaluated:t,props:n,items:i}){n instanceof o.Name&&e.assign(o._`${t}.props`,n);i instanceof o.Name&&e.assign(o._`${t}.items`,i)}(e),t.return(o._`${a.default.errors} === 0`))}(e)})}(e):h(e,()=>i.topBoolOrEmptySchema(e))},t.subschemaCode=function(e,t){p(e)&&(f(e),d(e))?function(e,t){const{schema:n,gen:i,opts:s}=e;s.$comment&&n.$comment&&g(e);(function(e){e.schema.$id&&(e.baseId=l.resolveUrl(e.baseId,e.schema.$id))})(e),function(e){if(e.schema.$async&&!e.schemaEnv.$async)throw new Error("async schema in sync schema")}(e);const r=i.const("_errs",a.default.errors);m(e,r),i.var(t,o._`${r} === ${a.default.errors}`)}(e,t):i.boolOrEmptySchema(e,t)},t.schemaCxtHasRules=d,t.checkStrictMode=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s={data:new i.Name("data"),valCxt:new i.Name("valCxt"),dataPath:new i.Name("dataPath"),parentData:new i.Name("parentData"),parentDataProperty:new i.Name("parentDataProperty"),rootData:new i.Name("rootData"),dynamicAnchors:new i.Name("dynamicAnchors"),vErrors:new i.Name("vErrors"),errors:new i.Name("errors"),this:new i.Name("this"),self:new i.Name("self"),scope:new i.Name("scope"),json:new i.Name("json"),jsonPos:new i.Name("jsonPos"),jsonLen:new i.Name("jsonLen"),jsonPart:new i.Name("jsonPart")};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateUnion=t.validateArray=t.usePattern=t.callValidateCode=t.schemaProperties=t.allSchemaProperties=t.noPropertyInData=t.propertyInData=t.isOwnProperty=t.hasPropFunc=t.reportMissingProp=t.checkMissingProp=t.checkReportMissingProp=void 0;const i=n(1),s=n(2),r=n(6),o=n(4);function a(e){return e.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:i._`Object.prototype.hasOwnProperty`})}function l(e,t,n){return i._`${a(e)}.call(${t}, ${n})`}function c(e,t,n,s){const r=i._`${t}${i.getProperty(n)} === undefined`;return s?i._`${r} || !${l(e,t,n)}`:r}function h(e){return e?Object.keys(e).filter(e=>"__proto__"!==e):[]}t.checkReportMissingProp=function(e,t){const{gen:n,data:s,it:r}=e;n.if(c(n,s,t,r.opts.ownProperties),()=>{e.setParams({missingProperty:i._`${t}`},!0),e.error()})},t.checkMissingProp=function({gen:e,data:t,it:{opts:n}},s,r){return i.or(...s.map(s=>i._`${c(e,t,s,n.ownProperties)} && (${r} = ${s})`))},t.reportMissingProp=function(e,t){e.setParams({missingProperty:t},!0),e.error()},t.hasPropFunc=a,t.isOwnProperty=l,t.propertyInData=function(e,t,n,s){const r=i._`${t}${i.getProperty(n)} !== undefined`;return s?i._`${r} && ${l(e,t,n)}`:r},t.noPropertyInData=c,t.allSchemaProperties=h,t.schemaProperties=function(e,t){return h(t).filter(n=>!s.alwaysValidSchema(e,t[n]))},t.callValidateCode=function({schemaCode:e,data:t,it:{gen:n,topSchemaRef:s,schemaPath:r,errorPath:a},it:l},c,h,u){const d=u?i._`${e}, ${t}, ${s}${r}`:t,p=[[o.default.dataPath,i.strConcat(o.default.dataPath,a)],[o.default.parentData,l.parentData],[o.default.parentDataProperty,l.parentDataProperty],[o.default.rootData,o.default.rootData]];l.opts.dynamicRef&&p.push([o.default.dynamicAnchors,o.default.dynamicAnchors]);const f=i._`${d}, ${n.object(...p)}`;return h!==i.nil?i._`${c}.call(${h}, ${f})`:i._`${c}(${f})`},t.usePattern=function(e,t){return e.scopeValue("pattern",{key:t,ref:new RegExp(t,"u"),code:i._`new RegExp(${t}, "u")`})},t.validateArray=function(e){const{gen:t,data:n,keyword:s,it:o}=e,a=t.name("valid");if(o.allErrors){const e=t.let("valid",!0);return l(()=>t.assign(e,!1)),e}return t.var(a,!0),l(()=>t.break()),a;function l(o){const l=t.const("len",i._`${n}.length`);t.forRange("i",0,l,n=>{e.subschema({keyword:s,dataProp:n,dataPropType:r.Type.Num},a),t.if(i.not(a),o)})}},t.validateUnion=function(e){const{gen:t,schema:n,keyword:r,it:o}=e;if(!Array.isArray(n))throw new Error("ajv implementation error");if(n.some(e=>s.alwaysValidSchema(o,e))&&!o.opts.unevaluated)return;const a=t.let("valid",!1),l=t.name("_valid");t.block(()=>n.forEach((n,s)=>{const o=e.subschema({keyword:r,schemaProp:s,compositeRule:!0},l);t.assign(a,i._`${a} || ${l}`);e.mergeValidEvaluated(o,l)||t.if(i.not(a))})),e.result(a,()=>e.reset(),()=>e.error(!0))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applySubschema=t.Type=void 0;const i=n(3),s=n(2),r=n(1);var o;!function(e){e[e.Num=0]="Num",e[e.Str=1]="Str"}(o=t.Type||(t.Type={})),t.applySubschema=function(e,t,n){const a=function(e,{keyword:t,schemaProp:n,schema:i,schemaPath:o,errSchemaPath:a,topSchemaRef:l}){if(void 0!==t&&void 0!==i)throw new Error('both "keyword" and "schema" passed, only one allowed');if(void 0!==t){const i=e.schema[t];return void 0===n?{schema:i,schemaPath:r._`${e.schemaPath}${r.getProperty(t)}`,errSchemaPath:`${e.errSchemaPath}/${t}`}:{schema:i[n],schemaPath:r._`${e.schemaPath}${r.getProperty(t)}${r.getProperty(n)}`,errSchemaPath:`${e.errSchemaPath}/${t}/${s.escapeFragment(n)}`}}if(void 0!==i){if(void 0===o||void 0===a||void 0===l)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:i,schemaPath:o,topSchemaRef:l,errSchemaPath:a}}throw new Error('either "keyword" or "schema" must be passed')}(e,t);!function(e,t,{dataProp:n,dataPropType:i,data:a,dataTypes:l,propertyName:c}){if(void 0!==a&&void 0!==n)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:h}=t;if(void 0!==n){const{errorPath:a,dataPathArr:l,opts:c}=t;u(h.let("data",r._`${t.data}${r.getProperty(n)}`,!0)),e.errorPath=r.str`${a}${function(e,t,n){if(e instanceof r.Name){const i=t===o.Num;return n?i?r._`"[" + ${e} + "]"`:r._`"['" + ${e} + "']"`:i?r._`"/" + ${e}`:r._`"/" + ${e}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return n?r.getProperty(e).toString():"/"+s.escapeJsonPointer(e)}(n,i,c.jsPropertySyntax)}`,e.parentDataProperty=r._`${n}`,e.dataPathArr=[...l,e.parentDataProperty]}if(void 0!==a){u(a instanceof r.Name?a:h.let("data",a,!0)),void 0!==c&&(e.propertyName=c)}l&&(e.dataTypes=l);function u(n){e.data=n,e.dataLevel=t.dataLevel+1,e.dataTypes=[],t.definedProperties=new Set,e.parentData=t.data,e.dataNames=[...t.dataNames,n]}}(a,e,t),function(e,{jtdDiscriminator:t,jtdMetadata:n,compositeRule:i,createErrors:s,allErrors:r}){void 0!==i&&(e.compositeRule=i);void 0!==s&&(e.createErrors=s);void 0!==r&&(e.allErrors=r);e.jtdDiscriminator=t,e.jtdMetadata=n}(a,t);const l={...e,...a,items:void 0,props:void 0};return i.subschemaCode(l,n),l}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reportTypeError=t.checkDataTypes=t.checkDataType=t.coerceAndCheckDataType=t.getJSONTypes=t.getSchemaTypes=t.DataType=void 0;const i=n(14),s=n(15),r=n(9),o=n(1),a=n(2);var l;function c(e){const t=Array.isArray(e)?e:e?[e]:[];if(t.every(i.isJSONType))return t;throw new Error("type must be JSONType or JSONType[]: "+t.join(","))}!function(e){e[e.Correct=0]="Correct",e[e.Wrong=1]="Wrong"}(l=t.DataType||(t.DataType={})),t.getSchemaTypes=function(e){const t=c(e.type);if(t.includes("null")){if(!1===e.nullable)throw new Error("type: null contradicts nullable: false")}else{if(!t.length&&void 0!==e.nullable)throw new Error('"nullable" cannot be used without "type"');!0===e.nullable&&t.push("null")}return t},t.getJSONTypes=c,t.coerceAndCheckDataType=function(e,t){const{gen:n,data:i,opts:r}=e,a=function(e,t){return t?e.filter(e=>h.has(e)||"array"===t&&"array"===e):[]}(t,r.coerceTypes),c=t.length>0&&!(0===a.length&&1===t.length&&s.schemaHasRulesForType(e,t[0]));if(c){const s=d(t,i,r.strict,l.Wrong);n.if(s,()=>{a.length?function(e,t,n){const{gen:i,data:s,opts:r}=e,a=i.let("dataType",o._`typeof ${s}`),l=i.let("coerced",o._`undefined`);"array"===r.coerceTypes&&i.if(o._`${a} == 'object' && Array.isArray(${s}) && ${s}.length == 1`,()=>i.assign(s,o._`${s}[0]`).assign(a,o._`typeof ${s}`).if(d(t,s,r.strict),()=>i.assign(l,s)));i.if(o._`${l} !== undefined`);for(const e of n)(h.has(e)||"array"===e&&"array"===r.coerceTypes)&&c(e);function c(e){switch(e){case"string":return void i.elseIf(o._`${a} == "number" || ${a} == "boolean"`).assign(l,o._`"" + ${s}`).elseIf(o._`${s} === null`).assign(l,o._`""`);case"number":return void i.elseIf(o._`${a} == "boolean" || ${s} === null
              || (${a} == "string" && ${s} && ${s} == +${s})`).assign(l,o._`+${s}`);case"integer":return void i.elseIf(o._`${a} === "boolean" || ${s} === null
              || (${a} === "string" && ${s} && ${s} == +${s} && !(${s} % 1))`).assign(l,o._`+${s}`);case"boolean":return void i.elseIf(o._`${s} === "false" || ${s} === 0 || ${s} === null`).assign(l,!1).elseIf(o._`${s} === "true" || ${s} === 1`).assign(l,!0);case"null":return i.elseIf(o._`${s} === "" || ${s} === 0 || ${s} === false`),void i.assign(l,null);case"array":i.elseIf(o._`${a} === "string" || ${a} === "number"
              || ${a} === "boolean" || ${s} === null`).assign(l,o._`[${s}]`)}}i.else(),f(e),i.endIf(),i.if(o._`${l} !== undefined`,()=>{i.assign(s,l),function({gen:e,parentData:t,parentDataProperty:n},i){e.if(o._`${t} !== undefined`,()=>e.assign(o._`${t}[${n}]`,i))}(e,l)})}(e,t,a):f(e)})}return c};const h=new Set(["string","number","integer","boolean","null"]);function u(e,t,n,i=l.Correct){const s=i===l.Correct?o.operators.EQ:o.operators.NEQ;let r;switch(e){case"null":return o._`${t} ${s} null`;case"array":r=o._`Array.isArray(${t})`;break;case"object":r=o._`${t} && typeof ${t} == "object" && !Array.isArray(${t})`;break;case"integer":r=a(o._`!(${t} % 1) && !isNaN(${t})`);break;case"number":r=a();break;default:return o._`typeof ${t} ${s} ${e}`}return i===l.Correct?r:o.not(r);function a(e=o.nil){return o.and(o._`typeof ${t} == "number"`,e,n?o._`isFinite(${t})`:o.nil)}}function d(e,t,n,i){if(1===e.length)return u(e[0],t,n,i);let s;const r=a.toHash(e);if(r.array&&r.object){const e=o._`typeof ${t} != "object"`;s=r.null?e:o._`!${t} || ${e}`,delete r.null,delete r.array,delete r.object}else s=o.nil;r.number&&delete r.integer;for(const e in r)s=o.and(s,u(e,t,n,i));return s}t.checkDataType=u,t.checkDataTypes=d;const p={message:({schema:e})=>o.str`should be ${e}`,params:({schema:e,schemaValue:t})=>"string"==typeof e?o._`{type: ${e}}`:o._`{type: ${t}}`};function f(e){const t=function(e){const{gen:t,data:n,schema:i}=e,s=a.schemaRefOrVal(e,i,"type");return{gen:t,keyword:"type",data:n,schema:i.type,schemaCode:s,schemaValue:s,parentSchema:i,params:{},it:e}}(e);r.reportError(t,p)}t.reportTypeError=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getData=void 0;const i=n(7),s=n(2),r=n(9),o=n(1),a=n(4),l=n(6);t.default=class{constructor(e,t,n){if(function({schema:e,opts:t,self:n},i,s){if(Array.isArray(i.keyword)?!i.keyword.includes(s):i.keyword!==s)throw new Error("ajv implementation error");const r=i.dependencies;if(null==r?void 0:r.some(t=>!Object.prototype.hasOwnProperty.call(e,t)))throw new Error(`parent schema must have dependencies of ${s}: ${r.join(",")}`);if(i.validateSchema){if(!i.validateSchema(e[s])){const e="keyword value is invalid: "+n.errorsText(i.validateSchema.errors);if("log"!==t.validateSchema)throw new Error(e);n.logger.error(e)}}}(e,t,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=t.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=s.schemaRefOrVal(e,this.schema,n,this.$data),this.schemaType=t.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=t,this.$data)this.schemaCode=e.gen.const("vSchema",u(this.$data,e));else if(this.schemaCode=this.schemaValue,!function(e,t,n=!1){return!t.length||t.some(t=>"array"===t?Array.isArray(e):"object"===t?e&&"object"==typeof e&&!Array.isArray(e):typeof e==t||n&&void 0===e)}(this.schema,t.schemaType,t.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(t.schemaType)}`);("code"in t?t.trackErrors:!1!==t.errors)&&(this.errsCount=e.gen.const("_errs",a.default.errors))}result(e,t,n){this.gen.if(o.not(e)),n?n():this.error(),t?(this.gen.else(),t(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,t){this.result(e,void 0,t)}fail(e){if(void 0===e)return this.error(),void(this.allErrors||this.gen.if(!1));this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);const{schemaCode:t}=this;this.fail(o._`${t} !== undefined && (${o.or(this.invalid$data(),e)})`)}error(e){(e?r.reportExtraError:r.reportError)(this,this.def.error)}$dataError(){r.reportError(this,this.def.$dataError||r.keyword$DataError)}reset(){if(void 0===this.errsCount)throw new Error('add "trackErrors" to keyword definition');r.resetErrorsCount(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,t){t?Object.assign(this.params,e):this.params=e}block$data(e,t,n=o.nil){this.gen.block(()=>{this.check$data(e,n),t()})}check$data(e=o.nil,t=o.nil){if(!this.$data)return;const{gen:n,schemaCode:i,schemaType:s,def:r}=this;n.if(o.or(o._`${i} === undefined`,t)),e!==o.nil&&n.assign(e,!0),(s.length||r.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==o.nil&&n.assign(e,!1)),n.else()}invalid$data(){const{gen:e,schemaCode:t,schemaType:n,def:s,it:r}=this;return o.or(function(){if(n.length){if(!(t instanceof o.Name))throw new Error("ajv implementation error");const e=Array.isArray(n)?n:[n];return o._`${i.checkDataTypes(e,t,r.opts.strict,i.DataType.Wrong)}`}return o.nil}(),function(){if(s.validateSchema){const n=e.scopeValue("validate$data",{ref:s.validateSchema});return o._`!${n}(${t})`}return o.nil}())}subschema(e,t){return l.applySubschema(this.it,e,t)}mergeEvaluated(e,t){const{it:n,gen:i}=this;n.opts.unevaluated&&(!0!==n.props&&void 0!==e.props&&(n.props=s.mergeEvaluated.props(i,e.props,n.props,t)),!0!==n.items&&void 0!==e.items&&(n.items=s.mergeEvaluated.items(i,e.items,n.items,t)))}mergeValidEvaluated(e,t){const{it:n,gen:i}=this;if(n.opts.unevaluated&&(!0!==n.props||!0!==n.items))return i.if(t,()=>this.mergeEvaluated(e,o.Name)),!0}};const c=/^\/(?:[^~]|~0|~1)*$/,h=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function u(e,{dataLevel:t,dataNames:n,dataPathArr:i}){let r,l;if(""===e)return a.default.rootData;if("/"===e[0]){if(!c.test(e))throw new Error("Invalid JSON-pointer: "+e);r=e,l=a.default.rootData}else{const s=h.exec(e);if(!s)throw new Error("Invalid JSON-pointer: "+e);const o=+s[1];if(r=s[2],"#"===r){if(o>=t)throw new Error(p("property/index",o));return i[t-o]}if(o>t)throw new Error(p("data",o));if(l=n[t-o],!r)return l}let u=l;const d=r.split("/");for(const e of d)e&&(l=o._`${l}${o.getProperty(s.unescapeJsonPointer(e))}`,u=o._`${u} && ${l}`);return u;function p(e,n){return`Cannot access ${e} ${n} levels up, current level is ${t}`}}t.getData=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extendErrors=t.resetErrorsCount=t.reportExtraError=t.reportError=t.keyword$DataError=t.keywordError=void 0;const i=n(1),s=n(4);function r(e,t){const n=e.const("err",t);e.if(i._`${s.default.vErrors} === null`,()=>e.assign(s.default.vErrors,i._`[${n}]`),i._`${s.default.vErrors}.push(${n})`),e.code(i._`${s.default.errors}++`)}function o(e,t){const{gen:n,validateName:s,schemaEnv:r}=e;r.$async?n.throw(i._`new ${e.ValidationError}(${t})`):(n.assign(i._`${s}.errors`,t),n.return(!1))}t.keywordError={message:({keyword:e})=>i.str`should pass "${e}" keyword validation`},t.keyword$DataError={message:({keyword:e,schemaType:t})=>t?i.str`"${e}" keyword must be ${t} ($data)`:i.str`"${e}" keyword is invalid ($data)`},t.reportError=function(e,n=t.keywordError,s){const{it:a}=e,{gen:c,compositeRule:h,allErrors:u}=a,d=l(e,n);(null!=s?s:h||u)?r(c,d):o(a,i._`[${d}]`)},t.reportExtraError=function(e,n=t.keywordError){const{it:i}=e,{gen:a,compositeRule:c,allErrors:h}=i;r(a,l(e,n)),c||h||o(i,s.default.vErrors)},t.resetErrorsCount=function(e,t){e.assign(s.default.errors,t),e.if(i._`${s.default.vErrors} !== null`,()=>e.if(t,()=>e.assign(i._`${s.default.vErrors}.length`,t),()=>e.assign(s.default.vErrors,null)))},t.extendErrors=function({gen:e,keyword:t,schemaValue:n,data:r,errsCount:o,it:a}){if(void 0===o)throw new Error("ajv implementation error");const l=e.name("err");e.forRange("i",o,s.default.errors,o=>{e.const(l,i._`${s.default.vErrors}[${o}]`),e.if(i._`${l}.dataPath === undefined`,()=>e.assign(i._`${l}.dataPath`,i.strConcat(s.default.dataPath,a.errorPath))),e.assign(i._`${l}.schemaPath`,i.str`${a.errSchemaPath}/${t}`),a.opts.verbose&&(e.assign(i._`${l}.schema`,n),e.assign(i._`${l}.data`,r))})};const a={keyword:new i.Name("keyword"),schemaPath:new i.Name("schemaPath"),params:new i.Name("params"),propertyName:new i.Name("propertyName"),message:new i.Name("message"),schema:new i.Name("schema"),parentSchema:new i.Name("parentSchema"),instancePath:new i.Name("instancePath")};function l(e,t){const{createErrors:n,opts:s}=e.it;return!1===n?i._`{}`:(s.jtd&&!s.ajvErrors?c:h)(e,t)}function c(e,{message:t}){const{gen:n,keyword:r,it:o}=e,{errorPath:l,errSchemaPath:c,opts:h}=o,u=[[a.instancePath,i.strConcat(s.default.dataPath,l)],[a.schemaPath,i.str`${c}/${r}`]];return h.messages&&u.push([a.message,"function"==typeof t?t(e):t]),n.object(...u)}function h(e,t){const{gen:n,keyword:r,data:o,schemaValue:l,it:c}=e,{topSchemaRef:h,schemaPath:u,errorPath:d,errSchemaPath:p,propertyName:f,opts:m}=c,{params:g,message:v}=t,y=[[a.keyword,r],[s.default.dataPath,i.strConcat(s.default.dataPath,d)],[a.schemaPath,i.str`${p}/${r}`],[a.params,"function"==typeof g?g(e):g||i._`{}`]];return f&&y.push([a.propertyName,f]),m.messages&&y.push([a.message,"function"==typeof v?v(e):v]),m.verbose&&y.push([a.schema,l],[a.parentSchema,i._`${h}${u}`],[s.default.data,o]),n.object(...y)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSchemaRefs=t.resolveUrl=t.normalizeId=t._getFullPath=t.getFullPath=t.inlineRef=void 0;const i=n(2),s=n(11),r=n(47),o=n(17),a=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);t.inlineRef=function(e,t=!0){return"boolean"==typeof e||(!0===t?!c(e):!!t&&function e(t){let n=0;for(const s in t){if("$ref"===s)return 1/0;if(n++,!a.has(s)&&("object"==typeof t[s]&&i.eachItem(t[s],t=>n+=e(t)),n===1/0))return 1/0}return n}(e)<=t)};const l=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function c(e){for(const t in e){if(l.has(t))return!0;const n=e[t];if(Array.isArray(n)&&n.some(c))return!0;if("object"==typeof n&&c(n))return!0}return!1}function h(e="",t){!1!==t&&(e=p(e));return u(o.parse(e))}function u(e){return o.serialize(e).split("#")[0]+"#"}t.getFullPath=h,t._getFullPath=u;const d=/#\/?$/;function p(e){return e?e.replace(d,""):""}t.normalizeId=p,t.resolveUrl=function(e,t){return t=p(t),o.resolve(e,t)};const f=/^[a-z_][-a-z0-9._]*$/i;t.getSchemaRefs=function(e){if("boolean"==typeof e)return{};const t=p(e.$id),n={"":t},i=h(t,!1),a={},l=new Set;return r(e,{allKeys:!0},(e,t,s,r)=>{if(void 0===r)return;const h=i+t;let d=n[r];function m(t){if(t=p(d?o.resolve(d,t):t),l.has(t))throw u(t);l.add(t);let n=this.refs[t];return"string"==typeof n&&(n=this.refs[n]),"object"==typeof n?c(e,n.schema,t):t!==p(h)&&("#"===t[0]?(c(e,a[t],t),a[t]=e):this.refs[t]=h),t}function g(e){if("string"==typeof e){if(!f.test(e))throw new Error(`invalid anchor "${e}"`);m.call(this,"#"+e)}}"string"==typeof e.$id&&(d=m.call(this,e.$id)),g.call(this,e.$anchor),g.call(this,e.$dynamicAnchor),n[t]=d}),a;function c(e,t,n){if(void 0!==t&&!s(e,t))throw u(n)}function u(e){return new Error(`reference "${e}" resolves to more than one schema`)}}},function(e,t,n){"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var i,s,r;if(Array.isArray(t)){if((i=t.length)!=n.length)return!1;for(s=i;0!=s--;)if(!e(t[s],n[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((i=(r=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(s=i;0!=s--;)if(!Object.prototype.hasOwnProperty.call(n,r[s]))return!1;for(s=i;0!=s--;){var o=r[s];if(!e(t[o],n[o]))return!1}return!0}return t!=t&&n!=n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProperty=t.safeStringify=t.stringify=t.strConcat=t.addCodeArg=t.str=t._=t.nil=t._Code=t.Name=t.IDENTIFIER=t._CodeOrName=void 0;class i{}t._CodeOrName=i,t.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class s extends i{constructor(e){if(super(),!t.IDENTIFIER.test(e))throw new Error("CodeGen: name must be a valid identifier");this.str=e}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}t.Name=s;class r extends i{constructor(e){super(),this._items="string"==typeof e?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const e=this._items[0];return""===e||'""'===e}get str(){var e;return null!==(e=this._str)&&void 0!==e?e:this._str=this._items.reduce((e,t)=>`${e}${t}`,"")}get names(){var e;return null!==(e=this._names)&&void 0!==e?e:this._names=this._items.reduce((e,t)=>(t instanceof s&&(e[t.str]=(e[t.str]||0)+1),e),{})}}function o(e,...t){const n=[e[0]];let i=0;for(;i<t.length;)c(n,t[i]),n.push(e[++i]);return new r(n)}t._Code=r,t.nil=new r(""),t._=o;const a=new r("+");function l(e,...t){const n=[u(e[0])];let i=0;for(;i<t.length;)n.push(a),c(n,t[i]),n.push(a,u(e[++i]));return function(e){let t=1;for(;t<e.length-1;){if(e[t]===a){const n=h(e[t-1],e[t+1]);if(void 0!==n){e.splice(t-1,3,n);continue}e[t++]="+"}t++}}(n),new r(n)}function c(e,t){var n;t instanceof r?e.push(...t._items):t instanceof s?e.push(t):e.push("number"==typeof(n=t)||"boolean"==typeof n||null===n?n:u(Array.isArray(n)?n.join(","):n))}function h(e,t){if('""'===t)return e;if('""'===e)return t;if("string"==typeof e){if(t instanceof s||'"'!==e[e.length-1])return;return"string"!=typeof t?`${e.slice(0,-1)}${t}"`:'"'===t[0]?e.slice(0,-1)+t.slice(1):void 0}return"string"!=typeof t||'"'!==t[0]||e instanceof s?void 0:`"${e}${t.slice(1)}`}function u(e){return JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}t.str=l,t.addCodeArg=c,t.strConcat=function(e,t){return t.emptyStr()?e:e.emptyStr()?t:l`${e}${t}`},t.stringify=function(e){return new r(u(e))},t.safeStringify=u,t.getProperty=function(e){return"string"==typeof e&&t.IDENTIFIER.test(e)?new r("."+e):o`[${e}]`}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRefError=t.ValidationError=void 0;const i=n(10);class s extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}}t.ValidationError=s;class r extends Error{constructor(e,t,n){super(n||`can't resolve reference ${t} from id ${e}`),this.missingRef=i.resolveUrl(e,t),this.missingSchema=i.normalizeId(i.getFullPath(this.missingRef))}}t.MissingRefError=r,e.exports={ValidationError:s,MissingRefError:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRules=t.isJSONType=void 0;const i=new Set(["string","number","integer","boolean","null","object","array"]);t.isJSONType=function(e){return"string"==typeof e&&i.has(e)},t.getRules=function(){const e={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...e,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},e.number,e.string,e.array,e.object],post:{rules:[]},all:{},keywords:{}}}},function(e,t,n){"use strict";function i(e,t){return t.rules.some(t=>s(e,t))}function s(e,t){var n;return void 0!==e[t.keyword]||(null===(n=t.definition.implements)||void 0===n?void 0:n.some(t=>void 0!==e[t]))}Object.defineProperty(t,"__esModule",{value:!0}),t.shouldUseRule=t.shouldUseGroup=t.schemaHasRulesForType=void 0,t.schemaHasRulesForType=function({schema:e,self:t},n){const s=t.RULES.types[n];return s&&!0!==s&&i(e,s)},t.shouldUseGroup=i,t.shouldUseRule=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ValueScope=t.ValueScopeName=t.Scope=t.varKinds=t.UsedValueState=void 0;const i=n(12);class s extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}}var r;!function(e){e[e.Started=0]="Started",e[e.Completed=1]="Completed"}(r=t.UsedValueState||(t.UsedValueState={})),t.varKinds={const:new i.Name("const"),let:new i.Name("let"),var:new i.Name("var")};class o{constructor({prefixes:e,parent:t}={}){this._names={},this._prefixes=e,this._parent=t}toName(e){return e instanceof i.Name?e:this.name(e)}name(e){return new i.Name(this._newName(e))}_newName(e){return`${e}${(this._names[e]||this._nameGroup(e)).index++}`}_nameGroup(e){var t,n;if((null===(n=null===(t=this._parent)||void 0===t?void 0:t._prefixes)||void 0===n?void 0:n.has(e))||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}}t.Scope=o;class a extends i.Name{constructor(e,t){super(t),this.prefix=e}setValue(e,{property:t,itemIndex:n}){this.value=e,this.scopePath=i._`.${new i.Name(t)}[${n}]`}}t.ValueScopeName=a;const l=i._`\n`;t.ValueScope=class extends o{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?l:i.nil}}get(){return this._scope}name(e){return new a(e,this._newName(e))}value(e,t){var n;if(void 0===t.ref)throw new Error("CodeGen: ref must be passed in value");const i=this.toName(e),{prefix:s}=i,r=null!==(n=t.key)&&void 0!==n?n:t.ref;let o=this._values[s];if(o){const e=o.get(r);if(e)return e}else o=this._values[s]=new Map;o.set(r,i);const a=this._scope[s]||(this._scope[s]=[]),l=a.length;return a[l]=t.ref,i.setValue(t,{property:s,itemIndex:l}),i}getValue(e,t){const n=this._values[e];if(n)return n.get(t)}scopeRefs(e,t=this._values){return this._reduceValues(t,t=>{if(void 0===t.scopePath)throw new Error(`CodeGen: name "${t}" has no value`);return i._`${e}${t.scopePath}`})}scopeCode(e=this._values,t,n){return this._reduceValues(e,e=>{if(void 0===e.value)throw new Error(`CodeGen: name "${e}" has no value`);return e.value.code},t,n)}_reduceValues(e,n,o={},a){let l=i.nil;for(const c in e){const h=e[c];if(!h)continue;const u=o[c]=o[c]||new Map;h.forEach(e=>{if(u.has(e))return;u.set(e,r.Started);let o=n(e);if(o){const n=this.opts.es5?t.varKinds.var:t.varKinds.const;l=i._`${l}${n} ${e} = ${o};${this.opts._n}`}else{if(!(o=null==a?void 0:a(e)))throw new s(e);l=i._`${l}${o}${this.opts._n}`}u.set(e,r.Completed)})}return l}}},function(e,t,n){!function(e){"use strict";function t(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length>1){t[0]=t[0].slice(0,-1);for(var i=t.length-1,s=1;s<i;++s)t[s]=t[s].slice(1,-1);return t[i]=t[i].slice(1),t.join("")}return t[0]}function n(e){return"(?:"+e+")"}function i(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).split(" ").pop().split("]").shift().toLowerCase()}function s(e){return e.toUpperCase()}function r(e){var i=t("[0-9]","[A-Fa-f]"),s=n(n("%[EFef]"+i+"%"+i+i+"%"+i+i)+"|"+n("%[89A-Fa-f]"+i+"%"+i+i)+"|"+n("%"+i+i)),r="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",o=t("[\\:\\/\\?\\#\\[\\]\\@]",r),a=e?"[\\uE000-\\uF8FF]":"[]",l=t("[A-Za-z]","[0-9]","[\\-\\.\\_\\~]",e?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]"),c=n("[A-Za-z]"+t("[A-Za-z]","[0-9]","[\\+\\-\\.]")+"*"),h=n(n(s+"|"+t(l,r,"[\\:]"))+"*"),u=(n(n("25[0-5]")+"|"+n("2[0-4][0-9]")+"|"+n("1[0-9][0-9]")+"|"+n("[1-9][0-9]")+"|[0-9]"),n(n("25[0-5]")+"|"+n("2[0-4][0-9]")+"|"+n("1[0-9][0-9]")+"|"+n("0?[1-9][0-9]")+"|0?0?[0-9]")),d=n(u+"\\."+u+"\\."+u+"\\."+u),p=n(i+"{1,4}"),f=n(n(p+"\\:"+p)+"|"+d),m=n(n(p+"\\:")+"{6}"+f),g=n("\\:\\:"+n(p+"\\:")+"{5}"+f),v=n(n(p)+"?\\:\\:"+n(p+"\\:")+"{4}"+f),y=n(n(n(p+"\\:")+"{0,1}"+p)+"?\\:\\:"+n(p+"\\:")+"{3}"+f),b=n(n(n(p+"\\:")+"{0,2}"+p)+"?\\:\\:"+n(p+"\\:")+"{2}"+f),x=n(n(n(p+"\\:")+"{0,3}"+p)+"?\\:\\:"+p+"\\:"+f),_=n(n(n(p+"\\:")+"{0,4}"+p)+"?\\:\\:"+f),w=n(n(n(p+"\\:")+"{0,5}"+p)+"?\\:\\:"+p),S=n(n(n(p+"\\:")+"{0,6}"+p)+"?\\:\\:"),M=n([m,g,v,y,b,x,_,w,S].join("|")),E=n(n(l+"|"+s)+"+"),T=(n(M+"\\%25"+E),n(M+n("\\%25|\\%(?!"+i+"{2})")+E)),C=n("[vV]"+i+"+\\."+t(l,r,"[\\:]")+"+"),A=n("\\["+n(T+"|"+M+"|"+C)+"\\]"),P=n(n(s+"|"+t(l,r))+"*"),L=n(A+"|"+d+"(?!"+P+")|"+P),R=n("[0-9]*"),N=n(n(h+"@")+"?"+L+n("\\:"+R)+"?"),D=n(s+"|"+t(l,r,"[\\:\\@]")),O=n(D+"*"),k=n(D+"+"),I=n(n(s+"|"+t(l,r,"[\\@]"))+"+"),z=n(n("\\/"+O)+"*"),U=n("\\/"+n(k+z)+"?"),F=n(I+z),V=n(k+z),B="(?!"+D+")",j=(n(z+"|"+U+"|"+F+"|"+V+"|"+B),n(n(D+"|"+t("[\\/\\?]",a))+"*")),$=n(n(D+"|[\\/\\?]")+"*"),G=n(n("\\/\\/"+N+z)+"|"+U+"|"+V+"|"+B),H=n(c+"\\:"+G+n("\\?"+j)+"?"+n("\\#"+$)+"?"),W=n(n("\\/\\/"+N+z)+"|"+U+"|"+F+"|"+B),q=n(W+n("\\?"+j)+"?"+n("\\#"+$)+"?");return n(H+"|"+q),n(c+"\\:"+G+n("\\?"+j)+"?"),n(n("\\/\\/("+n("("+h+")@")+"?("+L+")"+n("\\:("+R+")")+"?)")+"?("+z+"|"+U+"|"+V+"|"+B+")"),n("\\?("+j+")"),n("\\#("+$+")"),n(n("\\/\\/("+n("("+h+")@")+"?("+L+")"+n("\\:("+R+")")+"?)")+"?("+z+"|"+U+"|"+F+"|"+B+")"),n("\\?("+j+")"),n("\\#("+$+")"),n(n("\\/\\/("+n("("+h+")@")+"?("+L+")"+n("\\:("+R+")")+"?)")+"?("+z+"|"+U+"|"+V+"|"+B+")"),n("\\?("+j+")"),n("\\#("+$+")"),n("("+h+")@"),n("\\:("+R+")"),{NOT_SCHEME:new RegExp(t("[^]","[A-Za-z]","[0-9]","[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(t("[^\\%\\:]",l,r),"g"),NOT_HOST:new RegExp(t("[^\\%\\[\\]\\:]",l,r),"g"),NOT_PATH:new RegExp(t("[^\\%\\/\\:\\@]",l,r),"g"),NOT_PATH_NOSCHEME:new RegExp(t("[^\\%\\/\\@]",l,r),"g"),NOT_QUERY:new RegExp(t("[^\\%]",l,r,"[\\:\\@\\/\\?]",a),"g"),NOT_FRAGMENT:new RegExp(t("[^\\%]",l,r,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(t("[^]",l,r),"g"),UNRESERVED:new RegExp(l,"g"),OTHER_CHARS:new RegExp(t("[^\\%]",l,o),"g"),PCT_ENCODED:new RegExp(s,"g"),IPV4ADDRESS:new RegExp("^("+d+")$"),IPV6ADDRESS:new RegExp("^\\[?("+M+")"+n(n("\\%25|\\%(?!"+i+"{2})")+"("+E+")")+"?\\]?$")}}var o=r(!1),a=r(!0),l=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,s=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){s=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(s)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},c=2147483647,h=/^xn--/,u=/[^\0-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,m=String.fromCharCode;function g(e){throw new RangeError(p[e])}function v(e,t){var n=e.split("@"),i="";n.length>1&&(i=n[0]+"@",e=n[1]);var s=function(e,t){for(var n=[],i=e.length;i--;)n[i]=t(e[i]);return n}((e=e.replace(d,".")).split("."),t).join(".");return i+s}function y(e){for(var t=[],n=0,i=e.length;n<i;){var s=e.charCodeAt(n++);if(s>=55296&&s<=56319&&n<i){var r=e.charCodeAt(n++);56320==(64512&r)?t.push(((1023&s)<<10)+(1023&r)+65536):(t.push(s),n--)}else t.push(s)}return t}var b=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},x=function(e,t,n){var i=0;for(e=n?f(e/700):e>>1,e+=f(e/t);e>455;i+=36)e=f(e/35);return f(i+36*e/(e+38))},_=function(e){var t,n=[],i=e.length,s=0,r=128,o=72,a=e.lastIndexOf("-");a<0&&(a=0);for(var l=0;l<a;++l)e.charCodeAt(l)>=128&&g("not-basic"),n.push(e.charCodeAt(l));for(var h=a>0?a+1:0;h<i;){for(var u=s,d=1,p=36;;p+=36){h>=i&&g("invalid-input");var m=(t=e.charCodeAt(h++))-48<10?t-22:t-65<26?t-65:t-97<26?t-97:36;(m>=36||m>f((c-s)/d))&&g("overflow"),s+=m*d;var v=p<=o?1:p>=o+26?26:p-o;if(m<v)break;var y=36-v;d>f(c/y)&&g("overflow"),d*=y}var b=n.length+1;o=x(s-u,b,0==u),f(s/b)>c-r&&g("overflow"),r+=f(s/b),s%=b,n.splice(s++,0,r)}return String.fromCodePoint.apply(String,n)},w=function(e){var t=[],n=(e=y(e)).length,i=128,s=0,r=72,o=!0,a=!1,l=void 0;try{for(var h,u=e[Symbol.iterator]();!(o=(h=u.next()).done);o=!0){var d=h.value;d<128&&t.push(m(d))}}catch(e){a=!0,l=e}finally{try{!o&&u.return&&u.return()}finally{if(a)throw l}}var p=t.length,v=p;for(p&&t.push("-");v<n;){var _=c,w=!0,S=!1,M=void 0;try{for(var E,T=e[Symbol.iterator]();!(w=(E=T.next()).done);w=!0){var C=E.value;C>=i&&C<_&&(_=C)}}catch(e){S=!0,M=e}finally{try{!w&&T.return&&T.return()}finally{if(S)throw M}}var A=v+1;_-i>f((c-s)/A)&&g("overflow"),s+=(_-i)*A,i=_;var P=!0,L=!1,R=void 0;try{for(var N,D=e[Symbol.iterator]();!(P=(N=D.next()).done);P=!0){var O=N.value;if(O<i&&++s>c&&g("overflow"),O==i){for(var k=s,I=36;;I+=36){var z=I<=r?1:I>=r+26?26:I-r;if(k<z)break;var U=k-z,F=36-z;t.push(m(b(z+U%F,0))),k=f(U/F)}t.push(m(b(k,0))),r=x(s,A,v==p),s=0,++v}}}catch(e){L=!0,R=e}finally{try{!P&&D.return&&D.return()}finally{if(L)throw R}}++s,++i}return t.join("")},S=function(e){return v(e,(function(e){return u.test(e)?"xn--"+w(e):e}))},M=function(e){return v(e,(function(e){return h.test(e)?_(e.slice(4).toLowerCase()):e}))},E={};function T(e){var t=e.charCodeAt(0);return t<16?"%0"+t.toString(16).toUpperCase():t<128?"%"+t.toString(16).toUpperCase():t<2048?"%"+(t>>6|192).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase():"%"+(t>>12|224).toString(16).toUpperCase()+"%"+(t>>6&63|128).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase()}function C(e){for(var t="",n=0,i=e.length;n<i;){var s=parseInt(e.substr(n+1,2),16);if(s<128)t+=String.fromCharCode(s),n+=3;else if(s>=194&&s<224){if(i-n>=6){var r=parseInt(e.substr(n+4,2),16);t+=String.fromCharCode((31&s)<<6|63&r)}else t+=e.substr(n,6);n+=6}else if(s>=224){if(i-n>=9){var o=parseInt(e.substr(n+4,2),16),a=parseInt(e.substr(n+7,2),16);t+=String.fromCharCode((15&s)<<12|(63&o)<<6|63&a)}else t+=e.substr(n,9);n+=9}else t+=e.substr(n,3),n+=3}return t}function A(e,t){function n(e){var n=C(e);return n.match(t.UNRESERVED)?n:e}return e.scheme&&(e.scheme=String(e.scheme).replace(t.PCT_ENCODED,n).toLowerCase().replace(t.NOT_SCHEME,"")),void 0!==e.userinfo&&(e.userinfo=String(e.userinfo).replace(t.PCT_ENCODED,n).replace(t.NOT_USERINFO,T).replace(t.PCT_ENCODED,s)),void 0!==e.host&&(e.host=String(e.host).replace(t.PCT_ENCODED,n).toLowerCase().replace(t.NOT_HOST,T).replace(t.PCT_ENCODED,s)),void 0!==e.path&&(e.path=String(e.path).replace(t.PCT_ENCODED,n).replace(e.scheme?t.NOT_PATH:t.NOT_PATH_NOSCHEME,T).replace(t.PCT_ENCODED,s)),void 0!==e.query&&(e.query=String(e.query).replace(t.PCT_ENCODED,n).replace(t.NOT_QUERY,T).replace(t.PCT_ENCODED,s)),void 0!==e.fragment&&(e.fragment=String(e.fragment).replace(t.PCT_ENCODED,n).replace(t.NOT_FRAGMENT,T).replace(t.PCT_ENCODED,s)),e}function P(e){return e.replace(/^0*(.*)/,"$1")||"0"}function L(e,t){var n=e.match(t.IPV4ADDRESS)||[],i=l(n,2)[1];return i?i.split(".").map(P).join("."):e}function R(e,t){var n=e.match(t.IPV6ADDRESS)||[],i=l(n,3),s=i[1],r=i[2];if(s){for(var o=s.toLowerCase().split("::").reverse(),a=l(o,2),c=a[0],h=a[1],u=h?h.split(":").map(P):[],d=c.split(":").map(P),p=t.IPV4ADDRESS.test(d[d.length-1]),f=p?7:8,m=d.length-f,g=Array(f),v=0;v<f;++v)g[v]=u[v]||d[m+v]||"";p&&(g[f-1]=L(g[f-1],t));var y=g.reduce((function(e,t,n){if(!t||"0"===t){var i=e[e.length-1];i&&i.index+i.length===n?i.length++:e.push({index:n,length:1})}return e}),[]).sort((function(e,t){return t.length-e.length}))[0],b=void 0;if(y&&y.length>1){var x=g.slice(0,y.index),_=g.slice(y.index+y.length);b=x.join(":")+"::"+_.join(":")}else b=g.join(":");return r&&(b+="%"+r),b}return e}var N=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,D=void 0==="".match(/(){0}/)[1];function O(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},i=!1!==t.iri?a:o;"suffix"===t.reference&&(e=(t.scheme?t.scheme+":":"")+"//"+e);var s=e.match(N);if(s){D?(n.scheme=s[1],n.userinfo=s[3],n.host=s[4],n.port=parseInt(s[5],10),n.path=s[6]||"",n.query=s[7],n.fragment=s[8],isNaN(n.port)&&(n.port=s[5])):(n.scheme=s[1]||void 0,n.userinfo=-1!==e.indexOf("@")?s[3]:void 0,n.host=-1!==e.indexOf("//")?s[4]:void 0,n.port=parseInt(s[5],10),n.path=s[6]||"",n.query=-1!==e.indexOf("?")?s[7]:void 0,n.fragment=-1!==e.indexOf("#")?s[8]:void 0,isNaN(n.port)&&(n.port=e.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?s[4]:void 0)),n.host&&(n.host=R(L(n.host,i),i)),void 0!==n.scheme||void 0!==n.userinfo||void 0!==n.host||void 0!==n.port||n.path||void 0!==n.query?void 0===n.scheme?n.reference="relative":void 0===n.fragment?n.reference="absolute":n.reference="uri":n.reference="same-document",t.reference&&"suffix"!==t.reference&&t.reference!==n.reference&&(n.error=n.error||"URI is not a "+t.reference+" reference.");var r=E[(t.scheme||n.scheme||"").toLowerCase()];if(t.unicodeSupport||r&&r.unicodeSupport)A(n,i);else{if(n.host&&(t.domainHost||r&&r.domainHost))try{n.host=S(n.host.replace(i.PCT_ENCODED,C).toLowerCase())}catch(e){n.error=n.error||"Host's domain name can not be converted to ASCII via punycode: "+e}A(n,o)}r&&r.parse&&r.parse(n,t)}else n.error=n.error||"URI can not be parsed.";return n}function k(e,t){var n=!1!==t.iri?a:o,i=[];return void 0!==e.userinfo&&(i.push(e.userinfo),i.push("@")),void 0!==e.host&&i.push(R(L(String(e.host),n),n).replace(n.IPV6ADDRESS,(function(e,t,n){return"["+t+(n?"%25"+n:"")+"]"}))),"number"==typeof e.port&&(i.push(":"),i.push(e.port.toString(10))),i.length?i.join(""):void 0}var I=/^\.\.?\//,z=/^\/\.(\/|$)/,U=/^\/\.\.(\/|$)/,F=/^\/?(?:.|\n)*?(?=\/|$)/;function V(e){for(var t=[];e.length;)if(e.match(I))e=e.replace(I,"");else if(e.match(z))e=e.replace(z,"/");else if(e.match(U))e=e.replace(U,"/"),t.pop();else if("."===e||".."===e)e="";else{var n=e.match(F);if(!n)throw new Error("Unexpected dot segment condition");var i=n[0];e=e.slice(i.length),t.push(i)}return t.join("")}function B(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.iri?a:o,i=[],s=E[(t.scheme||e.scheme||"").toLowerCase()];if(s&&s.serialize&&s.serialize(e,t),e.host)if(n.IPV6ADDRESS.test(e.host));else if(t.domainHost||s&&s.domainHost)try{e.host=t.iri?M(e.host):S(e.host.replace(n.PCT_ENCODED,C).toLowerCase())}catch(n){e.error=e.error||"Host's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+n}A(e,n),"suffix"!==t.reference&&e.scheme&&(i.push(e.scheme),i.push(":"));var r=k(e,t);if(void 0!==r&&("suffix"!==t.reference&&i.push("//"),i.push(r),e.path&&"/"!==e.path.charAt(0)&&i.push("/")),void 0!==e.path){var l=e.path;t.absolutePath||s&&s.absolutePath||(l=V(l)),void 0===r&&(l=l.replace(/^\/\//,"/%2F")),i.push(l)}return void 0!==e.query&&(i.push("?"),i.push(e.query)),void 0!==e.fragment&&(i.push("#"),i.push(e.fragment)),i.join("")}function j(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments[3],s={};return i||(e=O(B(e,n),n),t=O(B(t,n),n)),!(n=n||{}).tolerant&&t.scheme?(s.scheme=t.scheme,s.userinfo=t.userinfo,s.host=t.host,s.port=t.port,s.path=V(t.path||""),s.query=t.query):(void 0!==t.userinfo||void 0!==t.host||void 0!==t.port?(s.userinfo=t.userinfo,s.host=t.host,s.port=t.port,s.path=V(t.path||""),s.query=t.query):(t.path?("/"===t.path.charAt(0)?s.path=V(t.path):(void 0===e.userinfo&&void 0===e.host&&void 0===e.port||e.path?e.path?s.path=e.path.slice(0,e.path.lastIndexOf("/")+1)+t.path:s.path=t.path:s.path="/"+t.path,s.path=V(s.path)),s.query=t.query):(s.path=e.path,void 0!==t.query?s.query=t.query:s.query=e.query),s.userinfo=e.userinfo,s.host=e.host,s.port=e.port),s.scheme=e.scheme),s.fragment=t.fragment,s}function $(e,t){return e&&e.toString().replace(t&&t.iri?a.PCT_ENCODED:o.PCT_ENCODED,C)}var G={scheme:"http",domainHost:!0,parse:function(e,t){return e.host||(e.error=e.error||"HTTP URIs must have a host."),e},serialize:function(e,t){return e.port!==("https"!==String(e.scheme).toLowerCase()?80:443)&&""!==e.port||(e.port=void 0),e.path||(e.path="/"),e}},H={scheme:"https",domainHost:G.domainHost,parse:G.parse,serialize:G.serialize},W={},q="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",X="[0-9A-Fa-f]",Y=n(n("%[EFef]"+X+"%"+X+X+"%"+X+X)+"|"+n("%[89A-Fa-f]"+X+"%"+X+X)+"|"+n("%"+X+X)),Z=t("[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",'[\\"\\\\]'),J=new RegExp(q,"g"),K=new RegExp(Y,"g"),Q=new RegExp(t("[^]","[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]","[\\.]",'[\\"]',Z),"g"),ee=new RegExp(t("[^]",q,"[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]"),"g"),te=ee;function ne(e){var t=C(e);return t.match(J)?t:e}var ie={scheme:"mailto",parse:function(e,t){var n=e,i=n.to=n.path?n.path.split(","):[];if(n.path=void 0,n.query){for(var s=!1,r={},o=n.query.split("&"),a=0,l=o.length;a<l;++a){var c=o[a].split("=");switch(c[0]){case"to":for(var h=c[1].split(","),u=0,d=h.length;u<d;++u)i.push(h[u]);break;case"subject":n.subject=$(c[1],t);break;case"body":n.body=$(c[1],t);break;default:s=!0,r[$(c[0],t)]=$(c[1],t)}}s&&(n.headers=r)}n.query=void 0;for(var p=0,f=i.length;p<f;++p){var m=i[p].split("@");if(m[0]=$(m[0]),t.unicodeSupport)m[1]=$(m[1],t).toLowerCase();else try{m[1]=S($(m[1],t).toLowerCase())}catch(e){n.error=n.error||"Email address's domain name can not be converted to ASCII via punycode: "+e}i[p]=m.join("@")}return n},serialize:function(e,t){var n,i=e,r=null!=(n=e.to)?n instanceof Array?n:"number"!=typeof n.length||n.split||n.setInterval||n.call?[n]:Array.prototype.slice.call(n):[];if(r){for(var o=0,a=r.length;o<a;++o){var l=String(r[o]),c=l.lastIndexOf("@"),h=l.slice(0,c).replace(K,ne).replace(K,s).replace(Q,T),u=l.slice(c+1);try{u=t.iri?M(u):S($(u,t).toLowerCase())}catch(e){i.error=i.error||"Email address's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+e}r[o]=h+"@"+u}i.path=r.join(",")}var d=e.headers=e.headers||{};e.subject&&(d.subject=e.subject),e.body&&(d.body=e.body);var p=[];for(var f in d)d[f]!==W[f]&&p.push(f.replace(K,ne).replace(K,s).replace(ee,T)+"="+d[f].replace(K,ne).replace(K,s).replace(te,T));return p.length&&(i.query=p.join("&")),i}},se=/^([^\:]+)\:(.*)/,re={scheme:"urn",parse:function(e,t){var n=e.path&&e.path.match(se),i=e;if(n){var s=t.scheme||i.scheme||"urn",r=n[1].toLowerCase(),o=n[2],a=s+":"+(t.nid||r),l=E[a];i.nid=r,i.nss=o,i.path=void 0,l&&(i=l.parse(i,t))}else i.error=i.error||"URN can not be parsed.";return i},serialize:function(e,t){var n=t.scheme||e.scheme||"urn",i=e.nid,s=n+":"+(t.nid||i),r=E[s];r&&(e=r.serialize(e,t));var o=e,a=e.nss;return o.path=(i||t.nid)+":"+a,o}},oe=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,ae={scheme:"urn:uuid",parse:function(e,t){var n=e;return n.uuid=n.nss,n.nss=void 0,t.tolerant||n.uuid&&n.uuid.match(oe)||(n.error=n.error||"UUID is not valid."),n},serialize:function(e,t){var n=e;return n.nss=(e.uuid||"").toLowerCase(),n}};E[G.scheme]=G,E[H.scheme]=H,E[ie.scheme]=ie,E[re.scheme]=re,E[ae.scheme]=ae,e.SCHEMES=E,e.pctEncChar=T,e.pctDecChars=C,e.parse=O,e.removeDotSegments=V,e.serialize=B,e.resolveComponents=j,e.resolve=function(e,t,n){var i=function(e,t){var n=e;if(t)for(var i in t)n[i]=t[i];return n}({scheme:"null"},n);return B(j(O(e,i),O(t,i),i,!0),i)},e.normalize=function(e,t){return"string"==typeof e?e=B(O(e,t),t):"object"===i(e)&&(e=O(B(e,t),t)),e},e.equal=function(e,t,n){return"string"==typeof e?e=B(O(e,n),n):"object"===i(e)&&(e=B(e,n)),"string"==typeof t?t=B(O(t,n),n):"object"===i(t)&&(t=B(t,n)),e===t},e.escapeComponent=function(e,t){return e&&e.toString().replace(t&&t.iri?a.ESCAPE:o.ESCAPE,T)},e.unescapeComponent=$,Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveSchema=t.getCompilingSchema=t.resolveRef=t.compileSchema=t.SchemaEnv=void 0;const i=n(1),s=n(13),r=n(4),o=n(10),a=n(2),l=n(3),c=n(17);class h{constructor(e){var t;let n;this.refs={},this.dynamicAnchors={},"object"==typeof e.schema&&(n=e.schema),this.schema=e.schema,this.root=e.root||this,this.baseId=null!==(t=e.baseId)&&void 0!==t?t:o.normalizeId(null==n?void 0:n.$id),this.localRefs=e.localRefs,this.meta=e.meta,this.$async=null==n?void 0:n.$async,this.refs={}}}function u(e){const t=p.call(this,e);if(t)return t;const n=o.getFullPath(e.root.baseId),{es5:a,lines:c}=this.opts.code,{ownProperties:h}=this.opts,u=new i.CodeGen(this.scope,{es5:a,lines:c,ownProperties:h});let d;e.$async&&(d=u.scopeValue("Error",{ref:s.ValidationError,code:i._`require("ajv/dist/compile/error_classes").ValidationError`}));const f=u.scopeName("validate");e.validateName=f;const m={gen:u,allErrors:this.opts.allErrors,data:r.default.data,parentData:r.default.parentData,parentDataProperty:r.default.parentDataProperty,dataNames:[r.default.data],dataPathArr:[i.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:u.scopeValue("schema",!0===this.opts.code.source?{ref:e.schema,code:i.stringify(e.schema)}:{ref:e.schema}),validateName:f,ValidationError:d,schema:e.schema,schemaEnv:e,rootId:n,baseId:e.baseId||n,schemaPath:i.nil,errSchemaPath:this.opts.jtd?"":"#",errorPath:i._`""`,opts:this.opts,self:this};let g;try{this._compilations.add(e),l.validateFunctionCode(m),u.optimize(this.opts.code.optimize);const t=u.toString();g=`${u.scopeRefs(r.default.scope)}return ${t}`,this.opts.code.process&&(g=this.opts.code.process(g,e));const n=new Function(""+r.default.self,""+r.default.scope,g)(this,this.scope.get());if(this.scope.value(f,{ref:n}),n.errors=null,n.schema=e.schema,n.schemaEnv=e,e.$async&&(n.$async=!0),!0===this.opts.code.source&&(n.source={validateName:f,validateCode:t,scopeValues:u._values}),this.opts.unevaluated){const{props:e,items:t}=m;n.evaluated={props:e instanceof i.Name?void 0:e,items:t instanceof i.Name?void 0:t,dynamicProps:e instanceof i.Name,dynamicItems:t instanceof i.Name},n.source&&(n.source.evaluated=i.stringify(n.evaluated))}return e.validate=n,e}catch(t){throw delete e.validate,delete e.validateName,g&&this.logger.error("Error compiling schema, function code:",g),t}finally{this._compilations.delete(e)}}function d(e){return o.inlineRef(e.schema,this.opts.inlineRefs)?e.schema:e.validate?e:u.call(this,e)}function p(e){for(const i of this._compilations)if(n=e,(t=i).schema===n.schema&&t.root===n.root&&t.baseId===n.baseId)return i;var t,n}function f(e,t){let n;for(;"string"==typeof(n=this.refs[t]);)t=n;return n||this.schemas[t]||m.call(this,e,t)}function m(e,t){const n=c.parse(t),i=o._getFullPath(n);let s=o.getFullPath(e.baseId);if(Object.keys(e.schema).length>0&&i===s)return v.call(this,n,e);const r=o.normalizeId(i),a=this.refs[r]||this.schemas[r];if("string"==typeof a){const t=m.call(this,e,a);if("object"!=typeof(null==t?void 0:t.schema))return;return v.call(this,n,t)}if("object"==typeof(null==a?void 0:a.schema)){if(a.validate||u.call(this,a),r===o.normalizeId(t)){const{schema:t}=a;return t.$id&&(s=o.resolveUrl(s,t.$id)),new h({schema:t,root:e,baseId:s})}return v.call(this,n,a)}}t.SchemaEnv=h,t.compileSchema=u,t.resolveRef=function(e,t,n){var i;n=o.resolveUrl(t,n);const s=e.refs[n];if(s)return s;let r=f.call(this,e,n);if(void 0===r){const s=null===(i=e.localRefs)||void 0===i?void 0:i[n];s&&(r=new h({schema:s,root:e,baseId:t}))}return void 0!==r?e.refs[n]=d.call(this,r):void 0},t.getCompilingSchema=p,t.resolveSchema=m;const g=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function v(e,{baseId:t,schema:n,root:i}){var s;if("/"!==(null===(s=e.fragment)||void 0===s?void 0:s[0]))return;for(const i of e.fragment.slice(1).split("/")){if("boolean"==typeof n)return;if(void 0===(n=n[a.unescapeFragment(i)]))return;!g.has(i)&&"object"==typeof n&&n.$id&&(t=o.resolveUrl(t,n.$id))}let r;if("boolean"!=typeof n&&n.$ref&&!a.schemaHasRulesButRef(n,this.RULES)){const e=o.resolveUrl(t,n.$ref);r=m.call(this,i,e)}return r=r||new h({schema:n,root:i,baseId:t}),r.schema!==r.root.schema?r:void 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(5),s=n(1),r=n(4),o=n(6),a=n(2),l={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:{message:"should NOT have additional properties",params:({params:e})=>s._`{additionalProperty: ${e.additionalProperty}}`},code(e){const{gen:t,schema:n,parentSchema:l,data:c,errsCount:h,it:u}=e;if(!h)throw new Error("ajv implementation error");const{allErrors:d,opts:p}=u;if(u.props=!0,"all"!==p.removeAdditional&&a.alwaysValidSchema(u,n))return;const f=i.allSchemaProperties(l.properties),m=i.allSchemaProperties(l.patternProperties);function g(e){t.code(s._`delete ${c}[${e}]`)}function v(i){if("all"===p.removeAdditional||p.removeAdditional&&!1===n)g(i);else{if(!1===n)return e.setParams({additionalProperty:i}),e.error(),void(d||t.break());if("object"==typeof n&&!a.alwaysValidSchema(u,n)){const n=t.name("valid");"failing"===p.removeAdditional?(y(i,n,!1),t.if(s.not(n),()=>{e.reset(),g(i)})):(y(i,n),d||t.if(s.not(n),()=>t.break()))}}}function y(t,n,i){const s={keyword:"additionalProperties",dataProp:t,dataPropType:o.Type.Str};!1===i&&Object.assign(s,{compositeRule:!0,createErrors:!1,allErrors:!1}),e.subschema(s,n)}t.forIn("key",c,e=>{f.length||m.length?t.if(function(e){let n;if(f.length>8){const s=a.schemaRefOrVal(u,l.properties,"properties");n=i.isOwnProperty(t,s,e)}else n=f.length?s.or(...f.map(t=>s._`${e} === ${t}`)):s.nil;return m.length&&(n=s.or(n,...m.map(n=>s._`${i.usePattern(t,n)}.test(${e})`))),s.not(n)}(e),()=>v(e)):v(e)}),e.ok(s._`${h} === ${r.default.errors}`)}};t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=void 0;const i=n(8);t.KeywordCxt=i.default;var s=n(1);Object.defineProperty(t,"_",{enumerable:!0,get:function(){return s._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return s.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return s.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return s.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return s.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return s.CodeGen}});const r=n(48),o=n(50),a=n(83),l=["/properties"],c="http://json-schema.org/draft-07/schema";class h extends r.default{_addVocabularies(){super._addVocabularies(),o.default.forEach(e=>this.addVocabulary(e))}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const e=this.opts.$data?this.$dataMetaSchema(a,l):a;this.addMetaSchema(e,c,!1),this.refs["http://json-schema.org/schema"]=c}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(c)?c:void 0)}}t.default=h},function(e){e.exports=JSON.parse('{"$id":"https://schemas.3d.si.edu/voyager/document.schema.json","$schema":"http://json-schema.org/draft-07/schema#","title":"Smithsonian 3D Document","description":"Describes a 3D document containing a scene with 3D models.","definitions":{"scene":{"$id":"#scene","type":"object","properties":{"nodes":{"type":"array","description":"The indices of the scene\'s root nodes.","items":{"type":"integer","minimum":0},"uniqueItems":true,"minItems":1},"setup":{"description":"The index of the scene\'s setup.","type":"integer","minimum":0}}},"node":{"$id":"#node","type":"object","properties":{"name":{"type":"string"},"children":{"type":"array","description":"The indices of this node\'s children.","items":{"type":"integer","minimum":0},"uniqueItems":true,"minItems":1},"matrix":{"description":"A floating-point 4x4 transformation matrix stored in column-major order.","type":"array","items":{"type":"number"},"minItems":16,"maxItems":16,"default":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},"translation":{"description":"The node\'s translation along the x, y, and z axes.","type":"array","items":{"type":"number"},"minItems":3,"maxItems":3,"default":[0,0,0]},"rotation":{"description":"The node\'s unit quaternion rotation in the order (x, y, z, w), where w is the scalar.","type":"array","items":{"type":"number","minimum":-1,"maximum":1},"minItems":4,"maxItems":4,"default":[0,0,0,1]},"scale":{"description":"The node\'s non-uniform scale, given as the scaling factors along the x, y, and z axes.","type":"array","items":{"type":"number"},"minItems":3,"maxItems":3,"default":[1,1,1]},"camera":{"description":"The index of the camera component of this node.","type":"integer","minimum":0},"light":{"description":"The index of the light component of this node.","type":"integer","minimum":0},"meta":{"description":"The index of the meta data component of this node.","type":"integer","minimum":0},"model":{"description":"The index of the model component of this node.","type":"integer","minimum":0}},"not":{"anyOf":[{"required":["matrix","translation"]},{"required":["matrix","rotation"]},{"required":["matrix","scale"]}]}},"camera":{"$id":"#camera","type":"object","properties":{"type":{"description":"Specifies if the camera uses a perspective or orthographic projection.","type":"string","enum":["perspective","orthographic"]},"perspective":{"description":"A perspective camera containing properties to create a perspective projection matrix.","type":"object","properties":{"yfov":{"type":"number","description":"The floating-point vertical field of view in radians.","exclusiveMinimum":0},"aspectRatio":{"type":"number","description":"The floating-point aspect ratio of the field of view.","exclusiveMinimum":0},"znear":{"type":"number","description":"The floating-point distance to the near clipping plane.","exclusiveMinimum":0},"zfar":{"type":"number","description":"The floating-point distance to the far clipping plane.","exclusiveMinimum":0}},"required":["yfov","znear"]},"orthographic":{"description":"An orthographic camera containing properties to create an orthographic projection matrix.","type":"object","properties":{"xmag":{"type":"number","description":"The floating-point horizontal magnification of the view. Must not be zero."},"ymag":{"type":"number","description":"The floating-point vertical magnification of the view. Must not be zero."},"znear":{"type":"number","description":"The floating-point distance to the near clipping plane.","exclusiveMinimum":0},"zfar":{"type":"number","description":"The floating-point distance to the far clipping plane. `zfar` must be greater than `znear`.","exclusiveMinimum":0}},"required":["xmag","ymag","znear","zfar"]}},"required":["type"],"not":{"required":["perspective","orthographic"]}},"light":{"$id":"#light","type":"object","properties":{"type":{"description":"Specifies the type of the light source.","type":"string","enum":["ambient","directional","point","spot","hemisphere"]},"color":{"$ref":"#/definitions/colorRGB"},"intensity":{"type":"number","minimum":0,"default":1},"castShadow":{"type":"boolean","default":false},"point":{"type":"object","properties":{"distance":{"type":"number","minimum":0},"decay":{"type":"number","minimum":0}}},"spot":{"type":"object","properties":{"distance":{"type":"number","minimum":0},"decay":{"type":"number","minimum":0},"angle":{"type":"number","minimum":0},"penumbra":{"type":"number","minimum":0}}},"hemisphere":{"type":"object","properties":{"groundColor":{"$ref":"#/definitions/colorRGB"}}}},"required":["type"],"not":{"required":["point","spot","hemisphere"]}},"colorRGB":{"$id":"#colorRGB","type":"array","items":{"type":"number","minimum":0,"maximum":1},"minItems":3,"maxItems":3,"default":[1,1,1]}},"type":"object","properties":{"asset":{"type":"object","properties":{"type":{"type":"string","const":"application/si-dpo-3d.document+json"},"version":{"description":"Version of this presentation description.","type":"string","minLength":1},"copyright":{"description":"A copyright message to credit the content creator.","type":"string","minLength":1},"generator":{"description":"Tool that generated this presentation description.","type":"string","minLength":1}},"required":["type","version"]},"scene":{"description":"Index of the root scene of the document.","type":"integer","minimum":0},"scenes":{"description":"An array of scenes.","type":"array","items":{"$ref":"#/definitions/scene"}},"nodes":{"description":"An array of nodes.","type":"array","items":{"$ref":"#/definitions/node"},"minItems":1},"metas":{"description":"An array of meta data components.","type":"array","items":{"$ref":"./meta.schema.json"}},"setups":{"description":"An array of setup components.","type":"array","items":{"$ref":"./setup.schema.json"},"minItems":1},"cameras":{"description":"An array of camera components.","type":"array","items":{"$ref":"#/definitions/camera"},"minItems":1},"lights":{"description":"An array of light components.","type":"array","items":{"$ref":"#/definitions/light"},"minItems":1},"models":{"description":"An array of model components.","type":"array","items":{"$ref":"./model.schema.json"},"minItems":1}},"required":["asset","scene","scenes"],"additionalProperties":false}')},function(e){e.exports=JSON.parse('{"$id":"https://schemas.3d.si.edu/voyager/common.schema.json","$schema":"http://json-schema.org/draft-07/schema#","title":"Math","description":"Definitions for mathematical compound objects such as vectors and matrices.","definitions":{"units":{"$id":"#units","type":"string","enum":["inherit","mm","cm","m","km","in","ft","yd","mi"]},"vector2":{"description":"2-component vector.","$id":"#vector2","type":"array","items":{"type":"number"},"minItems":2,"maxItems":2,"default":[0,0]},"vector3":{"description":"3-component vector.","$id":"#vector3","type":"array","items":{"type":"number"},"minItems":3,"maxItems":3,"default":[0,0,0]},"vector4":{"description":"4-component vector.","$id":"#vector4","type":"array","items":{"type":"number"},"minItems":4,"maxItems":4,"default":[0,0,0,0]},"matrix3":{"description":"3 by 3, matrix, storage: column-major.","$id":"#matrix3","type":"array","items":{"type":"number"},"minItems":9,"maxItems":9,"default":[1,0,0,0,1,0,0,0,1]},"matrix4":{"description":"4 by 4 matrix, storage: column-major.","$id":"#matrix4","type":"array","items":{"type":"number"},"minItems":16,"maxItems":16,"default":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},"boundingBox":{"description":"Axis-aligned 3D bounding box.","$id":"#boundingBox","type":"object","properties":{"min":{"$ref":"#/definitions/vector3"},"max":{"$ref":"#/definitions/vector3"}},"required":["min","max"]}}}')},function(e){e.exports=JSON.parse('{"$id":"https://schemas.3d.si.edu/voyager/meta.schema.json","$schema":"http://json-schema.org/draft-07/schema#","title":"Meta","description":"Meta data for a scene or model item.","definitions":{"image":{"$id":"image","description":"Reference to a preview image","type":"object","properties":{"uri":{"description":"Location of the image resource, absolute URL or path relative to this document","type":"string","minLength":1},"quality":{"type":"string","enum":["Thumb","Low","Medium","High"]},"byteSize":{"type":"integer","minimum":1},"width":{"type":"integer","minimum":1},"height":{"type":"integer","minimum":1}},"required":["uri","quality"]},"article":{"$id":"#article","description":"Reference to an external document (HTML)","type":"object","properties":{"id":{"type":"string","minLength":1},"title":{"description":"Short title.","type":"string"},"titles":{"description":"Short title with language key.","type":"object"},"lead":{"description":"Short lead text.","type":"string"},"leads":{"description":"Short lead text with language key.","type":"object"},"tags":{"description":"Array of tags, categorizing the article.","type":"array","items":{"type":"string"}},"taglist":{"description":"Array of tags, categorizing the annotation with language key.","type":"object"},"uri":{"description":"Location of the article resource, absolute URL or path relative to this document","type":"string","minLength":1},"uris":{"description":"Location of the article resource, absolute URL or path relative to this document with language key","type":"object"},"mimeType":{"description":"MIME type of the resource.","type":"string"},"thumbnailUri":{"description":"Location of a thumbnail/preview image of the resource.","type":"string"}},"required":["id"],"additionalProperties":false}},"type":"object","properties":{"collection":{"description":"Information retrieved from the collection record for the item.","type":"object"},"process":{"description":"Information about how the item was processed.","type":"object"},"images":{"type":"array","items":{"$ref":"#/definitions/image"},"minItems":1},"articles":{"type":"array","items":{"$ref":"#/definitions/article"},"minItems":1},"leadArticle":{"description":"Index of the main article. This is the default article displayed with the item.","type":"integer","minimum":0}},"additionalProperties":false}')},function(e){e.exports=JSON.parse('{"$id":"https://schemas.3d.si.edu/voyager/model.schema.json","$schema":"http://json-schema.org/draft-07/schema#","title":"Model","description":"Describes the visual representations (models, derivatives) of a 3D item.","definitions":{"annotation":{"description":"Spatial annotation (hot spot, hot zone) on a model. Annotations can reference articles.","type":"object","properties":{"id":{"type":"string","minLength":1},"title":{"type":"string"},"titles":{"description":"Short title with language key.","type":"object"},"lead":{"type":"string"},"leads":{"description":"Short lead text with language key.","type":"object"},"marker":{"type":"string"},"tags":{"description":"Array of tags, categorizing the annotation.","type":"array","items":{"type":"string"}},"taglist":{"description":"Array of tags, categorizing the annotation with language key.","type":"object"},"articleId":{"description":"Id of an article related to this annotation.","type":"string","minLength":1},"imageUri":{"description":"URI of an image resource for this annotation.","type":"string","minLength":1},"style":{"type":"string"},"visible":{"description":"Flag indicating whether the annotation is visible.","type":"boolean","default":true},"expanded":{"description":"Flag indicating whether the annotation is displayed in expanded state.","type":"boolean","default":false},"scale":{"description":"Scales the annotation relative to its default size.","type":"number","default":1},"offset":{"description":"Offsets the annotation along its direction.","type":"number","default":0},"tilt":{"description":"Tilt angle of the annotation relative to the direction vector in degrees.","type":"number","default":0},"azimuth":{"description":"Azimuth angle of a tilted annotation.","type":"number","default":0},"color":{"description":"Color of the annotation","type":"array","minItems":3,"maxItems":3,"items":{"type":"number"}},"position":{"description":"Position where the annotation is anchored, in local item coordinates.","$ref":"./common.schema.json#/definitions/vector3"},"direction":{"description":"Direction of the stem of this annotation, usually corresponds to the surface normal.","$ref":"./common.schema.json#/definitions/vector3"},"zoneIndex":{"description":"Index of the zone on the zone texture.","type":"integer","minimum":0}},"required":["id"],"additionalProperties":false},"derivative":{"description":"Visual representation derived from the master model.","type":"object","properties":{"usage":{"description":"usage categories for a derivative.","type":"string","enum":["Image2D","Web3D","App3D","iOSApp3D","Print3D","Editorial3D"]},"quality":{"type":"string","enum":["Thumb","Low","Medium","High","Highest","LOD","Stream","AR"]},"assets":{"description":"List of individual resources this derivative is composed of.","type":"array","items":{"$ref":"#/definitions/asset"}}}},"asset":{"description":"an individual resource for a 3D model.","type":"object","properties":{"uri":{"type":"string","minLength":1},"type":{"type":"string","enum":["Model","Geometry","Image","Texture","Points","Volume"]},"part":{"type":"string","minLength":1},"mimeType":{"type":"string","minLength":1},"byteSize":{"type":"integer","minimum":1},"numFaces":{"type":"integer","minimum":1},"imageSize":{"type":"integer","minimum":1},"mapType":{"type":"string","enum":["Color","Normal","Occlusion","Emissive","MetallicRoughness","Zone"]}},"required":["uri","type"]},"material":{"description":"Surface properties for this model, shared by all derivatives.","type":"object","properties":{}}},"type":"object","properties":{"units":{"$ref":"./common.schema.json#/definitions/units"},"tags":{"type":"string"},"visible":{"type":"boolean"},"renderOrder":{"type":"number"},"shadowSide":{"type":"string","enum":["Front","Back","Double"]},"derivatives":{"type":"array","items":{"$ref":"#/definitions/derivative"}},"translation":{"description":"Translation vector. Must be applied to bring model into its \'neutral\' pose.","$ref":"./common.schema.json#/definitions/vector3"},"rotation":{"description":"Rotation quaternion. Must be applied to bring model into its \'neutral\' pose.","$ref":"./common.schema.json#/definitions/vector4"},"boundingBox":{"description":"Bounding box for this model, shared by all derivatives.","$ref":"./common.schema.json#/definitions/boundingBox"},"material":{"$ref":"#/definitions/material"},"annotations":{"description":"List of annotations to be displayed with the model","type":"array","items":{"$ref":"#/definitions/annotation"}}},"required":["units","derivatives"],"additionalProperties":false}')},function(e){e.exports=JSON.parse('{"$id":"https://schemas.3d.si.edu/voyager/setup.schema.json","$schema":"http://json-schema.org/draft-07/schema#","title":"Setup","description":"Tours and settings for explorer documents (background, interface, etc.)","definitions":{"viewer":{"type":"object","properties":{"shader":{"type":"string"},"exposure":{"type":"number"},"gamma":{"type":"number"},"annotationsVisible":{"type":"boolean"},"activeTags":{"type":"string"},"sortedTags":{"type":"string"},"radioTags":{"type":"boolean"}},"required":["shader","exposure","gamma"]},"reader":{"type":"object","properties":{"enabled":{"type":"boolean"},"position":{"type":"string"},"articleId":{"description":"Id of the article currently displayed in the reader.","type":"string","minLength":1}}},"interface":{"type":"object","properties":{"visible":{"type":"boolean"},"logo":{"type":"boolean"},"menu":{"type":"boolean"},"tools":{"type":"boolean"}}},"navigation":{"type":"object","properties":{"type":{"type":"string","enum":["Orbit","Walk"]},"enabled":{"type":"boolean"},"autoZoom":{"type":"boolean"},"orbit":{"$comment":"TODO: Implement","type":"object","properties":{}},"walk":{"$comment":"TODO: Implement","type":"object","properties":{}}}},"background":{"type":"object","properties":{"style":{"type":"string","enum":["Solid","LinearGradient","RadialGradient"]},"color0":{"$ref":"./common.schema.json#/definitions/vector3"},"color1":{"$ref":"./common.schema.json#/definitions/vector3"}}},"floor":{"type":"object","properties":{"visible":{"type":"boolean"},"position":{"$ref":"./common.schema.json#/definitions/vector3"},"size":{"type":"number"},"color":{"$ref":"./common.schema.json#/definitions/vector3"},"opacity":{"type":"number"},"receiveShadow":{"type":"boolean"}}},"grid":{"type":"object","properties":{"visible":{"type":"boolean"},"color":{"$ref":"./common.schema.json#/definitions/vector3"}}},"tape":{"type":"object","properties":{"enabled":{"type":"boolean"},"startPosition":{"$ref":"./common.schema.json#/definitions/vector3"},"startDirection":{"$ref":"./common.schema.json#/definitions/vector3"},"endPosition":{"$ref":"./common.schema.json#/definitions/vector3"},"endDirection":{"$ref":"./common.schema.json#/definitions/vector3"}}},"slicer":{"type":"object","properties":{"enabled":{"type":"boolean"},"axis":{"type":"string","enum":["X","Y","Z"]},"inverted":{"type":"boolean"},"position":{"type":"number"}}},"tours":{"description":"Animated tours.","type":"array","items":{"type":"object","properties":{"title":{"type":"string"},"titles":{"description":"Short title with language key.","type":"object"},"lead":{"type":"string"},"leads":{"description":"Short lead text with language key.","type":"object"},"tags":{"description":"Array of tags, categorizing the tour.","type":"array","items":{"type":"string"}},"taglist":{"description":"Array of tags, categorizing the annotation with language key.","type":"object"},"steps":{"type":"array","items":{"type":"object","properties":{"title":{"type":"string"},"titles":{"description":"Short title with language key.","type":"object"},"id":{"type":"string"}}}}}}},"snapshots":{"description":"Snapshots are animatable scene states.","type":"object","properties":{"features":{"type":"array","items":{"type":"string"}},"targets":{"type":"array","items":{"type":"string"}},"states":{"type":"array","items":{"type":"object"}}}}},"type":"object","properties":{"units":{"$ref":"./common.schema.json#/definitions/units"},"interface":{"$ref":"#/definitions/interface"},"viewer":{"$ref":"#/definitions/viewer"},"reader":{"$ref":"#/definitions/reader"},"navigation":{"$ref":"#/definitions/navigation"},"background":{"$ref":"#/definitions/background"},"floor":{"$ref":"#/definitions/floor"},"grid":{"$ref":"#/definitions/grid"},"tape":{"$ref":"#/definitions/tape"},"slicer":{"$ref":"#/definitions/slicer"},"tours":{"$ref":"#/definitions/tours"}}}')},function(e){e.exports=JSON.parse('{"asset":{"type":"application/si-dpo-3d.document+json","version":"1.0","copyright":"(c) Smithsonian Institution, all rights reserved","generator":"Voyager"},"scene":0,"scenes":[{"nodes":[0,1],"setup":0}],"nodes":[{"translation":[0,0,15],"camera":0},{"name":"Lights","children":[2,3,4,5]},{"translation":[0,0,2],"rotation":[0.4829741,-0.1070728,0.1880998,0.8484633],"scale":[1,1,1],"name":"Key","light":0},{"rotation":[0.3546969,0.163893,-0.3861077,0.8356136],"scale":[1,1,1],"name":"Fill #1","light":1},{"translation":[0,0,1],"rotation":[0.9374013,-0.3018693,0.0532277,0.1652891],"name":"Fill #2","light":2},{"translation":[1,0,-1],"rotation":[0.373256,0.6426073,-0.5786063,0.3360813],"scale":[1,1,1],"name":"Rim","light":3}],"setups":[{"units":"cm","interface":{"visible":true,"logo":true,"menu":true,"tools":true},"viewer":{"shader":"Default","exposure":1,"gamma":2,"annotationsVisible":false},"reader":{"enabled":false,"position":"Overlay"},"navigation":{"type":"Orbit","enabled":true,"autoZoom":true,"lightsFollowCamera":true,"autoRotation":false,"orbit":{"orbit":[-24,-26,0],"offset":[0,0,150],"minOrbit":[-90,null,null],"maxOrbit":[90,null,null],"minOffset":[null,null,0.1],"maxOffset":[null,null,10000]}},"background":{"style":"RadialGradient","color0":[0.2,0.25,0.3],"color1":[0.01,0.03,0.05]},"floor":{"visible":false,"position":[0,-25,0],"size":50,"color":[0.6,0.75,0.8],"opacity":0.5,"receiveShadow":false},"grid":{"visible":false,"color":[0.5,0.7,0.8]},"tape":{"enabled":false,"startPosition":[0,0,0],"startDirection":[0,0,0],"endPosition":[0,0,0],"endDirection":[0,0,0]},"slicer":{"enabled":false,"axis":"X","inverted":false,"position":0.5}}],"cameras":[{"type":"perspective","perspective":{"yfov":52,"znear":0.1,"zfar":100000}}],"lights":[{"color":[1,0.95,0.9],"intensity":1,"type":"directional","shadowEnabled":true},{"color":[0.9,0.95,1],"intensity":0.7,"type":"directional","shadowEnabled":true},{"color":[0.8,0.85,1],"intensity":0.5,"type":"directional"},{"color":[0.85,0.9078313,1],"intensity":0.6,"type":"directional"}]}')},function(e,t,n){"use strict";n.r(t),t.default="//#define PHYSICAL\n//#define STANDARD\n\n#ifdef PHYSICAL\n    #define REFLECTIVITY\n    #define CLEARCOAT\n    #define TRANSPARENCY\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef TRANSPARENCY\n    uniform float transparency;\n#endif\n\n#ifdef REFLECTIVITY\n    uniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n    uniform float clearcoat;\n    uniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n    uniform vec3 sheen;\n#endif\n\n//#ifndef STANDARD\n//\tuniform float clearCoat;\n//\tuniform float clearCoatRoughness;\n//#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\n    #ifdef USE_TANGENT\n        varying vec3 vTangent;\n        varying vec3 vBitangent;\n    #endif\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n\n//#include <uv_pars_fragment>\n//#include <uv2_pars_fragment>\n// REPLACED WITH\n#if defined(USE_MAP) || defined(USE_BUMPMAP) || defined(USE_NORMALMAP) || defined(USE_SPECULARMAP) || defined(USE_ALPHAMAP) || defined(USE_EMISSIVEMAP) || defined(USE_ROUGHNESSMAP) || defined(USE_METALNESSMAP) || defined(USE_LIGHTMAP) || defined(USE_AOMAP)\n\tvarying vec2 vUv;\n#endif\n\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n//#include <envmap_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n#ifdef USE_AOMAP\n    uniform vec3 aoMapMix;\n#endif\n\n#ifdef MODE_XRAY\n    varying float vIntensity;\n#endif\n\n#ifdef CUT_PLANE\n    varying vec3 vWorldPosition;\n    uniform vec4 cutPlaneDirection;\n    uniform vec3 cutPlaneColor;\n#endif\n\nvoid main() {\n    #ifdef CUT_PLANE\n        if (dot(vWorldPosition, cutPlaneDirection.xyz) < -cutPlaneDirection.w) {\n            discard;\n        }\n    #endif\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n    #include <normal_fragment_maps>\n\n\t#ifdef CUT_PLANE\n\t    // on the cut surface (back facing fragments revealed), replace normal with cut plane direction\n        if (!gl_FrontFacing) {\n            normal = -cutPlaneDirection.xyz;\n            diffuseColor.rgb = cutPlaneColor.rgb;\n        }\n\t#endif\n\n    #include <clearcoat_normal_fragment_begin>\n    #include <clearcoat_normal_fragment_maps>\n    #include <emissivemap_fragment>\n\n\t// accumulation\n    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)\n        vec2 vUv2 = vUv;\n    #endif\n\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t//#include <aomap_fragment>\n\t// REPLACED WITH\n\t#ifdef USE_AOMAP\n\t    // if cut plane is enabled, disable ambient occlusion on back facing fragments\n\t    #ifdef CUT_PLANE\n            if (gl_FrontFacing) {\n\t    #endif\n\n    \t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n    \tvec3 aoSample = texture2D(aoMap, vUv).rgb;\n    \tvec3 aoFactors = mix(vec3(1.0), aoSample, clamp(aoMapMix * aoMapIntensity, 0.0, 1.0));\n    \tfloat ambientOcclusion = aoFactors.x * aoFactors.y * aoFactors.z;\n    \tfloat ambientOcclusion2 = ambientOcclusion * ambientOcclusion;\n    \treflectedLight.directDiffuse *= ambientOcclusion2;\n    \treflectedLight.directSpecular *= ambientOcclusion;\n    \t//reflectedLight.indirectDiffuse *= ambientOcclusion;\n\n    \t#if defined(USE_ENVMAP) && defined(PHYSICAL)\n    \t\tfloat dotNV = saturate(dot(geometry.normal, geometry.viewDir));\n    \t\treflectedLight.indirectSpecular *= computeSpecularOcclusion(dotNV, ambientOcclusion, material.specularRoughness);\n    \t#endif\n\n    \t#ifdef CUT_PLANE\n    \t    }\n    \t#endif\n    #endif\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n    // this is a stub for the transparency model\n    #ifdef TRANSPARENCY\n        diffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n    #endif\n\n\t#ifdef CUT_PLANE\n\tif (!gl_FrontFacing) {\n\t\toutgoingLight = cutPlaneColor.rgb;\n\t}\n\t#endif\n\n\tgl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n    #ifdef MODE_NORMALS\n        gl_FragColor = vec4(vec3(normal * 0.5 + 0.5), 1.0);\n    #endif\n\n    #ifdef MODE_XRAY\n        gl_FragColor = vec4(vec3(0.4, 0.7, 1.0) * vIntensity, 1.0);\n    #endif\n}\n"},function(e,t,n){"use strict";n.r(t),t.default="//#define PHYSICAL\n//#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n\n#include <common>\n\n//#include <uv_pars_vertex>\n//#include <uv2_pars_vertex>\n// REPLACED WITH\n#if defined(USE_MAP) || defined(USE_BUMPMAP) || defined(USE_NORMALMAP) || defined(USE_SPECULARMAP) || defined(USE_ALPHAMAP) || defined(USE_EMISSIVEMAP) || defined(USE_ROUGHNESSMAP) || defined(USE_METALNESSMAP) || defined(USE_LIGHTMAP) || defined(USE_AOMAP)\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n#ifdef MODE_XRAY\n    varying float vIntensity;\n#endif\n\n#ifdef CUT_PLANE\n    varying vec3 vWorldPosition;\n#endif\n\nvoid main() {\n\n//\t#include <uv_vertex>\n//\t#include <uv2_vertex>\n//  REPLACED WITH\n#if defined(USE_MAP) || defined(USE_BUMPMAP) || defined(USE_NORMALMAP) || defined(USE_SPECULARMAP) || defined(USE_ALPHAMAP) || defined(USE_EMISSIVEMAP) || defined(USE_ROUGHNESSMAP) || defined(USE_METALNESSMAP) || defined(USE_LIGHTMAP) || defined(USE_AOMAP)\n\tvUv = (uvTransform * vec3(uv, 1)).xy;\n#endif\n\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\tvNormal = normalize(transformedNormal);\n\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\n#ifdef MODE_XRAY\n    vIntensity = pow(abs(1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0)))), 3.0);\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = -mvPosition.xyz;\n\n\t// #include <worldpos_vertex>\n\t// REPLACED WITH\n\t#if defined(USE_ENVMAP) || defined(DISTANCE) || defined(USE_SHADOWMAP) || defined(CUT_PLANE)\n    \tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n    #endif\n\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n#ifdef CUT_PLANE\n    vWorldPosition = worldPosition.xyz / worldPosition.w;\n#endif\n\n#ifdef MODE_NORMALS\n    vNormal = normal;\n#endif\n}\n"},function(e,t,n){var i=n(30),s=n(31),r=n(32),o=["x","e","a","o","n","s","r","c","u","m","v","w","z"],a=["m","w"],l=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],c="\t".charCodeAt(0),h=" ".charCodeAt(0);function u(e){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(e)}function d(e){return new Function(["return function "+e+"() {","  return this._"+e,"}"].join("\n"))()}function p(e,t){if(!e.chars||0===e.chars.length)return null;var n=m(e.chars,t);return n>=0?e.chars[n]:null}function f(e,t,n){if(!e.kernings||0===e.kernings.length)return 0;for(var i=e.kernings,s=0;s<i.length;s++){var r=i[s];if(r.first===t&&r.second===n)return r.amount}return 0}function m(e,t,n){for(var i=n=n||0;i<e.length;i++)if(e[i].id===t)return i;return-1}e.exports=function(e){return new u(e)},u.prototype.update=function(e){if(e=s({measure:this._measure},e),this._opt=e,this._opt.tabSize=r(this._opt.tabSize,4),!e.font)throw new Error("must provide a valid bitmap font");var t=this.glyphs,n=e.text||"",a=e.font;this._setupSpaceGlyphs(a);var c=i.lines(n,e),h=e.width||0;t.length=0;var u=c.reduce((function(e,t){return Math.max(e,t.width,h)}),0),d=0,p=0,g=r(e.lineHeight,a.common.lineHeight),v=a.common.base,y=g-v,b=e.letterSpacing||0,x=g*c.length-y,_=function(e){if("center"===e)return 1;if("right"===e)return 2;return 0}(this._opt.align);p-=x,this._width=u,this._height=x,this._descender=g-v,this._baseline=v,this._xHeight=function(e){for(var t=0;t<o.length;t++){var n=o[t].charCodeAt(0),i=m(e.chars,n);if(i>=0)return e.chars[i].height}return 0}(a),this._capHeight=function(e){for(var t=0;t<l.length;t++){var n=l[t].charCodeAt(0),i=m(e.chars,n);if(i>=0)return e.chars[i].height}return 0}(a),this._lineHeight=g,this._ascender=g-y-this._xHeight;var w=this;c.forEach((function(e,i){for(var s,r=e.start,o=e.end,l=e.width,c=r;c<o;c++){var h=n.charCodeAt(c),m=w.getGlyph(a,h);if(m){s&&(d+=f(a,s.id,m.id));var v=d;1===_?v+=(u-l)/2:2===_&&(v+=u-l),t.push({position:[v,p],data:m,index:c,line:i}),d+=m.xadvance+b,s=m}}p+=g,d=0})),this._linesTotal=c.length},u.prototype._setupSpaceGlyphs=function(e){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,e.chars&&0!==e.chars.length){var t=p(e,h)||function(e){for(var t=0;t<a.length;t++){var n=a[t].charCodeAt(0),i=m(e.chars,n);if(i>=0)return e.chars[i]}return 0}(e)||e.chars[0],n=this._opt.tabSize*t.xadvance;this._fallbackSpaceGlyph=t,this._fallbackTabGlyph=s(t,{x:0,y:0,xadvance:n,id:c,xoffset:0,yoffset:0,width:0,height:0})}},u.prototype.getGlyph=function(e,t){var n=p(e,t);return n||(t===c?this._fallbackTabGlyph:t===h?this._fallbackSpaceGlyph:null)},u.prototype.computeMetrics=function(e,t,n,i){var s,r=this._opt.letterSpacing||0,o=this._opt.font,a=0,l=0,c=0;if(!o.chars||0===o.chars.length)return{start:t,end:t,width:0};n=Math.min(e.length,n);for(var h=t;h<n;h++){var u,d=e.charCodeAt(h);if(u=this.getGlyph(o,d)){u.xoffset;var p=(a+=s?f(o,s.id,u.id):0)+u.xadvance+r,m=a+u.width;if(m>=i||p>=i)break;a=p,l=m,s=u}c++}return s&&(l+=s.xoffset),{start:t,end:t+c,width:l}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach((function(e){Object.defineProperty(u.prototype,e,{get:d(e),configurable:!0})}))},function(e,t){var n=/\n/,i=/\s/;function s(e,t,n,i){var s=e.indexOf(t,n);return-1===s||s>i?i:s}function r(e){return i.test(e)}function o(e,t,n,i){return{start:t,end:t+Math.min(i,n-t)}}e.exports=function(t,n){return e.exports.lines(t,n).map((function(e){return t.substring(e.start,e.end)})).join("\n")},e.exports.lines=function(e,t){if(0===(t=t||{}).width&&"nowrap"!==t.mode)return[];e=e||"";var i="number"==typeof t.width?t.width:Number.MAX_VALUE,a=Math.max(0,t.start||0),l="number"==typeof t.end?t.end:e.length,c=t.mode,h=t.measure||o;return"pre"===c?function(e,t,i,s,r){for(var o=[],a=i,l=i;l<s&&l<t.length;l++){var c=t.charAt(l),h=n.test(c);if(h||l===s-1){var u=e(t,a,h?l:l+1,r);o.push(u),a=l+1}}return o}(h,e,a,l,i):function(e,t,n,i,o,a){var l=[],c=o;"nowrap"===a&&(c=Number.MAX_VALUE);for(;n<i&&n<t.length;){for(var h=s(t,"\n",n,i);n<h&&r(t.charAt(n));)n++;var u=e(t,n,h,c),d=n+(u.end-u.start),p=d+"\n".length;if(d<h){for(;d>n&&!r(t.charAt(d));)d--;if(d===n)p>n+"\n".length&&p--,d=p;else for(p=d;d>n&&r(t.charAt(d-"\n".length));)d--}if(d>=n){var f=e(t,n,d,c);l.push(f)}n=p}return l}(h,e,a,l,i,c)}},function(e,t){e.exports=function(){for(var e={},t=0;t<arguments.length;t++){var i=arguments[t];for(var s in i)n.call(i,s)&&(e[s]=i[s])}return e};var n=Object.prototype.hasOwnProperty},function(e,t){e.exports=function(e,t){return"number"==typeof e?e:"number"==typeof t?t:0}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){var i=n(35),s=n(36),r=n(37),o=[0,2,3],a=[2,1,3];e.exports=function(e,t){e&&(s(e)||r(e))||(t=e||{},e=null);for(var n="string"==typeof(t="number"==typeof t?{count:t}:t||{}).type?t.type:"uint16",l="number"==typeof t.count?t.count:1,c=t.start||0,h=!1!==t.clockwise?o:a,u=h[0],d=h[1],p=h[2],f=6*l,m=e||new(i(n))(f),g=0,v=0;g<f;g+=6,v+=4){var y=g+c;m[y+0]=v+0,m[y+1]=v+1,m[y+2]=v+2,m[y+3]=v+u,m[y+4]=v+d,m[y+5]=v+p}return m}},function(e,t){e.exports=function(e){switch(e){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return e.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===n.call(e.buffer)||Array.isArray(e)}},function(e,t){function n(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(n(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&n(e.slice(0,0))}(e)||!!e._isBuffer)}},function(e,t){e.exports.pages=function(e){var t=new Float32Array(4*e.length*1),n=0;return e.forEach((function(e){var i=e.data.page||0;t[n++]=i,t[n++]=i,t[n++]=i,t[n++]=i})),t},e.exports.uvs=function(e,t,n,i){var s=new Float32Array(4*e.length*2),r=0;return e.forEach((function(e){var o=e.data,a=o.x+o.width,l=o.y+o.height,c=o.x/t,h=o.y/n,u=a/t,d=l/n;i&&(h=(n-o.y)/n,d=(n-l)/n),s[r++]=c,s[r++]=h,s[r++]=c,s[r++]=d,s[r++]=u,s[r++]=d,s[r++]=u,s[r++]=h})),s},e.exports.positions=function(e){var t=new Float32Array(4*e.length*2),n=0;return e.forEach((function(e){var i=e.data,s=e.position[0]+i.xoffset,r=e.position[1]+i.yoffset,o=i.width,a=i.height;t[n++]=s,t[n++]=r,t[n++]=s,t[n++]=r+a,t[n++]=s+o,t[n++]=r+a,t[n++]=s+o,t[n++]=r})),t}},function(e,t){var n={min:[0,0],max:[0,0]};function i(e){var t=e.length/2;n.min[0]=e[0],n.min[1]=e[1],n.max[0]=e[0],n.max[1]=e[1];for(var i=0;i<t;i++){var s=e[2*i+0],r=e[2*i+1];n.min[0]=Math.min(s,n.min[0]),n.min[1]=Math.min(r,n.min[1]),n.max[0]=Math.max(s,n.max[0]),n.max[1]=Math.max(r,n.max[1])}}e.exports.computeBox=function(e,t){i(e),t.min.set(n.min[0],n.min[1],0),t.max.set(n.max[0],n.max[1],0)},e.exports.computeSphere=function(e,t){i(e);var s=n.min[0],r=n.min[1],o=n.max[0]-s,a=n.max[1]-r,l=Math.sqrt(o*o+a*a);t.center.set(s+o/2,r+a/2,0),t.radius=l/2}},function(e,t,n){"use strict";var i=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function o(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach((function(e){i[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,a,l=o(e),c=1;c<arguments.length;c++){for(var h in n=Object(arguments[c]))s.call(n,h)&&(l[h]=n[h]);if(i){a=i(n);for(var u=0;u<a.length;u++)r.call(n,a[u])&&(l[a[u]]=n[a[u]])}}return l}},function(e,t,n){"use strict";n.r(t),t.default="\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n\n// #include <uv_pars_fragment>\n// replaced with\nvarying vec2 vUv;\n\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n    vec2 coords = vUv * 2.0 - 1.0;\n    float f = dot(coords, coords);\n\tgl_FragColor = vec4(outgoingLight, mix(diffuseColor.a, 0.0, f));\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n\n"},function(e,t,n){"use strict";n.r(t),t.default="\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n\n// #include <uv_pars_vertex>\n// replaced with\nvarying vec2 vUv;\nuniform mat3 uvTransform;\n\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t// #include <uv_vertex>\n\t// replaced with\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n\n"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.boolOrEmptySchema=t.topBoolOrEmptySchema=void 0;const i=n(9),s=n(1),r=n(4),o={message:"boolean schema is false"};function a(e,t){const{gen:n,data:s}=e,r={gen:n,keyword:"false schema",data:s,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:e};i.reportError(r,o,t)}t.topBoolOrEmptySchema=function(e){const{gen:t,schema:n,validateName:i}=e;!1===n?a(e,!1):"object"==typeof n&&!0===n.$async?t.return(r.default.data):(t.assign(s._`${i}.errors`,null),t.return(!0))},t.boolOrEmptySchema=function(e,t){const{gen:n,schema:i}=e;!1===i?(n.var(t,!1),a(e)):n.var(t,!0)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.schemaKeywords=void 0;const i=n(15),s=n(7),r=n(45),o=n(46),a=n(2),l=n(3),c=n(1),h=n(4);function u(e,t){const{gen:n,schema:s,opts:{useDefaults:a}}=e;a&&r.assignDefaults(e,t.type),n.block(()=>{for(const n of t.rules)i.shouldUseRule(s,n)&&o.keywordCode(e,n.keyword,n.definition,t.type)})}function d(e,t){return e.includes(t)||"integer"===t&&e.includes("number")}function p(e,t){t+=` at "${e.schemaEnv.baseId+e.errSchemaPath}" (strictTypes)`,l.checkStrictMode(e,t,e.opts.strictTypes)}t.schemaKeywords=function(e,t,n,r){const{gen:l,schema:f,data:m,allErrors:g,opts:v,self:y}=e,{RULES:b}=y;function x(o){i.shouldUseGroup(f,o)&&(o.type?(l.if(s.checkDataType(o.type,m,v.strict)),u(e,o),1===t.length&&t[0]===o.type&&n&&(l.else(),s.reportTypeError(e)),l.endIf()):u(e,o),g||l.if(c._`${h.default.errors} === ${r||0}`))}!f.$ref||!v.ignoreKeywordsWithRef&&a.schemaHasRulesButRef(f,b)?(v.jtd||function(e,t){if(e.schemaEnv.meta||!e.opts.strictTypes)return;(function(e,t){if(!t.length)return;if(!e.dataTypes.length)return void(e.dataTypes=t);t.forEach(t=>{d(e.dataTypes,t)||p(e,`type "${t}" not allowed by context "${e.dataTypes.join(",")}"`)}),e.dataTypes=e.dataTypes.filter(e=>d(t,e))})(e,t),e.opts.allowUnionTypes||function(e,t){t.length>1&&(2!==t.length||!t.includes("null"))&&p(e,"use allowUnionTypes to allow union type keyword")}(e,t);!function(e,t){const n=e.self.RULES.all;for(const s in n){const r=n[s];if("object"==typeof r&&i.shouldUseRule(e.schema,r)){const{type:n}=r.definition;n.length&&!n.some(e=>{return i=e,(n=t).includes(i)||"number"===i&&n.includes("integer");var n,i})&&p(e,`missing type "${n.join(",")}" for keyword "${s}"`)}}}(e,e.dataTypes)}(e,t),l.block(()=>{for(const e of b.rules)x(e);x(b.post)})):l.block(()=>o.keywordCode(e,"$ref",b.all.$ref.definition))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.assignDefaults=void 0;const i=n(1),s=n(3);function r(e,t,n){const{gen:r,compositeRule:o,data:a,opts:l}=e;if(void 0===n)return;const c=i._`${a}${i.getProperty(t)}`;if(o)return void s.checkStrictMode(e,"default is ignored for: "+c);let h=i._`${c} === undefined`;"empty"===l.useDefaults&&(h=i._`${h} || ${c} === null || ${c} === ""`),r.if(h,i._`${c} = ${i.stringify(n)}`)}t.assignDefaults=function(e,t){const{properties:n,items:i}=e.schema;if("object"===t&&n)for(const t in n)r(e,t,n[t].default);else"array"===t&&Array.isArray(i)&&i.forEach((t,n)=>r(e,n,t.default))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.keywordCode=void 0;const i=n(8),s=n(9),r=n(5),o=n(1),a=n(4);function l(e,t){var n;const{gen:i,keyword:l,schema:u,parentSchema:d,$data:p,it:f}=e;!function({schemaEnv:e},t){if(t.async&&!e.$async)throw new Error("async keyword in sync schema")}(f,t);const m=!p&&t.compile?t.compile.call(f.self,u,d,f):t.validate,g=h(i,l,m),v=i.let("valid");function y(n=(t.async?o._`await `:o.nil)){const s=f.opts.passContext?a.default.this:a.default.self,l=!("compile"in t&&!p||!1===t.schema);i.assign(v,o._`${n}${r.callValidateCode(e,g,s,l)}`,t.modifying)}function b(e){var n;i.if(o.not(null!==(n=t.valid)&&void 0!==n?n:v),e)}e.block$data(v,(function(){if(!1===t.errors)y(),t.modifying&&c(e),b(()=>e.error());else{const n=t.async?function(){const e=i.let("ruleErrs",null);return i.try(()=>y(o._`await `),t=>i.assign(v,!1).if(o._`${t} instanceof ${f.ValidationError}`,()=>i.assign(e,o._`${t}.errors`),()=>i.throw(t))),e}():function(){const e=o._`${g}.errors`;return i.assign(e,null),y(o.nil),e}();t.modifying&&c(e),b(()=>function(e,t){const{gen:n}=e;n.if(o._`Array.isArray(${t})`,()=>{n.assign(a.default.vErrors,o._`${a.default.vErrors} === null ? ${t} : ${a.default.vErrors}.concat(${t})`).assign(a.default.errors,o._`${a.default.vErrors}.length`),s.extendErrors(e)},()=>e.error())}(e,n))}})),e.ok(null!==(n=t.valid)&&void 0!==n?n:v)}function c(e){const{gen:t,data:n,it:i}=e;t.if(i.parentData,()=>t.assign(n,o._`${i.parentData}[${i.parentDataProperty}]`))}function h(e,t,n){if(void 0===n)throw new Error(`keyword "${t}" failed to compile`);return e.scopeValue("keyword","function"==typeof n?{ref:n}:{ref:n,code:o.stringify(n)})}t.keywordCode=function(e,t,n,s){const r=new i.default(e,n,t);"code"in n?n.code(r,s):r.$data&&n.validate?l(r,n):"macro"in n?function(e,t){const{gen:n,keyword:i,schema:s,parentSchema:r,it:a}=e,l=t.macro.call(a.self,s,r,a),c=h(n,i,l);!1!==a.opts.validateSchema&&a.self.validateSchema(l,!0);const u=n.name("valid");e.subschema({schema:l,schemaPath:o.nil,errSchemaPath:`${a.errSchemaPath}/${i}`,topSchemaRef:c,compositeRule:!0},u),e.pass(u,()=>e.error(!0))}(r,n):(n.compile||n.validate)&&l(r,n)}},function(e,t,n){"use strict";var i=e.exports=function(e,t,n){"function"==typeof t&&(n=t,t={}),function e(t,n,s,r,o,a,l,c,h,u){if(r&&"object"==typeof r&&!Array.isArray(r)){for(var d in n(r,o,a,l,c,h,u),r){var p=r[d];if(Array.isArray(p)){if(d in i.arrayKeywords)for(var f=0;f<p.length;f++)e(t,n,s,p[f],o+"/"+d+"/"+f,a,o,d,r,f)}else if(d in i.propsKeywords){if(p&&"object"==typeof p)for(var m in p)e(t,n,s,p[m],o+"/"+d+"/"+m.replace(/~/g,"~0").replace(/\//g,"~1"),a,o,d,r,m)}else(d in i.keywords||t.allKeys&&!(d in i.skipKeywords))&&e(t,n,s,p,o+"/"+d,a,o,d,r)}s(r,o,a,l,c,h,u)}}(t,"function"==typeof(n=t.cb||n)?n:n.pre||function(){},n.post||function(){},e,"",e)};i.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},i.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},i.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},i.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=void 0;const i=n(8);t.KeywordCxt=i.default;var s=n(1);Object.defineProperty(t,"_",{enumerable:!0,get:function(){return s._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return s.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return s.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return s.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return s.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return s.CodeGen}});const r=n(13),o=n(14),a=n(18),l=n(1),c=n(10),h=n(7),u=n(2),d=n(49),p=["removeAdditional","useDefaults","coerceTypes"],f=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),m={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",schemaId:"JSON Schema draft-04 is not supported in Ajv v7.",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",strictNumbers:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key."},g={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'};function v(e){var t,n,i,s,r,o,a,l,c,h,u,d;const p=null===(t=e.strict)||void 0===t||t,f=!!p&&"log",m=null===(n=e.code)||void 0===n?void 0:n.optimize,g=!0===m||void 0===m?1:m||0;return{strict:p,strictTypes:null!==(i=e.strictTypes)&&void 0!==i?i:f,strictTuples:null!==(s=e.strictTuples)&&void 0!==s?s:f,code:e.code?{...e.code,optimize:g}:{optimize:g},loopRequired:null!==(r=e.loopRequired)&&void 0!==r?r:1/0,loopEnum:null!==(o=e.loopEnum)&&void 0!==o?o:1/0,meta:null===(a=e.meta)||void 0===a||a,messages:null===(l=e.messages)||void 0===l||l,inlineRefs:null===(c=e.inlineRefs)||void 0===c||c,addUsedSchema:null===(h=e.addUsedSchema)||void 0===h||h,validateSchema:null===(u=e.validateSchema)||void 0===u||u,validateFormats:null===(d=e.validateFormats)||void 0===d||d}}class y{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...v(e)};const{es5:t,lines:n}=this.opts.code;this.scope=new l.ValueScope({scope:{},prefixes:f,es5:t,lines:n}),this.logger=function(e){if(!1===e)return E;if(void 0===e)return console;if(e.log&&e.warn&&e.error)return e;throw new Error("logger must implement log, warn and error methods")}(e.logger);const i=e.validateFormats;e.validateFormats=!1,this.RULES=o.getRules(),b.call(this,m,e,"NOT SUPPORTED"),b.call(this,g,e,"DEPRECATED","warn"),this._metaOpts=M.call(this),e.formats&&w.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&S.call(this,e.keywords),"object"==typeof e.meta&&this.addMetaSchema(e.meta),_.call(this),e.validateFormats=i}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:e,meta:t}=this.opts;t&&e&&this.addMetaSchema(d,d.$id,!1)}defaultMeta(){const{meta:e}=this.opts;return this.opts.defaultMeta="object"==typeof e?e.$id||e:void 0}validate(e,t){let n;if("string"==typeof e){if(n=this.getSchema(e),!n)throw new Error(`no schema with key or ref "${e}"`)}else n=this.compile(e);const i=n(t);return"$async"in n||(this.errors=n.errors),i}compile(e,t){const n=this._addSchema(e,t);return n.validate||this._compileSchemaEnv(n)}compileAsync(e,t){if("function"!=typeof this.opts.loadSchema)throw new Error("options.loadSchema should be a function");const{loadSchema:n}=this.opts;return i.call(this,e,t);async function i(e,t){await s.call(this,e.$schema);const n=this._addSchema(e,t);return n.validate||o.call(this,n)}async function s(e){e&&!this.getSchema(e)&&await i.call(this,{$ref:e},!0)}async function o(e){try{return this._compileSchemaEnv(e)}catch(t){if(!(t instanceof r.MissingRefError))throw t;return a.call(this,t),await l.call(this,t.missingSchema),o.call(this,e)}}function a({missingSchema:e,missingRef:t}){if(this.refs[e])throw new Error(`AnySchema ${e} is loaded but ${t} cannot be resolved`)}async function l(e){const n=await c.call(this,e);this.refs[e]||await s.call(this,n.$schema),this.refs[e]||this.addSchema(n,e,t)}async function c(e){const t=this._loading[e];if(t)return t;try{return await(this._loading[e]=n(e))}finally{delete this._loading[e]}}}addSchema(e,t,n,i=this.opts.validateSchema){if(Array.isArray(e)){for(const t of e)this.addSchema(t,void 0,n,i);return this}let s;if("object"==typeof e&&(s=e.$id,void 0!==s&&"string"!=typeof s))throw new Error("schema id must be string");return t=c.normalizeId(t||s),this._checkUnique(t),this.schemas[t]=this._addSchema(e,n,i,!0),this}addMetaSchema(e,t,n=this.opts.validateSchema){return this.addSchema(e,t,!0,n),this}validateSchema(e,t){if("boolean"==typeof e)return!0;let n;if(n=e.$schema,void 0!==n&&"string"!=typeof n)throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const i=this.validate(n,e);if(!i&&t){const e="schema is invalid: "+this.errorsText();if("log"!==this.opts.validateSchema)throw new Error(e);this.logger.error(e)}return i}getSchema(e){let t;for(;"string"==typeof(t=x.call(this,e));)e=t;if(void 0===t){const n=new a.SchemaEnv({schema:{}});if(t=a.resolveSchema.call(this,n,e),!t)return;this.refs[e]=t}return t.validate||this._compileSchemaEnv(t)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const t=x.call(this,e);return"object"==typeof t&&this._cache.delete(t.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{const t=e;this._cache.delete(t);let n=e.$id;return n&&(n=c.normalizeId(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(const t of e)this.addKeyword(t);return this}addKeyword(e,t){let n;if("string"==typeof e)n=e,"object"==typeof t&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),t.keyword=n);else{if("object"!=typeof e||void 0!==t)throw new Error("invalid addKeywords parameters");if(n=(t=e).keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}if(C.call(this,n,t),!t)return u.eachItem(n,e=>A.call(this,e)),this;L.call(this,t);const i={...t,type:h.getJSONTypes(t.type),schemaType:h.getJSONTypes(t.schemaType)};return u.eachItem(n,0===i.type.length?e=>A.call(this,e,i):e=>i.type.forEach(t=>A.call(this,e,i,t))),this}getKeyword(e){const t=this.RULES.all[e];return"object"==typeof t?t.definition:!!t}removeKeyword(e){const{RULES:t}=this;delete t.keywords[e],delete t.all[e];for(const n of t.rules){const t=n.rules.findIndex(t=>t.keyword===e);t>=0&&n.rules.splice(t,1)}return this}addFormat(e,t){return"string"==typeof t&&(t=new RegExp(t)),this.formats[e]=t,this}errorsText(e=this.errors,{separator:t=", ",dataVar:n="data"}={}){return e&&0!==e.length?e.map(e=>`${n}${e.dataPath} ${e.message}`).reduce((e,n)=>e+t+n):"No errors"}$dataMetaSchema(e,t){const n=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(const i of t){const t=i.split("/").slice(1);let s=e;for(const e of t)s=s[e];for(const e in n){const t=n[e];if("object"!=typeof t)continue;const{$data:i}=t.definition,r=s[e];i&&r&&(s[e]=N(r))}}return e}_removeAllSchemas(e,t){for(const n in e){const i=e[n];t&&!t.test(n)||("string"==typeof i?delete e[n]:i&&!i.meta&&(this._cache.delete(i.schema),delete e[n]))}}_addSchema(e,t,n=this.opts.validateSchema,i=this.opts.addUsedSchema){if("object"!=typeof e){if(this.opts.jtd)throw new Error("schema must be object");if("boolean"!=typeof e)throw new Error("schema must be object or boolean")}let s=this._cache.get(e);if(void 0!==s)return s;const r=c.getSchemaRefs.call(this,e);s=new a.SchemaEnv({schema:e,meta:t,localRefs:r}),this._cache.set(s.schema,s);const o=s.baseId;return i&&!o.startsWith("#")&&(o&&this._checkUnique(o),this.refs[o]=s),n&&this.validateSchema(e,!0),s}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):a.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){const t=this.opts;this.opts=this._metaOpts;try{a.compileSchema.call(this,e)}finally{this.opts=t}}}function b(e,t,n,i="error"){for(const s in e){const r=s;r in t&&this.logger[i](`${n}: option ${s}. ${e[r]}`)}}function x(e){return e=c.normalizeId(e),this.schemas[e]||this.refs[e]}function _(){const e=this.opts.schemas;if(e)if(Array.isArray(e))this.addSchema(e);else for(const t in e)this.addSchema(e[t],t)}function w(){for(const e in this.opts.formats){const t=this.opts.formats[e];t&&this.addFormat(e,t)}}function S(e){if(Array.isArray(e))this.addVocabulary(e);else{this.logger.warn("keywords option as map is deprecated, pass array");for(const t in e){const n=e[t];n.keyword||(n.keyword=t),this.addKeyword(n)}}}function M(){const e={...this.opts};for(const t of p)delete e[t];return e}t.default=y,y.ValidationError=r.ValidationError,y.MissingRefError=r.MissingRefError;const E={log(){},warn(){},error(){}};const T=/^[a-z_$][a-z0-9_$:-]*$/i;function C(e,t){const{RULES:n}=this;if(u.eachItem(e,e=>{if(n.keywords[e])throw new Error(`Keyword ${e} is already defined`);if(!T.test(e))throw new Error(`Keyword ${e} has invalid name`)}),t&&t.$data&&!("code"in t)&&!("validate"in t))throw new Error('$data keyword must have "code" or "validate" function')}function A(e,t,n){var i;const s=null==t?void 0:t.post;if(n&&s)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:r}=this;let o=s?r.post:r.rules.find(({type:e})=>e===n);if(o||(o={type:n,rules:[]},r.rules.push(o)),r.keywords[e]=!0,!t)return;const a={keyword:e,definition:{...t,type:h.getJSONTypes(t.type),schemaType:h.getJSONTypes(t.schemaType)}};t.before?P.call(this,o,a,t.before):o.rules.push(a),r.all[e]=a,null===(i=t.implements)||void 0===i||i.forEach(e=>this.addKeyword(e))}function P(e,t,n){const i=e.rules.findIndex(e=>e.keyword===n);i>=0?e.rules.splice(i,0,t):(e.rules.push(t),this.logger.warn(`rule ${n} is not defined`))}function L(e){let{metaSchema:t}=e;void 0!==t&&(e.$data&&this.opts.$data&&(t=N(t)),e.validateSchema=this.compile(t,!0))}const R={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function N(e){return{anyOf:[e,R]}}},function(e){e.exports=JSON.parse('{"$id":"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#","description":"Meta-schema for $data reference (JSON AnySchema extension proposal)","type":"object","required":["$data"],"properties":{"$data":{"type":"string","anyOf":[{"format":"relative-json-pointer"},{"format":"json-pointer"}]}},"additionalProperties":false}')},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(51),s=n(54),r=n(66),o=n(80),a=n(82),l=[i.default,s.default,r.default,o.default,a.metadataVocabulary,a.contentVocabulary];t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(52),s=n(53),r=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",i.default,s.default];t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.callRef=t.getValidate=void 0;const i=n(13),s=n(5),r=n(1),o=n(4),a=n(18),l=n(2),c={keyword:"$ref",schemaType:"string",code(e){const{gen:t,schema:n,it:s}=e,{baseId:o,schemaEnv:l,validateName:c,opts:d,self:p}=s;if("#"===n||"#/"===n)return function(){if(l===l.root)return u(e,c,l,l.$async);const n=t.scopeValue("root",{ref:l.root});return u(e,r._`${n}.validate`,l.root,l.root.$async)}();const f=a.resolveRef.call(p,l.root,o,n);if(void 0===f)throw new i.MissingRefError(o,n);return f instanceof a.SchemaEnv?function(t){const n=h(e,t);u(e,n,t,t.$async)}(f):function(i){const s=t.scopeValue("schema",!0===d.code.source?{ref:i,code:r.stringify(i)}:{ref:i}),o=t.name("valid"),a=e.subschema({schema:i,dataTypes:[],schemaPath:r.nil,topSchemaRef:s,errSchemaPath:n},o);e.mergeEvaluated(a),e.ok(o)}(f)}};function h(e,t){const{gen:n}=e;return t.validate?n.scopeValue("validate",{ref:t.validate}):r._`${n.scopeValue("wrapper",{ref:t})}.validate`}function u(e,t,n,i){const{gen:a,it:c}=e,{allErrors:h,schemaEnv:u,opts:d}=c,p=d.passContext?o.default.this:r.nil;function f(e){const t=r._`${e}.errors`;a.assign(o.default.vErrors,r._`${o.default.vErrors} === null ? ${t} : ${o.default.vErrors}.concat(${t})`),a.assign(o.default.errors,r._`${o.default.vErrors}.length`)}function m(e){var t;if(!c.opts.unevaluated)return;const i=null===(t=null==n?void 0:n.validate)||void 0===t?void 0:t.evaluated;if(!0!==c.props)if(i&&!i.dynamicProps)void 0!==i.props&&(c.props=l.mergeEvaluated.props(a,i.props,c.props));else{const t=a.var("props",r._`${e}.evaluated.props`);c.props=l.mergeEvaluated.props(a,t,c.props,r.Name)}if(!0!==c.items)if(i&&!i.dynamicItems)void 0!==i.items&&(c.items=l.mergeEvaluated.items(a,i.items,c.items));else{const t=a.var("items",r._`${e}.evaluated.items`);c.items=l.mergeEvaluated.items(a,t,c.items,r.Name)}}i?function(){if(!u.$async)throw new Error("async schema referenced by sync schema");const n=a.let("valid");a.try(()=>{a.code(r._`await ${s.callValidateCode(e,t,p)}`),m(t),h||a.assign(n,!0)},e=>{a.if(r._`!(${e} instanceof ${c.ValidationError})`,()=>a.throw(e)),f(e),h||a.assign(n,!1)}),e.ok(n)}():e.result(s.callValidateCode(e,t,p),()=>m(t),()=>f(t))}t.getValidate=h,t.callRef=u,t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(55),s=n(56),r=n(57),o=n(59),a=n(60),l=n(61),c=n(62),h=n(63),u=n(64),d=n(65),p=[i.default,s.default,r.default,o.default,a.default,l.default,c.default,h.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},u.default,d.default];t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s=i.operators,r={maximum:{okStr:"<=",ok:s.LTE,fail:s.GT},minimum:{okStr:">=",ok:s.GTE,fail:s.LT},exclusiveMaximum:{okStr:"<",ok:s.LT,fail:s.GTE},exclusiveMinimum:{okStr:">",ok:s.GT,fail:s.LTE}},o={message:({keyword:e,schemaCode:t})=>i.str`should be ${r[e].okStr} ${t}`,params:({keyword:e,schemaCode:t})=>i._`{comparison: ${r[e].okStr}, limit: ${t}}`},a={keyword:Object.keys(r),type:"number",schemaType:"number",$data:!0,error:o,code(e){const{keyword:t,data:n,schemaCode:s}=e;e.fail$data(i._`${n} ${r[t].fail} ${s} || isNaN(${n})`)}};t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:{message:({schemaCode:e})=>i.str`should be multiple of ${e}`,params:({schemaCode:e})=>i._`{multipleOf: ${e}}`},code(e){const{gen:t,data:n,schemaCode:s,it:r}=e,o=r.opts.multipleOfPrecision,a=t.let("res"),l=o?i._`Math.abs(Math.round(${a}) - ${a}) > 1e-${o}`:i._`${a} !== parseInt(${a})`;e.fail$data(i._`(${s} === 0 || (${a} = ${n}/${s}, ${l}))`)}};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s=n(58),r={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:{message({keyword:e,schemaCode:t}){const n="maxLength"===e?"more":"fewer";return i.str`should NOT have ${n} than ${t} characters`},params:({schemaCode:e})=>i._`{limit: ${e}}`},code(e){const{keyword:t,data:n,schemaCode:r,it:o}=e,a="maxLength"===t?i.operators.GT:i.operators.LT;let l;if(!1===o.opts.unicode)l=i._`${n}.length`;else{const t=e.gen.scopeValue("func",{ref:s.default,code:i._`require("ajv/dist/compile/ucs2length").default`});l=i._`${t}(${n})`}e.fail$data(i._`${l} ${a} ${r}`)}};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t=e.length;let n,i=0,s=0;for(;s<t;)i++,n=e.charCodeAt(s++),n>=55296&&n<=56319&&s<t&&(n=e.charCodeAt(s),56320==(64512&n)&&s++);return i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(5),s=n(1),r={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:{message:({schemaCode:e})=>s.str`should match pattern "${e}"`,params:({schemaCode:e})=>s._`{pattern: ${e}}`},code(e){const{gen:t,data:n,$data:r,schema:o,schemaCode:a}=e,l=r?s._`(new RegExp(${a}, "u"))`:i.usePattern(t,o);e.fail$data(s._`!${l}.test(${n})`)}};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:{message({keyword:e,schemaCode:t}){const n="maxProperties"===e?"more":"fewer";return i.str`should NOT have ${n} than ${t} items`},params:({schemaCode:e})=>i._`{limit: ${e}}`},code(e){const{keyword:t,data:n,schemaCode:s}=e,r="maxProperties"===t?i.operators.GT:i.operators.LT;e.fail$data(i._`Object.keys(${n}).length ${r} ${s}`)}};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(5),s=n(1),r=n(3),o={keyword:"required",type:"object",schemaType:"array",$data:!0,error:{message:({params:{missingProperty:e}})=>s.str`should have required property '${e}'`,params:({params:{missingProperty:e}})=>s._`{missingProperty: ${e}}`},code(e){const{gen:t,schema:n,schemaCode:o,data:a,$data:l,it:c}=e,{opts:h}=c;if(!l&&0===n.length)return;const u=n.length>=h.loopRequired;if(c.allErrors?function(){if(u||l)e.block$data(s.nil,d);else for(const t of n)i.checkReportMissingProp(e,t)}():function(){const r=t.let("missing");if(u||l){const n=t.let("valid",!0);e.block$data(n,()=>function(n,r){e.setParams({missingProperty:n}),t.forOf(n,o,()=>{t.assign(r,i.propertyInData(t,a,n,h.ownProperties)),t.if(s.not(r),()=>{e.error(),t.break()})},s.nil)}(r,n)),e.ok(n)}else t.if(i.checkMissingProp(e,n,r)),i.reportMissingProp(e,r),t.else()}(),h.strictRequired){const t=e.parentSchema.properties,{definedProperties:i}=e.it;for(const e of n)if(void 0===(null==t?void 0:t[e])&&!i.has(e)){const t=`required property "${e}" is not defined at "${c.schemaEnv.baseId+c.errSchemaPath}" (strictRequired)`;r.checkStrictMode(c,t,c.opts.strictRequired)}}function d(){t.forOf("prop",o,n=>{e.setParams({missingProperty:n}),t.if(i.noPropertyInData(t,a,n,h.ownProperties),()=>e.error())})}}};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:{message({keyword:e,schemaCode:t}){const n="maxItems"===e?"more":"fewer";return i.str`should NOT have ${n} than ${t} items`},params:({schemaCode:e})=>i._`{limit: ${e}}`},code(e){const{keyword:t,data:n,schemaCode:s}=e,r="maxItems"===t?i.operators.GT:i.operators.LT;e.fail$data(i._`${n}.length ${r} ${s}`)}};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(7),s=n(1),r=n(11),o={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:{message:({params:{i:e,j:t}})=>s.str`should NOT have duplicate items (items ## ${t} and ${e} are identical)`,params:({params:{i:e,j:t}})=>s._`{i: ${e}, j: ${t}}`},code(e){const{gen:t,data:n,$data:o,schema:a,parentSchema:l,schemaCode:c,it:h}=e;if(!o&&!a)return;const u=t.let("valid"),d=l.items?i.getSchemaTypes(l.items):[];function p(r,o){const a=t.name("item"),l=i.checkDataTypes(d,a,h.opts.strict,i.DataType.Wrong),c=t.const("indices",s._`{}`);t.for(s._`;${r}--;`,()=>{t.let(a,s._`${n}[${r}]`),t.if(l,s._`continue`),d.length>1&&t.if(s._`typeof ${a} == "string"`,s._`${a} += "_"`),t.if(s._`typeof ${c}[${a}] == "number"`,()=>{t.assign(o,s._`${c}[${a}]`),e.error(),t.assign(u,!1).break()}).code(s._`${c}[${a}] = ${r}`)})}function f(i,o){const a=e.gen.scopeValue("func",{ref:r,code:s._`require("ajv/dist/compile/equal")`}),l=t.name("outer");t.label(l).for(s._`;${i}--;`,()=>t.for(s._`${o} = ${i}; ${o}--;`,()=>t.if(s._`${a}(${n}[${i}], ${n}[${o}])`,()=>{e.error(),t.assign(u,!1).break(l)})))}e.block$data(u,(function(){const i=t.let("i",s._`${n}.length`),r=t.let("j");e.setParams({i:i,j:r}),t.assign(u,!0),t.if(s._`${i} > 1`,()=>(d.length>0&&!d.some(e=>"object"===e||"array"===e)?p:f)(i,r))}),s._`${c} === false`),e.ok(u)}};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s=n(11),r={keyword:"const",$data:!0,error:{message:"should be equal to constant",params:({schemaCode:e})=>i._`{allowedValue: ${e}}`},code(e){const t=e.gen.scopeValue("func",{ref:s,code:i._`require("ajv/dist/compile/equal")`});e.fail$data(i._`!${t}(${e.data}, ${e.schemaCode})`)}};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s=n(11),r={keyword:"enum",schemaType:"array",$data:!0,error:{message:"should be equal to one of the allowed values",params:({schemaCode:e})=>i._`{allowedValues: ${e}}`},code(e){const{gen:t,data:n,$data:r,schema:o,schemaCode:a,it:l}=e;if(!r&&0===o.length)throw new Error("enum must have non-empty array");const c=o.length>=l.opts.loopEnum,h=e.gen.scopeValue("func",{ref:s,code:i._`require("ajv/dist/compile/equal")`});let u;if(c||r)u=t.let("valid"),e.block$data(u,(function(){t.assign(u,!1),t.forOf("v",a,e=>t.if(i._`${h}(${n}, ${e})`,()=>t.assign(u,!0).break()))}));else{if(!Array.isArray(o))throw new Error("ajv implementation error");const e=t.const("vSchema",a);u=i.or(...o.map((t,s)=>function(e,t){const s=o[t];return s&&"object"==typeof s?i._`${h}(${n}, ${e}[${t}])`:i._`${n} === ${s}`}(e,s)))}e.pass(u)}};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(67),s=n(68),r=n(69),o=n(70),a=n(71),l=n(19),c=n(72),h=n(73),u=n(74),d=n(75),p=n(76),f=n(77),m=n(78),g=n(79),v=[u.default,d.default,p.default,f.default,m.default,g.default,i.default,s.default,r.default,a.default,l.default,o.default,c.default,h.default];t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s=n(6),r=n(2),o=n(3),a={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:{message:({params:{len:e}})=>i.str`should NOT have more than ${e} items`,params:({params:{len:e}})=>i._`{limit: ${e}}`},code(e){const{gen:t,schema:n,parentSchema:a,data:l,it:c}=e,{items:h}=a;if(!Array.isArray(h))return void o.checkStrictMode(c,'"additionalItems" is ignored when "items" is not an array of schemas');c.items=!0;const u=t.const("len",i._`${l}.length`);if(!1===n)e.setParams({len:h.length}),e.pass(i._`${u} <= ${h.length}`);else if("object"==typeof n&&!r.alwaysValidSchema(c,n)){const n=t.var("valid",i._`${u} <= ${h.length}`);t.if(i.not(n),()=>function(n){t.forRange("i",h.length,u,r=>{e.subschema({keyword:"additionalItems",dataProp:r,dataPropType:s.Type.Num},n),c.allErrors||t.if(i.not(n),()=>t.break())})}(n)),e.ok(n)}}};t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s=n(2),r=n(3),o=n(5),a={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(e){const{gen:t,schema:n,it:a}=e;if(Array.isArray(n))a.opts.unevaluated&&n.length&&!0!==a.items&&(a.items=s.mergeEvaluated.items(t,n.length,a.items)),function(n){const{parentSchema:o,data:l}=e;if(a.opts.strictTuples&&!function(e,t){return e===t.minItems&&(e===t.maxItems||!1===t.additionalItems)}(n.length,o)){const e=`"items" is ${n.length}-tuple, but minItems or maxItems/additionalItems are not specified or different`;r.checkStrictMode(a,e,a.opts.strictTuples)}const c=t.name("valid"),h=t.const("len",i._`${l}.length`);n.forEach((n,r)=>{s.alwaysValidSchema(a,n)||(t.if(i._`${h} > ${r}`,()=>e.subschema({keyword:"items",schemaProp:r,dataProp:r},c)),e.ok(c))})}(n);else{if(a.items=!0,s.alwaysValidSchema(a,n))return;e.ok(o.validateArray(e))}}};t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s=n(6),r=n(2),o=n(3),a={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:{message:({params:{min:e,max:t}})=>void 0===t?i.str`should contain at least ${e} valid item(s)`:i.str`should contain at least ${e} and no more than ${t} valid item(s)`,params:({params:{min:e,max:t}})=>void 0===t?i._`{minContains: ${e}}`:i._`{minContains: ${e}, maxContains: ${t}}`},code(e){const{gen:t,schema:n,parentSchema:a,data:l,it:c}=e;let h,u;const{minContains:d,maxContains:p}=a;c.opts.next?(h=void 0===d?1:d,u=p):h=1;const f=t.const("len",i._`${l}.length`);if(e.setParams({min:h,max:u}),void 0===u&&0===h)return void o.checkStrictMode(c,'"minContains" == 0 without "maxContains": "contains" keyword ignored');if(void 0!==u&&h>u)return o.checkStrictMode(c,'"minContains" > "maxContains" is always invalid'),void e.fail();if(r.alwaysValidSchema(c,n)){let t=i._`${f} >= ${h}`;return void 0!==u&&(t=i._`${t} && ${f} <= ${u}`),void e.pass(t)}c.items=!0;const m=t.name("valid");if(void 0===u&&1===h)g(m,()=>t.if(m,()=>t.break()));else{t.let(m,!1);const e=t.name("_valid"),n=t.let("count",0);g(e,()=>t.if(e,()=>function(e){t.code(i._`${e}++`),void 0===u?t.if(i._`${e} >= ${h}`,()=>t.assign(m,!0).break()):(t.if(i._`${e} > ${u}`,()=>t.assign(m,!1).break()),1===h?t.assign(m,!0):t.if(i._`${e} >= ${h}`,()=>t.assign(m,!0)))}(n)))}function g(n,i){t.forRange("i",0,f,t=>{e.subschema({keyword:"contains",dataProp:t,dataPropType:s.Type.Num,compositeRule:!0},n),i()})}e.result(m,()=>e.reset())}};t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateSchemaDeps=t.validatePropertyDeps=t.error=void 0;const i=n(1),s=n(2),r=n(5);t.error={message:({params:{property:e,depsCount:t,deps:n}})=>{const s=1===t?"property":"properties";return i.str`should have ${s} ${n} when property ${e} is present`},params:({params:{property:e,depsCount:t,deps:n,missingProperty:s}})=>i._`{property: ${e},
    missingProperty: ${s},
    depsCount: ${t},
    deps: ${n}}`};const o={keyword:"dependencies",type:"object",schemaType:"object",error:t.error,code(e){const[t,n]=function({schema:e}){const t={},n={};for(const i in e){if("__proto__"===i)continue;(Array.isArray(e[i])?t:n)[i]=e[i]}return[t,n]}(e);a(e,t),l(e,n)}};function a(e,t=e.schema){const{gen:n,data:s,it:o}=e;if(0===Object.keys(t).length)return;const a=n.let("missing");for(const l in t){const c=t[l];if(0===c.length)continue;const h=r.propertyInData(n,s,l,o.opts.ownProperties);e.setParams({property:l,depsCount:c.length,deps:c.join(", ")}),o.allErrors?n.if(h,()=>{for(const t of c)r.checkReportMissingProp(e,t)}):(n.if(i._`${h} && (${r.checkMissingProp(e,c,a)})`),r.reportMissingProp(e,a),n.else())}}function l(e,t=e.schema){const{gen:n,data:i,keyword:o,it:a}=e,l=n.name("valid");for(const c in t)s.alwaysValidSchema(a,t[c])||(n.if(r.propertyInData(n,i,c,a.opts.ownProperties),()=>{const t=e.subschema({keyword:o,schemaProp:c},l);e.mergeValidEvaluated(t,l)},()=>n.var(l,!0)),e.ok(l))}t.validatePropertyDeps=a,t.validateSchemaDeps=l,t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s=n(2),r={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:{message:({params:e})=>i.str`property name '${e.propertyName}' is invalid`,params:({params:e})=>i._`{propertyName: ${e.propertyName}}`},code(e){const{gen:t,schema:n,data:r,it:o}=e;if(s.alwaysValidSchema(o,n))return;const a=t.name("valid");t.forIn("key",r,n=>{e.setParams({propertyName:n}),e.subschema({keyword:"propertyNames",data:n,dataTypes:["string"],propertyName:n,compositeRule:!0},a),t.if(i.not(a),()=>{e.error(!0),o.allErrors||t.break()})}),e.ok(a)}};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(8),s=n(5),r=n(2),o=n(19),a={keyword:"properties",type:"object",schemaType:"object",code(e){const{gen:t,schema:n,parentSchema:a,data:l,it:c}=e;"all"===c.opts.removeAdditional&&void 0===a.additionalProperties&&o.default.code(new i.default(c,o.default,"additionalProperties"));const h=s.allSchemaProperties(n);for(const e of h)c.definedProperties.add(e);c.opts.unevaluated&&h.length&&!0!==c.props&&(c.props=r.mergeEvaluated.props(t,r.toHash(h),c.props));const u=h.filter(e=>!r.alwaysValidSchema(c,n[e]));if(0===u.length)return;const d=t.name("valid");for(const n of u)p(n)?f(n):(t.if(s.propertyInData(t,l,n,c.opts.ownProperties)),f(n),c.allErrors||t.else().var(d,!0),t.endIf()),e.it.definedProperties.add(n),e.ok(d);function p(e){return c.opts.useDefaults&&!c.compositeRule&&void 0!==n[e].default}function f(t){e.subschema({keyword:"properties",schemaProp:t,dataProp:t},d)}}};t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(5),s=n(1),r=n(6),o=n(3),a=n(2),l={keyword:"patternProperties",type:"object",schemaType:"object",code(e){const{gen:t,schema:n,data:l,parentSchema:c,it:h}=e,{opts:u}=h,d=i.schemaProperties(h,n);if(0===d.length)return;const p=u.strict&&!u.allowMatchingProperties&&c.properties,f=t.name("valid");!0===h.props||h.props instanceof s.Name||(h.props=a.evaluatedPropsToName(t,h.props));const{props:m}=h;function g(e){for(const t in p)new RegExp(e).test(t)&&o.checkStrictMode(h,`property ${t} matches pattern ${e} (use allowMatchingProperties)`)}function v(n){t.forIn("key",l,o=>{t.if(s._`${i.usePattern(t,n)}.test(${o})`,()=>{e.subschema({keyword:"patternProperties",schemaProp:n,dataProp:o,dataPropType:r.Type.Str},f),h.opts.unevaluated&&!0!==m?t.assign(s._`${m}[${o}]`,!0):h.allErrors||t.if(s.not(f),()=>t.break())})})}!function(){for(const e of d)p&&g(e),h.allErrors?v(e):(t.var(f,!0),v(e),t.if(f))}()}};t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(2),s={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(e){const{gen:t,schema:n,it:s}=e;if(i.alwaysValidSchema(s,n))return void e.fail();const r=t.name("valid");e.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},r),e.result(r,()=>e.error(),()=>e.reset())},error:{message:"should NOT be valid"}};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:n(5).validateUnion,error:{message:"should match some schema in anyOf"}};t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s=n(2),r={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:{message:"should match exactly one schema in oneOf",params:({params:e})=>i._`{passingSchemas: ${e.passing}}`},code(e){const{gen:t,schema:n,it:r}=e;if(!Array.isArray(n))throw new Error("ajv implementation error");const o=n,a=t.let("valid",!1),l=t.let("passing",null),c=t.name("_valid");e.setParams({passing:l}),t.block((function(){o.forEach((n,o)=>{let h;s.alwaysValidSchema(r,n)?t.var(c,!0):h=e.subschema({keyword:"oneOf",schemaProp:o,compositeRule:!0},c),o>0&&t.if(i._`${c} && ${a}`).assign(a,!1).assign(l,i._`[${l}, ${o}]`).else(),t.if(c,()=>{t.assign(a,!0),t.assign(l,o),h&&e.mergeEvaluated(h,i.Name)})})})),e.result(a,()=>e.reset(),()=>e.error(!0))}};t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(2),s={keyword:"allOf",schemaType:"array",code(e){const{gen:t,schema:n,it:s}=e;if(!Array.isArray(n))throw new Error("ajv implementation error");const r=t.name("valid");n.forEach((t,n)=>{if(i.alwaysValidSchema(s,t))return;const o=e.subschema({keyword:"allOf",schemaProp:n},r);e.ok(r),e.mergeEvaluated(o)})}};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s=n(2),r=n(3),o={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:{message:({params:e})=>i.str`should match "${e.ifClause}" schema`,params:({params:e})=>i._`{failingKeyword: ${e.ifClause}}`},code(e){const{gen:t,parentSchema:n,it:s}=e;void 0===n.then&&void 0===n.else&&r.checkStrictMode(s,'"if" without "then" and "else" is ignored');const o=a(s,"then"),l=a(s,"else");if(!o&&!l)return;const c=t.let("valid",!0),h=t.name("_valid");if(function(){const t=e.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},h);e.mergeEvaluated(t)}(),e.reset(),o&&l){const n=t.let("ifClause");e.setParams({ifClause:n}),t.if(h,u("then",n),u("else",n))}else o?t.if(h,u("then")):t.if(i.not(h),u("else"));function u(n,s){return()=>{const r=e.subschema({keyword:n},h);t.assign(c,h),e.mergeValidEvaluated(r,c),s?t.assign(s,i._`${n}`):e.setParams({ifClause:n})}}e.pass(c,()=>e.error(!0))}};function a(e,t){const n=e.schema[t];return void 0!==n&&!s.alwaysValidSchema(e,n)}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(3),s={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:e,parentSchema:t,it:n}){void 0===t.if&&i.checkStrictMode(n,`"${e}" without "if" is ignored`)}};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=[n(81).default];t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),s={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:{message:({schemaCode:e})=>i.str`should match format "${e}"`,params:({schemaCode:e})=>i._`{format: ${e}}`},code(e,t){const{gen:n,data:s,$data:r,schema:o,schemaCode:a,it:l}=e,{opts:c,errSchemaPath:h,schemaEnv:u,self:d}=l;c.validateFormats&&(r?function(){const r=n.scopeValue("formats",{ref:d.formats,code:c.code.formats}),o=n.const("fDef",i._`${r}[${a}]`),l=n.let("fType"),h=n.let("format");n.if(i._`typeof ${o} == "object" && !(${o} instanceof RegExp)`,()=>n.assign(l,i._`${o}.type || "string"`).assign(h,i._`${o}.validate`),()=>n.assign(l,i._`"string"`).assign(h,o)),e.fail$data(i.or(!1===c.strict?i.nil:i._`${a} && !${h}`,function(){const e=u.$async?i._`(${o}.async ? await ${h}(${s}) : ${h}(${s}))`:i._`${h}(${s})`,n=i._`(typeof ${h} == "function" ? ${e} : ${h}.test(${s}))`;return i._`${h} && ${h} !== true && ${l} === ${t} && !${n}`}()))}():function(){const r=d.formats[o];if(!r)return void function(){if(!1===c.strict)return void d.logger.warn(e());throw new Error(e());function e(){return`unknown format "${o}" ignored in schema at path "${h}"`}}();if(!0===r)return;const[a,l,p]=function(e){const t=n.scopeValue("formats",{key:o,ref:e,code:c.code.formats?i._`${c.code.formats}${i.getProperty(o)}`:void 0});if("object"==typeof e&&!(e instanceof RegExp))return[e.type||"string",e.validate,i._`${t}.validate`];return["string",e,t]}(r);a===t&&e.pass(function(){if("object"==typeof r&&!(r instanceof RegExp)&&r.async){if(!u.$async)throw new Error("async format in sync schema");return i._`await ${p}(${s})`}return"function"==typeof l?i._`${p}(${s})`:i._`${p}.test(${s})`}())}())}};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.contentVocabulary=t.metadataVocabulary=void 0,t.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"],t.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"]},function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","$id":"http://json-schema.org/draft-07/schema#","title":"Core schema meta-schema","definitions":{"schemaArray":{"type":"array","minItems":1,"items":{"$ref":"#"}},"nonNegativeInteger":{"type":"integer","minimum":0},"nonNegativeIntegerDefault0":{"allOf":[{"$ref":"#/definitions/nonNegativeInteger"},{"default":0}]},"simpleTypes":{"enum":["array","boolean","integer","null","number","object","string"]},"stringArray":{"type":"array","items":{"type":"string"},"uniqueItems":true,"default":[]}},"type":["object","boolean"],"properties":{"$id":{"type":"string","format":"uri-reference"},"$schema":{"type":"string","format":"uri"},"$ref":{"type":"string","format":"uri-reference"},"$comment":{"type":"string"},"title":{"type":"string"},"description":{"type":"string"},"default":true,"readOnly":{"type":"boolean","default":false},"examples":{"type":"array","items":true},"multipleOf":{"type":"number","exclusiveMinimum":0},"maximum":{"type":"number"},"exclusiveMaximum":{"type":"number"},"minimum":{"type":"number"},"exclusiveMinimum":{"type":"number"},"maxLength":{"$ref":"#/definitions/nonNegativeInteger"},"minLength":{"$ref":"#/definitions/nonNegativeIntegerDefault0"},"pattern":{"type":"string","format":"regex"},"additionalItems":{"$ref":"#"},"items":{"anyOf":[{"$ref":"#"},{"$ref":"#/definitions/schemaArray"}],"default":true},"maxItems":{"$ref":"#/definitions/nonNegativeInteger"},"minItems":{"$ref":"#/definitions/nonNegativeIntegerDefault0"},"uniqueItems":{"type":"boolean","default":false},"contains":{"$ref":"#"},"maxProperties":{"$ref":"#/definitions/nonNegativeInteger"},"minProperties":{"$ref":"#/definitions/nonNegativeIntegerDefault0"},"required":{"$ref":"#/definitions/stringArray"},"additionalProperties":{"$ref":"#"},"definitions":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"properties":{"type":"object","additionalProperties":{"$ref":"#"},"default":{}},"patternProperties":{"type":"object","additionalProperties":{"$ref":"#"},"propertyNames":{"format":"regex"},"default":{}},"dependencies":{"type":"object","additionalProperties":{"anyOf":[{"$ref":"#"},{"$ref":"#/definitions/stringArray"}]}},"propertyNames":{"$ref":"#"},"const":true,"enum":{"type":"array","items":true,"minItems":1,"uniqueItems":true},"type":{"anyOf":[{"$ref":"#/definitions/simpleTypes"},{"type":"array","items":{"$ref":"#/definitions/simpleTypes"},"minItems":1,"uniqueItems":true}]},"format":{"type":"string"},"contentMediaType":{"type":"string"},"contentEncoding":{"type":"string"},"if":{"$ref":"#"},"then":{"$ref":"#"},"else":{"$ref":"#"},"allOf":{"$ref":"#/definitions/schemaArray"},"anyOf":{"$ref":"#/definitions/schemaArray"},"oneOf":{"$ref":"#/definitions/schemaArray"},"not":{"$ref":"#"}},"default":true}')},function(e,t,n){"use strict";n.r(t);var i={};n.r(i),n.d(i,"ArcCurve",(function(){return Vn})),n.d(i,"CatmullRomCurve3",(function(){return Wn})),n.d(i,"CubicBezierCurve",(function(){return Zn})),n.d(i,"CubicBezierCurve3",(function(){return Jn})),n.d(i,"EllipseCurve",(function(){return Fn})),n.d(i,"LineCurve",(function(){return Un})),n.d(i,"LineCurve3",(function(){return Kn})),n.d(i,"QuadraticBezierCurve",(function(){return Qn})),n.d(i,"QuadraticBezierCurve3",(function(){return ei})),n.d(i,"SplineCurve",(function(){return ti}));const s=Symbol("Publisher private data"),r=Symbol("Publisher strict option");class o{constructor(e){const t=!e||e.knownEvents;this[s]={[r]:t}}on(e,t,n){if(Array.isArray(e))return void e.forEach(e=>{this.on(e,t,n)});if(!t)throw new Error("missing callback function");let i=this[s][e];if(!i){if(this[s][r])throw new Error(`can't subscribe; unknown event: '${e}'`);i=this[s][e]=[]}let o={callback:t,context:n};i.push(o)}addEventListener(e,t,n){this.on(e,t,n)}once(e,t,n){if(Array.isArray(e))return void e.forEach(e=>{this.once(e,t,n)});const i=s=>{this.off(e,i,n),t.call(n,s)};i.cb=t,this.on(e,i,n)}off(e,t,n){if("object"==typeof e){if(Array.isArray(e))e.forEach(e=>{this.off(e,t,n)});else{const t=this[s];for(let n=0,i=Object.keys(t).length;n<i;++n){const n=t[e],i=[];for(let t=0,s=n.length;t<s;++t){const s=n[t];e&&s.context!==e&&i.push(s)}t[e]=i}}return}const i=this[s][e];if(!i)throw new Error(`can't unsubscribe; unknown event type: '${e}'`);const r=[];for(let e=0,s=i.length;e<s;++e){const s=i[e];(t&&t!==s.callback&&t!==s.callback.cb||n&&n!==s.context)&&r.push(s)}this[s][e]=r}removeEventListener(e,t,n){this.off(e,t,n)}emit(e,t){let n,i;if("string"==typeof e?(n=e,i=t):(n=e.type,i=e),!n)throw new Error(`empty or invalid event type: '${n}'`);const o=this[s],a=o[n];if(a)for(let e=0,t=a.length;e<t;++e){const t=a[e];t.context?t.callback.call(t.context,i):t.callback(i)}else if(o[r])throw new Error(`can't emit; unknown event type: '${n}'`)}addEvent(e){this[s][e]||(this[s][e]=[])}addEvents(...e){e.forEach(e=>{this[s][e]||(this[s][e]=[])})}hasEvent(e){return!!this[s][e]}listEvents(){return Object.getOwnPropertyNames(this[s])}}const a=[function(e){return e},function(e,t){for(let n=0,i=t.length;n<i;++n)t[n]=e[n];return t}],l=[function(e){return!!e},function(e,t){for(let n=0,i=t.length;n<i;++n)t[n]=!!e[n];return t}],c=[function(e){return String(e)},function(e,t){for(let n=0,i=t.length;n<i;++n)t[n]=String(e[n]);return t}],h=[function(e,t){throw new Error(`illegal value conversion from ${typeof e} to ${typeof t}`)},function(e,t,n){throw new Error(`illegal array conversion from ${typeof e[0]} to ${typeof t[0]}`)}],u={number:{number:a,boolean:l,string:c,object:h},boolean:{number:[function(e){return e?1:0},function(e,t){for(let n=0,i=t.length;n<i;++n)t[n]=e[n]?1:0;return t}],boolean:a,string:c,object:h},string:{number:[function(e){return parseFloat(e)||0},function(e,t){for(let n=0,i=t.length;n<i;++n)t[n]=parseFloat(e[n])||0;return t}],boolean:l,string:a,object:h},object:{number:h,boolean:l,string:c,object:a}},d={number:{number:!0,boolean:!0,string:!0,object:!1},boolean:{number:!0,boolean:!0,string:!0,object:!1},string:{number:!0,boolean:!0,string:!0,object:!1},object:{number:!1,boolean:!0,string:!0,object:!0}},p=[[function(e,t,n){return n(e,t)},function(e,t,n){return t[0]=n(e),t},function(e,t,n){return t[1]=n(e),t},function(e,t,n){return t[2]=n(e),t},function(e,t,n){return t[3]=n(e),t}],[function(e,t,n){return n(e[0])},function(e,t,n){return t[0]=n(e[0]),t},function(e,t,n){return t[1]=n(e[0]),t},function(e,t,n){return t[2]=n(e[0]),t},function(e,t,n){return t[3]=n(e[0]),t}],[function(e,t,n){return n(e[1])},function(e,t,n){return t[0]=n(e[1]),t},function(e,t,n){return t[1]=n(e[1]),t},function(e,t,n){return t[2]=n(e[1]),t},function(e,t,n){return t[3]=n(e[1]),t}],[function(e,t,n){return n(e[2])},function(e,t,n){return t[0]=n(e[2]),t},function(e,t,n){return t[1]=n(e[2]),t},function(e,t,n){return t[2]=n(e[2]),t},function(e,t,n){return t[3]=n(e[2]),t}],[function(e,t,n){return n(e[3])},function(e,t,n){return t[0]=n(e[3]),t},function(e,t,n){return t[1]=n(e[3]),t},function(e,t,n){return t[2]=n(e[3]),t},function(e,t,n){return t[3]=n(e[3]),t}]];class f{constructor(e,t,n,i){if(1===e.elementCount&&n>=0)throw new Error("non-array source property; can't link to element");if(1===t.elementCount&&i>=0)throw new Error("non-array destination property; can't link to element");this.source=e,this.destination=t,this.sourceIndex=n,this.destinationIndex=i;const s=void 0===n?-1:n,r=void 0===i?-1:i,o=e.elementCount>1&&s<0&&r<0;this.fnConvert=function(e,t,n){const i=n?1:0;return u[e][t][i]}(e.type,t.type,o);const a=function(e,t,n){return-1===e&&-1===t?n:e<=3&&t<=3?p[e+1][t+1]:function(n,i,s){return i[t]=s(n[e]),i}}(s,r,this.fnConvert);var l,c,h;this.fnCopy=(l=e.isMulti(),c=t.isMulti(),h=a,!1===l?!1===c?h:function(e,t,n){for(let n=0,i=t.length;n<i;++n)t[n]=h(e,t[n]);return t}:!1===c?function(e,t,n){return e.length>0&&(t=h(e[0],t)),t}:function(e,t,n){for(let n=0,i=e.length,s=t.length;n<s;++n)t[n]=h(e[n%i],t[n]);return t})}push(){this.destination.setValue(this.fnCopy(this.source.value,this.destination.value,this.fnConvert))}}const m={xyzw:["X","Y","Z","W"],rgba:["R","G","B","A"]},g=function(e){return void 0===e||"object"==typeof e&&!Array.isArray(e)?e:{preset:e}},v=function(e,t,n){return{path:t,schema:(n=g(n))?Object.assign({},e,n):e}},y={Number:{preset:0},Integer:{preset:0,step:1,speed:.34,precision:0},Natural:{preset:0,step:1,speed:.34,precision:0,min:0},Unit:{preset:0,min:0,max:1,bar:!0},Percent:{preset:0,min:0,max:1,bar:!0,percent:!0},Vector2:{preset:[0,0]},Vector3:{preset:[0,0,0]},Vector4:{preset:[0,0,0,0]},Matrix2:{preset:[1,0,0,1]},Matrix3:{preset:[1,0,0,0,1,0,0,0,1]},Matrix4:{preset:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},Scale:{preset:1},Scale2:{preset:[1,1]},Scale3:{preset:[1,1,1]},IntVec2:{preset:[0,0],step:1,speed:.34,precision:0},IntVec3:{preset:[0,0,0],step:1,speed:.34,precision:0},ColorRGB:{preset:[1,1,1],semantic:"color",labels:m.rgba,min:0,max:1,bar:!0},ColorRGBA:{preset:[1,1,1,1],semantic:"color",labels:m.rgba,min:0,max:1,bar:!0},Boolean:{preset:!1},String:{preset:""},AssetPath:{preset:"",semantic:"asset-path"},Object:{preset:null,objectType:Object},Event:{preset:0,event:!0}},b=(e,t)=>v(y.Number,e,t),x=(e,t)=>v(y.Integer,e,t),_=(e,t)=>v(y.Percent,e,t),w=(e,t)=>v(y.Vector3,e,t),S=(e,t)=>v(y.Matrix4,e,t),M=(e,t)=>v(y.Scale,e,t),E=(e,t)=>v(y.Scale3,e,t),T=(e,t)=>v(y.ColorRGB,e,t),C=(e,t)=>v(y.Boolean,e,t),A=(e,t)=>v(y.String,e,t),P=(e,t)=>v(y.AssetPath,e,t),L=(e,t,n)=>function(e,t,n){n=g(n);const i={enum:e,options:(s=e,Object.keys(s).filter(e=>isNaN(Number(e)))),preset:0};var s;return{path:t,schema:n?Object.assign({},i,n):i}}(t,e,n),R=(e,t,n)=>function(e,t,n){const i={options:e,preset:0};return{path:t,schema:(n=g(n))?Object.assign({},i,n):i}}(t,e,n),N=(e,t,n)=>function(e,t,n){const i={preset:null,objectType:e};return{path:t,schema:(n=g(n))?Object.assign({},i,n):i}}(t,e,n),D=(e,t)=>v(y.Event,e,t);class O extends o{constructor(e,t,n){if(super(),this.addEvents("value","link","change","dispose"),!t||void 0===t.preset)throw new Error("missing schema/preset");const i=t.preset,s=Array.isArray(i);this.type=typeof(s?i[0]:i),this.schema=t,this.custom=n||!1,this.elementCount=s?i.length:1,this.inLinks=[],this.outLinks=[],this._group=null,this._key="",this._path=e,this.value=null,this.reset(),this.changed=!t.event}get group(){return this._group}get key(){return this._key}get path(){return this._path}set path(e){this._path=e,this.emit({type:"change",what:"path",property:this})}get name(){return this._path.split(".").pop()}dispose(){this.unlink(),this._group&&this._group.removeProperty(this),this.emit({type:"dispose",property:this})}setValue(e,t,n){this.value=e,t||(this.changed=!0,this.isInput()&&(this._group.linkable.changed=!0)),n||this.emit("value",e);const i=this.outLinks;for(let e=0,t=i.length;e<t;++e)i[e].push()}setOption(e,t,n){if(!this.schema.options)throw new Error("not an 'option' type");const i=this.schema.options.indexOf(e);i>=0&&this.setValue(i,t,n)}copyValue(e,t){Array.isArray(e)&&(e=e.slice()),this.setValue(e,t)}set(e){e||(this.changed=!0,this.isInput()&&(this._group.linkable.changed=!0)),this.emit("value",this.value);const t=this.outLinks;for(let e=0,n=t.length;e<n;++e)t[e].push()}cloneValue(){const e=this.value;return Array.isArray(e)?e.slice():e}getValidatedValue(e){const t=this.value;if(this.isArray()){e=e||[];for(let n=0,i=t.length;n<i;++n)e[n]=this.validateValue(t[n]);return e}return this.validateValue(t)}linkTo(e,t,n){e.linkFrom(this,t,n)}linkFrom(e,t,n){if(!this.canLinkFrom(e,t,n))throw new Error(`can't link from '${e.path}' to '${this.path}'`);const i=new f(e,this,t,n);e.addOutLink(i),this.addInLink(i)}unlinkTo(e,t,n){e.unlinkFrom(this,t,n)}unlinkFrom(e,t,n){const i=this.inLinks.find(i=>i.source===e&&i.sourceIndex===t&&i.destinationIndex===n);return!!i&&(e.removeOutLink(i),this.removeInLink(i),!0)}unlink(){this.inLinks.slice().forEach(e=>{e.source.removeOutLink(e),this.removeInLink(e)});if(this.outLinks.slice().forEach(e=>{this.removeOutLink(e),e.destination.removeInLink(e)}),0!==this.inLinks.length||0!==this.outLinks.length)throw new Error("fatal: leftover links")}addInLink(e){if(e.destination!==this)throw new Error("input link's destination must equal this");this.inLinks.push(e),this.requestSort(),this.emit({type:"link",add:!0,remove:!1,link:e})}addOutLink(e){if(e.source!==this)throw new Error("output link's source must equal this");this.outLinks.push(e),this.requestSort(),e.push()}removeInLink(e){const t=this.inLinks.indexOf(e);if(t<0)throw new Error("input link not found");this.inLinks.splice(t,1),this.requestSort(),0===this.inLinks.length&&"object"===this.type&&this.reset(),this.emit({type:"link",add:!1,remove:!0,link:e})}removeOutLink(e){const t=this.outLinks.indexOf(e);if(t<0)throw new Error("output link not found");this.outLinks.splice(t,1),this.requestSort()}canLinkTo(e,t,n){return e.canLinkFrom(this,t,n)}canLinkFrom(e,t,n){if(this.isOutput())return!1;const i=t>=0,s=n>=0;if(!e.isArray()&&i)throw new Error("non-array source property; can't link to element");if(!this.isArray()&&s)throw new Error("non-array destination property; can't link to element");const r=e.isArray()&&!i;return r===(this.isArray()&&!s)&&((!r||e.elementCount===this.elementCount)&&(!("object"===e.type&&"object"===this.type&&!function(e,t){if(!e||!t)return!1;let n=e.prototype;for(;n;){if(n===t.prototype)return!0;n=n.prototype}return!1}(e.schema.objectType,this.schema.objectType))&&(o=e.type,a=this.type,d[o][a])));var o,a}reset(){let e;if(this.isMulti()){let t=this.value;t?t.length=1:e=t=[],t[0]=this.clonePreset()}else e=this.clonePreset();this.setValue(e)}setMultiChannelCount(e){if(!this.isMulti())throw new Error("can't set multi channel count on non-multi property");const t=this.value,n=t.length;t.length=e;for(let i=n;i<e;++i)t[i]=this.clonePreset();this.changed=!0}requestSort(){this._group&&this._group.linkable&&this._group.linkable.requestSort()}setOptions(e){if(!this.schema.options)throw new Error(`property type mismatch, can't set options on '${this.path}'`);this.schema.options=e.slice(),this.emit({type:"change",what:"options",property:this})}getOptionText(){const e=this.schema.options;if("number"===this.type&&e){const t=Math.trunc(this.value);return e[t<0||t>=e.length?0:t]||""}}isInput(){return this._group&&this._group===this._group.linkable.ins}isOutput(){return this._group&&this._group===this._group.linkable.outs}isArray(){return Array.isArray(this.schema.preset)}isMulti(){return!!this.schema.multi}isDefault(){const e=this.schema.multi?this.value[0]:this.value,t=this.schema.preset,n=Array.isArray(e)?e.length:-1;if(n!==(Array.isArray(t)?t.length:-1))return!1;if(n>=0){for(let i=0;i<n;++i)if(e[i]!==t[i])return!1;return!0}return e===t}hasLinks(){return this.inLinks.length>0||this.outLinks.length>0}hasInLinks(e){const t=this.inLinks;if(!(e>=0))return t.length>0;for(let n=0,i=t.length;n<i;++n)if(t[n].destinationIndex===e)return!0;return!1}hasMainInLinks(){const e=this.inLinks;for(let t=0,n=e.length;t<n;++t)if(!(e[t].destinationIndex>=0))return!0;return!1}hasOutLinks(e){const t=this.outLinks;if(!(e>=0))return t.length>0;for(let n=0,i=t.length;n<i;++n)if(t[n].sourceIndex===e)return!0;return!1}inLinkCount(){return this.inLinks.length}outLinkCount(){return this.outLinks.length}toJSON(){let e=this.custom?{path:this.path,schema:Object.assign({},this.schema)}:null;return this.isOutput()||this.hasMainInLinks()||this.isDefault()||"object"===this.type||(e=e||{},e.value=this.value),this.outLinks.length>0&&(e=e||{},e.links=this.outLinks.map(e=>{const t={id:e.destination._group.linkable.id,key:e.destination.key};return e.sourceIndex>=0&&(t.srcIndex=e.sourceIndex),e.destinationIndex>=0&&(t.dstIndex=e.destinationIndex),t})),e}fromJSON(e,t){void 0!==e.value&&(this.value=e.value),void 0!==e.links&&e.links.forEach(e=>{t[e.id].ins[e.key].linkFrom(this,e.srcIndex,e.dstIndex)})}toString(){const e=this.schema,t=e.event?"event":e.options?"enum":this.type;return`${this.path} [${t}]`}dump(e=""){console.log(e+`Property '${this.path}', key: ${this.key}, value: ${this.value}`)}validateValue(e){const t=this.schema;if(t.enum){const n=Math.trunc(e);return t.enum[n]?n:0}if(t.options){const n=Math.trunc(e);return n<0||n>=t.options.length?0:n}return"number"===this.type?(e=t.min?Math.max(t.min,e):e,e=t.max?Math.min(t.max,e):e):e}clonePreset(){const e=this.schema.preset;return Array.isArray(e)?e.slice():e}}function k(e,t){let n;e&&"number"==typeof e||(e=12);do{n="";for(let t=0;t<e;++t)n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[62*Math.random()|0]}while(t&&t[n]);return n}class I extends o{constructor(e){super(),this.addEvent("property"),this.linkable=e,this.properties=[]}get customProperties(){return this.properties.filter(e=>e.custom)}dispose(){this.unlinkAllProperties()}isInputGroup(){return this===this.linkable.ins}isOutputGroup(){return this===this.linkable.outs}createProperties(e,t){return Object.keys(e).forEach((n,i)=>{const s=void 0===t?void 0:t+i,r=e[n];this.createProperty(r.path,r.schema,n,s)}),this}createProperty(e,t,n,i){const s=new O(e,t);return this.addProperty(s,n,i),s}createCustomProperty(e,t,n){const i=new O(e,t,!0);return this.addCustomProperty(i,n),i}addCustomProperty(e,t){const n=k(5);this.addProperty(e,n,t)}addProperty(e,t,n){if(e.group)throw new Error("can't add, property already part of a group");if(this[t])throw new Error(`key '${t}' already exists in group`);e._group=this,e._key=t,void 0===n?this.properties.push(e):this.properties.splice(n,0,e),this[t]=e,this.emit({type:"property",add:!0,remove:!1,property:e})}removeProperty(e){if(e.group!==this)throw new Error("can't remove, property not in this group");if(e.hasLinks())throw new Error("can't remove, property has links");if(this[e.key]!==e)throw new Error(`property key '${e.key}' not found in group`);this.properties.slice(this.properties.indexOf(e),1),delete this[e.key],e._group=null,e._key="",this.emit({type:"property",add:!1,remove:!0,property:e})}getProperty(e){const t=this[e];if(!t)throw new Error(`no property found with key '${e}'`);return t}getKeys(e=!1){const t=[];return this.properties.forEach(n=>{(e||"object"!==n.type)&&t.push(n.key)}),t}getValues(e=!1){const t=[];return this.properties.map(n=>{(e||"object"!==n.type)&&t.push(n.value)}),t}cloneValues(e=!1){const t=[];return this.properties.map(n=>{(e||"object"!==n.type)&&t.push(n.cloneValue())}),t}setValues(e){Object.keys(e).forEach(t=>this.getProperty(t).value=e[t])}copyValues(e){Object.keys(e).forEach(t=>this.getProperty(t).copyValue(e[t]))}unlinkAllProperties(){this.properties.forEach(e=>e.unlink())}toJSON(){let e=null;return this.properties.forEach(t=>{const n=t.toJSON();n&&(e=e||{},e[t.key]=n)}),e}fromJSON(e){Object.keys(e).forEach(t=>{const n=e[t];if(n.schema){const e=new O(n.path,n.schema,!0);this.addProperty(e,t)}})}linksFromJSON(e,t){Object.keys(e).forEach(n=>{this[n].fromJSON(e[n],t)})}}class z{constructor(e,t,n,i){this.typeName=j.getTypeName(t),this.didAdd=n,this.willRemove=i,this._registry=e,e.on(this.typeName,this.onComponent,this),this.component=e.get(t,!0),this.component&&n&&n(this.component)}dispose(){this._registry.off(this.typeName,this.onComponent,this),this.component=null,this.didAdd=null,this.willRemove=null}onComponent(e){e.add?(this.component=e.object,this.didAdd&&this.didAdd(e.object)):e.remove&&(this.willRemove&&this.willRemove(e.object),this.component=null)}}class U{constructor(e,t){this._typeName=t?j.getTypeName(t):null,this._id=t instanceof j?t.id:void 0,this._system=e}get component(){return this._id&&this._system.components.getById(this._id)||null}set component(e){if(e&&this._typeName&&!(e instanceof this._system.registry.getType(this._typeName)))throw new Error(`can't assign component of class '${e.constructor.name||"unknown"}' to link of class '${this._typeName}'`);this._id=e?e.id:void 0}}const F=[];class V extends o{constructor(e){super({knownEvents:!1});const t=e.typeName;if(!t)throw new Error("root type must have a 'typeName' member");this._rootTypeName=t,this._objLists={[this._rootTypeName]:[]},this._objTags={},this._objDict={}}static getTypeName(e){return"function"==typeof e?e.typeName:"object"==typeof e?e.constructor.typeName:e}add(e){const t=e.id;if("string"==typeof t){if(void 0!==this._objDict[t])throw new Error("object already registered");this._objDict[t]=e}let n,i=e;const s=this._rootTypeName,r={type:"",add:!0,remove:!1,object:e};do{i=Object.getPrototypeOf(i),n=i.constructor.typeName,n&&((this._objLists[n]||(this._objLists[n]=[])).push(e),r.type=n,this.emit(r))}while(n!==s)}remove(e){const t=e.id;if("string"==typeof t){if(this._objDict[t]!==e)throw new Error("object not registered");delete this._objDict[t]}let n,i=e;const s=this._rootTypeName,r={type:"",add:!1,remove:!0,object:e};do{if(i=Object.getPrototypeOf(i),n=i.constructor.typeName,n){r.type=n,this.emit(r);const t=this._objLists[n];t.splice(t.indexOf(e),1)}}while(n!==s)}addByTag(e,t){if(!e||"tag"===e)throw new Error("illegal tag name");(this._objTags[e]||(this._objTags[e]=[])).push(t);const n={type:"tag",add:!0,remove:!1,object:t,tag:e};this.emit(n),n.type=e,this.emit(n)}removeByTag(e,t){if(!e||"tag"===e)throw new Error("illegal tag name");const n=this._objTags[e];if(n){const i=n.indexOf(t);if(i>=0){const s={type:"tag",add:!1,remove:!0,object:t,tag:e};return this.emit(s),s.type=e,this.emit(s),n.splice(i,1),!0}}return!1}clear(){this.cloneArray().forEach(e=>this.remove(e))}get length(){return this._objLists[this._rootTypeName].length}count(e){const t=this._objLists[this.getTypeName(e)];return t?t.length:0}has(e){if("function"==typeof e){const t=this._objLists[e.typeName];return!!t&&t.length>0}if("string"==typeof e){const t=this._objLists[e];return!!t&&t.length>0}const t=this._objLists[e.constructor.typeName];return t&&t.indexOf(e)>=0}contains(e){const t=e.id;if("string"==typeof t)return!!this._objDict[t];const n=this._objLists[e.constructor.typeName];return n&&n.indexOf(e)>=0}get(e,t=!1){const n=this.getTypeName(e),i=this._objLists[n],s=i?i[0]:void 0;if(!t&&!s)throw new Error(`no instances of class '${n}' in object registry`);return s}getArray(e){return this._objLists[this.getTypeName(e)]||F}cloneArray(e){return this.getArray(e).slice()}getById(e){return this._objDict[e]}getDictionary(){return this._objDict}getByTag(e){return this._objTags[e]||F}on(e,t,n){super.on(this.getTypeName(e),t,n)}once(e,t,n){super.once(this.getTypeName(e),t,n)}off(e,t,n){super.off(this.getTypeName(e),t,n)}getTypeName(e){return"function"==typeof e?e.typeName:"object"==typeof e?e.constructor.typeName:e||this._rootTypeName}}class B extends o{constructor(e,t){super({knownEvents:!1}),this.graph=null,this.components=new V(j),this._name="",this._tags=new Set,this._isLocked=void 0,this.graph=e,this.id=t}static getTypeName(e){return"function"==typeof e?e.typeName:"object"==typeof e?e.constructor.typeName:e||B.typeName}get typeName(){return this.constructor.typeName}get displayTypeName(){const e=this.typeName;return"Node"===e?e:e.substr(1)}get isLocked(){return this._isLocked}get text(){return this.constructor.text}get icon(){return this.constructor.icon}get name(){return this._name}get displayName(){return this._name||this.text||this.displayTypeName}set name(e){this._name=e,this.emit({type:"change",what:"name",node:this})}get tags(){return this._tags}addTag(e){this._tags.has(e)||(this._tags.add(e),this.graph._addNodeTag(e,this))}removeTag(e){this._tags.has(e)&&(this._tags.delete(e),this.graph._removeNodeTag(e,this))}get system(){return this.graph.system}getComponent(e,t=!1){return this.components.get(e,t)}getComponents(e){return this.components.getArray(e)}getComponentsByTag(e){return this.components.getByTag(e)}getOrCreateComponent(e){return this.components.get(e,!0)||this.createComponent(e)}hasComponent(e){return this.components.has(e)}getGraphComponent(e,t=!1){return this.graph.components.get(e,t)}getGraphComponents(e){return this.graph.components.getArray(e)}getGraphComponentsByTag(e){return this.graph.components.getByTag(e)}hasGraphComponent(e){return this.graph.components.has(e)}getMainComponent(e,t=!1){return this.graph.system.graph.components.get(e,t)}getMainComponents(e){return this.graph.system.graph.components.getArray(e)}getMainComponentsByTag(e){return this.graph.system.graph.components.getByTag(e)}hasMainComponent(e){return this.graph.system.graph.components.has(e)}getSystemComponent(e,t=!1){return this.graph.system.components.get(e,t)}getSystemComponents(e){return this.graph.system.components.getArray(e)}getSystemComponentsByTag(e){return this.graph.system.components.getByTag(e)}hasSystemComponent(e){return this.graph.system.components.has(e)}getComponentById(e){return this.graph.system.components.getById(e)}getNode(e,t=!1){return this.graph.nodes.get(e,t)}getNodes(e){return this.graph.nodes.getArray(e)}getNodesByTag(e){return this.graph.nodes.getByTag(e)}hasNode(e){return this.graph.nodes.has(e)}getMainNode(e,t=!1){return this.graph.system.graph.nodes.get(e,t)}getMainNodes(e){return this.graph.system.graph.nodes.getArray(e)}getMainNodesByTag(e){return this.graph.system.graph.nodes.getByTag(e)}hasMainNode(e){return this.graph.system.graph.nodes.has(e)}getSystemNode(e,t=!1){return this.graph.system.nodes.get(e,t)}getSystemNodes(e){return this.graph.system.nodes.getArray(e)}getSystemNodesByTag(e){return this.graph.system.nodes.getByTag(e)}hasSystemNode(e){return this.graph.system.nodes.has(e)}getNodeById(e){return this.graph.system.nodes.getById(e)}lock(){if(!1===this._isLocked)throw new Error("can't lock an unlocked node again");this._isLocked=!0}unlock(){this._isLocked=!1}create(){this.graph._addNode(this)}createComponents(){}clear(){this.components.getArray().slice().forEach(e=>e.dispose())}dispose(){this.components.cloneArray().reverse().forEach(e=>e.dispose()),this.emit({type:"dispose",node:this}),this.graph&&(this.graph._removeNode(this),this.graph=null)}createComponent(e,t,n){if(!0===this._isLocked)throw new Error("node is locked, can't create component");const i=this.system.registry.getType(e);if(!i)throw new Error(`component type '${j.getTypeName(e)}' not registered`);const s=new i(this,n||k(12,this.system.components.getDictionary()));return s.create(),t&&(s.name=t),s}is(e){const t=B.getTypeName(e);let n=this;do{if(n=Object.getPrototypeOf(n),n.constructor.typeName===t)return!0}while(n.constructor.typeName!==B.typeName);return!1}toString(e=!1){const t=this.components.getArray(),n=`Node '${this.name}' - ${t.length} components`;return e?n+"\n"+t.map(e=>"  "+e.toString()).join("\n"):n}dump(e=""){console.log(e+`%cNode '${this.typeName}' (${this.displayName})`,"color: blue"),this.components.getArray().forEach(t=>t.dump(e+"  "))}toJSON(){const e={},t=[];this._isLocked&&(e.locked=!0);const n=this.components.getArray();for(let e=0,i=n.length;e<i;++e){const i=n[e],s=this.componentToJSON(i);s&&(s.type=i.typeName,s.id=i.id,i.name&&(s.name=i.name),t.push(s))}return t.length>0&&(e.components=t),e}fromJSON(e){this._isLocked=!!e.locked,e.components&&e.components.forEach(e=>this.componentFromJSON(e))}componentFromJSON(e){this.createComponent(e.type,e.name,e.id).fromJSON(e)}referencesFromJSON(e){e.components&&e.components.forEach(e=>{this.components.getById(e.id).referencesFromJSON(e)})}componentToJSON(e){return e.toJSON()}_addComponent(e){if(e.isNodeSingleton&&this.components.has(e))throw new Error(`only one component of type '${e.typeName}' allowed per node`);this.components.add(e),this.graph._addComponent(e)}_removeComponent(e){this.graph._removeComponent(e),this.components.remove(e)}_addComponentTag(e,t){this.components.addByTag(e,t),this.graph._addComponentTag(e,t)}_removeComponentTag(e,t){this.graph._removeComponentTag(e,t),this.components.removeByTag(e,t)}}B.typeName="Node",B.text="",B.icon="";class j extends o{constructor(e,t){super({knownEvents:!1}),this.ins=new I(this),this.outs=new I(this),this.changed=!0,this.updated=!1,this._name="",this._tags=new Set,this._trackers=[],this.node=e,this.id=t}static getTypeName(e){return"function"==typeof e?e.typeName:"object"==typeof e?e.constructor.typeName:e||j.typeName}create(){this.node._addComponent(this),this.graph.isActive&&this.activate&&this.activate()}dispose(){this.graph.isActive&&this.deactivate&&this.deactivate(),this.emit({type:"dispose",component:this}),this.ins.dispose(),this.outs.dispose(),this._trackers.forEach(e=>e.dispose()),this.node&&(this.node._removeComponent(this),this.node=null)}get isNodeSingleton(){return this.constructor.isNodeSingleton}get isGraphSingleton(){return this.constructor.isGraphSingleton}get isSystemSingleton(){return this.constructor.isSystemSingleton}get typeName(){return this.constructor.typeName}get displayTypeName(){const e=this.typeName;return"Component"===e?e:e.substr(1)}get text(){return this.constructor.text}get icon(){return this.constructor.icon}get name(){return this._name}get displayName(){return this._name||this.text||this.displayTypeName}set name(e){this._name=e,this.emit({type:"change",component:this,what:"name"})}get tags(){return this._tags}addTag(e){this._tags.has(e)||(this._tags.add(e),this.node._addComponentTag(e,this))}removeTag(e){this._tags.has(e)&&(this._tags.delete(e),this.node._removeComponentTag(e,this))}get graph(){return this.node.graph}get system(){return this.node.system}get components(){return this.node.components}get isActive(){return this.graph.isActive}getComponent(e,t=!1){return this.node.components.get(e,t)}getComponents(e){return this.node.components.getArray(e)}getComponentsByTag(e){return this.node.components.getByTag(e)}createComponent(e){return this.node.createComponent(e)}getOrCreateComponent(e){return this.node.components.get(e,!0)||this.node.createComponent(e)}hasComponent(e){return this.node.components.has(e)}getGraphComponent(e,t=!1){return this.node.graph.components.get(e,t)}getGraphComponents(e){return this.node.graph.components.getArray(e)}getGraphComponentsByTag(e){return this.node.graph.components.getByTag(e)}hasGraphComponent(e){return this.node.graph.components.has(e)}getMainComponent(e,t=!1){return this.node.system.graph.components.get(e,t)}getMainComponents(e){return this.node.system.graph.components.getArray(e)}getMainComponentsByTag(e){return this.node.system.graph.components.getByTag(e)}hasMainComponent(e){return this.node.system.graph.components.has(e)}getSystemComponent(e,t=!1){return this.node.system.components.get(e,t)}getSystemComponents(e){return this.node.system.components.getArray(e)}getSystemComponentsByTag(e){return this.node.system.components.getByTag(e)}hasSystemComponent(e){return this.node.system.components.has(e)}getComponentById(e){return this.node.system.components.getById(e)}getNode(e,t=!1){return this.node.graph.nodes.get(e,t)}getNodes(e){return this.node.graph.nodes.getArray(e)}getNodesByTag(e){return this.node.graph.nodes.getByTag(e)}hasNode(e){return this.node.graph.nodes.has(e)}getMainNode(e,t=!1){return this.node.system.graph.nodes.get(e,t)}getMainNodes(e){return this.node.system.graph.nodes.getArray(e)}getMainNodesByTag(e){return this.node.system.graph.nodes.getByTag(e)}hasMainNode(e){return this.node.system.graph.nodes.has(e)}getSystemNode(e,t=!1){return this.node.system.nodes.get(e,t)}getSystemNodes(e){return this.node.system.nodes.getArray(e)}getSystemNodesByTag(e){return this.node.system.nodes.getByTag(e)}hasSystemNode(e){return this.node.system.nodes.has(e)}getNodeById(e){return this.node.system.nodes.getById(e)}activate(){}update(e){throw new Error("this should never be called")}tick(e){throw new Error("this should never be called")}tock(e){throw new Error("this should never be called")}deactivate(){}requestSort(){this.graph.requestSort()}is(e){const t=j.getTypeName(e);let n=this;do{if(n=Object.getPrototypeOf(n),n.constructor.typeName===t)return!0}while(n.constructor.typeName!==j.typeName);return!1}unlinkAllProperties(){this.ins.unlinkAllProperties(),this.outs.unlinkAllProperties()}resetChanged(){this.changed=!1;const e=this.ins.properties;for(let t=0,n=e.length;t<n;++t)e[t].changed=!1;const t=this.outs.properties;for(let e=0,n=t.length;e<n;++e)t[e].changed=!1}trackComponent(e,t,n){const i=new z(this.node.components,e,t,n);return this._trackers.push(i),i}referenceComponent(e){return new U(this.system,e)}toString(){return`${this.typeName}${this.name?" ("+this.name+")":""}`}dump(e=""){console.log(e+`%cComponent '${this.typeName}' (${this.displayName})`,"color: green"),this.ins.properties.forEach(t=>t.dump(e+"  IN  ")),this.outs.properties.forEach(t=>t.dump(e+"  OUT "))}toJSON(){let e={};const t=this.ins.toJSON();t&&(e.ins=t);const n=this.outs.toJSON();return n&&(e.outs=n),e}fromJSON(e){e.ins&&this.ins.fromJSON(e.ins),e.outs&&this.outs.fromJSON(e.outs)}referencesFromJSON(e){const t=this.system.components.getDictionary();e.ins&&this.ins.linksFromJSON(e.ins,t),e.outs&&this.outs.linksFromJSON(e.outs,t)}addCustomInput(e,t,n){return this.changed=!0,this.ins.createCustomProperty(e,t,n)}allowCustomInput(e){return!1}addCustomOutput(e,t,n){return this.outs.createCustomProperty(e,t,n)}allowCustomOutput(e){return!1}addInputs(e,t){return this.ins.createProperties(e,t)}addOutputs(e,t){return this.outs.createProperties(e,t)}}j.typeName="Component",j.text="",j.icon="",j.isNodeSingleton=!0,j.isGraphSingleton=!1,j.isSystemSingleton=!1,j.prototype.activate=null,j.prototype.update=null,j.prototype.tick=null,j.prototype.tock=null,j.prototype.deactivate=null;class $ extends j{constructor(e,t){super(e,t),this.ins=this.addInputs($.ins),this.outs=this.addOutputs($.outs),this._fullscreenElement=null,this.onFullscreenChange=this.onFullscreenChange.bind(this);const n=document.documentElement,i=n.requestFullscreen||n.mozRequestFullScreen||n.webkitRequestFullscreen;this.outs.fullscreenAvailable.setValue(!!i),this.ins.toggle.on("value",this.toggle,this)}get fullscreenElement(){return this._fullscreenElement}set fullscreenElement(e){e!==this._fullscreenElement&&(this._fullscreenElement&&this._fullscreenElement.removeEventListener("fullscreenchange",this.onFullscreenChange),this._fullscreenElement=e,e&&e.addEventListener("fullscreenchange",this.onFullscreenChange))}update(e){return!0}toggle(){const e=this.outs,t=this._fullscreenElement;if(t){const n=e.fullscreenActive.value;if(!n&&e.fullscreenAvailable.value)t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);else if(n){const e=document;e.exitFullscreen?e.exitFullscreen():e.cancelFullScreen?e.cancelFullScreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen&&e.webkitCancelFullScreen()}}}onFullscreenChange(e){const t=document,n=t.fullscreenElement||t.mozFullScreenElement||t.webkitFullscreenElement;this.outs.fullscreenActive.setValue(!!n)}}$.typeName="CFullscreen",$.ins={toggle:D("Fullscreen.Toggle")},$.outs={fullscreenAvailable:C("Fullscreen.Available",!1),fullscreenActive:C("Fullscreen.Active",!1)};class G extends j{constructor(e,t){super(e,t),this.outs=this.addOutputs(G.pulseOuts),this._tockUpdated=!1,this.addEvent("pulse"),this.onAnimationFrame=this.onAnimationFrame.bind(this),this.context={time:new Date,secondsElapsed:0,secondsDelta:0,frameNumber:0},this._secondsStarted=.001*Date.now(),this._secondsStopped=this._secondsStarted,this._animHandler=0,this._pulseEvent={type:"pulse",context:this.context,systemUpdated:!1}}start(){0===this._animHandler&&(this._secondsStopped>0&&(this._secondsStarted+=.001*Date.now()-this._secondsStopped,this._secondsStopped=0),this._animHandler=window.requestAnimationFrame(this.onAnimationFrame))}stop(){0!==this._animHandler&&(0===this._secondsStopped&&(this._secondsStopped=.001*Date.now()),window.cancelAnimationFrame(this._animHandler),this._animHandler=0)}pulse(e){const{outs:t,context:n,_pulseEvent:i}=this;n.time.setTime(e);const s=.001*e-this._secondsStarted;n.secondsDelta=s-n.secondsElapsed,n.secondsElapsed=s,n.frameNumber++,t.time.setValue(n.secondsElapsed),t.frame.setValue(n.frameNumber);const r=this.system.graph.tick(n);i.systemUpdated=r||this._tockUpdated,this.emit(i),this._tockUpdated=this.system.graph.tock(n)}onAnimationFrame(){this.pulse(Date.now()),this._animHandler=window.requestAnimationFrame(this.onAnimationFrame)}}var H;G.typeName="CPulse",G.isSystemSingleton=!0,G.pulseOuts={time:b("Pulse.Time"),frame:x("Pulse.Frame")},function(e){e[e.Basic=0]="Basic",e[e.PCF=1]="PCF",e[e.PCFSoft=2]="PCFSoft"}(H||(H={}));const W={[H.Basic]:0,[H.PCF]:1,[H.PCFSoft]:2};class q extends j{constructor(e,t){super(e,t),this.ins=this.addInputs(q.ins),this.outs=this.addOutputs(q.outs),this.views=[],this._activeSceneComponent=null,this._forceRender=!1,this.addEvents("active-scene","active-camera")}get activeSceneComponent(){return this._activeSceneComponent}set activeSceneComponent(e){if(e!==this._activeSceneComponent){const t=this._activeSceneComponent,n=this.activeCameraComponent;t&&t.off("active-camera",this.onActiveCamera,this),e&&e.on("active-camera",this.onActiveCamera,this),this._activeSceneComponent=e;const i=this.activeCameraComponent,s={type:"active-scene",previous:t,next:e};this.emit(s);const r={type:"active-camera",previous:n,next:i};this.emit(r)}}get activeSceneGraph(){return this._activeSceneComponent?this._activeSceneComponent.graph:null}get activeScene(){return this._activeSceneComponent?this._activeSceneComponent.scene:null}get activeCameraComponent(){return this._activeSceneComponent?this._activeSceneComponent.activeCameraComponent:null}get activeCamera(){const e=this._activeSceneComponent?this._activeSceneComponent.activeCameraComponent:null;return e?e.camera:null}forceRender(){this._forceRender=!0}create(){super.create(),this.trackComponent(G,e=>{e.on("pulse",this.onPulse,this)},e=>{e.off("pulse",this.onPulse,this)})}update(){const e=this.ins;if(e.exposure.changed&&this.views.forEach(t=>t.renderer.toneMappingExposure=e.exposure.value),e.gamma.changed){this.views.forEach(t=>t.renderer.gammaFactor=e.gamma.value);const t=this.activeScene;t&&t.traverse(e=>{const t=e;t.isMesh&&(Array.isArray(t.material)?t.material.forEach(e=>e.needsUpdate=!0):t.material.needsUpdate=!0)})}return e.shadowsEnabled.changed&&this.views.forEach(t=>t.renderer.shadowMap.enabled=e.shadowsEnabled.value),e.shadowMapType.changed&&this.views.forEach(t=>t.renderer.shadowMap.type=W[e.shadowMapType.getValidatedValue()]),!0}attachView(e){if(0===this.views.length){const t=e.renderer,n=this.outs;n.maxTextureSize.setValue(t.capabilities.maxTextureSize),n.maxCubemapSize.setValue(t.capabilities.maxCubemapSize)}this.views.push(e)}detachView(e){const t=this.views.indexOf(e);if(t<0)throw new Error("render view not registered");this.views.splice(t,1)}logInfo(){this.views.forEach(e=>{console.log(e.renderer.info)})}onPulse(e){(e.systemUpdated||this._forceRender)&&(this.views.forEach(e=>{e.renderer.xr.isPresenting||e.render()}),this._forceRender=!1)}onActiveCamera(e){this.emit(e)}}q.typeName="CRenderer",q.isSystemSingleton=!0,q.ins={exposure:b("Shading.Exposure",1),gamma:b("Shading.Gamma",2),shadowsEnabled:C("Shadows.Enabled",!0),shadowMapType:L("Shadows.MapType",H,H.PCF)},q.outs={maxTextureSize:x("Caps.MaxTextureSize"),maxCubemapSize:x("Caps.MaxCubemapSize")};const X=[];for(let e=0;e<256;e++)X[e]=(e<16?"0":"")+e.toString(16);let Y=1234567;const Z={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(X[255&e]+X[e>>8&255]+X[e>>16&255]+X[e>>24&255]+"-"+X[255&t]+X[t>>8&255]+"-"+X[t>>16&15|64]+X[t>>24&255]+"-"+X[63&n|128]+X[n>>8&255]+"-"+X[n>>16&255]+X[n>>24&255]+X[255&i]+X[i>>8&255]+X[i>>16&255]+X[i>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,i,s){return i+(e-t)*(s-i)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:function(e,t,n){return(1-n)*e+n*t},damp:function(e,t,n,i){return Z.lerp(e,t,1-Math.exp(-n*i))},pingpong:function(e,t=1){return t-Math.abs(Z.euclideanModulo(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(Y=e%2147483647),Y=16807*Y%2147483647,(Y-1)/2147483646},degToRad:function(e){return e*Z.DEG2RAD},radToDeg:function(e){return e*Z.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,i,s){const r=Math.cos,o=Math.sin,a=r(n/2),l=o(n/2),c=r((t+i)/2),h=o((t+i)/2),u=r((t-i)/2),d=o((t-i)/2),p=r((i-t)/2),f=o((i-t)/2);switch(s){case"XYX":e.set(a*h,l*u,l*d,a*c);break;case"YZY":e.set(l*d,a*h,l*u,a*c);break;case"ZXZ":e.set(l*u,l*d,a*h,a*c);break;case"XZX":e.set(a*h,l*f,l*p,a*c);break;case"YXY":e.set(l*p,a*h,l*f,a*c);break;case"ZYZ":e.set(l*f,l*p,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}};class J{constructor(e=0,t=0,n=0,i=1){this._x=e,this._y=t,this._z=n,this._w=i}static slerp(e,t,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,i)}static slerpFlat(e,t,n,i,s,r,o){let a=n[i+0],l=n[i+1],c=n[i+2],h=n[i+3];const u=s[r+0],d=s[r+1],p=s[r+2],f=s[r+3];if(0===o)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=h);if(1===o)return e[t+0]=u,e[t+1]=d,e[t+2]=p,void(e[t+3]=f);if(h!==f||a!==u||l!==d||c!==p){let e=1-o;const t=a*u+l*d+c*p+h*f,n=t>=0?1:-1,i=1-t*t;if(i>Number.EPSILON){const s=Math.sqrt(i),r=Math.atan2(s,t*n);e=Math.sin(e*r)/s,o=Math.sin(o*r)/s}const s=o*n;if(a=a*e+u*s,l=l*e+d*s,c=c*e+p*s,h=h*e+f*s,e===1-o){const e=1/Math.sqrt(a*a+l*l+c*c+h*h);a*=e,l*=e,c*=e,h*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,i,s,r){const o=n[i],a=n[i+1],l=n[i+2],c=n[i+3],h=s[r],u=s[r+1],d=s[r+2],p=s[r+3];return e[t]=o*p+c*h+a*d-l*u,e[t+1]=a*p+c*u+l*h-o*d,e[t+2]=l*p+c*d+o*u-a*h,e[t+3]=c*p-o*h-a*u-l*d,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,i=e._y,s=e._z,r=e._order,o=Math.cos,a=Math.sin,l=o(n/2),c=o(i/2),h=o(s/2),u=a(n/2),d=a(i/2),p=a(s/2);switch(r){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],s=t[8],r=t[1],o=t[5],a=t[9],l=t[2],c=t[6],h=t[10],u=n+o+h;if(u>0){const e=.5/Math.sqrt(u+1);this._w=.25/e,this._x=(c-a)*e,this._y=(s-l)*e,this._z=(r-i)*e}else if(n>o&&n>h){const e=2*Math.sqrt(1+n-o-h);this._w=(c-a)/e,this._x=.25*e,this._y=(i+r)/e,this._z=(s+l)/e}else if(o>h){const e=2*Math.sqrt(1+o-n-h);this._w=(s-l)/e,this._x=(i+r)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+h-n-o);this._w=(r-i)/e,this._x=(s+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Z.clamp(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,s=e._z,r=e._w,o=t._x,a=t._y,l=t._z,c=t._w;return this._x=n*c+r*o+i*l-s*a,this._y=i*c+r*a+s*o-n*l,this._z=s*c+r*l+n*a-i*o,this._w=r*c-n*o-i*a-s*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,i=this._y,s=this._z,r=this._w;let o=r*e._w+n*e._x+i*e._y+s*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=r,this._x=n,this._y=i,this._z=s,this;const a=1-o*o;if(a<=Number.EPSILON){const e=1-t;return this._w=e*r+t*this._w,this._x=e*n+t*this._x,this._y=e*i+t*this._y,this._z=e*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),h=Math.sin((1-t)*c)/l,u=Math.sin(t*c)/l;return this._w=r*h+this._w*u,this._x=n*h+this._x*u,this._y=i*h+this._y*u,this._z=s*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(e,t,n){this.copy(e).slerp(t,n)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}J.prototype.isQuaternion=!0;class K{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(ee.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(ee.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*i,this.y=s[1]*t+s[4]*n+s[7]*i,this.z=s[2]*t+s[5]*n+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=e.elements,r=1/(s[3]*t+s[7]*n+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*i+s[12])*r,this.y=(s[1]*t+s[5]*n+s[9]*i+s[13])*r,this.z=(s[2]*t+s[6]*n+s[10]*i+s[14])*r,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,s=e.x,r=e.y,o=e.z,a=e.w,l=a*t+r*i-o*n,c=a*n+o*t-s*i,h=a*i+s*n-r*t,u=-s*t-r*n-o*i;return this.x=l*a+u*-s+c*-o-h*-r,this.y=c*a+u*-r+h*-s-l*-o,this.z=h*a+u*-o+l*-r-c*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i,this.y=s[1]*t+s[5]*n+s[9]*i,this.z=s[2]*t+s[6]*n+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,s=e.z,r=t.x,o=t.y,a=t.z;return this.x=i*a-s*o,this.y=s*r-n*a,this.z=n*o-i*r,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Q.copy(this).projectOnVector(e),this.sub(Q)}reflect(e){return this.sub(Q.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Z.clamp(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}K.prototype.isVector3=!0;const Q=new K,ee=new J;class te{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,s,r,o,a,l,c,h,u,d,p,f,m){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=s,g[5]=r,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new te).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/ne.setFromMatrixColumn(e,0).length(),s=1/ne.setFromMatrixColumn(e,1).length(),r=1/ne.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*r,t[9]=n[9]*r,t[10]=n[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,i=e.y,s=e.z,r=Math.cos(n),o=Math.sin(n),a=Math.cos(i),l=Math.sin(i),c=Math.cos(s),h=Math.sin(s);if("XYZ"===e.order){const e=r*c,n=r*h,i=o*c,s=o*h;t[0]=a*c,t[4]=-a*h,t[8]=l,t[1]=n+i*l,t[5]=e-s*l,t[9]=-o*a,t[2]=s-e*l,t[6]=i+n*l,t[10]=r*a}else if("YXZ"===e.order){const e=a*c,n=a*h,i=l*c,s=l*h;t[0]=e+s*o,t[4]=i*o-n,t[8]=r*l,t[1]=r*h,t[5]=r*c,t[9]=-o,t[2]=n*o-i,t[6]=s+e*o,t[10]=r*a}else if("ZXY"===e.order){const e=a*c,n=a*h,i=l*c,s=l*h;t[0]=e-s*o,t[4]=-r*h,t[8]=i+n*o,t[1]=n+i*o,t[5]=r*c,t[9]=s-e*o,t[2]=-r*l,t[6]=o,t[10]=r*a}else if("ZYX"===e.order){const e=r*c,n=r*h,i=o*c,s=o*h;t[0]=a*c,t[4]=i*l-n,t[8]=e*l+s,t[1]=a*h,t[5]=s*l+e,t[9]=n*l-i,t[2]=-l,t[6]=o*a,t[10]=r*a}else if("YZX"===e.order){const e=r*a,n=r*l,i=o*a,s=o*l;t[0]=a*c,t[4]=s-e*h,t[8]=i*h+n,t[1]=h,t[5]=r*c,t[9]=-o*c,t[2]=-l*c,t[6]=n*h+i,t[10]=e-s*h}else if("XZY"===e.order){const e=r*a,n=r*l,i=o*a,s=o*l;t[0]=a*c,t[4]=-h,t[8]=l*c,t[1]=e*h+s,t[5]=r*c,t[9]=n*h-i,t[2]=i*h-n,t[6]=o*c,t[10]=s*h+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(se,e,re)}lookAt(e,t,n){const i=this.elements;return le.subVectors(e,t),0===le.lengthSq()&&(le.z=1),le.normalize(),oe.crossVectors(n,le),0===oe.lengthSq()&&(1===Math.abs(n.z)?le.x+=1e-4:le.z+=1e-4,le.normalize(),oe.crossVectors(n,le)),oe.normalize(),ae.crossVectors(le,oe),i[0]=oe.x,i[4]=ae.x,i[8]=le.x,i[1]=oe.y,i[5]=ae.y,i[9]=le.y,i[2]=oe.z,i[6]=ae.z,i[10]=le.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,r=n[0],o=n[4],a=n[8],l=n[12],c=n[1],h=n[5],u=n[9],d=n[13],p=n[2],f=n[6],m=n[10],g=n[14],v=n[3],y=n[7],b=n[11],x=n[15],_=i[0],w=i[4],S=i[8],M=i[12],E=i[1],T=i[5],C=i[9],A=i[13],P=i[2],L=i[6],R=i[10],N=i[14],D=i[3],O=i[7],k=i[11],I=i[15];return s[0]=r*_+o*E+a*P+l*D,s[4]=r*w+o*T+a*L+l*O,s[8]=r*S+o*C+a*R+l*k,s[12]=r*M+o*A+a*N+l*I,s[1]=c*_+h*E+u*P+d*D,s[5]=c*w+h*T+u*L+d*O,s[9]=c*S+h*C+u*R+d*k,s[13]=c*M+h*A+u*N+d*I,s[2]=p*_+f*E+m*P+g*D,s[6]=p*w+f*T+m*L+g*O,s[10]=p*S+f*C+m*R+g*k,s[14]=p*M+f*A+m*N+g*I,s[3]=v*_+y*E+b*P+x*D,s[7]=v*w+y*T+b*L+x*O,s[11]=v*S+y*C+b*R+x*k,s[15]=v*M+y*A+b*N+x*I,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],s=e[12],r=e[1],o=e[5],a=e[9],l=e[13],c=e[2],h=e[6],u=e[10],d=e[14];return e[3]*(+s*a*h-i*l*h-s*o*u+n*l*u+i*o*d-n*a*d)+e[7]*(+t*a*d-t*l*u+s*r*u-i*r*d+i*l*c-s*a*c)+e[11]*(+t*l*h-t*o*d-s*r*h+n*r*d+s*o*c-n*l*c)+e[15]*(-i*o*c-t*a*h+t*o*u+i*r*h-n*r*u+n*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],r=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15],v=h*m*l-f*u*l+f*a*d-o*m*d-h*a*g+o*u*g,y=p*u*l-c*m*l-p*a*d+r*m*d+c*a*g-r*u*g,b=c*f*l-p*h*l+p*o*d-r*f*d-c*o*g+r*h*g,x=p*h*a-c*f*a-p*o*u+r*f*u+c*o*m-r*h*m,_=t*v+n*y+i*b+s*x;if(0===_)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/_;return e[0]=v*w,e[1]=(f*u*s-h*m*s-f*i*d+n*m*d+h*i*g-n*u*g)*w,e[2]=(o*m*s-f*a*s+f*i*l-n*m*l-o*i*g+n*a*g)*w,e[3]=(h*a*s-o*u*s-h*i*l+n*u*l+o*i*d-n*a*d)*w,e[4]=y*w,e[5]=(c*m*s-p*u*s+p*i*d-t*m*d-c*i*g+t*u*g)*w,e[6]=(p*a*s-r*m*s-p*i*l+t*m*l+r*i*g-t*a*g)*w,e[7]=(r*u*s-c*a*s+c*i*l-t*u*l-r*i*d+t*a*d)*w,e[8]=b*w,e[9]=(p*h*s-c*f*s-p*n*d+t*f*d+c*n*g-t*h*g)*w,e[10]=(r*f*s-p*o*s+p*n*l-t*f*l-r*n*g+t*o*g)*w,e[11]=(c*o*s-r*h*s-c*n*l+t*h*l+r*n*d-t*o*d)*w,e[12]=x*w,e[13]=(c*f*i-p*h*i+p*n*u-t*f*u-c*n*m+t*h*m)*w,e[14]=(p*o*i-r*f*i-p*n*a+t*f*a+r*n*m-t*o*m)*w,e[15]=(r*h*i-c*o*i+c*n*a-t*h*a-r*n*u+t*o*u)*w,this}scale(e){const t=this.elements,n=e.x,i=e.y,s=e.z;return t[0]*=n,t[4]*=i,t[8]*=s,t[1]*=n,t[5]*=i,t[9]*=s,t[2]*=n,t[6]*=i,t[10]*=s,t[3]*=n,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),s=1-n,r=e.x,o=e.y,a=e.z,l=s*r,c=s*o;return this.set(l*r+n,l*o-i*a,l*a+i*o,0,l*o+i*a,c*o+n,c*a-i*r,0,l*a-i*o,c*a+i*r,s*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,s=t._x,r=t._y,o=t._z,a=t._w,l=s+s,c=r+r,h=o+o,u=s*l,d=s*c,p=s*h,f=r*c,m=r*h,g=o*h,v=a*l,y=a*c,b=a*h,x=n.x,_=n.y,w=n.z;return i[0]=(1-(f+g))*x,i[1]=(d+b)*x,i[2]=(p-y)*x,i[3]=0,i[4]=(d-b)*_,i[5]=(1-(u+g))*_,i[6]=(m+v)*_,i[7]=0,i[8]=(p+y)*w,i[9]=(m-v)*w,i[10]=(1-(u+f))*w,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let s=ne.set(i[0],i[1],i[2]).length();const r=ne.set(i[4],i[5],i[6]).length(),o=ne.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],ie.copy(this);const a=1/s,l=1/r,c=1/o;return ie.elements[0]*=a,ie.elements[1]*=a,ie.elements[2]*=a,ie.elements[4]*=l,ie.elements[5]*=l,ie.elements[6]*=l,ie.elements[8]*=c,ie.elements[9]*=c,ie.elements[10]*=c,t.setFromRotationMatrix(ie),n.x=s,n.y=r,n.z=o,this}makePerspective(e,t,n,i,s,r){void 0===r&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*s/(t-e),l=2*s/(n-i),c=(t+e)/(t-e),h=(n+i)/(n-i),u=-(r+s)/(r-s),d=-2*r*s/(r-s);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=h,o[13]=0,o[2]=0,o[6]=0,o[10]=u,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,n,i,s,r){const o=this.elements,a=1/(t-e),l=1/(n-i),c=1/(r-s),h=(t+e)*a,u=(n+i)*l,d=(r+s)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-h,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-u,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}te.prototype.isMatrix4=!0;const ne=new K,ie=new te,se=new K(0,0,0),re=new K(1,1,1),oe=new K,ae=new K,le=new K,ce=new te,he=new J;class ue{constructor(e=0,t=0,n=0,i=ue.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t,n){const i=Z.clamp,s=e.elements,r=s[0],o=s[4],a=s[8],l=s[1],c=s[5],h=s[9],u=s[2],d=s[6],p=s[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(i(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-i(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(i(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,p),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-i(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(i(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-i(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return ce.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ce,t,n)}setFromVector3(e,t){return this.set(e.x,e.y,e.z,t||this._order)}reorder(e){return he.setFromEuler(this),this.setFromQuaternion(he,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new K(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}function de(){}ue.prototype.isEuler=!0,ue.DefaultOrder="XYZ",ue.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Object.assign(de.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}},dispatchEvent:function(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,i=n.length;t<i;t++)n[t].call(this,e);e.target=null}}});class pe{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}class fe{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,i,s,r,o,a,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=o,c[3]=t,c[4]=s,c[5]=a,c[6]=n,c[7]=r,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,r=n[0],o=n[3],a=n[6],l=n[1],c=n[4],h=n[7],u=n[2],d=n[5],p=n[8],f=i[0],m=i[3],g=i[6],v=i[1],y=i[4],b=i[7],x=i[2],_=i[5],w=i[8];return s[0]=r*f+o*v+a*x,s[3]=r*m+o*y+a*_,s[6]=r*g+o*b+a*w,s[1]=l*f+c*v+h*x,s[4]=l*m+c*y+h*_,s[7]=l*g+c*b+h*w,s[2]=u*f+d*v+p*x,s[5]=u*m+d*y+p*_,s[8]=u*g+d*b+p*w,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],r=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*r*c-t*o*l-n*s*c+n*o*a+i*s*l-i*r*a}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],r=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=c*r-o*l,u=o*a-c*s,d=l*s-r*a,p=t*h+n*u+i*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const f=1/p;return e[0]=h*f,e[1]=(i*l-c*n)*f,e[2]=(o*n-i*r)*f,e[3]=u*f,e[4]=(c*t-i*a)*f,e[5]=(i*s-o*t)*f,e[6]=d*f,e[7]=(n*a-l*t)*f,e[8]=(r*t-n*s)*f,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,s,r,o){const a=Math.cos(s),l=Math.sin(s);return this.set(n*a,n*l,-n*(a*r+l*o)+r+e,-i*l,i*a,-i*(-l*r+a*o)+o+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.elements,s=i[0],r=i[3],o=i[6],a=i[1],l=i[4],c=i[7];return i[0]=t*s+n*a,i[3]=t*r+n*l,i[6]=t*o+n*c,i[1]=-n*s+t*a,i[4]=-n*r+t*l,i[7]=-n*o+t*c,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}fe.prototype.isMatrix3=!0;let me=0;const ge=new K,ve=new J,ye=new te,be=new K,xe=new K,_e=new K,we=new J,Se=new K(1,0,0),Me=new K(0,1,0),Ee=new K(0,0,1),Te={type:"added"},Ce={type:"removed"};function Ae(){Object.defineProperty(this,"id",{value:me++}),this.uuid=Z.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ae.DefaultUp.clone();const e=new K,t=new ue,n=new J,i=new K(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new te},normalMatrix:{value:new fe}}),this.matrix=new te,this.matrixWorld=new te,this.matrixAutoUpdate=Ae.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new pe,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}Ae.DefaultUp=new K(0,1,0),Ae.DefaultMatrixAutoUpdate=!0,Ae.prototype=Object.assign(Object.create(de.prototype),{constructor:Ae,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return ve.setFromAxisAngle(e,t),this.quaternion.multiply(ve),this},rotateOnWorldAxis:function(e,t){return ve.setFromAxisAngle(e,t),this.quaternion.premultiply(ve),this},rotateX:function(e){return this.rotateOnAxis(Se,e)},rotateY:function(e){return this.rotateOnAxis(Me,e)},rotateZ:function(e){return this.rotateOnAxis(Ee,e)},translateOnAxis:function(e,t){return ge.copy(e).applyQuaternion(this.quaternion),this.position.add(ge.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(Se,e)},translateY:function(e){return this.translateOnAxis(Me,e)},translateZ:function(e){return this.translateOnAxis(Ee,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(ye.copy(this.matrixWorld).invert())},lookAt:function(e,t,n){e.isVector3?be.copy(e):be.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),xe.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ye.lookAt(xe,be,this.up):ye.lookAt(be,xe,this.up),this.quaternion.setFromRotationMatrix(ye),i&&(ye.extractRotation(i.matrixWorld),ve.setFromRotationMatrix(ye),this.quaternion.premultiply(ve.invert()))},add:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Te)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Ce)),this},clear:function(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Ce)}return this.children.length=0,this},attach:function(e){return this.updateWorldMatrix(!0,!1),ye.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),ye.multiply(e.parent.matrixWorld)),e.applyMatrix4(ye),this.add(e),e.updateWorldMatrix(!1,!0),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new K),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new J),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xe,e,_e),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new K),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(xe,we,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new K),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)},traverseAncestors:function(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}},toJSON:function(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function s(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const i=n[t];s(e.shapes,i)}else s(e.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,i=this.material.length;n<i;n++)t.push(s(e.materials,this.material[n]));i.material=t}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let t=0;t<this.children.length;t++)i.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];i.animations.push(s(e.animations,n))}}if(t){const t=r(e.geometries),i=r(e.materials),s=r(e.textures),o=r(e.images),a=r(e.shapes),l=r(e.skeletons),c=r(e.animations);t.length>0&&(n.geometries=t),i.length>0&&(n.materials=i),s.length>0&&(n.textures=s),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),l.length>0&&(n.skeletons=l),c.length>0&&(n.animations=c)}return n.object=i,n;function r(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}});const Pe={PI:3.141592653589793,DOUBLE_PI:6.283185307179586,HALF_PI:1.5707963267948966,QUARTER_PI:.7853981633974483,DEG2RAD:.017453292519943295,RAD2DEG:57.29577951308232,limit:(e,t,n)=>e<t?t:e>n?n:e,limitInt:function(e,t,n){return(e=Math.trunc(e))<t?t:e>n?n:e},normalize:(e,t,n)=>(e-t)/(n-t),normalizeLimit:(e,t,n)=>(e=(e-t)/(n-t))<0?0:e>1?1:e,denormalize:(e,t,n)=>(t+e)*(n-t),scale:(e,t,n,i,s)=>i+(e-t)/(n-t)*(s-i),scaleLimit:(e,t,n,i,s)=>i+((e=e<t?t:e>n?n:e)-t)/(n-t)*(s-i),deg2rad:function(e){return.017453292519943295*e},rad2deg:function(e){return 57.29577951308232*e},deltaRadians:function(e,t){return e=(e%=Pe.DOUBLE_PI)<0?e+Pe.DOUBLE_PI:e,(t=(t%=Pe.DOUBLE_PI)<0?t+Pe.DOUBLE_PI:t)-e>Pe.PI&&(e+=Pe.DOUBLE_PI),t-e},deltaDegrees:function(e,t){return e=(e%=Pe.DOUBLE_PI)<0?e+Pe.DOUBLE_PI:e,(t=(t%=Pe.DOUBLE_PI)<0?t+Pe.DOUBLE_PI:t)-e>Pe.PI&&(e+=Pe.DOUBLE_PI),t-e},curves:{linear:e=>e,easeIn:e=>Math.sin(e*Pe.HALF_PI),easeOut:e=>Math.cos(e*Pe.HALF_PI-Pe.PI)+1,ease:e=>.5*Math.cos(e*Pe.PI-Pe.PI)+.5,easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),easeQuad:e=>e<.5?2*e*e:(4-2*e)*e-1,easeInCubic:e=>e*e*e,easeOutCubic:e=>--e*e*e+1,easeCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1- --e*e*e*e,easeQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e}};var Le=Pe;class Re{constructor(){this.visited={},this.visiting={},this.sorted=[]}sort(e){for(let t=0,n=e.length;t<n;++t)this.visit(e[t]);const t=this.sorted;return this.visited={},this.visiting={},this.sorted=[],t}visit(e){const t=this.visited,n=this.visiting;if(t[e.id]||n[e.id])return;n[e.id]=!0;const i=e.outs.properties.concat(e.ins.properties);for(let e=0,t=i.length;e<t;++e){const t=i[e].outLinks;for(let e=0,n=t.length;e<n;++e){const n=t[e].destination.group,i=n.properties;for(let e=0,t=i.length;e<t;++e){const t=i[e].outLinks;for(let e=0,n=t.length;e<n;++e){const n=t[e].destination.group;this.visit(n.linkable)}}this.visit(n.linkable)}}n[e.id]=void 0,t[e.id]=!0,this.sorted.unshift(e)}}class Ne extends o{constructor(e,t){super({knownEvents:!1}),this.nodes=new V(B),this.components=new V(j),this.roots=[],this._sorter=new Re,this._sortRequested=!0,this._sortedList=null,this._tockList=[],this._isActive=!1,this.system=e,this.parent=t}get isActive(){return this._isActive}getComponent(e,t=!1){return this.components.get(e,t)}getComponents(e){return this.components.getArray(e)}getComponentsByTag(e){return this.components.getByTag(e)}hasComponent(e){return this.components.has(e)}getMainComponent(e,t=!1){return this.system.graph.components.get(e,t)}getMainComponents(e){return this.system.graph.components.getArray(e)}getMainComponentsByTag(e){return this.system.graph.components.getByTag(e)}hasMainComponent(e){return this.system.graph.components.has(e)}getSystemComponent(e,t=!1){return this.system.components.get(e,t)}getSystemComponents(e){return this.system.components.getArray(e)}getSystemComponentsByTag(e){return this.system.components.getByTag(e)}hasSystemComponent(e){return this.system.components.has(e)}getComponentById(e){return this.system.components.getById(e)}getNode(e,t=!1){return this.nodes.get(e,t)}getNodes(e){return this.nodes.getArray(e)}getNodesByTag(e){return this.nodes.getByTag(e)}hasNode(e){return this.nodes.has(e)}getMainNode(e,t=!1){return this.system.graph.nodes.get(e,t)}getMainNodes(e){return this.system.graph.nodes.getArray(e)}getMainNodesByTag(e){return this.system.graph.nodes.getByTag(e)}hasMainNode(e){return this.system.graph.nodes.has(e)}getSystemNode(e,t=!1){return this.system.nodes.get(e,t)}getSystemNodes(e){return this.system.nodes.getArray(e)}getSystemNodesByTag(e){return this.system.nodes.getByTag(e)}hasSystemNode(e){return this.system.nodes.has(e)}getNodeById(e){return this.system.nodes.getById(e)}activate(){if(this._isActive)return;this._isActive=!0,this._sortRequested&&(this._sortRequested=!1,this.sort());const e=this._sortedList;for(let t=0,n=e.length;t<n;++t){const n=e[t];n.activate&&n.activate()}}deactivate(){if(!this._isActive)return;this._isActive=!1;const e=this._sortedList;for(let t=0,n=e.length;t<n;++t){const n=e[t];n.deactivate&&n.deactivate()}}tick(e){if(!this._isActive)return;this._sortRequested&&(this._sortRequested=!1,this.sort());const t=this._sortedList;let n=!1;for(let i=0,s=t.length;i<s;++i){const s=t[i];s.updated=!1,s.changed?(s.update&&s.update(e)&&(s.updated=!0),s.tick&&s.tick(e)&&(s.updated=!0),s.resetChanged()):s.tick&&s.tick(e)&&(s.updated=!0),s.updated&&(n=!0,s.emit("update"))}return n}tock(e){if(!this._isActive)return;const t=this._tockList;let n=!1;for(let i=0,s=t.length;i<s;++i)n=t[i].tock(e)||n;return n}clear(){const e=this.nodes.cloneArray().reverse();for(let t=0,n=e.length;t<n;++t)e[t].dispose();if(this.nodes.length>0)throw new Error("graph not empty")}requestSort(){this._sortRequested=!0}sort(){this._sortedList=this._sorter.sort(this.components.getArray());this.parent&&(this.parent.name||this.parent.typeName)}createCustomNode(e,t,n){const i=this.system.registry.getType(e);if(!i)throw new Error(`node type '${B.getTypeName(e)}' not registered`);const s=new i(this,n||k(12,this.system.nodes.getDictionary()));return s.create(),t&&(s.name=t),n||(s.createComponents(),s.unlock()),s}createNode(e,t){const n=new B(this,t||k(12,this.system.nodes.getDictionary()));return n.create(),e&&(n.name=e),n.unlock(),n}findNodeByName(e,t){const n=this.nodes.getArray(t);for(let t=0,i=n.length;t<i;++t)if(n[t].name===e)return n[t]}findRootNodes(e){const t=this.nodes.getArray(e),n=[];for(let e=0,i=t.length;e<i;++e){const i=t[e].components.get("CHierarchy",!0);i&&i.parent||n.push(t[e])}return n}toString(e=!1){const t=this.nodes.getArray(),n=this.components.count(),i=`Graph - ${t.length} nodes, ${n} components.`;return e?i+"\n"+t.map(e=>e.toString(!0)).join("\n"):i}dump(e=""){console.log(e+"%cGraph","color: red");this.findRootNodes().forEach(t=>t.dump(e+"  "))}toJSON(){const e={},t=[],n=this.nodes.getArray();for(let e=0,i=n.length;e<i;++e){const i=n[e],s=this.nodeToJSON(i);s.type=i.typeName,s.id=i.id,i.name&&(s.name=i.name),t.push(s)}return t.length>0&&(e.nodes=t),e}fromJSON(e){e.nodes&&(e.nodes.forEach(e=>{this.createCustomNode(e.type,e.name,e.id).fromJSON(e)}),e.nodes.forEach(e=>{this.nodes.getById(e.id).referencesFromJSON(e)}))}nodeToJSON(e){return e.toJSON()}_addNode(e){this.nodes.add(e),this.system._addNode(e)}_removeNode(e){this.system._removeNode(e),this.nodes.remove(e)}_addNodeTag(e,t){this.nodes.addByTag(e,t),this.system._addNodeTag(e,t)}_removeNodeTag(e,t){this.system._removeNodeTag(e,t),this.nodes.removeByTag(e,t)}_addComponent(e){if(e.isGraphSingleton&&this.components.has(e))throw new Error(`only one component of type '${e.typeName}' allowed per graph`);this.components.add(e),this.system._addComponent(e),e.tock&&this._tockList.push(e),this._sortRequested=!0}_removeComponent(e){this.system._removeComponent(e),this.components.remove(e),e.tock&&this._tockList.splice(this._tockList.indexOf(e),1),this._sortRequested=!0}_addComponentTag(e,t){this.components.addByTag(e,t),this.system._addComponentTag(e,t)}_removeComponentTag(e,t){this.system._removeComponentTag(e,t),this.components.removeByTag(e,t)}_addRoot(e){this.roots.push(e),this.parent&&this.parent.onAddInnerRoot(e)}_removeRoot(e){this.parent&&this.parent.onRemoveInnerRoot(e),this.roots.splice(this.roots.indexOf(e),1)}}class De extends j{constructor(e,t){super(e,t),this.ins=this.addInputs(De.graphIns),this._innerGraph=null,this._innerRoot=null,this._innerGraph=new Ne(this.system,this)}get innerGraph(){return this._innerGraph}get innerNodes(){return this._innerGraph.nodes}get innerComponents(){return this._innerGraph.components}get innerRoots(){return this._innerGraph.roots}getInnerComponent(e,t=!1){return this._innerGraph.components.get(e,t)}getInnerComponents(e){return this._innerGraph.components.getArray(e)}hasInnerComponent(e){return this._innerGraph.components.has(e)}getInnerNode(e,t=!1){return this._innerGraph.nodes.get(e,t)}getInnerNodes(e){return this._innerGraph.nodes.getArray(e)}hasInnerNode(e){return this._innerGraph.nodes.has(e)}isEmpty(){return 0===this._innerGraph.nodes.count()}update(e){const t=this.ins;if(t.active.changed){const e=t.active.value;e!==this._innerGraph.isActive&&(e?this.activateInnerGraph():this.deactivateInnerGraph())}return!0}tick(e){return this._innerGraph.tick(e)}tock(e){return this._innerGraph.tock(e)}dispose(){this._innerGraph.clear(),this._innerGraph=null,this._innerRoot=null,super.dispose()}clearInnerGraph(){this._innerGraph.clear()}fromJSON(e){super.fromJSON(e),this._innerGraph.clear(),this._innerGraph.fromJSON(e.graph)}toJSON(){const e=super.toJSON();return e.graph=this._innerGraph.toJSON(),e}dump(e=""){super.dump(e),this.innerGraph.dump(e+"  ")}onAddInnerRoot(e){}onRemoveInnerRoot(e){}activateInnerGraph(){this._innerGraph.activate()}deactivateInnerGraph(){this._innerGraph.deactivate()}}De.typeName="CGraph",De.graphIns={active:C("Graph.Active",!0)};const Oe=(e,t,n)=>{let i;const s=e.children;for(let e=0,n=s.length;e<n;++e)if(i=s[e].components.has(t),i)return!0;if(n)for(let e=0,n=s.length;e<n;++e)if(i=Oe(s[e],t,!0),i)return!0;return!1},ke=(e,t,n)=>{let i;const s=e.children;for(let e=0,n=s.length;e<n;++e)if(i=s[e].components.get(t),i)return i;if(n)for(let e=0,n=s.length;e<n;++e)if(i=ke(s[e],t,!0),i)return i;return null},Ie=(e,t,n)=>{let i=[];const s=e.children;for(let e=0,n=s.length;e<n;++e)i=i.concat(s[e].components.getArray(t));if(n)for(let e=0,n=s.length;e<n;++e)i=i.concat(Ie(s[e],t,!0));return i};class ze extends j{constructor(){super(...arguments),this._parent=null,this._children=[]}get parent(){return this._parent}get children(){return this._children||[]}create(){super.create(),this.graph._addRoot(this),this.node.components.on(j,this.onComponent,this)}dispose(){this.node.components.off(j,this.onComponent,this),this._children.slice().forEach(e=>e.node.dispose()),this._parent&&this._parent.removeChild(this),this.graph._removeRoot(this),super.dispose()}getRootComponent(e){let t=this;for(;t._parent;)t=t._parent;return t?t.node.components.get(e):null}getParentComponent(e,t){let n=this;for(;;){if(n=n._parent,!n){const e=this.graph.parent;n=e?e.components.get(ze):void 0}if(!n)return;const i=n.node.components.get(e,!0);if(i)return i;if(!t)return}}getParentNode(e,t){let n=this;for(;;){if(n=n._parent,!n){const e=this.graph.parent;n=e?e.components.get(ze):void 0}if(!n)return;const i=n.node;if(i.is(e))return i;if(!t)return}}getSiblingNode(e){return this.getSiblingNodes(e)[0]}getSiblingNodes(e){const t=this._parent;return this.graph.nodes.getArray(e).filter(e=>{const n=e.components.get(ze);return(n?n._parent:null)==t})}hasChildComponents(e,t){return Oe(this,e,t)}getChildComponent(e,t){return ke(this,e,t)}getChildComponents(e,t){return Ie(this,e,t)}traverseUp(e,t,n,i){if(e)if(t){const e=this.node.components.getArray();for(let t=0,n=e.length;t<n;++t)if(i(e[t]))return}else if(i(this))return;let s=this._parent;if(!s&&n){const e=this.node.graph.parent;s=e?e.getComponent(ze,!0):null}s&&s.traverseUp(!0,t,n,i)}traverseDown(e,t,n,i){if(e)if(t){const e=this.node.components.getArray();for(let t=0,n=e.length;t<n;++t)if(i(e[t]))return}else if(i(this))return;if(n){const e=this.node.components.getArray(De);for(let s=0,r=e.length;s<r;++s){const r=e[s].innerRoots;for(let e=0,s=r.length;e<s;++e)r[e].traverseDown(!0,t,n,i)}}const s=this._children;for(let e=0,r=s.length;e<r;++e)s[e].traverseDown(!0,t,n,i)}propagateUp(e,t,n){this.traverseUp(!0,e,t,e=>(e.emit(n),n.stopPropagation))}propagateDown(e,t,n){this.traverseDown(!0,e,t,e=>(e.emit(n),n.stopPropagation))}addChild(e){if(e===this)throw new Error("can't add self as child");if(e._parent)throw new Error("can't add child, component has a parent");if(e.graph!==this.graph)throw new Error("can't add child, component in different graph");e._parent=this,this._children.push(e),this.graph._removeRoot(e);const t={type:"hierarchy",add:!0,remove:!1,parent:this,child:e};this.traverseUp(!0,!1,!0,e=>e.emit(t)),this.traverseDown(!1,!1,!0,e=>e.emit(t)),this.system.emit(t)}removeChild(e){if(e._parent!==this)throw new Error("component not a child of this");const t={type:"hierarchy",add:!1,remove:!0,parent:this,child:e};this.traverseUp(!0,!1,!0,e=>e.emit(t)),this.traverseDown(!1,!1,!0,e=>e.emit(t)),this.system.emit(t);const n=this._children.indexOf(e);this._children.splice(n,1),e._parent=null,this.graph._addRoot(e)}onComponent(e){if(e.object===this)return;const t={type:"child",add:e.add,remove:e.remove,component:e.object};this.traverseUp(!0,!1,!0,e=>e.emit(t))}toJSON(){const e=super.toJSON();return this._children.length>0&&(e.children=this._children.map(e=>e.id)),e}referencesFromJSON(e){super.referencesFromJSON(e);const t=this.system.components.getDictionary();e.children&&e.children.forEach(e=>{const n=t[e];this.addChild(n)})}toString(){return super.toString()+" - children: "+this.children.length}dump(e=""){super.dump(e),this.children.length>0&&(console.log(e+"%cChildren","color: purple"),this.children.forEach(t=>t.node.dump(e+"  ")))}}ze.typeName="CHierarchy";const Ue=new K,Fe=new K,Ve=new J,Be=new ue;var je;!function(e){e[e.XYZ=0]="XYZ",e[e.YZX=1]="YZX",e[e.ZXY=2]="ZXY",e[e.XZY=3]="XZY",e[e.YXZ=4]="YXZ",e[e.ZYX=5]="ZYX"}(je||(je={}));class $e extends ze{constructor(e,t){super(e,t),this.ins=this.addInputs($e.transformIns),this.outs=this.addOutputs($e.transformOuts),this._object3D=this.createObject3D(),this._object3D.matrixAutoUpdate=!1}get transform(){return this}get object3D(){return this._object3D}get children(){return this._children||[]}get matrix(){return this._object3D.matrix}update(e){const t=this._object3D,{position:n,rotation:i,order:s,scale:r}=this.ins,{matrix:o}=this.outs;t.position.fromArray(n.value),Ue.fromArray(i.value).multiplyScalar(Le.DEG2RAD);const a=s.getOptionText();return t.rotation.setFromVector3(Ue,a),t.scale.fromArray(r.value),t.updateMatrix(),t.matrix.toArray(o.value),o.set(),!0}dispose(){this._object3D&&(this._object3D.children.slice().forEach(e=>this._object3D.remove(e)),this._object3D.parent&&this._object3D.parent.remove(this._object3D)),super.dispose()}setPropertiesFromMatrix(e){const t=!e;e=e||this._object3D.matrix;const{position:n,rotation:i,order:s,scale:r}=this.ins;e.decompose(Ue,Ve,Fe),Ue.toArray(n.value);const o=s.getOptionText();Be.setFromQuaternion(Ve,o),Be.toVector3(Ue),Ue.multiplyScalar(Le.RAD2DEG).toArray(i.value),Fe.toArray(r.value),n.set(t),i.set(t),r.set(t)}addChild(e){super.addChild(e),this._object3D.add(e._object3D)}removeChild(e){this._object3D.remove(e._object3D),super.removeChild(e)}createObject3D(){return new Ae}}$e.typeName="CTransform",$e.transformIns={position:w("Transform.Position"),rotation:w("Transform.Rotation"),order:L("Transform.Order",je),scale:E("Transform.Scale")},$e.transformOuts={matrix:S("Transform.Matrix")};class Ge{constructor(e=new K(1/0,1/0,1/0),t=new K(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,i=1/0,s=-1/0,r=-1/0,o=-1/0;for(let a=0,l=e.length;a<l;a+=3){const l=e[a],c=e[a+1],h=e[a+2];l<t&&(t=l),c<n&&(n=c),h<i&&(i=h),l>s&&(s=l),c>r&&(r=c),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(s,r,o),this}setFromBufferAttribute(e){let t=1/0,n=1/0,i=1/0,s=-1/0,r=-1/0,o=-1/0;for(let a=0,l=e.count;a<l;a++){const l=e.getX(a),c=e.getY(a),h=e.getZ(a);l<t&&(t=l),c<n&&(n=c),h<i&&(i=h),l>s&&(s=l),c>r&&(r=c),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(s,r,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=We.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new K),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new K),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),qe.copy(t.boundingBox),qe.applyMatrix4(e.matrixWorld),this.union(qe));const n=e.children;for(let e=0,t=n.length;e<t;e++)this.expandByObject(n[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new K),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,We),We.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(et),tt.subVectors(this.max,et),Xe.subVectors(e.a,et),Ye.subVectors(e.b,et),Ze.subVectors(e.c,et),Je.subVectors(Ye,Xe),Ke.subVectors(Ze,Ye),Qe.subVectors(Xe,Ze);let t=[0,-Je.z,Je.y,0,-Ke.z,Ke.y,0,-Qe.z,Qe.y,Je.z,0,-Je.x,Ke.z,0,-Ke.x,Qe.z,0,-Qe.x,-Je.y,Je.x,0,-Ke.y,Ke.x,0,-Qe.y,Qe.x,0];return!!st(t,Xe,Ye,Ze,tt)&&(t=[1,0,0,0,1,0,0,0,1],!!st(t,Xe,Ye,Ze,tt)&&(nt.crossVectors(Je,Ke),t=[nt.x,nt.y,nt.z],st(t,Xe,Ye,Ze,tt)))}clampPoint(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new K),t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return We.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(We).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(He[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),He[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),He[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),He[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),He[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),He[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),He[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),He[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(He)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Ge.prototype.isBox3=!0;const He=[new K,new K,new K,new K,new K,new K,new K,new K],We=new K,qe=new Ge,Xe=new K,Ye=new K,Ze=new K,Je=new K,Ke=new K,Qe=new K,et=new K,tt=new K,nt=new K,it=new K;function st(e,t,n,i,s){for(let r=0,o=e.length-3;r<=o;r+=3){it.fromArray(e,r);const o=s.x*Math.abs(it.x)+s.y*Math.abs(it.y)+s.z*Math.abs(it.z),a=t.dot(it),l=n.dot(it),c=i.dot(it);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const rt=new K,ot=new K,at=new K,lt=new K,ct=new K,ht=new K,ut=new K;class dt{constructor(e=new K,t=new K(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new K),t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,rt)),this}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new K),t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=rt.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(rt.copy(this.direction).multiplyScalar(t).add(this.origin),rt.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){ot.copy(e).add(t).multiplyScalar(.5),at.copy(t).sub(e).normalize(),lt.copy(this.origin).sub(ot);const s=.5*e.distanceTo(t),r=-this.direction.dot(at),o=lt.dot(this.direction),a=-lt.dot(at),l=lt.lengthSq(),c=Math.abs(1-r*r);let h,u,d,p;if(c>0)if(h=r*a-o,u=r*o-a,p=s*c,h>=0)if(u>=-p)if(u<=p){const e=1/c;h*=e,u*=e,d=h*(h+r*u+2*o)+u*(r*h+u+2*a)+l}else u=s,h=Math.max(0,-(r*u+o)),d=-h*h+u*(u+2*a)+l;else u=-s,h=Math.max(0,-(r*u+o)),d=-h*h+u*(u+2*a)+l;else u<=-p?(h=Math.max(0,-(-r*s+o)),u=h>0?-s:Math.min(Math.max(-s,-a),s),d=-h*h+u*(u+2*a)+l):u<=p?(h=0,u=Math.min(Math.max(-s,-a),s),d=u*(u+2*a)+l):(h=Math.max(0,-(r*s+o)),u=h>0?s:Math.min(Math.max(-s,-a),s),d=-h*h+u*(u+2*a)+l);else u=r>0?-s:s,h=Math.max(0,-(r*u+o)),d=-h*h+u*(u+2*a)+l;return n&&n.copy(this.direction).multiplyScalar(h).add(this.origin),i&&i.copy(at).multiplyScalar(u).add(ot),d}intersectSphere(e,t){rt.subVectors(e.center,this.origin);const n=rt.dot(this.direction),i=rt.dot(rt)-n*n,s=e.radius*e.radius;if(i>s)return null;const r=Math.sqrt(s-i),o=n-r,a=n+r;return o<0&&a<0?null:o<0?this.at(a,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,s,r,o,a;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(n=(e.min.x-u.x)*l,i=(e.max.x-u.x)*l):(n=(e.max.x-u.x)*l,i=(e.min.x-u.x)*l),c>=0?(s=(e.min.y-u.y)*c,r=(e.max.y-u.y)*c):(s=(e.max.y-u.y)*c,r=(e.min.y-u.y)*c),n>r||s>i?null:((s>n||n!=n)&&(n=s),(r<i||i!=i)&&(i=r),h>=0?(o=(e.min.z-u.z)*h,a=(e.max.z-u.z)*h):(o=(e.max.z-u.z)*h,a=(e.min.z-u.z)*h),n>a||o>i?null:((o>n||n!=n)&&(n=o),(a<i||i!=i)&&(i=a),i<0?null:this.at(n>=0?n:i,t)))}intersectsBox(e){return null!==this.intersectBox(e,rt)}intersectTriangle(e,t,n,i,s){ct.subVectors(t,e),ht.subVectors(n,e),ut.crossVectors(ct,ht);let r,o=this.direction.dot(ut);if(o>0){if(i)return null;r=1}else{if(!(o<0))return null;r=-1,o=-o}lt.subVectors(this.origin,e);const a=r*this.direction.dot(ht.crossVectors(lt,ht));if(a<0)return null;const l=r*this.direction.dot(ct.cross(lt));if(l<0)return null;if(a+l>o)return null;const c=-r*lt.dot(ut);return c<0?null:this.at(c/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}function pt(e,t,n=0,i=1/0){this.ray=new dt(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new pe,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ft(e,t){return e.distance-t.distance}function mt(e,t,n,i){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===i){const i=e.children;for(let e=0,s=i.length;e<s;e++)mt(i[e],t,n,!0)}}Object.assign(pt.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)},intersectObject:function(e,t=!1,n=[]){return mt(e,this,n,t),n.sort(ft),n},intersectObjects:function(e,t=!1,n=[]){for(let i=0,s=e.length;i<s;i++)mt(e[i],this,n,t);return n.sort(ft),n}});class gt{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),s=this.x-e.x,r=this.y-e.y;return this.x=s*n-r*i+e.x,this.y=s*i+r*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}}gt.prototype.isVector2=!0;const vt=new Ge,yt=new K,bt=new K,xt=new K;class _t{constructor(e=new K,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):vt.setFromPoints(e).getCenter(n);let i=0;for(let t=0,s=e.length;t<s;t++)i=Math.max(i,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new K),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Ge),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){xt.subVectors(e,this.center);const t=xt.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(xt.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return bt.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(yt.copy(e.center).add(bt)),this.expandByPoint(yt.copy(e.center).sub(bt)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const wt=new K,St=new K,Mt=new fe;class Et{constructor(e=new K(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=wt.subVectors(n,t).cross(St.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new K),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new K);const n=e.delta(wt),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(n).multiplyScalar(s).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new K),e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Mt.getNormalMatrix(e),i=this.coplanarPoint(wt).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Et.prototype.isPlane=!0;const Tt=new K,Ct=new K,At=new K,Pt=new K,Lt=new K,Rt=new K,Nt=new K,Dt=new K,Ot=new K,kt=new K;class It{constructor(e=new K,t=new K,n=new K){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){void 0===i&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new K),i.subVectors(n,t),Tt.subVectors(e,t),i.cross(Tt);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,n,i,s){Tt.subVectors(i,t),Ct.subVectors(n,t),At.subVectors(e,t);const r=Tt.dot(Tt),o=Tt.dot(Ct),a=Tt.dot(At),l=Ct.dot(Ct),c=Ct.dot(At),h=r*l-o*o;if(void 0===s&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),s=new K),0===h)return s.set(-2,-1,-1);const u=1/h,d=(l*a-o*c)*u,p=(r*c-o*a)*u;return s.set(1-d-p,p,d)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,Pt),Pt.x>=0&&Pt.y>=0&&Pt.x+Pt.y<=1}static getUV(e,t,n,i,s,r,o,a){return this.getBarycoord(e,t,n,i,Pt),a.set(0,0),a.addScaledVector(s,Pt.x),a.addScaledVector(r,Pt.y),a.addScaledVector(o,Pt.z),a}static isFrontFacing(e,t,n,i){return Tt.subVectors(n,t),Ct.subVectors(e,t),Tt.cross(Ct).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Tt.subVectors(this.c,this.b),Ct.subVectors(this.a,this.b),.5*Tt.cross(Ct).length()}getMidpoint(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new K),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return It.getNormal(this.a,this.b,this.c,e)}getPlane(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Et),e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return It.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,s){return It.getUV(e,this.a,this.b,this.c,t,n,i,s)}containsPoint(e){return It.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return It.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new K);const n=this.a,i=this.b,s=this.c;let r,o;Lt.subVectors(i,n),Rt.subVectors(s,n),Dt.subVectors(e,n);const a=Lt.dot(Dt),l=Rt.dot(Dt);if(a<=0&&l<=0)return t.copy(n);Ot.subVectors(e,i);const c=Lt.dot(Ot),h=Rt.dot(Ot);if(c>=0&&h<=c)return t.copy(i);const u=a*h-c*l;if(u<=0&&a>=0&&c<=0)return r=a/(a-c),t.copy(n).addScaledVector(Lt,r);kt.subVectors(e,s);const d=Lt.dot(kt),p=Rt.dot(kt);if(p>=0&&d<=p)return t.copy(s);const f=d*l-a*p;if(f<=0&&l>=0&&p<=0)return o=l/(l-p),t.copy(n).addScaledVector(Rt,o);const m=c*p-d*h;if(m<=0&&h-c>=0&&d-p>=0)return Nt.subVectors(s,i),o=(h-c)/(h-c+(d-p)),t.copy(i).addScaledVector(Nt,o);const g=1/(m+f+u);return r=f*g,o=u*g,t.copy(n).addScaledVector(Lt,r).addScaledVector(Rt,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let zt=0;function Ut(){Object.defineProperty(this,"id",{value:zt++}),this.uuid=Z.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}Ut.prototype=Object.assign(Object.create(de.prototype),{constructor:Ut,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}},toJSON:function(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(e){const t=[];for(const n in e){const i=e[n];delete i.metadata,t.push(i)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=i(e.textures),s=i(e.images);t.length>0&&(n.textures=t),s.length>0&&(n.images=s)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let i=0;i!==e;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Ut.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});const Ft={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Vt={h:0,s:0,l:0},Bt={h:0,s:0,l:0};function jt(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function $t(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Gt(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Ht{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=Z.euclideanModulo(e,1),t=Z.clamp(t,0,1),n=Z.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+t):n+t-n*t,s=2*n-i;this.r=jt(s,i,e+1/3),this.g=jt(s,i,e),this.b=jt(s,i,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const i=n[1],s=n[2];switch(i){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const n=parseFloat(e[1])/360,i=parseInt(e[2],10)/100,s=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,i,s)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Ft[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=$t(e.r),this.g=$t(e.g),this.b=$t(e.b),this}copyLinearToSRGB(e){return this.r=Gt(e.r),this.g=Gt(e.g),this.b=Gt(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});const t=this.r,n=this.g,i=this.b,s=Math.max(t,n,i),r=Math.min(t,n,i);let o,a;const l=(r+s)/2;if(r===s)o=0,a=0;else{const e=s-r;switch(a=l<=.5?e/(s+r):e/(2-s-r),s){case t:o=(n-i)/e+(n<i?6:0);break;case n:o=(i-t)/e+2;break;case i:o=(t-n)/e+4}o/=6}return e.h=o,e.s=a,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(Vt),Vt.h+=e,Vt.s+=t,Vt.l+=n,this.setHSL(Vt.h,Vt.s,Vt.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Vt),e.getHSL(Bt);const n=Z.lerp(Vt.h,Bt.h,t),i=Z.lerp(Vt.s,Bt.s,t),s=Z.lerp(Vt.l,Bt.l,t);return this.setHSL(n,i,s),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Ht.NAMES=Ft,Ht.prototype.isColor=!0,Ht.prototype.r=1,Ht.prototype.g=1,Ht.prototype.b=1;class Wt extends Ut{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Ht(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this}}Wt.prototype.isMeshBasicMaterial=!0;class qt{constructor(e=0,t=0,n=0,i=1){this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=this.w,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i+r[12]*s,this.y=r[1]*t+r[5]*n+r[9]*i+r[13]*s,this.z=r[2]*t+r[6]*n+r[10]*i+r[14]*s,this.w=r[3]*t+r[7]*n+r[11]*i+r[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,s;const r=e.elements,o=r[0],a=r[4],l=r[8],c=r[1],h=r[5],u=r[9],d=r[2],p=r[6],f=r[10];if(Math.abs(a-c)<.01&&Math.abs(l-d)<.01&&Math.abs(u-p)<.01){if(Math.abs(a+c)<.1&&Math.abs(l+d)<.1&&Math.abs(u+p)<.1&&Math.abs(o+h+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const e=(o+1)/2,r=(h+1)/2,m=(f+1)/2,g=(a+c)/4,v=(l+d)/4,y=(u+p)/4;return e>r&&e>m?e<.01?(n=0,i=.707106781,s=.707106781):(n=Math.sqrt(e),i=g/n,s=v/n):r>m?r<.01?(n=.707106781,i=0,s=.707106781):(i=Math.sqrt(r),n=g/i,s=y/i):m<.01?(n=.707106781,i=.707106781,s=0):(s=Math.sqrt(m),n=v/s,i=y/s),this.set(n,i,s,t),this}let m=Math.sqrt((p-u)*(p-u)+(l-d)*(l-d)+(c-a)*(c-a));return Math.abs(m)<.001&&(m=1),this.x=(p-u)/m,this.y=(l-d)/m,this.z=(c-a)/m,this.w=Math.acos((o+h+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}qt.prototype.isVector4=!0;const Xt=new K,Yt=new gt;function Zt(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function Jt(e,t,n){Zt.call(this,new Int8Array(e),t,n)}function Kt(e,t,n){Zt.call(this,new Uint8Array(e),t,n)}function Qt(e,t,n){Zt.call(this,new Uint8ClampedArray(e),t,n)}function en(e,t,n){Zt.call(this,new Int16Array(e),t,n)}function tn(e,t,n){Zt.call(this,new Uint16Array(e),t,n)}function nn(e,t,n){Zt.call(this,new Int32Array(e),t,n)}function sn(e,t,n){Zt.call(this,new Uint32Array(e),t,n)}function rn(e,t,n){Zt.call(this,new Uint16Array(e),t,n)}function on(e,t,n){Zt.call(this,new Float32Array(e),t,n)}function an(e,t,n){Zt.call(this,new Float64Array(e),t,n)}function ln(e){if(0===e.length)return-1/0;let t=e[0];for(let n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}Object.defineProperty(Zt.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Zt.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[n+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){const t=this.array;let n=0;for(let i=0,s=e.length;i<s;i++){let s=e[i];void 0===s&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),s=new Ht),t[n++]=s.r,t[n++]=s.g,t[n++]=s.b}return this},copyVector2sArray:function(e){const t=this.array;let n=0;for(let i=0,s=e.length;i<s;i++){let s=e[i];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),s=new gt),t[n++]=s.x,t[n++]=s.y}return this},copyVector3sArray:function(e){const t=this.array;let n=0;for(let i=0,s=e.length;i<s;i++){let s=e[i];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),s=new K),t[n++]=s.x,t[n++]=s.y,t[n++]=s.z}return this},copyVector4sArray:function(e){const t=this.array;let n=0;for(let i=0,s=e.length;i<s;i++){let s=e[i];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),s=new qt),t[n++]=s.x,t[n++]=s.y,t[n++]=s.z,t[n++]=s.w}return this},applyMatrix3:function(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)Yt.fromBufferAttribute(this,t),Yt.applyMatrix3(e),this.setXY(t,Yt.x,Yt.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)Xt.fromBufferAttribute(this,t),Xt.applyMatrix3(e),this.setXYZ(t,Xt.x,Xt.y,Xt.z);return this},applyMatrix4:function(e){for(let t=0,n=this.count;t<n;t++)Xt.x=this.getX(t),Xt.y=this.getY(t),Xt.z=this.getZ(t),Xt.applyMatrix4(e),this.setXYZ(t,Xt.x,Xt.y,Xt.z);return this},applyNormalMatrix:function(e){for(let t=0,n=this.count;t<n;t++)Xt.x=this.getX(t),Xt.y=this.getY(t),Xt.z=this.getZ(t),Xt.applyNormalMatrix(e),this.setXYZ(t,Xt.x,Xt.y,Xt.z);return this},transformDirection:function(e){for(let t=0,n=this.count;t<n;t++)Xt.x=this.getX(t),Xt.y=this.getY(t),Xt.z=this.getZ(t),Xt.transformDirection(e),this.setXYZ(t,Xt.x,Xt.y,Xt.z);return this},set:function(e,t=0){return this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this},setXYZW:function(e,t,n,i,s){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=s,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}),Jt.prototype=Object.create(Zt.prototype),Jt.prototype.constructor=Jt,Kt.prototype=Object.create(Zt.prototype),Kt.prototype.constructor=Kt,Qt.prototype=Object.create(Zt.prototype),Qt.prototype.constructor=Qt,en.prototype=Object.create(Zt.prototype),en.prototype.constructor=en,tn.prototype=Object.create(Zt.prototype),tn.prototype.constructor=tn,nn.prototype=Object.create(Zt.prototype),nn.prototype.constructor=nn,sn.prototype=Object.create(Zt.prototype),sn.prototype.constructor=sn,rn.prototype=Object.create(Zt.prototype),rn.prototype.constructor=rn,rn.prototype.isFloat16BufferAttribute=!0,on.prototype=Object.create(Zt.prototype),on.prototype.constructor=on,an.prototype=Object.create(Zt.prototype),an.prototype.constructor=an;Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;let cn=0;const hn=new te,un=new Ae,dn=new K,pn=new Ge,fn=new Ge,mn=new K;function gn(){Object.defineProperty(this,"id",{value:cn++}),this.uuid=Z.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}gn.prototype=Object.assign(Object.create(de.prototype),{constructor:gn,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){return Array.isArray(e)?this.index=new(ln(e)>65535?sn:tn)(e,1):this.index=e,this},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},hasAttribute:function(e){return void 0!==this.attributes[e]},addGroup:function(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new fe).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return hn.makeRotationX(e),this.applyMatrix4(hn),this},rotateY:function(e){return hn.makeRotationY(e),this.applyMatrix4(hn),this},rotateZ:function(e){return hn.makeRotationZ(e),this.applyMatrix4(hn),this},translate:function(e,t,n){return hn.makeTranslation(e,t,n),this.applyMatrix4(hn),this},scale:function(e,t,n){return hn.makeScale(e,t,n),this.applyMatrix4(hn),this},lookAt:function(e){return un.lookAt(e),un.updateMatrix(),this.applyMatrix4(un.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(dn).negate(),this.translate(dn.x,dn.y,dn.z),this},setFromPoints:function(e){const t=[];for(let n=0,i=e.length;n<i;n++){const i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new on(t,3)),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ge);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new K(-1/0,-1/0,-1/0),new K(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];pn.setFromBufferAttribute(n),this.morphTargetsRelative?(mn.addVectors(this.boundingBox.min,pn.min),this.boundingBox.expandByPoint(mn),mn.addVectors(this.boundingBox.max,pn.max),this.boundingBox.expandByPoint(mn)):(this.boundingBox.expandByPoint(pn.min),this.boundingBox.expandByPoint(pn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new _t);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new K,1/0);if(e){const n=this.boundingSphere.center;if(pn.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];fn.setFromBufferAttribute(n),this.morphTargetsRelative?(mn.addVectors(pn.min,fn.min),pn.expandByPoint(mn),mn.addVectors(pn.max,fn.max),pn.expandByPoint(mn)):(pn.expandByPoint(fn.min),pn.expandByPoint(fn.max))}pn.getCenter(n);let i=0;for(let t=0,s=e.count;t<s;t++)mn.fromBufferAttribute(e,t),i=Math.max(i,n.distanceToSquared(mn));if(t)for(let s=0,r=t.length;s<r;s++){const r=t[s],o=this.morphTargetsRelative;for(let t=0,s=r.count;t<s;t++)mn.fromBufferAttribute(r,t),o&&(dn.fromBufferAttribute(e,t),mn.add(dn)),i=Math.max(i,n.distanceToSquared(mn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,i=t.position.array,s=t.normal.array,r=t.uv.array,o=i.length/3;void 0===t.tangent&&this.setAttribute("tangent",new Zt(new Float32Array(4*o),4));const a=t.tangent.array,l=[],c=[];for(let e=0;e<o;e++)l[e]=new K,c[e]=new K;const h=new K,u=new K,d=new K,p=new gt,f=new gt,m=new gt,g=new K,v=new K;function y(e,t,n){h.fromArray(i,3*e),u.fromArray(i,3*t),d.fromArray(i,3*n),p.fromArray(r,2*e),f.fromArray(r,2*t),m.fromArray(r,2*n),u.sub(h),d.sub(h),f.sub(p),m.sub(p);const s=1/(f.x*m.y-m.x*f.y);isFinite(s)&&(g.copy(u).multiplyScalar(m.y).addScaledVector(d,-f.y).multiplyScalar(s),v.copy(d).multiplyScalar(f.x).addScaledVector(u,-m.x).multiplyScalar(s),l[e].add(g),l[t].add(g),l[n].add(g),c[e].add(v),c[t].add(v),c[n].add(v))}let b=this.groups;0===b.length&&(b=[{start:0,count:n.length}]);for(let e=0,t=b.length;e<t;++e){const t=b[e],i=t.start;for(let e=i,s=i+t.count;e<s;e+=3)y(n[e+0],n[e+1],n[e+2])}const x=new K,_=new K,w=new K,S=new K;function M(e){w.fromArray(s,3*e),S.copy(w);const t=l[e];x.copy(t),x.sub(w.multiplyScalar(w.dot(t))).normalize(),_.crossVectors(S,t);const n=_.dot(c[e])<0?-1:1;a[4*e]=x.x,a[4*e+1]=x.y,a[4*e+2]=x.z,a[4*e+3]=n}for(let e=0,t=b.length;e<t;++e){const t=b[e],i=t.start;for(let e=i,s=i+t.count;e<s;e+=3)M(n[e+0]),M(n[e+1]),M(n[e+2])}},computeVertexNormals:function(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new Zt(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const i=new K,s=new K,r=new K,o=new K,a=new K,l=new K,c=new K,h=new K;if(e)for(let u=0,d=e.count;u<d;u+=3){const d=e.getX(u+0),p=e.getX(u+1),f=e.getX(u+2);i.fromBufferAttribute(t,d),s.fromBufferAttribute(t,p),r.fromBufferAttribute(t,f),c.subVectors(r,s),h.subVectors(i,s),c.cross(h),o.fromBufferAttribute(n,d),a.fromBufferAttribute(n,p),l.fromBufferAttribute(n,f),o.add(c),a.add(c),l.add(c),n.setXYZ(d,o.x,o.y,o.z),n.setXYZ(p,a.x,a.y,a.z),n.setXYZ(f,l.x,l.y,l.z)}else for(let e=0,o=t.count;e<o;e+=3)i.fromBufferAttribute(t,e+0),s.fromBufferAttribute(t,e+1),r.fromBufferAttribute(t,e+2),c.subVectors(r,s),h.subVectors(i,s),c.cross(h),n.setXYZ(e+0,c.x,c.y,c.z),n.setXYZ(e+1,c.x,c.y,c.z),n.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===e.attributes[i])continue;const s=n[i].array,r=e.attributes[i],o=r.array,a=r.itemSize*t,l=Math.min(o.length,s.length-a);for(let e=0,t=a;e<l;e++,t++)s[t]=o[e]}return this},normalizeNormals:function(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)mn.fromBufferAttribute(e,t),mn.normalize(),e.setXYZ(t,mn.x,mn.y,mn.z)},toNonIndexed:function(){function e(e,t){const n=e.array,i=e.itemSize,s=e.normalized,r=new n.constructor(t.length*i);let o=0,a=0;for(let e=0,s=t.length;e<s;e++){o=t[e]*i;for(let e=0;e<i;e++)r[a++]=n[o++]}return new Zt(r,i,s)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new gn,n=this.index.array,i=this.attributes;for(const s in i){const r=e(i[s],n);t.setAttribute(s,r)}const s=this.morphAttributes;for(const i in s){const r=[],o=s[i];for(let t=0,i=o.length;t<i;t++){const i=e(o[t],n);r.push(i)}t.morphAttributes[i]=r}t.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let e=0,n=r.length;e<n;e++){const n=r[e];t.addGroup(n.start,n.count,n.materialIndex)}return t},toJSON:function(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const i=n[t];e.data.attributes[t]=i.toJSON(e.data)}const i={};let s=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],r=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];r.push(i.toJSON(e.data))}r.length>0&&(i[t]=r,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(e.data.groups=JSON.parse(JSON.stringify(r)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e},clone:function(){return(new gn).copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const i=e.attributes;for(const e in i){const n=i[e];this.setAttribute(e,n.clone(t))}const s=e.morphAttributes;for(const e in s){const n=[],i=s[e];for(let e=0,s=i.length;e<s;e++)n.push(i[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const r=e.groups;for(let e=0,t=r.length;e<t;e++){const t=r[e];this.addGroup(t.start,t.count,t.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const vn=new te,yn=new dt,bn=new _t,xn=new K,_n=new K,wn=new K,Sn=new K,Mn=new K,En=new K,Tn=new K,Cn=new K,An=new K,Pn=new gt,Ln=new gt,Rn=new gt,Nn=new K,Dn=new K;function On(e=new gn,t=new Wt){Ae.call(this),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}function kn(e,t,n,i,s,r,o,a,l,c,h,u){xn.fromBufferAttribute(s,c),_n.fromBufferAttribute(s,h),wn.fromBufferAttribute(s,u);const d=e.morphTargetInfluences;if(t.morphTargets&&r&&d){Tn.set(0,0,0),Cn.set(0,0,0),An.set(0,0,0);for(let e=0,t=r.length;e<t;e++){const t=d[e],n=r[e];0!==t&&(Sn.fromBufferAttribute(n,c),Mn.fromBufferAttribute(n,h),En.fromBufferAttribute(n,u),o?(Tn.addScaledVector(Sn,t),Cn.addScaledVector(Mn,t),An.addScaledVector(En,t)):(Tn.addScaledVector(Sn.sub(xn),t),Cn.addScaledVector(Mn.sub(_n),t),An.addScaledVector(En.sub(wn),t)))}xn.add(Tn),_n.add(Cn),wn.add(An)}e.isSkinnedMesh&&t.skinning&&(e.boneTransform(c,xn),e.boneTransform(h,_n),e.boneTransform(u,wn));const p=function(e,t,n,i,s,r,o,a){let l;if(l=1===t.side?i.intersectTriangle(o,r,s,!0,a):i.intersectTriangle(s,r,o,2!==t.side,a),null===l)return null;Dn.copy(a),Dn.applyMatrix4(e.matrixWorld);const c=n.ray.origin.distanceTo(Dn);return c<n.near||c>n.far?null:{distance:c,point:Dn.clone(),object:e}}(e,t,n,i,xn,_n,wn,Nn);if(p){a&&(Pn.fromBufferAttribute(a,c),Ln.fromBufferAttribute(a,h),Rn.fromBufferAttribute(a,u),p.uv=It.getUV(Nn,xn,_n,wn,Pn,Ln,Rn,new gt)),l&&(Pn.fromBufferAttribute(l,c),Ln.fromBufferAttribute(l,h),Rn.fromBufferAttribute(l,u),p.uv2=It.getUV(Nn,xn,_n,wn,Pn,Ln,Rn,new gt));const e={a:c,b:h,c:u,normal:new K,materialIndex:0};It.getNormal(xn,_n,wn,e.normal),p.face=e}return p}On.prototype=Object.assign(Object.create(Ae.prototype),{constructor:On,isMesh:!0,copy:function(e){return Ae.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){const n=this.geometry,i=this.material,s=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),bn.copy(n.boundingSphere),bn.applyMatrix4(s),!1===e.ray.intersectsSphere(bn))return;if(vn.copy(s).invert(),yn.copy(e.ray).applyMatrix4(vn),null!==n.boundingBox&&!1===yn.intersectsBox(n.boundingBox))return;let r;if(n.isBufferGeometry){const s=n.index,o=n.attributes.position,a=n.morphAttributes.position,l=n.morphTargetsRelative,c=n.attributes.uv,h=n.attributes.uv2,u=n.groups,d=n.drawRange;if(null!==s)if(Array.isArray(i))for(let n=0,p=u.length;n<p;n++){const p=u[n],f=i[p.materialIndex];for(let n=Math.max(p.start,d.start),i=Math.min(p.start+p.count,d.start+d.count);n<i;n+=3){const i=s.getX(n),u=s.getX(n+1),d=s.getX(n+2);r=kn(this,f,e,yn,o,a,l,c,h,i,u,d),r&&(r.faceIndex=Math.floor(n/3),r.face.materialIndex=p.materialIndex,t.push(r))}}else{for(let n=Math.max(0,d.start),u=Math.min(s.count,d.start+d.count);n<u;n+=3){const u=s.getX(n),d=s.getX(n+1),p=s.getX(n+2);r=kn(this,i,e,yn,o,a,l,c,h,u,d,p),r&&(r.faceIndex=Math.floor(n/3),t.push(r))}}else if(void 0!==o)if(Array.isArray(i))for(let n=0,s=u.length;n<s;n++){const s=u[n],p=i[s.materialIndex];for(let n=Math.max(s.start,d.start),i=Math.min(s.start+s.count,d.start+d.count);n<i;n+=3){r=kn(this,p,e,yn,o,a,l,c,h,n,n+1,n+2),r&&(r.faceIndex=Math.floor(n/3),r.face.materialIndex=s.materialIndex,t.push(r))}}else{for(let n=Math.max(0,d.start),s=Math.min(o.count,d.start+d.count);n<s;n+=3){r=kn(this,i,e,yn,o,a,l,c,h,n,n+1,n+2),r&&(r.faceIndex=Math.floor(n/3),t.push(r))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}});class In extends gn{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const s=e/2,r=t/2,o=Math.floor(n),a=Math.floor(i),l=o+1,c=a+1,h=e/o,u=t/a,d=[],p=[],f=[],m=[];for(let e=0;e<c;e++){const t=e*u-r;for(let n=0;n<l;n++){const i=n*h-s;p.push(i,-t,0),f.push(0,0,1),m.push(n/o),m.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<o;t++){const n=t+l*e,i=t+l*(e+1),s=t+1+l*(e+1),r=t+1+l*e;d.push(n,i,r),d.push(i,s,r)}this.setIndex(d),this.setAttribute("position",new on(p,3)),this.setAttribute("normal",new on(f,3)),this.setAttribute("uv",new on(m,2))}}function zn(){this.type="Curve",this.arcLengthDivisions=200}Object.assign(zn.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){const e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),s=0;t.push(0);for(let r=1;r<=e;r++)n=this.getPoint(r/e),s+=n.distanceTo(i),t.push(s),i=n;return this.cacheArcLengths=t,t},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){const n=this.getLengths();let i=0;const s=n.length;let r;r=t||e*n[s-1];let o,a=0,l=s-1;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),o=n[i]-r,o<0)a=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(i=l,n[i]===r)return i/(s-1);const c=n[i];return(i+(r-c)/(n[i+1]-c))/(s-1)},getTangent:function(e,t){let n=e-1e-4,i=e+1e-4;n<0&&(n=0),i>1&&(i=1);const s=this.getPoint(n),r=this.getPoint(i),o=t||(s.isVector2?new gt:new K);return o.copy(r).sub(s).normalize(),o},getTangentAt:function(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)},computeFrenetFrames:function(e,t){const n=new K,i=[],s=[],r=[],o=new K,a=new te;for(let t=0;t<=e;t++){const n=t/e;i[t]=this.getTangentAt(n,new K),i[t].normalize()}s[0]=new K,r[0]=new K;let l=Number.MAX_VALUE;const c=Math.abs(i[0].x),h=Math.abs(i[0].y),u=Math.abs(i[0].z);c<=l&&(l=c,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),u<=l&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),s[0].crossVectors(i[0],o),r[0].crossVectors(i[0],s[0]);for(let t=1;t<=e;t++){if(s[t]=s[t-1].clone(),r[t]=r[t-1].clone(),o.crossVectors(i[t-1],i[t]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(Z.clamp(i[t-1].dot(i[t]),-1,1));s[t].applyMatrix4(a.makeRotationAxis(o,e))}r[t].crossVectors(i[t],s[t])}if(!0===t){let t=Math.acos(Z.clamp(s[0].dot(s[e]),-1,1));t/=e,i[0].dot(o.crossVectors(s[0],s[e]))>0&&(t=-t);for(let n=1;n<=e;n++)s[n].applyMatrix4(a.makeRotationAxis(i[n],t*n)),r[n].crossVectors(i[n],s[n])}return{tangents:i,normals:s,binormals:r}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}});class Un extends zn{constructor(e=new gt,t=new gt){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new gt){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new gt;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Un.prototype.isLineCurve=!0;class Fn extends zn{constructor(e=0,t=0,n=1,i=1,s=0,r=2*Math.PI,o=!1,a=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=r,this.aClockwise=o,this.aRotation=a}getPoint(e,t){const n=t||new gt,i=2*Math.PI;let s=this.aEndAngle-this.aStartAngle;const r=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(s=r?0:i),!0!==this.aClockwise||r||(s===i?s=-i:s-=i);const o=this.aStartAngle+e*s;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=a-this.aX,i=l-this.aY;a=n*e-i*t+this.aX,l=n*t+i*e+this.aY}return n.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Fn.prototype.isEllipseCurve=!0;class Vn extends Fn{constructor(e,t,n,i,s,r){super(e,t,n,n,i,s,r),this.type="ArcCurve"}}function Bn(){let e=0,t=0,n=0,i=0;function s(s,r,o,a){e=s,t=o,n=-3*s+3*r-2*o-a,i=2*s-2*r+o+a}return{initCatmullRom:function(e,t,n,i,r){s(t,n,r*(n-e),r*(i-t))},initNonuniformCatmullRom:function(e,t,n,i,r,o,a){let l=(t-e)/r-(n-e)/(r+o)+(n-t)/o,c=(n-t)/o-(i-t)/(o+a)+(i-n)/a;l*=o,c*=o,s(t,n,l,c)},calc:function(s){const r=s*s;return e+t*s+n*r+i*(r*s)}}}Vn.prototype.isArcCurve=!0;const jn=new K,$n=new Bn,Gn=new Bn,Hn=new Bn;class Wn extends zn{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new K){const n=t,i=this.points,s=i.length,r=(s-(this.closed?0:1))*e;let o,a,l=Math.floor(r),c=r-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/s)+1)*s:0===c&&l===s-1&&(l=s-2,c=1),this.closed||l>0?o=i[(l-1)%s]:(jn.subVectors(i[0],i[1]).add(i[0]),o=jn);const h=i[l%s],u=i[(l+1)%s];if(this.closed||l+2<s?a=i[(l+2)%s]:(jn.subVectors(i[s-1],i[s-2]).add(i[s-1]),a=jn),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(h),e),n=Math.pow(h.distanceToSquared(u),e),i=Math.pow(u.distanceToSquared(a),e);n<1e-4&&(n=1),t<1e-4&&(t=n),i<1e-4&&(i=n),$n.initNonuniformCatmullRom(o.x,h.x,u.x,a.x,t,n,i),Gn.initNonuniformCatmullRom(o.y,h.y,u.y,a.y,t,n,i),Hn.initNonuniformCatmullRom(o.z,h.z,u.z,a.z,t,n,i)}else"catmullrom"===this.curveType&&($n.initCatmullRom(o.x,h.x,u.x,a.x,this.tension),Gn.initCatmullRom(o.y,h.y,u.y,a.y,this.tension),Hn.initCatmullRom(o.z,h.z,u.z,a.z,this.tension));return n.set($n.calc(c),Gn.calc(c),Hn.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new K).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function qn(e,t,n,i,s){const r=.5*(i-t),o=.5*(s-n),a=e*e;return(2*n-2*i+r+o)*(e*a)+(-3*n+3*i-2*r-o)*a+r*e+n}function Xn(e,t,n,i){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,i)}function Yn(e,t,n,i,s){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,i)+function(e,t){return e*e*e*t}(e,s)}Wn.prototype.isCatmullRomCurve3=!0;class Zn extends zn{constructor(e=new gt,t=new gt,n=new gt,i=new gt){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new gt){const n=t,i=this.v0,s=this.v1,r=this.v2,o=this.v3;return n.set(Yn(e,i.x,s.x,r.x,o.x),Yn(e,i.y,s.y,r.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Zn.prototype.isCubicBezierCurve=!0;class Jn extends zn{constructor(e=new K,t=new K,n=new K,i=new K){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new K){const n=t,i=this.v0,s=this.v1,r=this.v2,o=this.v3;return n.set(Yn(e,i.x,s.x,r.x,o.x),Yn(e,i.y,s.y,r.y,o.y),Yn(e,i.z,s.z,r.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Jn.prototype.isCubicBezierCurve3=!0;class Kn extends zn{constructor(e=new K,t=new K){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new K){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Qn extends zn{constructor(e=new gt,t=new gt,n=new gt){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new gt){const n=t,i=this.v0,s=this.v1,r=this.v2;return n.set(Xn(e,i.x,s.x,r.x),Xn(e,i.y,s.y,r.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Qn.prototype.isQuadraticBezierCurve=!0;class ei extends zn{constructor(e=new K,t=new K,n=new K){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new K){const n=t,i=this.v0,s=this.v1,r=this.v2;return n.set(Xn(e,i.x,s.x,r.x),Xn(e,i.y,s.y,r.y),Xn(e,i.z,s.z,r.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}ei.prototype.isQuadraticBezierCurve3=!0;class ti extends zn{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new gt){const n=t,i=this.points,s=(i.length-1)*e,r=Math.floor(s),o=s-r,a=i[0===r?r:r-1],l=i[r],c=i[r>i.length-2?i.length-1:r+1],h=i[r>i.length-3?i.length-1:r+2];return n.set(qn(o,a.x,l.x,c.x,h.x),qn(o,a.y,l.y,c.y,h.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new gt).fromArray(n))}return this}}ti.prototype.isSplineCurve=!0;class ni extends zn{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Un(t,e))}getPoint(e){const t=e*this.getLength(),n=this.getCurveLengths();let i=0;for(;i<n.length;){if(n[i]>=t){const e=n[i]-t,s=this.curves[i],r=s.getLength(),o=0===r?0:1-e/r;return s.getPointAt(o)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,s=this.curves;i<s.length;i++){const r=s[i],o=r&&r.isEllipseCurve?2*e:r&&(r.isLineCurve||r.isLineCurve3)?1:r&&r.isSplineCurve?e*r.points.length:e,a=r.getPoints(o);for(let e=0;e<a.length;e++){const i=a[e];n&&n.equals(i)||(t.push(i),n=i)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new i[n.type]).fromJSON(n))}return this}}class ii extends ni{constructor(e){super(),this.type="Path",this.currentPoint=new gt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Un(this.currentPoint.clone(),new gt(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const s=new Qn(this.currentPoint.clone(),new gt(e,t),new gt(n,i));return this.curves.push(s),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,s,r){const o=new Zn(this.currentPoint.clone(),new gt(e,t),new gt(n,i),new gt(s,r));return this.curves.push(o),this.currentPoint.set(s,r),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new ti(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,s,r){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+o,t+a,n,i,s,r),this}absarc(e,t,n,i,s,r){return this.absellipse(e,t,n,n,i,s,r),this}ellipse(e,t,n,i,s,r,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,n,i,s,r,o,a),this}absellipse(e,t,n,i,s,r,o,a){const l=new Fn(e,t,n,i,s,r,o,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class si extends ii{constructor(e){super(e),this.uuid=Z.generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new ii).fromJSON(n))}return this}}const ri=function(e,t,n){n=n||2;const i=t&&t.length,s=i?t[0]*n:e.length;let r=oi(e,0,s,n,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c,h,u,d,p;if(i&&(r=function(e,t,n,i){const s=[];let r,o,a,l,c;for(r=0,o=t.length;r<o;r++)a=t[r]*i,l=r<o-1?t[r+1]*i:e.length,c=oi(e,a,l,i,!1),c===c.next&&(c.steiner=!0),s.push(vi(c));for(s.sort(pi),r=0;r<s.length;r++)fi(s[r],n),n=ai(n,n.next);return n}(e,t,r,n)),e.length>80*n){a=c=e[0],l=h=e[1];for(let t=n;t<s;t+=n)u=e[t],d=e[t+1],u<a&&(a=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-a,h-l),p=0!==p?1/p:0}return li(r,o,n,a,l,p),o};function oi(e,t,n,i,s){let r,o;if(s===function(e,t,n,i){let s=0;for(let r=t,o=n-i;r<n;r+=i)s+=(e[o]-e[r])*(e[r+1]+e[o+1]),o=r;return s}(e,t,n,i)>0)for(r=t;r<n;r+=i)o=Ci(r,e[r],e[r+1],o);else for(r=n-i;r>=t;r-=i)o=Ci(r,e[r],e[r+1],o);return o&&_i(o,o.next)&&(Ai(o),o=o.next),o}function ai(e,t){if(!e)return e;t||(t=e);let n,i=e;do{if(n=!1,i.steiner||!_i(i,i.next)&&0!==xi(i.prev,i,i.next))i=i.next;else{if(Ai(i),i=t=i.prev,i===i.next)break;n=!0}}while(n||i!==t);return t}function li(e,t,n,i,s,r,o){if(!e)return;!o&&r&&function(e,t,n,i){let s=e;do{null===s.z&&(s.z=gi(s.x,s.y,t,n,i)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){let t,n,i,s,r,o,a,l,c=1;do{for(n=e,e=null,r=null,o=0;n;){for(o++,i=n,a=0,t=0;t<c&&(a++,i=i.nextZ,i);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||n.z<=i.z)?(s=n,n=n.nextZ,a--):(s=i,i=i.nextZ,l--),r?r.nextZ=s:e=s,s.prevZ=r,r=s;n=i}r.nextZ=null,c*=2}while(o>1)}(s)}(e,i,s,r);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,r?hi(e,i,s,r):ci(e))t.push(a.i/n),t.push(e.i/n),t.push(l.i/n),Ai(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?li(e=ui(ai(e),t,n),t,n,i,s,r,2):2===o&&di(e,t,n,i,s,r):li(ai(e),t,n,i,s,r,1);break}}function ci(e){const t=e.prev,n=e,i=e.next;if(xi(t,n,i)>=0)return!1;let s=e.next.next;for(;s!==e.prev;){if(yi(t.x,t.y,n.x,n.y,i.x,i.y,s.x,s.y)&&xi(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function hi(e,t,n,i){const s=e.prev,r=e,o=e.next;if(xi(s,r,o)>=0)return!1;const a=s.x<r.x?s.x<o.x?s.x:o.x:r.x<o.x?r.x:o.x,l=s.y<r.y?s.y<o.y?s.y:o.y:r.y<o.y?r.y:o.y,c=s.x>r.x?s.x>o.x?s.x:o.x:r.x>o.x?r.x:o.x,h=s.y>r.y?s.y>o.y?s.y:o.y:r.y>o.y?r.y:o.y,u=gi(a,l,t,n,i),d=gi(c,h,t,n,i);let p=e.prevZ,f=e.nextZ;for(;p&&p.z>=u&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&yi(s.x,s.y,r.x,r.y,o.x,o.y,p.x,p.y)&&xi(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&yi(s.x,s.y,r.x,r.y,o.x,o.y,f.x,f.y)&&xi(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=u;){if(p!==e.prev&&p!==e.next&&yi(s.x,s.y,r.x,r.y,o.x,o.y,p.x,p.y)&&xi(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&yi(s.x,s.y,r.x,r.y,o.x,o.y,f.x,f.y)&&xi(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function ui(e,t,n){let i=e;do{const s=i.prev,r=i.next.next;!_i(s,r)&&wi(s,i,i.next,r)&&Ei(s,r)&&Ei(r,s)&&(t.push(s.i/n),t.push(i.i/n),t.push(r.i/n),Ai(i),Ai(i.next),i=e=r),i=i.next}while(i!==e);return ai(i)}function di(e,t,n,i,s,r){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&bi(o,e)){let a=Ti(o,e);return o=ai(o,o.next),a=ai(a,a.next),li(o,t,n,i,s,r),void li(a,t,n,i,s,r)}e=e.next}o=o.next}while(o!==e)}function pi(e,t){return e.x-t.x}function fi(e,t){if(t=function(e,t){let n=t;const i=e.x,s=e.y;let r,o=-1/0;do{if(s<=n.y&&s>=n.next.y&&n.next.y!==n.y){const e=n.x+(s-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=i&&e>o){if(o=e,e===i){if(s===n.y)return n;if(s===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===o)return r;const a=r,l=r.x,c=r.y;let h,u=1/0;n=r;do{i>=n.x&&n.x>=l&&i!==n.x&&yi(s<c?i:o,s,l,c,s<c?o:i,s,n.x,n.y)&&(h=Math.abs(s-n.y)/(i-n.x),Ei(n,e)&&(h<u||h===u&&(n.x>r.x||n.x===r.x&&mi(r,n)))&&(r=n,u=h)),n=n.next}while(n!==a);return r}(e,t)){const n=Ti(t,e);ai(t,t.next),ai(n,n.next)}}function mi(e,t){return xi(e.prev,e,t.prev)<0&&xi(t.next,e,e.next)<0}function gi(e,t,n,i,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function vi(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function yi(e,t,n,i,s,r,o,a){return(s-o)*(t-a)-(e-o)*(r-a)>=0&&(e-o)*(i-a)-(n-o)*(t-a)>=0&&(n-o)*(r-a)-(s-o)*(i-a)>=0}function bi(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&wi(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Ei(e,t)&&Ei(t,e)&&function(e,t){let n=e,i=!1;const s=(e.x+t.x)/2,r=(e.y+t.y)/2;do{n.y>r!=n.next.y>r&&n.next.y!==n.y&&s<(n.next.x-n.x)*(r-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(xi(e.prev,e,t.prev)||xi(e,t.prev,t))||_i(e,t)&&xi(e.prev,e,e.next)>0&&xi(t.prev,t,t.next)>0)}function xi(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function _i(e,t){return e.x===t.x&&e.y===t.y}function wi(e,t,n,i){const s=Mi(xi(e,t,n)),r=Mi(xi(e,t,i)),o=Mi(xi(n,i,e)),a=Mi(xi(n,i,t));return s!==r&&o!==a||(!(0!==s||!Si(e,n,t))||(!(0!==r||!Si(e,i,t))||(!(0!==o||!Si(n,e,i))||!(0!==a||!Si(n,t,i)))))}function Si(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Mi(e){return e>0?1:e<0?-1:0}function Ei(e,t){return xi(e.prev,e,e.next)<0?xi(e,t,e.next)>=0&&xi(e,e.prev,t)>=0:xi(e,t,e.prev)<0||xi(e,e.next,t)<0}function Ti(e,t){const n=new Pi(e.i,e.x,e.y),i=new Pi(t.i,t.x,t.y),s=e.next,r=t.prev;return e.next=t,t.prev=e,n.next=s,s.prev=n,i.next=n,n.prev=i,r.next=i,i.prev=r,i}function Ci(e,t,n,i){const s=new Pi(e,t,n);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function Ai(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Pi(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const Li={area:function(e){const t=e.length;let n=0;for(let i=t-1,s=0;s<t;i=s++)n+=e[i].x*e[s].y-e[s].x*e[i].y;return.5*n},isClockWise:function(e){return Li.area(e)<0},triangulateShape:function(e,t){const n=[],i=[],s=[];Ri(e),Ni(n,e);let r=e.length;t.forEach(Ri);for(let e=0;e<t.length;e++)i.push(r),r+=t[e].length,Ni(n,t[e]);const o=ri(n,i);for(let e=0;e<o.length;e+=3)s.push(o.slice(e,e+3));return s}};function Ri(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Ni(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Di extends gn{constructor(e,t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],s=[],r=[];let o=0,a=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(o,a,t),o+=a,a=0;function l(e){const o=i.length/3,l=e.extractPoints(t);let c=l.shape;const h=l.holes;!1===Li.isClockWise(c)&&(c=c.reverse());for(let e=0,t=h.length;e<t;e++){const t=h[e];!0===Li.isClockWise(t)&&(h[e]=t.reverse())}const u=Li.triangulateShape(c,h);for(let e=0,t=h.length;e<t;e++){const t=h[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];i.push(t.x,t.y,0),s.push(0,0,1),r.push(t.x,t.y)}for(let e=0,t=u.length;e<t;e++){const t=u[e],i=t[0]+o,s=t[1]+o,r=t[2]+o;n.push(i,s,r),a+=3}}this.setIndex(n),this.setAttribute("position",new on(i,3)),this.setAttribute("normal",new on(s,3)),this.setAttribute("uv",new on(r,2))}toJSON(){const e=gn.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,i=e.length;n<i;n++){const i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}const Oi=null!=navigator.xr&&null!=self.XRSession&&null!=navigator.xr.isSessionSupported&&self.XRSession.prototype.requestHitTestSource,ki=(()=>{const e=navigator.userAgent||navigator.vendor||self.opera;let t=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t})(),Ii=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,zi=(()=>{const e=document.createElement("a");return Boolean(e.relList&&e.relList.supports&&e.relList.supports("ar"))})(),Ui=(/\bCrOS\b/.test(navigator.userAgent),/android/i.test(navigator.userAgent));var Fi,Vi,Bi;!function(e){e[e.mm=0]="mm",e[e.cm=1]="cm",e[e.m=2]="m",e[e.km=3]="km",e[e.in=4]="in",e[e.ft=5]="ft",e[e.yd=6]="yd",e[e.mi=7]="mi"}(Fi||(Fi={})),function(e){e[e.EN=0]="EN",e[e.ES=1]="ES",e[e.DE=2]="DE"}(Vi||(Vi={})),function(e){e.EN="English",e.ES="Spanish (Espaol)",e.DE="German (Deutsche)"}(Bi||(Bi={}));const ji=new K,$i=new K,Gi=new te,Hi=new J,Wi=new ue;class qi extends $e{get settingProperties(){return[this.ins.position,this.ins.rotation,this.ins.scale]}get snapshotProperties(){return[this.ins.position,this.ins.rotation,this.ins.scale]}fromData(e){const{position:t,rotation:n,order:i,scale:s}=this.ins,r=je[i.getValidatedValue()];e.matrix?(Gi.fromArray(e.matrix),Gi.decompose(ji,Hi,$i),ji.toArray(t.value),Wi.setFromQuaternion(Hi,r),Wi.toVector3(ji).multiplyScalar(Z.RAD2DEG).toArray(n.value),$i.toArray(s.value),t.set(),n.set(),s.set()):(e.translation&&t.setValue(e.translation.slice()),e.rotation&&(Hi.fromArray(e.rotation),Wi.setFromQuaternion(Hi,r),Wi.toVector3(ji).multiplyScalar(Z.RAD2DEG).toArray(n.value),n.set()),e.scale&&s.setValue(e.scale.slice()),this.transform.changed=!0)}toData(){this.object3D.matrix.decompose(ji,Hi,$i);const e={};return 0===ji.x&&0===ji.y&&0===ji.z||(e.translation=ji.toArray()),0===Hi.x&&0===Hi.y&&0===Hi.z&&1===Hi.w||(e.rotation=Hi.toArray()),1===$i.x&&1===$i.y&&1===$i.z||(e.scale=$i.toArray()),e}}qi.typeName="CVNode",qi.text="Transform",qi.icon="";class Xi extends Ae{constructor(){super(),this.type="Group"}}Xi.prototype.isGroup=!0;class Yi extends Ut{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Ht(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this}}Yi.prototype.isLineBasicMaterial=!0;const Zi=new K,Ji=new K,Ki=new te,Qi=new dt,es=new _t;function ts(e=new gn,t=new Yi){Ae.call(this),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}ts.prototype=Object.assign(Object.create(Ae.prototype),{constructor:ts,isLine:!0,copy:function(e){return Ae.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,i=t.count;e<i;e++)Zi.fromBufferAttribute(t,e-1),Ji.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=Zi.distanceTo(Ji);e.setAttribute("lineDistance",new on(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,r=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),es.copy(n.boundingSphere),es.applyMatrix4(i),es.radius+=s,!1===e.ray.intersectsSphere(es))return;Ki.copy(i).invert(),Qi.copy(e.ray).applyMatrix4(Ki);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new K,c=new K,h=new K,u=new K,d=this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,s=n.attributes.position;if(null!==i){for(let n=Math.max(0,r.start),o=Math.min(i.count,r.start+r.count)-1;n<o;n+=d){const r=i.getX(n),o=i.getX(n+1);l.fromBufferAttribute(s,r),c.fromBufferAttribute(s,o);if(Qi.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);const d=e.ray.origin.distanceTo(u);d<e.near||d>e.far||t.push({distance:d,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,r.start),i=Math.min(s.count,r.start+r.count)-1;n<i;n+=d){l.fromBufferAttribute(s,n),c.fromBufferAttribute(s,n+1);if(Qi.distanceSqToSegment(l,c,u,h)>a)continue;u.applyMatrix4(this.matrixWorld);const i=e.ray.origin.distanceTo(u);i<e.near||i>e.far||t.push({distance:i,point:h.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const ns=new K,is=new K;function ss(e,t){ts.call(this,e,t),this.type="LineSegments"}ss.prototype=Object.assign(Object.create(ts.prototype),{constructor:ss,isLineSegments:!0,computeLineDistances:function(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,i=t.count;e<i;e+=2)ns.fromBufferAttribute(t,e),is.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+ns.distanceTo(is);e.setAttribute("lineDistance",new on(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}});class rs extends ss{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new gn;i.setIndex(new Zt(n,1)),i.setAttribute("position",new on([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new Yi({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}const os="undefined"!=typeof window&&null!=window.customElements&&void 0!==window.customElements.polyfillWrapFlushCallback,as=(e,t,n=null,i=null)=>{for(;t!==n;){const n=t.nextSibling;e.insertBefore(t,i),t=n}},ls=(e,t,n=null)=>{for(;t!==n;){const n=t.nextSibling;e.removeChild(t),t=n}},cs=`{{lit-${String(Math.random()).slice(2)}}}`,hs=`\x3c!--${cs}--\x3e`,us=new RegExp(`${cs}|${hs}`);class ds{constructor(e,t){this.parts=[],this.element=t;const n=[],i=[],s=document.createTreeWalker(t.content,133,null,!1);let r=0,o=-1,a=0;const{strings:l,values:{length:c}}=e;for(;a<c;){const e=s.nextNode();if(null!==e){if(o++,1===e.nodeType){if(e.hasAttributes()){const t=e.attributes,{length:n}=t;let i=0;for(let e=0;e<n;e++)ps(t[e].name,"$lit$")&&i++;for(;i-- >0;){const t=l[a],n=gs.exec(t)[2],i=n.toLowerCase()+"$lit$",s=e.getAttribute(i);e.removeAttribute(i);const r=s.split(us);this.parts.push({type:"attribute",index:o,name:n,strings:r}),a+=r.length-1}}"TEMPLATE"===e.tagName&&(i.push(e),s.currentNode=e.content)}else if(3===e.nodeType){const t=e.data;if(t.indexOf(cs)>=0){const i=e.parentNode,s=t.split(us),r=s.length-1;for(let t=0;t<r;t++){let n,r=s[t];if(""===r)n=ms();else{const e=gs.exec(r);null!==e&&ps(e[2],"$lit$")&&(r=r.slice(0,e.index)+e[1]+e[2].slice(0,-"$lit$".length)+e[3]),n=document.createTextNode(r)}i.insertBefore(n,e),this.parts.push({type:"node",index:++o})}""===s[r]?(i.insertBefore(ms(),e),n.push(e)):e.data=s[r],a+=r}}else if(8===e.nodeType)if(e.data===cs){const t=e.parentNode;null!==e.previousSibling&&o!==r||(o++,t.insertBefore(ms(),e)),r=o,this.parts.push({type:"node",index:o}),null===e.nextSibling?e.data="":(n.push(e),o--),a++}else{let t=-1;for(;-1!==(t=e.data.indexOf(cs,t+1));)this.parts.push({type:"node",index:-1}),a++}}else s.currentNode=i.pop()}for(const e of n)e.parentNode.removeChild(e)}}const ps=(e,t)=>{const n=e.length-t.length;return n>=0&&e.slice(n)===t},fs=e=>-1!==e.index,ms=()=>document.createComment(""),gs=/([ \x09\x0a\x0c\x0d])([^\0-\x1F\x7F-\x9F "'>=/]+)([ \x09\x0a\x0c\x0d]*=[ \x09\x0a\x0c\x0d]*(?:[^ \x09\x0a\x0c\x0d"'`<>=]*|"[^"]*|'[^']*))$/;function vs(e,t){const{element:{content:n},parts:i}=e,s=document.createTreeWalker(n,133,null,!1);let r=bs(i),o=i[r],a=-1,l=0;const c=[];let h=null;for(;s.nextNode();){a++;const e=s.currentNode;for(e.previousSibling===h&&(h=null),t.has(e)&&(c.push(e),null===h&&(h=e)),null!==h&&l++;void 0!==o&&o.index===a;)o.index=null!==h?-1:o.index-l,r=bs(i,r),o=i[r]}c.forEach(e=>e.parentNode.removeChild(e))}const ys=e=>{let t=11===e.nodeType?0:1;const n=document.createTreeWalker(e,133,null,!1);for(;n.nextNode();)t++;return t},bs=(e,t=-1)=>{for(let n=t+1;n<e.length;n++){const t=e[n];if(fs(t))return n}return-1};const xs=new WeakMap,_s=e=>"function"==typeof e&&xs.has(e),ws={},Ss={};class Ms{constructor(e,t,n){this.__parts=[],this.template=e,this.processor=t,this.options=n}update(e){let t=0;for(const n of this.__parts)void 0!==n&&n.setValue(e[t]),t++;for(const e of this.__parts)void 0!==e&&e.commit()}_clone(){const e=os?this.template.element.content.cloneNode(!0):document.importNode(this.template.element.content,!0),t=[],n=this.template.parts,i=document.createTreeWalker(e,133,null,!1);let s,r=0,o=0,a=i.nextNode();for(;r<n.length;)if(s=n[r],fs(s)){for(;o<s.index;)o++,"TEMPLATE"===a.nodeName&&(t.push(a),i.currentNode=a.content),null===(a=i.nextNode())&&(i.currentNode=t.pop(),a=i.nextNode());if("node"===s.type){const e=this.processor.handleTextExpression(this.options);e.insertAfterNode(a.previousSibling),this.__parts.push(e)}else this.__parts.push(...this.processor.handleAttributeExpressions(a,s.name,s.strings,this.options));r++}else this.__parts.push(void 0),r++;return os&&(document.adoptNode(e),customElements.upgrade(e)),e}}const Es=window.trustedTypes&&trustedTypes.createPolicy("lit-html",{createHTML:e=>e}),Ts=` ${cs} `;class Cs{constructor(e,t,n,i){this.strings=e,this.values=t,this.type=n,this.processor=i}getHTML(){const e=this.strings.length-1;let t="",n=!1;for(let i=0;i<e;i++){const e=this.strings[i],s=e.lastIndexOf("\x3c!--");n=(s>-1||n)&&-1===e.indexOf("--\x3e",s+1);const r=gs.exec(e);t+=null===r?e+(n?Ts:hs):e.substr(0,r.index)+r[1]+r[2]+"$lit$"+r[3]+cs}return t+=this.strings[e],t}getTemplateElement(){const e=document.createElement("template");let t=this.getHTML();return void 0!==Es&&(t=Es.createHTML(t)),e.innerHTML=t,e}}const As=e=>null===e||!("object"==typeof e||"function"==typeof e),Ps=e=>Array.isArray(e)||!(!e||!e[Symbol.iterator]);class Ls{constructor(e,t,n){this.dirty=!0,this.element=e,this.name=t,this.strings=n,this.parts=[];for(let e=0;e<n.length-1;e++)this.parts[e]=this._createPart()}_createPart(){return new Rs(this)}_getValue(){const e=this.strings,t=e.length-1,n=this.parts;if(1===t&&""===e[0]&&""===e[1]){const e=n[0].value;if("symbol"==typeof e)return String(e);if("string"==typeof e||!Ps(e))return e}let i="";for(let s=0;s<t;s++){i+=e[s];const t=n[s];if(void 0!==t){const e=t.value;if(As(e)||!Ps(e))i+="string"==typeof e?e:String(e);else for(const t of e)i+="string"==typeof t?t:String(t)}}return i+=e[t],i}commit(){this.dirty&&(this.dirty=!1,this.element.setAttribute(this.name,this._getValue()))}}class Rs{constructor(e){this.value=void 0,this.committer=e}setValue(e){e===ws||As(e)&&e===this.value||(this.value=e,_s(e)||(this.committer.dirty=!0))}commit(){for(;_s(this.value);){const e=this.value;this.value=ws,e(this)}this.value!==ws&&this.committer.commit()}}class Ns{constructor(e){this.value=void 0,this.__pendingValue=void 0,this.options=e}appendInto(e){this.startNode=e.appendChild(ms()),this.endNode=e.appendChild(ms())}insertAfterNode(e){this.startNode=e,this.endNode=e.nextSibling}appendIntoPart(e){e.__insert(this.startNode=ms()),e.__insert(this.endNode=ms())}insertAfterPart(e){e.__insert(this.startNode=ms()),this.endNode=e.endNode,e.endNode=this.startNode}setValue(e){this.__pendingValue=e}commit(){if(null===this.startNode.parentNode)return;for(;_s(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=ws,e(this)}const e=this.__pendingValue;e!==ws&&(As(e)?e!==this.value&&this.__commitText(e):e instanceof Cs?this.__commitTemplateResult(e):e instanceof Node?this.__commitNode(e):Ps(e)?this.__commitIterable(e):e===Ss?(this.value=Ss,this.clear()):this.__commitText(e))}__insert(e){this.endNode.parentNode.insertBefore(e,this.endNode)}__commitNode(e){this.value!==e&&(this.clear(),this.__insert(e),this.value=e)}__commitText(e){const t=this.startNode.nextSibling,n="string"==typeof(e=null==e?"":e)?e:String(e);t===this.endNode.previousSibling&&3===t.nodeType?t.data=n:this.__commitNode(document.createTextNode(n)),this.value=e}__commitTemplateResult(e){const t=this.options.templateFactory(e);if(this.value instanceof Ms&&this.value.template===t)this.value.update(e.values);else{const n=new Ms(t,e.processor,this.options),i=n._clone();n.update(e.values),this.__commitNode(i),this.value=n}}__commitIterable(e){Array.isArray(this.value)||(this.value=[],this.clear());const t=this.value;let n,i=0;for(const s of e)n=t[i],void 0===n&&(n=new Ns(this.options),t.push(n),0===i?n.appendIntoPart(this):n.insertAfterPart(t[i-1])),n.setValue(s),n.commit(),i++;i<t.length&&(t.length=i,this.clear(n&&n.endNode))}clear(e=this.startNode){ls(this.startNode.parentNode,e.nextSibling,this.endNode)}}class Ds{constructor(e,t,n){if(this.value=void 0,this.__pendingValue=void 0,2!==n.length||""!==n[0]||""!==n[1])throw new Error("Boolean attributes can only contain a single expression");this.element=e,this.name=t,this.strings=n}setValue(e){this.__pendingValue=e}commit(){for(;_s(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=ws,e(this)}if(this.__pendingValue===ws)return;const e=!!this.__pendingValue;this.value!==e&&(e?this.element.setAttribute(this.name,""):this.element.removeAttribute(this.name),this.value=e),this.__pendingValue=ws}}class Os extends Ls{constructor(e,t,n){super(e,t,n),this.single=2===n.length&&""===n[0]&&""===n[1]}_createPart(){return new ks(this)}_getValue(){return this.single?this.parts[0].value:super._getValue()}commit(){this.dirty&&(this.dirty=!1,this.element[this.name]=this._getValue())}}class ks extends Rs{}let Is=!1;(()=>{try{const e={get capture(){return Is=!0,!1}};window.addEventListener("test",e,e),window.removeEventListener("test",e,e)}catch(e){}})();class zs{constructor(e,t,n){this.value=void 0,this.__pendingValue=void 0,this.element=e,this.eventName=t,this.eventContext=n,this.__boundHandleEvent=e=>this.handleEvent(e)}setValue(e){this.__pendingValue=e}commit(){for(;_s(this.__pendingValue);){const e=this.__pendingValue;this.__pendingValue=ws,e(this)}if(this.__pendingValue===ws)return;const e=this.__pendingValue,t=this.value,n=null==e||null!=t&&(e.capture!==t.capture||e.once!==t.once||e.passive!==t.passive),i=null!=e&&(null==t||n);n&&this.element.removeEventListener(this.eventName,this.__boundHandleEvent,this.__options),i&&(this.__options=Us(e),this.element.addEventListener(this.eventName,this.__boundHandleEvent,this.__options)),this.value=e,this.__pendingValue=ws}handleEvent(e){"function"==typeof this.value?this.value.call(this.eventContext||this.element,e):this.value.handleEvent(e)}}const Us=e=>e&&(Is?{capture:e.capture,passive:e.passive,once:e.once}:e.capture);function Fs(e){let t=Vs.get(e.type);void 0===t&&(t={stringsArray:new WeakMap,keyString:new Map},Vs.set(e.type,t));let n=t.stringsArray.get(e.strings);if(void 0!==n)return n;const i=e.strings.join(cs);return n=t.keyString.get(i),void 0===n&&(n=new ds(e,e.getTemplateElement()),t.keyString.set(i,n)),t.stringsArray.set(e.strings,n),n}const Vs=new Map,Bs=new WeakMap,js=(e,t,n)=>{let i=Bs.get(t);void 0===i&&(ls(t,t.firstChild),Bs.set(t,i=new Ns(Object.assign({templateFactory:Fs},n))),i.appendInto(t)),i.setValue(e),i.commit()};const $s=new class{handleAttributeExpressions(e,t,n,i){const s=t[0];if("."===s){return new Os(e,t.slice(1),n).parts}if("@"===s)return[new zs(e,t.slice(1),i.eventContext)];if("?"===s)return[new Ds(e,t.slice(1),n)];return new Ls(e,t,n).parts}handleTextExpression(e){return new Ns(e)}};"undefined"!=typeof window&&(window.litHtmlVersions||(window.litHtmlVersions=[])).push("1.3.0");const Gs=(e,...t)=>new Cs(e,t,"html",$s),Hs=(e,t)=>`${e}--${t}`;let Ws=!0;void 0===window.ShadyCSS?Ws=!1:void 0===window.ShadyCSS.prepareTemplateDom&&(console.warn("Incompatible ShadyCSS version detected. Please update to at least @webcomponents/webcomponentsjs@2.0.2 and @webcomponents/shadycss@1.3.1."),Ws=!1);const qs=e=>t=>{const n=Hs(t.type,e);let i=Vs.get(n);void 0===i&&(i={stringsArray:new WeakMap,keyString:new Map},Vs.set(n,i));let s=i.stringsArray.get(t.strings);if(void 0!==s)return s;const r=t.strings.join(cs);if(s=i.keyString.get(r),void 0===s){const n=t.getTemplateElement();Ws&&window.ShadyCSS.prepareTemplateDom(n,e),s=new ds(t,n),i.keyString.set(r,s)}return i.stringsArray.set(t.strings,s),s},Xs=["html","svg"],Ys=new Set,Zs=(e,t,n)=>{Ys.add(e);const i=n?n.element:document.createElement("template"),s=t.querySelectorAll("style"),{length:r}=s;if(0===r)return void window.ShadyCSS.prepareTemplateStyles(i,e);const o=document.createElement("style");for(let e=0;e<r;e++){const t=s[e];t.parentNode.removeChild(t),o.textContent+=t.textContent}(e=>{Xs.forEach(t=>{const n=Vs.get(Hs(t,e));void 0!==n&&n.keyString.forEach(e=>{const{element:{content:t}}=e,n=new Set;Array.from(t.querySelectorAll("style")).forEach(e=>{n.add(e)}),vs(e,n)})})})(e);const a=i.content;n?function(e,t,n=null){const{element:{content:i},parts:s}=e;if(null==n)return void i.appendChild(t);const r=document.createTreeWalker(i,133,null,!1);let o=bs(s),a=0,l=-1;for(;r.nextNode();){l++;for(r.currentNode===n&&(a=ys(t),n.parentNode.insertBefore(t,n));-1!==o&&s[o].index===l;){if(a>0){for(;-1!==o;)s[o].index+=a,o=bs(s,o);return}o=bs(s,o)}}}(n,o,a.firstChild):a.insertBefore(o,a.firstChild),window.ShadyCSS.prepareTemplateStyles(i,e);const l=a.querySelector("style");if(window.ShadyCSS.nativeShadow&&null!==l)t.insertBefore(l.cloneNode(!0),t.firstChild);else if(n){a.insertBefore(o,a.firstChild);const e=new Set;e.add(o),vs(n,e)}};window.JSCompiler_renameProperty=(e,t)=>e;const Js={toAttribute(e,t){switch(t){case Boolean:return e?"":null;case Object:case Array:return null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){switch(t){case Boolean:return null!==e;case Number:return null===e?null:Number(e);case Object:case Array:return JSON.parse(e)}return e}},Ks=(e,t)=>t!==e&&(t==t||e==e),Qs={attribute:!0,type:String,converter:Js,reflect:!1,hasChanged:Ks};class er extends HTMLElement{constructor(){super(),this._updateState=0,this._instanceProperties=void 0,this._updatePromise=new Promise(e=>this._enableUpdatingResolver=e),this._changedProperties=new Map,this._reflectingProperties=void 0,this.initialize()}static get observedAttributes(){this.finalize();const e=[];return this._classProperties.forEach((t,n)=>{const i=this._attributeNameForProperty(n,t);void 0!==i&&(this._attributeToPropertyMap.set(i,n),e.push(i))}),e}static _ensureClassProperties(){if(!this.hasOwnProperty(JSCompiler_renameProperty("_classProperties",this))){this._classProperties=new Map;const e=Object.getPrototypeOf(this)._classProperties;void 0!==e&&e.forEach((e,t)=>this._classProperties.set(t,e))}}static createProperty(e,t=Qs){if(this._ensureClassProperties(),this._classProperties.set(e,t),t.noAccessor||this.prototype.hasOwnProperty(e))return;const n="symbol"==typeof e?Symbol():"__"+e,i=this.getPropertyDescriptor(e,n,t);void 0!==i&&Object.defineProperty(this.prototype,e,i)}static getPropertyDescriptor(e,t,n){return{get(){return this[t]},set(n){const i=this[e];this[t]=n,this._requestUpdate(e,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this._classProperties&&this._classProperties.get(e)||Qs}static finalize(){const e=Object.getPrototypeOf(this);if(e.hasOwnProperty("finalized")||e.finalize(),this.finalized=!0,this._ensureClassProperties(),this._attributeToPropertyMap=new Map,this.hasOwnProperty(JSCompiler_renameProperty("properties",this))){const e=this.properties,t=[...Object.getOwnPropertyNames(e),..."function"==typeof Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[]];for(const n of t)this.createProperty(n,e[n])}}static _attributeNameForProperty(e,t){const n=t.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof e?e.toLowerCase():void 0}static _valueHasChanged(e,t,n=Ks){return n(e,t)}static _propertyValueFromAttribute(e,t){const n=t.type,i=t.converter||Js,s="function"==typeof i?i:i.fromAttribute;return s?s(e,n):e}static _propertyValueToAttribute(e,t){if(void 0===t.reflect)return;const n=t.type,i=t.converter;return(i&&i.toAttribute||Js.toAttribute)(e,n)}initialize(){this._saveInstanceProperties(),this._requestUpdate()}_saveInstanceProperties(){this.constructor._classProperties.forEach((e,t)=>{if(this.hasOwnProperty(t)){const e=this[t];delete this[t],this._instanceProperties||(this._instanceProperties=new Map),this._instanceProperties.set(t,e)}})}_applyInstanceProperties(){this._instanceProperties.forEach((e,t)=>this[t]=e),this._instanceProperties=void 0}connectedCallback(){this.enableUpdating()}enableUpdating(){void 0!==this._enableUpdatingResolver&&(this._enableUpdatingResolver(),this._enableUpdatingResolver=void 0)}disconnectedCallback(){}attributeChangedCallback(e,t,n){t!==n&&this._attributeToProperty(e,n)}_propertyToAttribute(e,t,n=Qs){const i=this.constructor,s=i._attributeNameForProperty(e,n);if(void 0!==s){const e=i._propertyValueToAttribute(t,n);if(void 0===e)return;this._updateState=8|this._updateState,null==e?this.removeAttribute(s):this.setAttribute(s,e),this._updateState=-9&this._updateState}}_attributeToProperty(e,t){if(8&this._updateState)return;const n=this.constructor,i=n._attributeToPropertyMap.get(e);if(void 0!==i){const e=n.getPropertyOptions(i);this._updateState=16|this._updateState,this[i]=n._propertyValueFromAttribute(t,e),this._updateState=-17&this._updateState}}_requestUpdate(e,t){let n=!0;if(void 0!==e){const i=this.constructor,s=i.getPropertyOptions(e);i._valueHasChanged(this[e],t,s.hasChanged)?(this._changedProperties.has(e)||this._changedProperties.set(e,t),!0!==s.reflect||16&this._updateState||(void 0===this._reflectingProperties&&(this._reflectingProperties=new Map),this._reflectingProperties.set(e,s))):n=!1}!this._hasRequestedUpdate&&n&&(this._updatePromise=this._enqueueUpdate())}requestUpdate(e,t){return this._requestUpdate(e,t),this.updateComplete}async _enqueueUpdate(){this._updateState=4|this._updateState;try{await this._updatePromise}catch(e){}const e=this.performUpdate();return null!=e&&await e,!this._hasRequestedUpdate}get _hasRequestedUpdate(){return 4&this._updateState}get hasUpdated(){return 1&this._updateState}performUpdate(){this._instanceProperties&&this._applyInstanceProperties();let e=!1;const t=this._changedProperties;try{e=this.shouldUpdate(t),e?this.update(t):this._markUpdated()}catch(t){throw e=!1,this._markUpdated(),t}e&&(1&this._updateState||(this._updateState=1|this._updateState,this.firstUpdated(t)),this.updated(t))}_markUpdated(){this._changedProperties=new Map,this._updateState=-5&this._updateState}get updateComplete(){return this._getUpdateComplete()}_getUpdateComplete(){return this._updatePromise}shouldUpdate(e){return!0}update(e){void 0!==this._reflectingProperties&&this._reflectingProperties.size>0&&(this._reflectingProperties.forEach((e,t)=>this._propertyToAttribute(t,this[t],e)),this._reflectingProperties=void 0),this._markUpdated()}updated(e){}firstUpdated(e){}}er.finalized=!0;const tr=(e,t)=>"method"===t.kind&&t.descriptor&&!("value"in t.descriptor)?Object.assign(Object.assign({},t),{finisher(n){n.createProperty(t.key,e)}}):{kind:"field",key:Symbol(),placement:"own",descriptor:{},initializer(){"function"==typeof t.initializer&&(this[t.key]=t.initializer.call(this))},finisher(n){n.createProperty(t.key,e)}};function nr(e){return(t,n)=>void 0!==n?((e,t,n)=>{t.constructor.createProperty(n,e)})(e,t,n):tr(e,t)}const ir="adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype;Symbol();(window.litElementVersions||(window.litElementVersions=[])).push("2.3.1");const sr={};class rr extends er{static getStyles(){return this.styles}static _getUniqueStyles(){if(this.hasOwnProperty(JSCompiler_renameProperty("_styles",this)))return;const e=this.getStyles();if(void 0===e)this._styles=[];else if(Array.isArray(e)){const t=(e,n)=>e.reduceRight((e,n)=>Array.isArray(n)?t(n,e):(e.add(n),e),n),n=t(e,new Set),i=[];n.forEach(e=>i.unshift(e)),this._styles=i}else this._styles=[e]}initialize(){super.initialize(),this.constructor._getUniqueStyles(),this.renderRoot=this.createRenderRoot(),window.ShadowRoot&&this.renderRoot instanceof window.ShadowRoot&&this.adoptStyles()}createRenderRoot(){return this.attachShadow({mode:"open"})}adoptStyles(){const e=this.constructor._styles;0!==e.length&&(void 0===window.ShadyCSS||window.ShadyCSS.nativeShadow?ir?this.renderRoot.adoptedStyleSheets=e.map(e=>e.styleSheet):this._needsShimAdoptedStyleSheets=!0:window.ShadyCSS.ScopingShim.prepareAdoptedCssText(e.map(e=>e.cssText),this.localName))}connectedCallback(){super.connectedCallback(),this.hasUpdated&&void 0!==window.ShadyCSS&&window.ShadyCSS.styleElement(this)}update(e){const t=this.render();super.update(e),t!==sr&&this.constructor.render(t,this.renderRoot,{scopeName:this.localName,eventContext:this}),this._needsShimAdoptedStyleSheets&&(this._needsShimAdoptedStyleSheets=!1,this.constructor._styles.forEach(e=>{const t=document.createElement("style");t.textContent=e.cssText,this.renderRoot.appendChild(t)}))}render(){return sr}}rr.finalized=!0,rr.render=(e,t,n)=>{if(!n||"object"!=typeof n||!n.scopeName)throw new Error("The `scopeName` option is required.");const i=n.scopeName,s=Bs.has(t),r=Ws&&11===t.nodeType&&!!t.host,o=r&&!Ys.has(i),a=o?document.createDocumentFragment():t;if(js(e,a,Object.assign({templateFactory:qs(i)},n)),o){const e=Bs.get(a);Bs.delete(a);const n=e.value instanceof Ms?e.value.template:void 0;Zs(i,a,n),ls(t,t.firstChild),t.appendChild(a),Bs.set(t,e)}!s&&r&&window.ShadyCSS.styleElement(t.host)};const or=(e,t)=>{const n=e.startNode.parentNode,i=void 0===t?e.endNode:t.startNode,s=n.insertBefore(ms(),i);n.insertBefore(ms(),i);const r=new Ns(e.options);return r.insertAfterNode(s),r},ar=(e,t)=>(e.setValue(t),e.commit(),e),lr=(e,t,n)=>{const i=e.startNode.parentNode,s=n?n.startNode:e.endNode,r=t.endNode.nextSibling;r!==s&&as(i,t.startNode,r,s)},cr=e=>{ls(e.startNode.parentNode,e.startNode,e.endNode.nextSibling)},hr=(e,t,n)=>{const i=new Map;for(let s=t;s<=n;s++)i.set(e[s],s);return i},ur=new WeakMap,dr=new WeakMap;pr=(e,t,n)=>{let i;return void 0===n?n=t:void 0!==t&&(i=t),t=>{if(!(t instanceof Ns))throw new Error("repeat can only be used in text bindings");const s=ur.get(t)||[],r=dr.get(t)||[],o=[],a=[],l=[];let c,h,u=0;for(const t of e)l[u]=i?i(t,u):u,a[u]=n(t,u),u++;let d=0,p=s.length-1,f=0,m=a.length-1;for(;d<=p&&f<=m;)if(null===s[d])d++;else if(null===s[p])p--;else if(r[d]===l[f])o[f]=ar(s[d],a[f]),d++,f++;else if(r[p]===l[m])o[m]=ar(s[p],a[m]),p--,m--;else if(r[d]===l[m])o[m]=ar(s[d],a[m]),lr(t,s[d],o[m+1]),d++,m--;else if(r[p]===l[f])o[f]=ar(s[p],a[f]),lr(t,s[p],s[d]),p--,f++;else if(void 0===c&&(c=hr(l,f,m),h=hr(r,d,p)),c.has(r[d]))if(c.has(r[p])){const e=h.get(l[f]),n=void 0!==e?s[e]:null;if(null===n){const e=or(t,s[d]);ar(e,a[f]),o[f]=e}else o[f]=ar(n,a[f]),lr(t,n,s[d]),s[e]=null;f++}else cr(s[p]),p--;else cr(s[d]),d++;for(;f<=m;){const e=or(t,o[m+1]);ar(e,a[f]),o[f++]=e}for(;d<=p;){const e=s[d++];null!==e&&cr(e)}ur.set(t,o),dr.set(t,l)}};var pr,fr,mr=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let gr=fr=class extends rr{constructor(){super(...arguments),this._isFirstConnected=!1}static setStyle(e,t){Object.assign(e.style,t)}static setAttribs(e,t){for(let n in t)e.setAttribute(n,t[n])}get shady(){return this.constructor.shady}appendTo(e){return e.appendChild(this),this}removeChildren(){for(;this.firstChild;)this.removeChild(this.firstChild)}getChildrenArray(){return Array.from(this.children)}appendElement(e,t){return this.createElement(e,t,this)}createElement(e,t,n){let i;return i="string"==typeof e?document.createElement(e):e instanceof HTMLElement?e:new e,t&&Object.assign(i.style,t),n&&n.appendChild(i),i}setStyle(e){return fr.setStyle(this,e),this}setAttribute(e,t){return super.setAttribute(e,t),this}setAttributes(e){return fr.setAttribs(this,e),this}addClass(...e){return e.forEach(e=>this.classList.add(e)),this}removeClass(...e){return e.forEach(e=>this.classList.remove(e)),this}setClass(e,t){return t?this.classList.add(e):this.classList.remove(e),this}hasFocus(){return document.activeElement===this}on(e,t,n){return this.addEventListener(e,t,n),this}off(e,t,n){return this.removeEventListener(e,t,n),this}connectedCallback(){this._isFirstConnected||(this._isFirstConnected=!0,this.firstConnected()),this.connected(),super.connectedCallback()}disconnectedCallback(){super.disconnectedCallback(),this.disconnected()}createRenderRoot(){return this.shady?super.createRenderRoot():this}firstConnected(){}connected(){}disconnected(){}onUpdate(){this.requestUpdate()}};gr.tagName="ff-custom-element",gr.shady=!1,gr=fr=mr([yr("ff-custom-element")],gr);var vr=gr;function yr(e){return t=>(t.tagName=e,customElements.define(t.tagName,t),t)}var br,xr=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let _r=br=class extends vr{constructor(e){super(),this.template=null,this.name=e||""}static add(e,t){if(br.templates[e])throw new Error(`icon already registered: '${e}'`);br.templates[e]=t}static getTemplateNames(){return Object.keys(br.templates)}firstConnected(){this.classList.add("ff-icon")}render(){if(this.name){const e=this.constructor.templates[this.name];return e||console.warn(`icon not found: '${this.name}'`),e}return this.template?this.template:Gs`[icon undefined]`}};_r.templates={},xr([nr({attribute:!1})],_r.prototype,"template",void 0),xr([nr({type:String})],_r.prototype,"name",void 0),_r=br=xr([yr("ff-icon")],_r);var wr=_r;_r.add("empty",Gs``),_r.add("check",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg>`),_r.add("close",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"/></svg>`),_r.add("grip",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M149.333 56v80c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V56c0-13.255 10.745-24 24-24h101.333c13.255 0 24 10.745 24 24zm181.334 240v-80c0-13.255-10.745-24-24-24H205.333c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256 0 24.001-10.745 24.001-24zm32-240v80c0 13.255 10.745 24 24 24H488c13.255 0 24-10.745 24-24V56c0-13.255-10.745-24-24-24H386.667c-13.255 0-24 10.745-24 24zm-32 80V56c0-13.255-10.745-24-24-24H205.333c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256 0 24.001-10.745 24.001-24zm-205.334 56H24c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24zM0 376v80c0 13.255 10.745 24 24 24h101.333c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H24c-13.255 0-24 10.745-24 24zm386.667-56H488c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zm0 160H488c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zM181.333 376v80c0 13.255 10.745 24 24 24h101.333c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H205.333c-13.255 0-24 10.745-24 24z"/></svg>`),_r.add("up",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg>`),_r.add("down",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M413.1 222.5l22.2 22.2c9.4 9.4 9.4 24.6 0 33.9L241 473c-9.4 9.4-24.6 9.4-33.9 0L12.7 278.6c-9.4-9.4-9.4-24.6 0-33.9l22.2-22.2c9.5-9.5 25-9.3 34.3.4L184 343.4V56c0-13.3 10.7-24 24-24h32c13.3 0 24 10.7 24 24v287.4l114.8-120.5c9.3-9.8 24.8-10 34.3-.4z"/></svg>`),_r.add("caret-up",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M288.662 352H31.338c-17.818 0-26.741-21.543-14.142-34.142l128.662-128.662c7.81-7.81 20.474-7.81 28.284 0l128.662 128.662c12.6 12.599 3.676 34.142-14.142 34.142z"/></svg>`),_r.add("caret-down",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path d="M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"/></svg>`),_r.add("folder",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M464 128H272l-64-64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48z"/></svg>`),_r.add("file",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48z"/></svg>`),_r.add("info",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></svg>`),_r.add("warning",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/></svg>`),_r.add("error",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"/></svg>`),_r.add("prompt",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zM262.655 90c-54.497 0-89.255 22.957-116.549 63.758-3.536 5.286-2.353 12.415 2.715 16.258l34.699 26.31c5.205 3.947 12.621 3.008 16.665-2.122 17.864-22.658 30.113-35.797 57.303-35.797 20.429 0 45.698 13.148 45.698 32.958 0 14.976-12.363 22.667-32.534 33.976C247.128 238.528 216 254.941 216 296v4c0 6.627 5.373 12 12 12h56c6.627 0 12-5.373 12-12v-1.333c0-28.462 83.186-29.647 83.186-106.667 0-58.002-60.165-102-116.531-102zM256 338c-25.365 0-46 20.635-46 46 0 25.364 20.635 46 46 46s46-20.636 46-46c0-25.365-20.635-46-46-46z"/></svg>`);var Sr,Mr=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};const Er={info:"ff-info",success:"ff-success",warning:"ff-warning",error:"ff-error"},Tr={info:"info",success:"check",warning:"warning",error:"error"},Cr={info:2e3,success:2e3,warning:5e3,error:0};let Ar=Sr=class extends vr{constructor(e,t,n){super(),this._handler=0,this.on("transitionend",this.remove.bind(this)),this.message=e||"<messge>",this.level=t||"info",this.timeout=void 0!==n?n:Cr[this.level];const i=(Sr.shadowRootNode||document).getElementById(Sr.stackId);i?i.appendChild(this):console.warn(`element '#${Sr.stackId}' not found`)}static show(e,t,n){new Sr(e,t,n)}close(){this._handler>0&&(window.clearTimeout(this._handler),this._handler=0),this.classList.add("ff-out")}firstUpdated(){this.classList.add("ff-notification",Er[this.level]),this.timeout>0&&(this._handler=window.setTimeout(()=>this.close(),this.timeout))}render(){const e=Tr[this.level];return Gs`<ff-icon name=${e}></ff-icon>
            <div class="ff-text">${this.message}</div>
            <ff-button inline icon="close" @click=${this.onClose}>`}onClose(e){e.stopPropagation(),this.close()}};Ar.stackId="ff-notification-stack",Ar.shadowRootNode=null,Mr([nr({type:String})],Ar.prototype,"message",void 0),Mr([nr({type:String})],Ar.prototype,"level",void 0),Mr([nr({type:Number})],Ar.prototype,"timeout",void 0),Ar=Sr=Mr([yr("ff-notification")],Ar);var Pr=Ar;let Lr;const Rr=function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Lr&&(Lr=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),Lr.width=e.width,Lr.height=e.height;const n=Lr.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Lr}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")};let Nr=0;class Dr extends de{constructor(e=Dr.DEFAULT_IMAGE,t=Dr.DEFAULT_MAPPING,n=1001,i=1001,s=1006,r=1008,o=1023,a=1009,l=1,c=3e3){super(),Object.defineProperty(this,"id",{value:Nr++}),this.uuid=Z.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=i,this.magFilter=s,this.minFilter=r,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new gt(0,0),this.repeat=new gt(1,1),this.center=new gt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new fe,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.version=0,this.onUpdate=null}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const i=this.image;if(void 0===i.uuid&&(i.uuid=Z.generateUUID()),!t&&void 0===e.images[i.uuid]){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(Or(i[e].image)):t.push(Or(i[e]))}else t=Or(i);e.images[i.uuid]={uuid:i.uuid,url:t}}n.image=i.uuid}return t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function Or(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Rr(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Dr.DEFAULT_IMAGE=void 0,Dr.DEFAULT_MAPPING=300,Dr.prototype.isTexture=!0;class kr extends de{constructor(e,t,n){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new qt(0,0,e,t),this.scissorTest=!1,this.viewport=new qt(0,0,e,t),n=n||{},this.texture=new Dr(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=1,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:1006,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}function Ir(e){const t={};for(const n in e){t[n]={};for(const i in e[n]){const s=e[n][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?t[n][i]=s.clone():Array.isArray(s)?t[n][i]=s.slice():t[n][i]=s}}return t}function zr(e){const t={};for(let n=0;n<e.length;n++){const i=Ir(e[n]);for(const e in i)t[e]=i[e]}return t}kr.prototype.isWebGLRenderTarget=!0;const Ur={clone:Ir,merge:zr};function Fr(e){Ut.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="\nvoid main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",this.fragmentShader="\nvoid main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}\n",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}Fr.prototype=Object.create(Ut.prototype),Fr.prototype.constructor=Fr,Fr.prototype.isShaderMaterial=!0,Fr.prototype.copy=function(e){return Ut.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ir(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this},Fr.prototype.toJSON=function(e){const t=Ut.prototype.toJSON.call(this,e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?t.uniforms[n]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[n]={type:"m4",value:i.toArray()}:t.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t};class Vr extends Fr{constructor(){super(...arguments),this.isIndexShader=!0,this.uniformsNeedUpdate=!1,this.lights=!1,this.uniforms={index:{value:[0,0,0]}},this.vertexShader=["void main() {","  #include <begin_vertex>","  #include <project_vertex>","}"].join("\n"),this.fragmentShader=["uniform vec3 index;","void main() {","  gl_FragColor = vec4(index, 1.0);","}"].join("\n")}static indexFromPixel(e){return e[0]+e[1]<<8+e[2]<<16}static zoneFromPixel(e){return e[3]}setIndex(e){const t=e>>16,n=(e>>8)-(t<<8),i=e-(t<<16)-(n<<8),s=this.uniforms.index.value;s[0]=i/255,s[1]=n/255,s[2]=t/255,this.uniformsNeedUpdate=!0}}class Br extends Fr{constructor(){super(...arguments),this.isPositionShader=!0,this.uniforms={index:{value:0},range:{value:[-1,1]}},this.vertexShader=["varying vec3 vLocalPosition;","void main() {","  #include <begin_vertex>","  #include <project_vertex>","  vLocalPosition = vec3(position);","}"].join("\n"),this.fragmentShader=["uniform float index;","uniform vec2 range;","varying vec3 vLocalPosition;","vec4 toVec4(float v) {","  float vn = (v - range.x) / (range.y - range.x);","  float b0 = floor(vn * 255.0) / 255.0; vn = (vn - b0) * 256.0;","  float b1 = floor(vn * 255.0) / 255.0; vn = (vn - b1) * 256.0;","  float b2 = floor(vn * 255.0) / 255.0; vn = (vn - b2) * 256.0;","  float b3 = floor(vn * 255.0) / 255.0;","  return vec4(clamp(b0, 0.0, 1.0), clamp(b1, 0.0, 1.0), clamp(b2, 0.0, 1.0), clamp(b3, 0.0, 1.0));","}","void main() {","  gl_FragColor = (index == 0.0 ? toVec4(vLocalPosition.x)","    : (index == 1.0 ? toVec4(vLocalPosition.y) : toVec4(vLocalPosition.z)));","}"].join("\n")}}class jr extends Fr{constructor(){super(...arguments),this.isNormalShader=!0,this.uniforms={index:{value:0}},this.vertexShader=["varying vec3 vLocalNormal;","void main() {","  #include <beginnormal_vertex>","  #include <begin_vertex>","  #include <project_vertex>","  vLocalNormal = vec3(normal);","}"].join("\n"),this.fragmentShader=["uniform vec3 index;","varying vec3 vLocalNormal;","void main() {","  vec3 normal = normalize(vLocalNormal);","  gl_FragColor = vec4(normal * 0.5 + 0.5, 1.0);","}"].join("\n")}}const $r=new K,Gr=new Ht,Hr=new Ge(new K(-1e4,-1e4,-1e4),new K(1e4,1e4,1e4));class Wr{constructor(e){this.renderer=e,this.pickTextures=[];for(let e=0;e<3;++e)this.pickTextures[e]=new kr(1,1,{stencilBuffer:!1});this.pickBuffer=new Uint8Array(4),this.indexShader=new Vr,this.positionShader=new Br,this.normalShader=new jr}static add(e,t){const n=e=>{e.material&&(e.onBeforeRender=function(t,n,i,s,r){r.isIndexShader&&r.setIndex(e.id)})};t?e.traverse(e=>n(e)):n(e)}static remove(e,t){const n=e=>{e.material&&(e.onBeforeRender=null)};t?e.traverse(e=>n(e)):n(e)}pickObject(e,t,n){const i=this.pickIndex(e,t,n);if(i>0)return e.getObjectById(i)}pickIndex(e,t,n){const i=n.viewport;t=i.updateCamera(t);const s=e.overrideMaterial;e.overrideMaterial=this.indexShader;const r=this.renderer,o=this.pickTextures[0];r.getClearColor(Gr),i.applyPickViewport(o,n),r.setRenderTarget(o),r.setClearColor(0);const a=r.xr.enabled;r.xr.enabled=!1,r.clear(),r.render(e,t),r.xr.enabled=a,r.setRenderTarget(null),r.setClearColor(Gr),e.overrideMaterial=s;const l=this.pickBuffer;return r.readRenderTargetPixels(o,0,0,1,1,l),l[0]+256*l[1]+65536*l[2]}pickPosition(e,t,n,i,s){i=i||Hr,s=s||new K;const r=n.viewport;t=r.updateCamera(t);const o=e.overrideMaterial,a=e.overrideMaterial=this.positionShader,l=this.renderer,c=this.pickTextures;l.getClearColor(Gr),l.setClearColor(0);for(let s=0;s<3;++s)a.uniforms.index.value=s,a.uniforms.range.value[0]=i.min.getComponent(s),a.uniforms.range.value[1]=i.max.getComponent(s),r.applyPickViewport(c[s],n),l.setRenderTarget(c[s]),l.clear(),l.render(e,t);l.setRenderTarget(null),l.setClearColor(Gr),e.overrideMaterial=o;const h=this.pickBuffer;for(let e=0;e<3;++e)l.readRenderTargetPixels(c[e],0,0,1,1,h),s.setComponent(e,2.337437050015319e-10*h[3]+5.983838848039216e-8*h[2]+1531862745098039e-20*h[1]+.003921568627451*h[0]);return i.getSize($r),s.multiply($r).add(i.min)}pickNormal(e,t,n,i){i=i||new K;const s=n.viewport;t=s.updateCamera(t);const r=e.overrideMaterial;e.overrideMaterial=this.normalShader;const o=this.renderer,a=this.pickTextures[0];o.getClearColor(Gr),s.applyPickViewport(a,n),o.setRenderTarget(a),o.setClearColor(0),o.clear(),o.render(e,t),o.setRenderTarget(null),o.setClearColor(Gr),e.overrideMaterial=r;const l=this.pickBuffer;return o.readRenderTargetPixels(a,0,0,1,1,l),i.set(l[0]/255*2-1,l[1]/255*2-1,l[2]/255*2-1).normalize()}}class qr extends Ae{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}qr.prototype.isScene=!0;const Xr={view:null,viewport:null,renderer:null,scene:null,camera:null},Yr={type:"before-render",component:null,context:Xr},Zr={type:"after-render",component:null,context:Xr},Jr={activate:D("Scene.Activate")};class Kr extends $e{constructor(e,t){super(e,t),this._activeCameraComponent=null,this._preRenderList=[],this._postRenderList=[],this._renderListsNeedUpdate=!0,this.ins=this.addInputs(Jr,0),this.addEvents("before-render","after-render","active-camera")}get scene(){return this.object3D}get activeCameraComponent(){return this._activeCameraComponent}set activeCameraComponent(e){if(e!==this._activeCameraComponent){const t=this._activeCameraComponent;this._activeCameraComponent=e;const n={type:"active-camera",previous:t,next:e};this.emit(n)}}get activeCamera(){return this._activeCameraComponent?this._activeCameraComponent.camera:null}get renderer(){return this.getMainComponent(q)}create(){super.create(),this.on("hierarchy",this.shouldUpdateRenderLists,this),this.on("child",this.shouldUpdateRenderLists,this);const e=this.renderer;e&&!e.activeSceneComponent&&(e.activeSceneComponent=this)}update(e){if(super.update(e),this.ins.activate.changed){const e=this.renderer;e&&(e.activeSceneComponent=this)}return!0}tick(e){return this._renderListsNeedUpdate&&(this.updateRenderLists(),this._renderListsNeedUpdate=!1),!1}dispose(){const e=this.renderer;e&&e.activeSceneComponent===this&&(e.activeSceneComponent=null),this.off("hierarchy",this.shouldUpdateRenderLists,this),this.off("child",this.shouldUpdateRenderLists,this),super.dispose()}preRender(e){const t=this._preRenderList;for(let n=0,i=t.length;n<i;++n)t[n].preRender(e)}postRender(e){const t=this._postRenderList;for(let n=0,i=t.length;n<i;++n)t[n].postRender(e)}createObject3D(){const e=new qr;return e.onBeforeRender=this._onBeforeRender.bind(this),e.onAfterRender=this._onAfterRender.bind(this),e}shouldUpdateRenderLists(){this._renderListsNeedUpdate=!0}updateRenderLists(){this._preRenderList=[],this._postRenderList=[],this.traverseDown(!1,!0,!0,e=>(e.preRender&&this._preRenderList.push(e),e.postRender&&this._postRenderList.push(e),!1)),this.changed=!0}_onBeforeRender(e,t,n){Xr.view=e.__view,Xr.viewport=e.__viewport,Xr.renderer=e,Xr.scene=t,Xr.camera=n,this.preRender(Xr),Yr.component=this,this.emit(Yr)}_onAfterRender(e,t,n){Xr.view=e.__view,Xr.viewport=e.__viewport,Xr.renderer=e,Xr.scene=t,Xr.camera=n,this.postRender(Xr),Zr.component=this,this.emit(Zr)}}Kr.typeName="CScene",Kr.isGraphSingleton=!0;const Qr=new K;class eo extends j{constructor(e,t){super(e,t),this.ins=this.addInputs(eo.object3DIns),this.outs=this.addOutputs(eo.object3DOuts),this._object3D=null,this._isPickable=!1,this.addEvent("object"),this.node.components.on(this.parentComponentClass,this._onParent,this)}get parentComponentClass(){return this.constructor.parentComponentClass}get parentComponent(){return this.node.components.get(this.parentComponentClass,!0)}get transform(){return this.node.components.get($e,!0)}get scene(){const e=this.transform;return e?e.getParentComponent(Kr,!0):void 0}get object3D(){return this._object3D}set object3D(e){const t=this._object3D;if(t&&(t.userData.component=null,this.unregisterPickableObject3D(t,!0),t.parent&&this.onRemoveFromParent(t.parent)),this.emit({type:"object",current:t,next:e}),this._object3D=e,e){e.userData.component=this,e.matrixAutoUpdate=!1,e.visible=this.ins.visible.value,this.registerPickableObject3D(e,!0);const t=this.parentComponent;t&&this.onAddToParent(t.object3D)}}update(e){const{visible:t,pickable:n}=this.ins;return t.changed&&this._object3D&&(this._object3D.visible=t.value),n.changed&&n.value!==this._isPickable&&(this._isPickable=n.value,n.value?this.enablePointerEvents():this.disablePointerEvents()),!0}dispose(){this.object3D=null,this.ins.pickable.value&&this.disablePointerEvents(),this.node.components.off(this.parentComponentClass,this._onParent,this),super.dispose()}preRender(e){}postRender(e){}toString(){return super.toString()+(this._object3D?" - type: "+this._object3D.type:" - (null)")}onPointer(e){const t=this.outs;"pointer-down"===e.type?(t.pointerDown.set(),t.pointerActive.setValue(!0)):"pointer-up"===e.type&&(t.pointerUp.set(),t.pointerActive.setValue(!1)),e.stopPropagation=!0}enablePointerEvents(){this.on("pointer-down",this.onPointer,this),this.on("pointer-up",this.onPointer,this)}disablePointerEvents(){this.off("pointer-down",this.onPointer,this),this.off("pointer-up",this.onPointer,this);const e=this.outs;e.pointerActive.value&&(e.pointerUp.set(),e.pointerActive.setValue(!1))}updateTransform(){const e=this._object3D;if(!e)return;const{position:t,rotation:n,order:i,scale:s}=this.ins;if(t.changed||n.changed||i.changed||s.changed){e.position.fromArray(t.value),Qr.fromArray(n.value).multiplyScalar(Z.DEG2RAD);const r=i.getOptionText();e.rotation.setFromVector3(Qr,r),e.scale.fromArray(s.value),e.updateMatrix()}return!0}onAddToParent(e){e.add(this._object3D)}onRemoveFromParent(e){e.remove(this._object3D)}addObject3D(e){this._object3D.add(e),this.registerPickableObject3D(e,!0)}removeObject3D(e){this.unregisterPickableObject3D(e,!0),this._object3D.remove(e)}registerPickableObject3D(e,t){Wr.add(e,t)}unregisterPickableObject3D(e,t){Wr.remove(e,t)}_onParent(e){this._object3D&&!this._object3D.parent&&e.add&&this.onAddToParent(e.object.object3D)}}eo.typeName="CObject3D",eo.parentComponentClass=$e,eo.object3DIns={visible:C("Object.Visible",!0),pickable:C("Object.Pickable")},eo.object3DOuts={pointerDown:D("Pointer.Down"),pointerUp:D("Pointer.Up"),pointerActive:C("Pointer.Active")},eo.transformIns=$e.transformIns,eo.prototype.preRender=null,eo.prototype.postRender=null;const to=new K,no=new te,io=new ue;new J;function so(e,t,n){const i=n||new J;return to.fromArray(e).multiplyScalar(Z.DEG2RAD),io.setFromVector3(to,t),i.setFromEuler(io),i}function ro(e,t,n){const i=n||[0,0,0];return io.setFromQuaternion(e,t),io.toVector3(to),to.multiplyScalar(Z.RAD2DEG).toArray(i),i}function oo(e){const t=new Map,n=new Map,i=new Map;e.traverse(e=>{const s=e;if(s.isMesh){const e=s.geometry;e&&t.set(e.uuid,e);const r=s.material;if(r){n.set(r.uuid,r);for(let e in r){const t=r[e];t&&t.isTexture&&i.set(t.uuid,t)}}}});for(let e of i)e[1].dispose();for(let e of n)e[1].dispose();for(let e of t)e[1].dispose()}function ao(e,t,n){n||(n=e);const i=e.geometry;if(i&&e.visible){let s=e;for(no.identity();s&&s!==n;)no.premultiply(s.matrix),s=s.parent;if(i.isGeometry){const e=i.vertices;for(let n=0,i=e.length;n<i;++n)to.copy(e[n]).applyMatrix4(no),t.expandByPoint(to)}else if(i.isBufferGeometry){const e=i.attributes.position;if(void 0!==e)for(let n=0,i=e.count;n<i;++n)to.fromBufferAttribute(e,n).applyMatrix4(no),t.expandByPoint(to)}}const s=e.children;for(let e=0,i=s.length;e<i;++e)ao(s[e],t,n)}var lo,co,ho,uo,po;!function(e){e[e.Image2D=0]="Image2D",e[e.Web3D=1]="Web3D",e[e.App3D=2]="App3D",e[e.iOSApp3D=3]="iOSApp3D",e[e.Print3D=4]="Print3D",e[e.Editorial3D=5]="Editorial3D"}(lo||(lo={})),function(e){e[e.Thumb=0]="Thumb",e[e.Low=1]="Low",e[e.Medium=2]="Medium",e[e.High=3]="High",e[e.Highest=4]="Highest",e[e.LOD=5]="LOD",e[e.Stream=6]="Stream",e[e.AR=7]="AR"}(co||(co={})),function(e){e[e.Model=0]="Model",e[e.Geometry=1]="Geometry",e[e.Image=2]="Image",e[e.Texture=3]="Texture",e[e.Points=4]="Points",e[e.Volume=5]="Volume"}(ho||(ho={})),function(e){e[e.Color=0]="Color",e[e.Emissive=1]="Emissive",e[e.Occlusion=2]="Occlusion",e[e.Normal=3]="Normal",e[e.MetallicRoughness=4]="MetallicRoughness",e[e.Zone=5]="Zone"}(uo||(uo={})),function(e){e[e.Front=0]="Front",e[e.Back=1]="Back",e[e.Double=2]="Double"}(po||(po={}));const fo={mm:{mm:1,cm:.1,m:.001,km:1,in:.0393701,ft:.00328084,yd:.00109361,mi:1},cm:{mm:10,cm:1,m:.01,km:1,in:.393701,ft:.0328084,yd:.0109361,mi:1},m:{mm:1e3,cm:100,m:1,km:1,in:39.3701,ft:3.28084,yd:1.09361,mi:1},km:{mm:1e6,cm:1e5,m:1e3,km:1,in:39370.1,ft:3280.84,yd:1093.61,mi:1},in:{mm:25.4,cm:2.54,m:.0254,km:1,in:1,ft:.0833333,yd:.0277778,mi:1},ft:{mm:304.8,cm:30.48,m:.3048,km:1,in:12,ft:1,yd:.333334,mi:1},yd:{mm:914.4,cm:91.44,m:.9144,km:1,in:36,ft:3,yd:1,mi:1},mi:{mm:1609e3,cm:160900,m:1609,km:1,in:63346456.693,ft:5278871.391,yd:1759623.797,mi:1}};var mo=function(e,t){const n=Fi[e],i=Fi[t];return fo[n][i]||1};function go(e){Ut.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ht(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ht(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.vertexTangents=!1,this.setValues(e)}go.prototype=Object.create(Ut.prototype),go.prototype.constructor=go,go.prototype.isMeshStandardMaterial=!0,go.prototype.copy=function(e){return Ut.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this};const vo={alphamap_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n",alphamap_pars_fragment:"\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",alphatest_fragment:"\n#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n",aomap_fragment:"\n#ifdef USE_AOMAP\n\n\t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\n\t#endif\n\n#endif\n",aomap_pars_fragment:"\n#ifdef USE_AOMAP\n\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n\n#endif\n",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n\n#ifdef USE_TANGENT\n\n\tvec3 objectTangent = vec3( tangent.xyz );\n\n#endif\n",bsdfs:'\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via \'environmentBRDF\' from "Physically Based Shading on Mobile"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\n\tvec4 r = roughness * c0 + c1;\n\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n}\n\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\n\t// based upon Frostbite 3 Moving to Physically-based Rendering\n\t// page 32, equation 26: E[window1]\n\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\n\t// this is intended to be used on spot and point lights who are represented as luminous intensity\n\t// but who must be converted to luminous irradiance for surface lighting calculation\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\n\tif( cutoffDistance > 0.0 ) {\n\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\n\t}\n\n\treturn distanceFalloff;\n\n#else\n\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\n\t}\n\n\treturn 1.0;\n\n#endif\n\n}\n\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\n\treturn RECIPROCAL_PI * diffuseColor;\n\n} // validated\n\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\n\t// Original approximation by Christophe Schlick \'94\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\n\n\t// Optimized variant (presented by Epic at SIGGRAPH \'13)\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n\n} // validated\n\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\n\t// See F_Schlick\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\n\treturn Fr * fresnel + F0;\n\n}\n\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (34)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disneys reparameterization\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\t// geometry term (normalized) = G(l)G(v) / 4(nl)(nv)\n\t// also see #12151\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\n\treturn 1.0 / ( gl * gv );\n\n} // validated\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\n\tfloat a2 = pow2( alpha );\n\n\t// dotNL and dotNV are explicitly swapped. This is not a mistake.\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\n\treturn 0.5 / max( gv + gl, EPSILON );\n\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is "roughness squared" in Disneys reparameterization\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\n\tfloat a2 = pow2( alpha );\n\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\n\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n\n}\n\n// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat alpha = pow2( roughness ); // UE4\'s roughness\n\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\n\tfloat D = D_GGX( alpha, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// Rect Area Light\n\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\n// code: https://github.com/selfshadow/ltc_code/\n\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\tfloat dotNV = saturate( dot( N, V ) );\n\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\treturn uv;\n\n}\n\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\n\t// An approximation of the form factor of a horizon-clipped rectangle.\n\n\tfloat l = length( f );\n\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n\n}\n\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\n\tfloat x = dot( v1, v2 );\n\n\tfloat y = abs( x );\n\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\n\treturn cross( v1, v2 ) * theta_sintheta;\n\n}\n\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\n\t// bail if point is on back side of plane of light\n\t// assumes ccw winding order of light vertices\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\n\t// construct orthonormal basis around N\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\n\n\t// compute transform\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\n\t// transform rect\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\n\t// project rect onto sphere\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\n\t// calculate vector form factor\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\n\t// adjust for horizon clipping\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\n/*\n\t// alternate method of adjusting for horizon clipping (see referece)\n\t// refactoring required\n\tfloat len = length( vectorFormFactor );\n\tfloat z = vectorFormFactor.z / len;\n\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\n\t// tabulated horizon-clipped sphere, apparently...\n\tvec2 uv = vec2( z * 0.5 + 0.5, len );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\n\tfloat scale = texture2D( ltc_2, uv ).w;\n\n\tfloat result = len * scale;\n*/\n\n\treturn vec3( result );\n\n}\n\n// End Rect Area Light\n\n// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\n\treturn specularColor * brdf.x + brdf.y;\n\n} // validated\n\n// Fdez-Agera\'s "Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619; // 1/21\n\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n\n}\n\nfloat G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {\n\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\n\treturn 0.25;\n\n}\n\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n\n}\n\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\n\t//float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\t//float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\n\tfloat G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );\n\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\n\treturn F * ( G * D );\n\n} // validated\n\n// source: http://simonstechblog.blogspot.ca/2011/12/microfacet-brdf.html\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\n\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n\n#if defined( USE_SHEEN )\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L94\nfloat D_Charlie(float roughness, float NoH) {\n\t// Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125); // 2^(-14/2), so sin2h^2 > 0 in fp16\n\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\n\n// https://github.com/google/filament/blob/master/shaders/src/brdf.fs#L136\nfloat V_Neubelt(float NoV, float NoL) {\n\t// Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\n\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n\n}\n\n#endif\n',bumpmap_pars_fragment:"\n#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n\t// http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n",clipping_planes_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvec4 plane;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\n\t\tbool clipped = true;\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t\tif ( clipped ) discard;\n\n\t#endif\n\n#endif\n",clipping_planes_pars_fragment:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n\n#endif\n",clipping_planes_pars_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvarying vec3 vClipPosition;\n\n#endif\n",clipping_planes_vertex:"\n#if NUM_CLIPPING_PLANES > 0\n\n\tvClipPosition = - mvPosition.xyz;\n\n#endif\n",color_fragment:"\n#if defined( USE_COLOR_ALPHA )\n\n\tdiffuseColor *= vColor;\n\n#elif defined( USE_COLOR )\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif\n",color_pars_fragment:"\n#if defined( USE_COLOR_ALPHA )\n\n\tvarying vec4 vColor;\n\n#elif defined( USE_COLOR )\n\n\tvarying vec3 vColor;\n\n#endif\n",color_pars_vertex:"\n#if defined( USE_COLOR_ALPHA )\n\n\tvarying vec4 vColor;\n\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\n\tvarying vec3 vColor;\n\n#endif\n",color_vertex:"\n#if defined( USE_COLOR_ALPHA )\n\n\tvColor = vec4( 1.0 );\n\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\n\tvColor = vec3( 1.0 );\n\n#endif\n\n#ifdef USE_COLOR\n\n\tvColor *= color;\n\n#endif\n\n#ifdef USE_INSTANCING_COLOR\n\n\tvColor.xyz *= instanceColor.xyz;\n\n#endif\n",common:"\n#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n\n#ifndef saturate\n// <tonemapping_pars_fragment> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\n\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\n\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\n\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\n\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n}\n\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t// dir can be either a direction vector or a normal vector\n\t// upper-left 3x3 of matrix is assumed to be orthogonal\n\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n\n}\n\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\n\treturn - distance * planeNormal + point;\n\n}\n\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n\n}\n\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n\n}\n\nmat3 transposeMat3( const in mat3 m ) {\n\n\tmat3 tmp;\n\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\n\treturn tmp;\n\n}\n\n// https://en.wikipedia.org/wiki/Relative_luminance\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\n\treturn dot( weights, color.rgb );\n\n}\n\nbool isPerspectiveMatrix( mat4 m ) {\n\n\treturn m[ 2 ][ 3 ] == - 1.0;\n\n}\n\nvec2 equirectUv( in vec3 dir ) {\n\n\t// dir is assumed to be unit length\n\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\n\treturn vec2( u, v );\n\n}\n",cube_uv_reflection_fragment:"\n#ifdef ENVMAP_TYPE_CUBE_UV\n\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\n\t// These shader functions convert between the UV coordinates of a single face of\n\t// a cubemap, the 0-5 integer index of a cube face, and the direction vector for\n\t// sampling a textureCube (not generally normalized ).\n\n\tfloat getFace( vec3 direction ) {\n\n\t\tvec3 absDirection = abs( direction );\n\n\t\tfloat face = - 1.0;\n\n\t\tif ( absDirection.x > absDirection.z ) {\n\n\t\t\tif ( absDirection.x > absDirection.y )\n\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t} else {\n\n\t\t\tif ( absDirection.z > absDirection.y )\n\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\n\t\t\telse\n\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\n\t\t}\n\n\t\treturn face;\n\n\t}\n\n\t// RH coordinate system; PMREM face-indexing convention\n\tvec2 getUV( vec3 direction, float face ) {\n\n\t\tvec2 uv;\n\n\t\tif ( face == 0.0 ) {\n\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x ); // pos x\n\n\t\t} else if ( face == 1.0 ) {\n\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y ); // pos y\n\n\t\t} else if ( face == 2.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z ); // pos z\n\n\t\t} else if ( face == 3.0 ) {\n\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x ); // neg x\n\n\t\t} else if ( face == 4.0 ) {\n\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y ); // neg y\n\n\t\t} else {\n\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z ); // neg z\n\n\t\t}\n\n\t\treturn 0.5 * ( uv + 1.0 );\n\n\t}\n\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\n\t\tfloat face = getFace( direction );\n\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\n\t\tfloat faceSize = exp2( mipInt );\n\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\n\t\tvec2 f = fract( uv );\n\n\t\tuv += 0.5 - f;\n\n\t\tif ( face > 2.0 ) {\n\n\t\t\tuv.y += faceSize;\n\n\t\t\tface -= 3.0;\n\n\t\t}\n\n\t\tuv.x += face * faceSize;\n\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\n\t\t}\n\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\n\t\tuv *= texelSize;\n\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.x += texelSize;\n\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.y += texelSize;\n\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tuv.x -= texelSize;\n\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\n\t\tvec3 tm = mix( tl, tr, f.x );\n\n\t\tvec3 bm = mix( bl, br, f.x );\n\n\t\treturn mix( tm, bm, f.y );\n\n\t}\n\n\t// These defines must match with PMREMGenerator\n\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\n\tfloat roughnessToMip( float roughness ) {\n\n\t\tfloat mip = 0.0;\n\n\t\tif ( roughness >= r1 ) {\n\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\n\t\t} else if ( roughness >= r4 ) {\n\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\n\t\t} else if ( roughness >= r5 ) {\n\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\n\t\t} else if ( roughness >= r6 ) {\n\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\n\t\t} else {\n\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness ); // 1.16 = 1.79^0.25\n\t\t}\n\n\t\treturn mip;\n\n\t}\n\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\n\t\tfloat mipF = fract( mip );\n\n\t\tfloat mipInt = floor( mip );\n\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\n\t\tif ( mipF == 0.0 ) {\n\n\t\t\treturn vec4( color0, 1.0 );\n\n\t\t} else {\n\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\n\t\t}\n\n\t}\n\n#endif\n",defaultnormal_vertex:"\nvec3 transformedNormal = objectNormal;\n\n#ifdef USE_INSTANCING\n\n\t// this is in lieu of a per-instance normal-matrix\n\t// shear transforms in the instance matrix are not supported\n\n\tmat3 m = mat3( instanceMatrix );\n\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\n\ttransformedNormal = m * transformedNormal;\n\n#endif\n\ntransformedNormal = normalMatrix * transformedNormal;\n\n#ifdef FLIP_SIDED\n\n\ttransformedNormal = - transformedNormal;\n\n#endif\n\n#ifdef USE_TANGENT\n\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#ifdef FLIP_SIDED\n\n\t\ttransformedTangent = - transformedTangent;\n\n\t#endif\n\n#endif\n",displacementmap_pars_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n\n#endif\n",displacementmap_vertex:"\n#ifdef USE_DISPLACEMENTMAP\n\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n\n#endif\n",emissivemap_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n\n#endif\n",emissivemap_pars_fragment:"\n#ifdef USE_EMISSIVEMAP\n\n\tuniform sampler2D emissiveMap;\n\n#endif\n",encodings_fragment:"\ngl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\n// For a discussion of what this is, please read this: http://lousodrome.net/blog/light/2013/05/26/gamma-correct-and-hdr-rendering-in-a-32-bits-buffer/\n\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\n\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\n\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\n\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\n\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\n\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\n\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n\t// return vec4( value.brg, ( 3.0 + 128.0 ) / 256.0 );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\n\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\n\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\n\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\t// NOTE: The implementation with min causes the shader to not compile on\n\t// a common Alcatel A502DL in Chrome 78/Android 8.1. Some research suggests \n\t// that the chipset is Mediatek MT6739 w/ IMG PowerVR GE8100 GPU.\n\t// D = min( floor( D ) / 255.0, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\n\n// LogLuv reference: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\n\n// M matrix, for encoding\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\n\n// Inverse M matrix, for decoding\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}\n",envmap_fragment:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvec3 cameraToFrag;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\n\t\t}\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\n\t#else\n\n\t\tvec4 envColor = vec4( 0.0 );\n\n\t#endif\n\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\n\t\tenvColor = envMapTexelToLinear( envColor );\n\n\t#endif\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n",envmap_common_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif\n",envmap_pars_fragment:"\n#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n\n#endif\n",envmap_pars_vertex:"\n#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\n\t\t#define ENV_WORLDPOS\n\n\t#endif\n\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\n\t#endif\n\n#endif\n",envmap_physical_pars_fragment:"\n#if defined( USE_ENVMAP )\n\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\n\tvec3 getLightProbeIndirectIrradiance( /*const in SpecularLightProbe specularLightProbe,*/ const in GeometricContext geometry, const in int maxMIPLevel ) {\n\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\n\t\t\t// TODO: replace with properly filtered cubemaps and access the irradiance LOD level, be it the last LOD level\n\t\t\t// of a specular cubemap, or just the default level of a specially created irradiance cubemap.\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#else\n\n\t\t\t\t// force the bias high to get the last LOD level as it is the most blurred.\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\n\t\t#else\n\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\n\t\t#endif\n\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\n\t}\n\n\t// Trowbridge-Reitz distribution to Mip level, following the logic of http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\n\t\t// clamp to allowable LOD ranges.\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\n\t}\n\n\tvec3 getLightProbeIndirectRadiance( /*const in SpecularLightProbe specularLightProbe,*/ const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\n\t\t\t// Mixing the reflection with the normal is more accurate and keeps rough objects from gathering light from behind their tangent plane.\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\n\t\t#endif\n\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#else\n\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\n\t\t\t#endif\n\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\n\t\t#endif\n\n\t\treturn envMapColor.rgb * envMapIntensity;\n\n\t}\n\n#endif\n",envmap_vertex:"\n#ifdef USE_ENVMAP\n\n\t#ifdef ENV_WORLDPOS\n\n\t\tvWorldPosition = worldPosition.xyz;\n\n\t#else\n\n\t\tvec3 cameraToVertex;\n\n\t\tif ( isOrthographic ) {\n\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\n\t\t} else {\n\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t\t}\n\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\n\n\tfogDepth = - mvPosition.z;\n\n#endif\n",fog_pars_vertex:"\n#ifdef USE_FOG\n\n\tvarying float fogDepth;\n\n#endif\n",fog_fragment:"\n#ifdef USE_FOG\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\n\t#endif\n\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n\n#endif\n",fog_pars_fragment:"\n#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\n\t#endif\n\n#endif\n",gradientmap_pars_fragment:"\n\n#ifdef USE_GRADIENTMAP\n\n\tuniform sampler2D gradientMap;\n\n#endif\n\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\n\t// dotNL will be from -1.0 to 1.0\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\n\t#ifdef USE_GRADIENTMAP\n\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\n\t#else\n\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\n\t#endif\n\n}\n",lightmap_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity; // factor of PI should not be present; included here to prevent breakage\n\n#endif\n",lightmap_pars_fragment:"\n#ifdef USE_LIGHTMAP\n\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n\n#endif\n",lights_lambert_vertex:"\nvec3 diffuse = vec3( 1.0 );\n\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\n\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\n\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\n\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\n\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n\n#ifdef DOUBLE_SIDED\n\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n\n#endif\n\n#if NUM_POINT_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if NUM_SPOT_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n/*\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\t// TODO (abelnation): implement\n\n\t}\n\n#endif\n*/\n\n#if NUM_DIR_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if NUM_HEMI_LIGHTS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\n\t\t#endif\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n",lights_pars_begin:"\nuniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\n\n// get the irradiance (radiance convolved with cosine lobe) at the point 'normal' on the unit sphere\n// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\n\t// normal is assumed to have unit length\n\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\n\t// band 0\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\n\t// band 1\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\n\t// band 2\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\n\treturn result;\n\n}\n\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\n\treturn irradiance;\n\n}\n\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\n\tvec3 irradiance = ambientLightColor;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI;\n\n\t#endif\n\n\treturn irradiance;\n\n}\n\n#if NUM_DIR_LIGHTS > 0\n\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\n\t}\n\n#endif\n\n\n#if NUM_POINT_LIGHTS > 0\n\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\n\t}\n\n#endif\n\n\n#if NUM_SPOT_LIGHTS > 0\n\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\n\t\tif ( angleCos > spotLight.coneCos ) {\n\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\n\t\t} else {\n\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\n\t\t}\n\t}\n\n#endif\n\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\n\t// BRDF approximation Texture is 64x64\n\tuniform sampler2D ltc_1; // RGBA Float\n\tuniform sampler2D ltc_2; // RGBA Float\n\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n\n#endif\n\n\n#if NUM_HEMI_LIGHTS > 0\n\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tirradiance *= PI;\n\n\t\t#endif\n\n\t\treturn irradiance;\n\n\t}\n\n#endif\n",lights_toon_fragment:"\nToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\n",lights_toon_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct ToonMaterial {\n\n\tvec3 diffuseColor;\n\n};\n\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_phong_fragment:"\nBlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n\nstruct BlinnPhongMaterial {\n\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n\n};\n\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n\n}\n\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"\nPhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\n\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\n\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.\nmaterial.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n\n#ifdef REFLECTIVITY\n\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\n#else\n\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n\n#endif\n\n#ifdef CLEARCOAT\n\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\n\t#ifdef USE_CLEARCOATMAP\n\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\n\t#endif\n\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\n\t#endif\n\n\tmaterial.clearcoat = saturate( material.clearcoat ); // Burley clearcoat model\n\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n\n#endif\n\n#ifdef USE_SHEEN\n\n\tmaterial.sheenColor = sheen;\n\n#endif\n",lights_physical_pars_fragment:"\nstruct PhysicalMaterial {\n\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n\n};\n\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\n\n// Clear coat directional hemishperical reflectance (this approximation should be improved)\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n\n}\n\n#if NUM_RECT_AREA_LIGHTS > 0\n\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight; // counterclockwise; light shines in local neg z direction\n\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\n\t\t// LTC Fresnel Approximation by Stephen Hill\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\n\t}\n\n#endif\n\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\n\tvec3 irradiance = dotNL * directLight.color;\n\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\tirradiance *= PI; // punctual light\n\n\t#endif\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tccIrradiance *= PI; // punctual light\n\n\t\t#endif\n\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\n\t#ifdef CLEARCOAT\n\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\n\t#else\n\n\t\tfloat clearcoatDHR = 0.0;\n\n\t#endif\n\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\n\t// Both indirect specular and indirect diffuse light accumulate here\n\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n\n}\n\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n\n}\n",lights_fragment_begin:"\n/**\n * This is a template that can be used to light a material, it uses pluggable\n * RenderEquations (RE)for specific lighting scenarios.\n *\n * Instructions for use:\n * - Ensure that both RE_Direct, RE_IndirectDiffuse and RE_IndirectSpecular are defined\n * - If you have defined an RE_IndirectSpecular, you need to also provide a Material_LightProbeLOD. <---- ???\n * - Create a material parameter that is to be passed as the third parameter to your lighting functions.\n *\n * TODO:\n * - Add area light support.\n * - Add sphere light support.\n * - Add diffuse light probe (irradiance cubemap) support.\n */\n\nGeometricContext geometry;\n\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n\n#ifdef CLEARCOAT\n\n\tgeometry.clearcoatNormal = clearcoatNormal;\n\n#endif\n\nIncidentLight directLight;\n\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\n\t\tpointLight = pointLights[ i ];\n\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\n\t\tspotLight = spotLights[ i ];\n\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\n\t\tdirectionalLight = directionalLights[ i ];\n\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\n\tRectAreaLight rectAreaLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\n\t}\n\t#pragma unroll_loop_end\n\n#endif\n\n#if defined( RE_IndirectDiffuse )\n\n\tvec3 iblIrradiance = vec3( 0.0 );\n\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\n\t\t}\n\t\t#pragma unroll_loop_end\n\n\t#endif\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n\n#endif\n",lights_fragment_maps:"\n#if defined( RE_IndirectDiffuse )\n\n\t#ifdef USE_LIGHTMAP\n\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\n\t\t\tlightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\n\n\t\t#endif\n\n\t\tirradiance += lightMapIrradiance;\n\n\t#endif\n\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( /*lightProbe,*/ geometry, maxMipLevel );\n\n\t#endif\n\n#endif\n\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\n\tradiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\n\t#ifdef CLEARCOAT\n\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( /*specularLightProbe,*/ geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\n\t#endif\n\n#endif\n",lights_fragment_end:"\n#if defined( RE_IndirectDiffuse )\n\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n\n#endif\n\n#if defined( RE_IndirectSpecular )\n\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n\n#endif\n",logdepthbuf_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\t// Doing a strict comparison with == 1.0 can cause noise artifacts\n\t// on some platforms. See issue #17623.\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n\n#endif\n",logdepthbuf_pars_fragment:"\n#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n\n#endif\n",logdepthbuf_pars_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\n\t#else\n\n\t\tuniform float logDepthBufFC;\n\n\t#endif\n\n#endif\n",logdepthbuf_vertex:"\n#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\n\t#else\n\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\n\t\t\tgl_Position.z *= gl_Position.w;\n\n\t\t}\n\n\t#endif\n\n#endif\n",map_fragment:"\n#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n\n#endif\n",map_pars_fragment:"\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n",map_particle_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\n#endif\n\n#ifdef USE_MAP\n\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n\n#endif\n",map_particle_pars_fragment:"\n#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\n\tuniform mat3 uvTransform;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif\n\n#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n",metalnessmap_fragment:"\nfloat metalnessFactor = metalness;\n\n#ifdef USE_METALNESSMAP\n\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\tmetalnessFactor *= texelMetalness.b;\n\n#endif\n",metalnessmap_pars_fragment:"\n#ifdef USE_METALNESSMAP\n\n\tuniform sampler2D metalnessMap;\n\n#endif\n",morphnormal_vertex:"\n#ifdef USE_MORPHNORMALS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in normal = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\n#endif\n",morphtarget_pars_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\tuniform float morphTargetBaseInfluence;\n\n\t#ifndef USE_MORPHNORMALS\n\n\t\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\t\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif\n",morphtarget_vertex:"\n#ifdef USE_MORPHTARGETS\n\n\t// morphTargetBaseInfluence is set based on BufferGeometry.morphTargetsRelative value:\n\t// When morphTargetsRelative is false, this is set to 1 - sum(influences); this results in position = sum((target - base) * influence)\n\t// When morphTargetsRelative is true, this is set to 1; as a result, all morph targets are simply added to the base after weighting\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n#endif\n",normal_fragment_begin:"\nfloat faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n\n#ifdef FLAT_SHADED\n\n\t// Workaround for Adreno GPUs not able to do dFdx( vViewPosition )\n\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#else\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * faceDirection;\n\n\t#endif\n\n\t#ifdef USE_TANGENT\n\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\n\t\t#endif\n\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\n\t\t#endif\n\n\t#endif\n\n#endif\n\n// non perturbed normal for clearcoat among others\n\nvec3 geometryNormal = normal;\n\n",normal_fragment_maps:"\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals\n\n\t#ifdef FLIP_SIDED\n\n\t\tnormal = - normal;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * faceDirection;\n\n\t#endif\n\n\tnormal = normalize( normalMatrix * normal );\n\n#elif defined( TANGENTSPACE_NORMALMAP )\n\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tnormal = normalize( vTBN * mapN );\n\n\t#else\n\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN, faceDirection );\n\n\t#endif\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd(), faceDirection );\n\n#endif\n",normalmap_pars_fragment:"\n#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n#endif\n\n#ifdef OBJECTSPACE_NORMALMAP\n\n\tuniform mat3 normalMatrix;\n\n#endif\n\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\n\t// Normal Mapping Without Precomputed Tangents\n\t// http://www.thetenthplanet.de/archives/1180\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\n\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 N = surf_norm; // normalized\n\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\n\t}\n\n#endif\n",clearcoat_normal_fragment_begin:"\n#ifdef CLEARCOAT\n\n\tvec3 clearcoatNormal = geometryNormal;\n\n#endif\n",clearcoat_normal_fragment_maps:"\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\n\t#ifdef USE_TANGENT\n\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\n\t#else\n\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\n\t#endif\n\n#endif\n",clearcoat_pars_fragment:"\n\n#ifdef USE_CLEARCOATMAP\n\n\tuniform sampler2D clearcoatMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\n\tuniform sampler2D clearcoatRoughnessMap;\n\n#endif\n\n#ifdef USE_CLEARCOAT_NORMALMAP\n\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n\n#endif\n",packing:"\nvec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\n\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\n\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\n\treturn r * PackUpscale;\n}\n\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\n\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\n\n// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions\n\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\n\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"\n#ifdef PREMULTIPLIED_ALPHA\n\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\n\tgl_FragColor.rgb *= gl_FragColor.a;\n\n#endif\n",project_vertex:"\nvec4 mvPosition = vec4( transformed, 1.0 );\n\n#ifdef USE_INSTANCING\n\n\tmvPosition = instanceMatrix * mvPosition;\n\n#endif\n\nmvPosition = modelViewMatrix * mvPosition;\n\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"\n#ifdef DITHERING\n\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n\n#endif\n",dithering_pars_fragment:"\n#ifdef DITHERING\n\n\t// based on https://www.shadertoy.com/view/MslGR8\n\tvec3 dithering( vec3 color ) {\n\t\t//Calculate grid position\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\n\t\t//Shift the individual colors differently, thus making it even harder to see the dithering pattern\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\n\t\t//modify shift acording to grid position.\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\n\t\t//shift the color by dither_shift\n\t\treturn color + dither_shift_RGB;\n\t}\n\n#endif\n",roughnessmap_fragment:"\nfloat roughnessFactor = roughness;\n\n#ifdef USE_ROUGHNESSMAP\n\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n\troughnessFactor *= texelRoughness.g;\n\n#endif\n",roughnessmap_pars_fragment:"\n#ifdef USE_ROUGHNESSMAP\n\n\tuniform sampler2D roughnessMap;\n\n#endif\n",shadowmap_pars_fragment:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): create uniforms for area light shadows\n\n\t#endif\n\t*/\n\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\n\t}\n\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\n\t}\n\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\n\t\tfloat occlusion = 1.0;\n\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\n\t\tfloat hard_shadow = step( compare , distribution.x ); // Hard Shadow\n\n\t\tif (hard_shadow != 1.0 ) {\n\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance ); // Chebeyshevs inequality\n\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 ); // 0.3 reduces light bleed\n\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\n\t\t}\n\t\treturn occlusion;\n\n\t}\n\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\n\t\tfloat shadow = 1.0;\n\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\n\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#else // no percentage-closer filtering:\n\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\n\t\t#endif\n\n\t\t}\n\n\t\treturn shadow;\n\n\t}\n\n\t// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\n\t// vector suitable for 2D texture mapping. This code uses the following layout for the\n\t// 2D texture:\n\t//\n\t// xzXZ\n\t//  y Y\n\t//\n\t// Y - Positive y direction\n\t// y - Negative y direction\n\t// X - Positive x direction\n\t// x - Negative x direction\n\t// Z - Positive z direction\n\t// z - Negative z direction\n\t//\n\t// Source and test bed:\n\t// https://gist.github.com/tschw/da10c43c467ce8afd0c4\n\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\n\t\t// Number of texels to avoid at the edge of each square\n\n\t\tvec3 absV = abs( v );\n\n\t\t// Intersect unit cube\n\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\n\t\t// Apply scale to avoid seams\n\n\t\t// two texels less per square (one texel will do for NEAREST)\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\n\t\t// Unwrap\n\n\t\t// space: -1 ... 1 range for each square\n\t\t//\n\t\t// #X##\t\tdim    := ( 4 , 2 )\n\t\t//  # #\t\tcenter := ( 1 , 1 )\n\n\t\tvec2 planar = v.xy;\n\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\n\t\tif ( absV.z >= almostOne ) {\n\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\n\t\t} else if ( absV.x >= almostOne ) {\n\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\n\t\t} else if ( absV.y >= almostOne ) {\n\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\n\t\t}\n\n\t\t// Transform to UV space\n\n\t\t// scale := 0.5 / dim\n\t\t// translate := ( center + 0.5 ) / dim\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\n\t}\n\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\n\t\t// for point lights, the uniform @vShadowCoord is re-purposed to hold\n\t\t// the vector from the light to the world-space position of the fragment.\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\n\t\t// dp = normalized distance from light to fragment position\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\n\t\tdp += shadowBias;\n\n\t\t// bd3D = base direction 3D\n\t\tvec3 bd3D = normalize( lightToPosition );\n\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\n\t\t#else // no percentage-closer filtering\n\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\n\t\t#endif\n\n\t}\n\n#endif\n",shadowmap_pars_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): uniforms for area light shadows\n\n\t#endif\n\t*/\n\n#endif\n",shadowmap_vertex:"\n#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\n\t\t// Offsetting the position used for querying occlusion along the world normal can be used to reduce shadow acne.\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\n\t#endif\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update vAreaShadowCoord with area light info\n\n\t#endif\n\t*/\n\n#endif\n",shadowmask_pars_fragment:"\nfloat getShadowMask() {\n\n\tfloat shadow = 1.0;\n\n\t#ifdef USE_SHADOWMAP\n\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\n\tDirectionalLightShadow directionalLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\n\tSpotLightShadow spotLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\n\tPointLightShadow pointLight;\n\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\n\t}\n\t#pragma unroll_loop_end\n\n\t#endif\n\n\t/*\n\t#if NUM_RECT_AREA_LIGHTS > 0\n\n\t\t// TODO (abelnation): update shadow for Area light\n\n\t#endif\n\t*/\n\n\t#endif\n\n\treturn shadow;\n\n}\n",skinbase_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif\n",skinning_pars_vertex:"\n#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n",skinning_vertex:"\n#ifdef USE_SKINNING\n\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n\n#endif\n",skinnormal_vertex:"\n#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\n\t#ifdef USE_TANGENT\n\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\n\t#endif\n\n#endif\n",specularmap_fragment:"\nfloat specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif\n",specularmap_pars_fragment:"\n#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif\n",tonemapping_fragment:"\n#if defined( TONE_MAPPING )\n\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n\n#endif\n",tonemapping_pars_fragment:"\n#ifndef saturate\n// <common> may have defined saturate() already\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n\nuniform float toneMappingExposure;\n\n// exposure only\nvec3 LinearToneMapping( vec3 color ) {\n\n\treturn toneMappingExposure * color;\n\n}\n\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\nvec3 ReinhardToneMapping( vec3 color ) {\n\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n\n}\n\n// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\n\t// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n\n}\n\n// source: https://github.com/selfshadow/ltc_code/blob/master/webgl/shaders/ltc/ltc_blit.fs\nvec3 RRTAndODTFit( vec3 v ) {\n\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n\n}\n\n// this implementation of ACES is modified to accommodate a brighter viewing environment.\n// the scale factor of 1/0.6 is subjective. see discussion in #19621.\n\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\n\t// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ), // transposed from source\n\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\n\t// ODT_SAT => XYZ => D60_2_D65 => sRGB\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ), // transposed from source\n\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\n\tcolor *= toneMappingExposure / 0.6;\n\n\tcolor = ACESInputMat * color;\n\n\t// Apply RRT and ODT\n\tcolor = RRTAndODTFit( color );\n\n\tcolor = ACESOutputMat * color;\n\n\t// Clamp to [0, 1]\n\treturn saturate( color );\n\n}\n\nvec3 CustomToneMapping( vec3 color ) { return color; }\n",transmissionmap_fragment:"\n#ifdef USE_TRANSMISSIONMAP\n\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n\n#endif\n",transmissionmap_pars_fragment:"\n#ifdef USE_TRANSMISSIONMAP\n\n\tuniform sampler2D transmissionMap;\n\n#endif\n",uv_pars_fragment:"\n#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\n\tvarying vec2 vUv;\n\n#endif\n",uv_pars_vertex:"\n#ifdef USE_UV\n\n\t#ifdef UVS_VERTEX_ONLY\n\n\t\tvec2 vUv;\n\n\t#else\n\n\t\tvarying vec2 vUv;\n\n\t#endif\n\n\tuniform mat3 uvTransform;\n\n#endif\n",uv_vertex:"\n#ifdef USE_UV\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n#endif\n",uv2_pars_fragment:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvarying vec2 vUv2;\n\n#endif\n",uv2_pars_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\n\tuniform mat3 uv2Transform;\n\n#endif\n",uv2_vertex:"\n#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n\n#endif\n",worldpos_vertex:"\n#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\n\t#ifdef USE_INSTANCING\n\n\t\tworldPosition = instanceMatrix * worldPosition;\n\n\t#endif\n\n\tworldPosition = modelMatrix * worldPosition;\n\n#endif\n",background_frag:"\nuniform sampler2D t2D;\n\nvarying vec2 vUv;\n\nvoid main() {\n\n\tvec4 texColor = texture2D( t2D, vUv );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",background_vert:"\nvarying vec2 vUv;\nuniform mat3 uvTransform;\n\nvoid main() {\n\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n\n}\n",cube_frag:"\n#include <envmap_common_pars_fragment>\nuniform float opacity;\n\nvarying vec3 vWorldDirection;\n\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",cube_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n\tgl_Position.z = gl_Position.w; // set z to camera.far\n\n}\n",depth_frag:"\n#if DEPTH_PACKING == 3200\n\n\tuniform float opacity;\n\n#endif\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tdiffuseColor.a = opacity;\n\n\t#endif\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\t#include <logdepthbuf_fragment>\n\n\t// Higher precision equivalent of gl_FragCoord.z. This assumes depthRange has been left to its default values.\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n\t#if DEPTH_PACKING == 3200\n\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\n\t#elif DEPTH_PACKING == 3201\n\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\n\t#endif\n\n}\n",depth_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\n// This is used for computing an equivalent of gl_FragCoord.z that is as high precision as possible.\n// Some platforms compute gl_FragCoord at a lower precision which makes the manually computed value better for\n// depth-based postprocessing effects. Reproduced on iPad with A10 processor / iPadOS 13.3.1.\nvarying vec2 vHighPrecisionZW;\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvHighPrecisionZW = gl_Position.zw;\n\n}\n",distanceRGBA_frag:"\n#define DISTANCE\n\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main () {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( 1.0 );\n\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\n\n\tgl_FragColor = packDepthToRGBA( dist );\n\n}\n",distanceRGBA_vert:"\n#define DISTANCE\n\nvarying vec3 vWorldPosition;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_DISPLACEMENTMAP\n\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvWorldPosition = worldPosition.xyz;\n\n}\n",equirect_frag:"\nuniform sampler2D tEquirect;\n\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvec3 direction = normalize( vWorldDirection );\n\n\tvec2 sampleUV = equirectUv( direction );\n\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\n\tgl_FragColor = mapTexelToLinear( texColor );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\n}\n",equirect_vert:"\nvarying vec3 vWorldDirection;\n\n#include <common>\n\nvoid main() {\n\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\n}\n",linedashed_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\nuniform float dashSize;\nuniform float totalSize;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\n\t\tdiscard;\n\n\t}\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\n\toutgoingLight = diffuseColor.rgb; // simple shader\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",linedashed_vert:"\nuniform float scale;\nattribute float lineDistance;\n\nvarying float vLineDistance;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\tvLineDistance = scale * lineDistance;\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n",meshbasic_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshbasic_vert:"\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\n\t#ifdef USE_ENVMAP\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshlambert_frag:"\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\n\t#else\n\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\n\t#endif\n\n\t#include <lightmap_fragment>\n\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\n\t#else\n\n\t\treflectedLight.directDiffuse = vLightFront;\n\n\t#endif\n\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\n\t// modulation\n\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"\n#define LAMBERT\n\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshmatcap_frag:"\n#define MATCAP\n\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks\n\n\t#ifdef USE_MATCAP\n\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\n\t#else\n\n\t\tvec4 matcapColor = vec4( 1.0 );\n\n\t#endif\n\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshmatcap_vert:"\n#define MATCAP\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\t\tvNormal = normalize( transformedNormal );\n\n\t#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n}\n",meshtoon_frag:"\n#define TOON\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshtoon_vert:"\n#define TOON\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphong_frag:"\n#define PHONG\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\n\t// accumulation\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphong_vert:"\n#define PHONG\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",meshphysical_frag:"\n#define STANDARD\n\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\n\t// accumulation\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\n\t// this is a stub for the transmission model\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n\n}\n",meshphysical_vert:"\n#define STANDARD\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n\tvViewPosition = - mvPosition.xyz;\n\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",normal_frag:"\n#define NORMAL\n\nuniform float opacity;\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\n}\n",normal_vert:"\n#define NORMAL\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvarying vec3 vViewPosition;\n\n#endif\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n\t#ifdef USE_TANGENT\n\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\n\t#endif\n\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\n\n\tvNormal = normalize( transformedNormal );\n\n\t#ifdef USE_TANGENT\n\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\n\t#endif\n\n#endif\n\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\n\tvViewPosition = - mvPosition.xyz;\n\n#endif\n\n}\n",points_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\n}\n",points_vert:"\nuniform float size;\nuniform float scale;\n\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\n\tgl_PointSize = size;\n\n\t#ifdef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\n\t#endif\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n\n}\n",shadow_frag:"\nuniform vec3 color;\nuniform float opacity;\n\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n\nvoid main() {\n\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",shadow_vert:"\n#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n\nvoid main() {\n\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n\n}\n",sprite_frag:"\nuniform vec3 diffuse;\nuniform float opacity;\n\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\nvoid main() {\n\n\t#include <clipping_planes_fragment>\n\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\n\toutgoingLight = diffuseColor.rgb;\n\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\n}\n",sprite_vert:"\nuniform float rotation;\nuniform vec2 center;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\n\t#include <uv_vertex>\n\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n\t#ifndef USE_SIZEATTENUATION\n\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\n\t#endif\n\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\n\tmvPosition.xy += rotatedPosition;\n\n\tgl_Position = projectionMatrix * mvPosition;\n\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\n}\n"},yo={common:{diffuse:{value:new Ht(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new fe},uv2Transform:{value:new fe},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new gt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ht(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ht(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new fe}},sprite:{diffuse:{value:new Ht(15658734)},opacity:{value:1},center:{value:new gt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new fe}}},bo={basic:{uniforms:zr([yo.common,yo.specularmap,yo.envmap,yo.aomap,yo.lightmap,yo.fog]),vertexShader:vo.meshbasic_vert,fragmentShader:vo.meshbasic_frag},lambert:{uniforms:zr([yo.common,yo.specularmap,yo.envmap,yo.aomap,yo.lightmap,yo.emissivemap,yo.fog,yo.lights,{emissive:{value:new Ht(0)}}]),vertexShader:vo.meshlambert_vert,fragmentShader:vo.meshlambert_frag},phong:{uniforms:zr([yo.common,yo.specularmap,yo.envmap,yo.aomap,yo.lightmap,yo.emissivemap,yo.bumpmap,yo.normalmap,yo.displacementmap,yo.fog,yo.lights,{emissive:{value:new Ht(0)},specular:{value:new Ht(1118481)},shininess:{value:30}}]),vertexShader:vo.meshphong_vert,fragmentShader:vo.meshphong_frag},standard:{uniforms:zr([yo.common,yo.envmap,yo.aomap,yo.lightmap,yo.emissivemap,yo.bumpmap,yo.normalmap,yo.displacementmap,yo.roughnessmap,yo.metalnessmap,yo.fog,yo.lights,{emissive:{value:new Ht(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:vo.meshphysical_vert,fragmentShader:vo.meshphysical_frag},toon:{uniforms:zr([yo.common,yo.aomap,yo.lightmap,yo.emissivemap,yo.bumpmap,yo.normalmap,yo.displacementmap,yo.gradientmap,yo.fog,yo.lights,{emissive:{value:new Ht(0)}}]),vertexShader:vo.meshtoon_vert,fragmentShader:vo.meshtoon_frag},matcap:{uniforms:zr([yo.common,yo.bumpmap,yo.normalmap,yo.displacementmap,yo.fog,{matcap:{value:null}}]),vertexShader:vo.meshmatcap_vert,fragmentShader:vo.meshmatcap_frag},points:{uniforms:zr([yo.points,yo.fog]),vertexShader:vo.points_vert,fragmentShader:vo.points_frag},dashed:{uniforms:zr([yo.common,yo.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:vo.linedashed_vert,fragmentShader:vo.linedashed_frag},depth:{uniforms:zr([yo.common,yo.displacementmap]),vertexShader:vo.depth_vert,fragmentShader:vo.depth_frag},normal:{uniforms:zr([yo.common,yo.bumpmap,yo.normalmap,yo.displacementmap,{opacity:{value:1}}]),vertexShader:vo.normal_vert,fragmentShader:vo.normal_frag},sprite:{uniforms:zr([yo.sprite,yo.fog]),vertexShader:vo.sprite_vert,fragmentShader:vo.sprite_frag},background:{uniforms:{uvTransform:{value:new fe},t2D:{value:null}},vertexShader:vo.background_vert,fragmentShader:vo.background_frag},cube:{uniforms:zr([yo.envmap,{opacity:{value:1}}]),vertexShader:vo.cube_vert,fragmentShader:vo.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:vo.equirect_vert,fragmentShader:vo.equirect_frag},distanceRGBA:{uniforms:zr([yo.common,yo.displacementmap,{referencePosition:{value:new K},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:vo.distanceRGBA_vert,fragmentShader:vo.distanceRGBA_frag},shadow:{uniforms:zr([yo.lights,yo.fog,{color:{value:new Ht(0)},opacity:{value:1}}]),vertexShader:vo.shadow_vert,fragmentShader:vo.shadow_frag}};var xo,_o,wo,So,Mo;bo.physical={uniforms:zr([bo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new gt(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new Ht(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:vo.meshphysical_vert,fragmentShader:vo.meshphysical_frag},function(e){e[e.Default=0]="Default",e[e.Clay=1]="Clay",e[e.XRay=2]="XRay",e[e.Normals=3]="Normals",e[e.Wireframe=4]="Wireframe"}(xo||(xo={})),function(e){e[e.Solid=0]="Solid",e[e.LinearGradient=1]="LinearGradient",e[e.RadialGradient=2]="RadialGradient"}(_o||(_o={})),function(e){e[e.Orbit=0]="Orbit",e[e.Walk=1]="Walk"}(wo||(wo={})),function(e){e[e.Overlay=0]="Overlay",e[e.Left=1]="Left",e[e.Right=2]="Right"}(So||(So={})),function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(Mo||(Mo={}));const Eo=n(27).default,To=n(28).default;class Co extends go{constructor(e){super(),this._clayColor=new Ht("#a67a6c"),this._wireColor=new Ht("#004966"),this._wireEmissiveColor=new Ht("#004966"),this._objectSpaceNormalMap=!1,this._paramCopy={},this._sideCopy=0,this.type="UberPBRMaterial",this.isUberPBRMaterial=!0,this.isMeshStandardMaterial=!0,this.isMeshPhysicalMaterial=!1,this.defines={STANDARD:!0,PHYSICAL:!1,OBJECTSPACE_NORMALMAP:!1,MODE_NORMALS:!1,MODE_XRAY:!1,CUT_PLANE:!1},this.uniforms=Ur.merge([bo.standard.uniforms,{aoMapMix:{value:new K(.25,.25,.25)},cutPlaneDirection:{value:new qt(0,0,-1,0)},cutPlaneColor:{value:new K(1,0,0)}}]),this._aoMapMix=this.uniforms.aoMapMix.value,this._cutPlaneDirection=this.uniforms.cutPlaneDirection.value,this._cutPlaneColor=this.uniforms.cutPlaneColor.value,this.vertexShader=To,this.fragmentShader=Eo,this.color=new Ht(16777215),this.roughness=.7,this.metalness=0,e&&this.setValues(e)}set cutPlaneDirection(e){this._cutPlaneDirection.copy(e)}get cutPlaneDirection(){return this._cutPlaneDirection}set cutPlaneColor(e){this._cutPlaneColor.copy(e)}get cutPlaneColor(){return this._cutPlaneColor}set aoMapMix(e){this._aoMapMix.copy(e)}get aoMapMix(){return this._aoMapMix}setShaderMode(e){switch(Object.assign(this,this._paramCopy),this.defines.MODE_NORMALS=!1,this.defines.MODE_XRAY=!1,this.defines.OBJECTSPACE_NORMALMAP=!(!this.normalMap||!this._objectSpaceNormalMap),this.side=this.defines.CUT_PLANE?2:this.side,this.needsUpdate=!0,e){case xo.Clay:this._paramCopy={color:this.color,map:this.map,roughness:this.roughness,metalness:this.metalness,aoMapIntensity:this.aoMapIntensity,blending:this.blending,transparent:this.transparent,depthWrite:this.depthWrite},this.color=this._clayColor,this.map=null,this.roughness=1,this.metalness=0,this.aoMapIntensity*=1,this.blending=0,this.transparent=!1,this.depthWrite=!0;break;case xo.Normals:this._paramCopy={blending:this.blending,transparent:this.transparent,depthWrite:this.depthWrite},this.defines.MODE_NORMALS=!0,this.blending=0,this.transparent=!1,this.depthWrite=!0;break;case xo.XRay:this._paramCopy={side:this.side,blending:this.blending,transparent:this.transparent,depthWrite:this.depthWrite},this.defines.MODE_XRAY=!0,this.side=2,this.blending=2,this.transparent=!0,this.depthWrite=!1;break;case xo.Wireframe:this._paramCopy={color:this.color,emissive:this.emissive,roughness:this.roughness,metalness:this.metalness,wireframe:this.wireframe,map:this.map,aoMap:this.aoMap,emissiveMap:this.emissiveMap,normalMap:this.normalMap},this.color=this._wireColor,this.emissive=this._wireEmissiveColor,this.roughness=.8,this.metalness=.1,this.wireframe=!0,this.map=null,this.aoMap=null,this.emissiveMap=null,this.normalMap=null,this.defines.OBJECTSPACE_NORMALMAP=!1}}enableCutPlane(e){this.defines.CUT_PLANE=e,e?(this._sideCopy=this.side,this.side=2):this.side=this._sideCopy}enableObjectSpaceNormalMap(e){e!==this._objectSpaceNormalMap&&(this._objectSpaceNormalMap=e),this.normalMap&&(this.defines.OBJECTSPACE_NORMALMAP=e,this.needsUpdate=!0)}copyStandardMaterial(e){return this.color=e.color,this.opacity=e.opacity,this.transparent=e.opacity<1||!!e.alphaMap||e.transparent,this.alphaTest=e.alphaTest,this.roughness=e.roughness,this.roughnessMap=e.roughnessMap,this.metalness=e.metalness,this.metalnessMap=e.metalnessMap,this.map=e.map,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.normalMap=e.normalMap,this.shadowSide=e.shadowSide,this}}class Ao extends o{constructor(e){super(),this.addEvents("update","dispose"),e?this.fromJSON(e):this._data=this.init()}static generateId(){return k()}get id(){return this._data.id}get data(){return this._data}set(e,t){this._data[e]=t,this.update()}get(e){return this._data[e]}update(){this.emit({type:"update",document:this})}dispose(){this.emit({type:"dispose",document:this}),this._data=null}fromJSON(e){return this._data={},this.inflate(e,this._data),this.update(),this}toJSON(e){return e=e||{},this.deflate(this._data,e),e}init(){return{}}inflate(e,t){Object.assign(t,e)}deflate(e,t){t=t||{},Object.assign(t,this._data)}}class Po extends Ao{setModel(e){this.data.uri=e,this.data.type=ho.Model,this.data.mimeType=this.guessAssetMimeType()}setGeometry(e){this.data.uri=e,this.data.type=ho.Geometry,this.data.mimeType=this.guessAssetMimeType()}setTexture(e,t){this.data.uri=e,this.data.type=ho.Image,this.data.mimeType=this.guessAssetMimeType(),this.data.mapType=t}isValid(){return!!this.data.uri&&void 0!==this.data.type}toString(){const e=this.data;return`Asset - type: '${ho[e.type]}', uri: '${e.uri}', mime type: '${e.mimeType||"(not set)"}'`}init(){return{uri:"",mimeType:"",type:void 0,mapType:void 0,byteSize:0,numFaces:0,numVertices:0,imageSize:0}}deflate(e,t){t.uri=e.uri,t.type=ho[e.type],e.mimeType&&(t.mimeType=e.mimeType),void 0!==e.mapType&&(t.mapType=uo[e.mapType]),e.byteSize>0&&(t.byteSize=e.byteSize),e.type!==ho.Model&&e.type!==ho.Geometry||e.numFaces>0&&(t.numFaces=e.numFaces),e.type!==ho.Model&&e.type!==ho.Image&&e.type!==ho.Texture||e.imageSize>0&&(t.imageSize=e.imageSize)}inflate(e,t){t.uri=e.uri,t.mimeType=e.mimeType||"",t.type=ho[e.type],t.mapType=uo[e.mapType],t.byteSize=e.byteSize||0,t.numFaces=e.numFaces||0,t.imageSize=e.imageSize||0,void 0===t.type&&(t.type=this.guessAssetType(),void 0===t.type&&console.warn("failed to determine asset type from asset: "+t.uri))}guessAssetType(){const e=this.data;if(void 0!==e.type&&ho[e.type])return e.type;if(e.mimeType){if(e.mimeType===Po.mimeType.gltfJson||e.mimeType===Po.mimeType.gltfBinary)return ho.Model;if(e.mimeType===Po.mimeType.imageJpeg||e.mimeType===Po.mimeType.imagePng)return ho.Image}const t=e.uri.split(".").pop().toLowerCase();return"gltf"===t||"glb"===t?ho.Model:"obj"===t||"ply"===t?ho.Geometry:"jpg"===t||"png"===t?ho.Image:void 0}guessAssetMimeType(){const e=this.data;if(e.mimeType)return e.mimeType;const t=e.uri.split(".").pop().toLowerCase();return"gltf"===t?Po.mimeType.gltfJson:"glb"===t?Po.mimeType.gltfBinary:"jpg"===t?Po.mimeType.imageJpeg:"png"===t?Po.mimeType.imagePng:""}}Po.mimeType={gltfJson:"model/gltf+json",gltfBinary:"model/gltf-binary",imageJpeg:"image/jpeg",imagePng:"image/png"};class Lo extends Ao{constructor(){super(...arguments),this.model=null}static fromJSON(e){return new Lo(e)}dispose(){this.unload(),super.dispose()}load(e){if(this.data.usage!==lo.Web3D)throw new Error("can't load, not a Web3D derivative");const t=this.findAsset(ho.Model);if(t)return e.getModel(t.data.uri).then(e=>(this.model&&oo(this.model),this.model=e,e));const n=this.findAsset(ho.Geometry),i=this.findAssets(ho.Image);return n?e.getGeometry(n.data.uri).then(t=>(this.model=new On(t,new Co),Promise.all(i.map(t=>e.getTexture(t.data.uri))).catch(e=>(console.warn("failed to load texture files"),[])))).then(e=>{const t=this.model.material;return this.assignTextures(i,e,t),t.map||(t.color.setScalar(.5),t.roughness=.8,t.metalness=0),this.model}):void 0}unload(){this.model&&(oo(this.model),this.model=null)}createAsset(e,t){const n=new Po;return n.data.type=e,n.data.uri=t,this.addAsset(n),n}addAsset(e){if(!e.data.uri)throw new Error("uri must be specified");this.data.assets.push(e),this.update()}removeAsset(e){const t=this.data.assets.indexOf(e);t>=0&&this.data.assets.splice(t,1)}findAsset(e){return this.data.assets.find(t=>t.data.type===e)}findAssets(e){return this.data.assets.filter(t=>t.data.type===e)}toString(e=!1){const t=this.data;return e?`Derivative - usage: '${lo[t.usage]}', quality: '${co[t.quality]}'\n   `+t.assets.map(e=>e.toString()).join("\n   "):`Derivative - usage: '${lo[t.usage]}', quality: '${co[t.quality]}', #assets: ${t.assets.length})`}init(){return{usage:lo.Web3D,quality:co.Medium,assets:[]}}deflate(e,t){t.usage=lo[e.usage],t.quality=co[e.quality],t.assets=e.assets.map(e=>e.toJSON())}inflate(e,t){if(t.usage=lo[e.usage],void 0===t.usage)throw new Error("unknown derivative usage: "+e.usage);if(t.quality=co[e.quality],void 0===t.quality)throw new Error("unknown derivative quality: "+e.quality);t.assets=e.assets.map(e=>new Po(e))}assignTextures(e,t,n){for(let i=0;i<e.length;++i){const s=e[i],r=t[i];switch(s.data.mapType){case uo.Color:n.map=r;break;case uo.Occlusion:n.aoMap=r;break;case uo.Emissive:n.emissiveMap=r;break;case uo.MetallicRoughness:n.metalnessMap=r,n.roughnessMap=r;break;case uo.Normal:n.normalMap=r}}}}const Ro=[],No=[co.Thumb,co.AR,co.Low,co.Medium,co.High,co.Highest];class Do{constructor(){this.derivatives={}}select(e,t){const n=lo[e],i=co[t],s=No.indexOf(t);if(s<0)return console.warn(`derivative quality not supported: '${i}'`),null;const r=this.get(e,t);if(r)return r;for(let t=s+1;t<No.length;++t){const n=this.get(e,No[t]);if(n)return console.warn(`derivative quality '${i}' not available, using higher quality`),n}for(let t=s-1;t>=0;--t){const n=this.get(e,No[t]);if(n)return console.warn(`derivative quality '${i}' not available, using lower quality`),n}return console.warn(`no suitable derivative found for quality '${i}' and usage '${n}'`),null}getByUsage(e){const t=lo[e];return(this.derivatives[t]||Ro).sort((e,t)=>e.data.quality<t.data.quality?-1:e.data.quality>t.data.quality?1:0)}getByQuality(e){return this.getArray().filter(t=>t.data.quality===e)}getArray(){return Object.keys(this.derivatives).reduce((e,t)=>e.concat(this.derivatives[t]),[])}get(e,t){const n=lo[e],i=this.derivatives[n];if(i)for(let e=0,n=i.length;e<n;++e)if(i[e].data.quality===t)return i[e];return null}getOrCreate(e,t){const n=this.getOrCreateBin(e);for(let e=0,i=n.length;e<i;++e)if(n[e].data.quality===t)return n[e];const i=new Lo;return i.set("usage",e),i.set("quality",t),n.push(i),i}createModelAsset(e,t){t="string"==typeof t?co[t]:t,t=isFinite(t)?t:co.Medium;const n=this.getOrCreate(lo.Web3D,t),i=new Po;return i.setModel(e),n.addAsset(i),n}createMeshAsset(e,t,n,i,s){s="string"==typeof s?co[s]:s,s=isFinite(s)?s:co.Medium;const r=this.getOrCreate(lo.Web3D,s),o=new Po;if(o.setGeometry(e),r.addAsset(o),t){const e=new Po;e.setTexture(t,uo.Color),r.addAsset(e)}if(n){const e=new Po;e.setTexture(n,uo.Occlusion),r.addAsset(e)}if(i){const e=new Po;e.setTexture(i,uo.Normal),r.addAsset(e)}return r}clear(){for(let e in this.derivatives)this.derivatives[e].forEach(e=>e.dispose());this.derivatives={}}toJSON(){const e=[];for(let t in this.derivatives)this.derivatives[t].forEach(t=>e.push(t.toJSON()));return e}fromJSON(e){this.clear(),e.forEach(e=>{this.getOrCreateBin(lo[e.usage]).push(new Lo(e))})}toString(e=!1){const t=this.derivatives,n=Object.keys(t);return e?`Derivatives (${n.length}) \n `+n.map(e=>t[e].map(e=>e.toString(!0)).join("\n ")).join("\n "):`Derivatives (${n.length}) `+n.map(e=>`${e} (${t[e].length})`).join(", ")}getOrCreateBin(e){const t=lo[e];return this.derivatives[t]||(this.derivatives[t]=[])}}var Oo=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};const ko=new K,Io=new K,zo=new K,Uo=new K,Fo=new gt,Vo=new gt;var Bo;!function(e){e[e.TopRight=0]="TopRight",e[e.TopLeft=1]="TopLeft",e[e.BottomLeft=2]="BottomLeft",e[e.BottomRight=3]="BottomRight"}(Bo||(Bo={}));class jo extends Ae{constructor(){super(),this.isHTMLSprite=!0,this.viewAngle=0,this.orientationAngle=0,this.orientationQuadrant=Bo.TopLeft,this._elements=new Map,this._visible=!0,this.frustumCulled=!1}get visible(){return this._visible}set visible(e){e!==this._visible&&this._elements&&(this._visible=e,this._elements.forEach(t=>{t&&t.setVisible(e)}))}dispose(){this._elements.forEach((e,t)=>{e&&t.removeChild(e)}),this._elements.clear()}disposeHTMLElement(e){const t=this._elements.get(e);t&&(this._elements.delete(e),e.removeChild(t))}update(){this._elements.forEach(e=>{e&&this.updateHTMLElement(e)})}renderHTMLElement(e,t,n,i,s){i=i||this,ko.set(0,0,0),ko.applyMatrix4(i.modelViewMatrix),s?Io.copy(s):Io.set(0,1,0),Io.applyMatrix4(i.modelViewMatrix),zo.copy(Io).sub(ko).normalize(),Uo.set(0,0,1),this.viewAngle=zo.angleTo(Uo),ko.applyMatrix4(n.projectionMatrix),Io.applyMatrix4(n.projectionMatrix),Vo.set(Io.x,Io.y),Fo.set(ko.x,ko.y),Vo.sub(Fo);const r=.5*(Io.x+1)*t.clientWidth,o=.5*(1-Io.y)*t.clientHeight;e.setPosition(r,o);const a=this.orientationAngle=Vo.angle();this.orientationQuadrant=Math.floor(2*a/Math.PI)}getHTMLElement(e){let t=this._elements.get(e);return t||(t=this.createHTMLElement(),t&&(t.setVisible(this._visible),e.appendChild(t),this._elements.set(e,t))),t}createHTMLElement(){return null}updateHTMLElement(e){e.requestUpdate()}}let $o=class extends vr{setVisible(e){this.style.display=e?"block":"none"}setOpacity(e){this.style.opacity=e.toString(),this.style.visibility=e>0?"visible":"hidden"}setPosition(e,t){this.style.left=e.toString()+"px",this.style.top=t.toString()+"px"}};$o=Oo([yr("ff-sprite-element")],$o);class Go extends Ae{constructor(){super(...arguments),this.isHTMLSpriteGroup=!0,this._visible=!0}get visible(){return this._visible}set visible(e){if(e!==this._visible){this._visible=e;const t=this.children;for(let n=0,i=t.length;n<i;++n)t[n].visible=e}}dispose(){const e=this.children;for(let t=0,n=e.length;t<n;++t)e[t].dispose()}disposeHTMLElements(e){const t=this.children;for(let n=0,i=t.length;n<i;++n)t[n].disposeHTMLElement(e)}render(e,t){if(!this.visible)return;const n=this.children;for(let i=0,s=n.length;i<s;++i){const s=n[i],r=s.getHTMLElement(e);r&&s.renderHTMLElement(r,e,t)}}update(){const e=this.children;for(let t=0,n=e.length;t<n;++t)e[t].update()}}class Ho extends o{constructor(e){super(),this.addEvent("update"),this._list=e||[],this._dict={},e&&e.forEach(e=>{e.id&&(this._dict[e.id]=e)})}get length(){return this._list.length}get ids(){return Object.keys(this._dict)}get items(){return this._list}set items(e){this._list=e,this._dict={},e.forEach(e=>{e.id&&(this._dict[e.id]=e)}),this.emit({type:"update",item:null,what:"update"})}append(e){this._list.push(e),e.id&&(this._dict[e.id]=e),this.emit({type:"update",item:e,what:"add"})}insertBefore(e,t){const n=this._list.indexOf(t);n>=0&&this.insertAt(e,n)}insertAt(e,t){this._list.splice(t,0,e),e.id&&(this._dict[e.id]=e),this.emit({type:"update",item:e,what:"add"})}replaceItem(e,t){const n=this._list.indexOf(t);n>=0&&this.replaceAt(e,n)}replaceAt(e,t){const n=this._list[t];n.id&&delete this._dict[n.id],this._list[t]=e,e.id&&(this._dict[e.id]=e),this.emit({type:"update",item:e,what:"replace"})}moveItem(e,t){const n=this._list.indexOf(e);this.moveAt(n,t)}moveAt(e,t){const n=this._list;if(e+t<0||e+t>=n.length)return;const i=n[e];if(t>0){for(let i=0;i<t;++i)n[e+i]=n[e+i+1];n[e+t]=i}else{if(!(t<0))return;for(let i=0;i>t;--i)n[e+i]=n[e+i-1];n[e+t]=i}this.emit({type:"update",item:i,what:"move"})}removeById(e){const t=this._dict[e];return t&&this.removeItem(t),t}removeItem(e){const t=this._list.indexOf(e);return this.removeAt(t),t}removeAt(e){const t=this._list;if(e<0||e>=t.length)return;const n=t[e];return t.splice(e,1),n.id&&delete this._dict[n.id],this.emit({type:"update",item:n,what:"remove"}),n}getAt(e){return this._list[e]}getById(e){return this._dict[e]}getIndexOf(e){return this._list.indexOf(e)}copy(e){this.items=e.slice()}clone(){return this._list.slice()}}Ho.prototype[Symbol.iterator]=function(){return{index:0,list:this._list,next:function(){return this.index<this.list.length?{value:this.list[this.index++],done:!1}:{done:!0}}}};class Wo extends o{constructor(e){super(),this.addEvent("update"),this._dict={},e&&e.forEach(e=>{e.id&&(this._dict[e.id]=e)})}get length(){return this.ids.length}get items(){return this.ids.map(e=>this._dict[e])}set items(e){e.forEach(e=>{e.id&&(this._dict[e.id]=e)}),this.emit({type:"update",item:null,what:"update"})}get ids(){return Object.keys(this._dict)}get dictionary(){return this._dict}set dictionary(e){this._dict=e,this.emit({type:"update",item:null,what:"update"})}insert(e,t){if(!(t=t||e.id))throw new Error("can't insert, missing id");this._dict[t]=e,this.emit({type:"update",item:e,what:"insert"})}remove(e){const t="string"==typeof e?e:e.id,n=this._dict[t];void 0!==n&&(delete this._dict[t],this.emit({type:"update",item:n,what:"remove"}))}get(e){return this._dict[e]}getOrCreate(e,t){let n=this._dict[e];return n||(n=this._dict[e]=t,this.emit({type:"update",item:n,what:"insert"})),n}copy(e){this.dictionary=Object.assign({},e)}clone(){return Object.assign({},this._dict)}}class qo extends Ao{constructor(){super(...arguments),this._language=Vi.EN}static fromJSON(e){return new qo(e)}toString(){return this.title}get title(){return 0===Object.keys(this.data.titles).length&&(this.data.titles.EN=this.data.title),this.data.titles[Vi[this.language]]||"undefined"}set title(e){this.data.titles[Vi[this.language]]=e,this.update()}get defaultTitle(){return 0===Object.keys(this.data.titles).length&&(this.data.titles.EN=this.data.title),this.data.titles.EN||"undefined"}get uri(){return 0===Object.keys(this.data.uris).length&&(this.data.uris.EN=this.data.uri),this.data.uris[Vi[this.language]]}set uri(e){this.data.uris[Vi[this.language]]=e,this.update()}get lead(){return 0===Object.keys(this.data.leads).length&&(this.data.leads.EN=this.data.lead),this.data.leads[Vi[this.language]]||""}set lead(e){this.data.leads[Vi[this.language]]=e,this.update()}get tags(){return 0===Object.keys(this.data.taglist).length&&this.data.tags.length>0&&(this.data.taglist.EN=this.data.tags),this.data.taglist[Vi[this.language]]||[]}set tags(e){this.data.taglist[Vi[this.language]]=e,this.update()}get language(){return this._language}set language(e){this._language=e}init(){return{id:Ao.generateId(),title:"New Article",titles:{},lead:"",leads:{},tags:[],taglist:{},uri:"",uris:{},mimeType:"",thumbnailUri:""}}deflate(e,t){t.id=e.id,Object.keys(this.data.uris).length>0?(t.uris={},Object.keys(this.data.uris).forEach(n=>{t.uris[n]=e.uris[n]})):e.uri&&(t.uri=e.uri),Object.keys(this.data.titles).length>0?(t.titles={},Object.keys(this.data.titles).forEach(n=>{t.titles[n]=e.titles[n]})):e.title&&(t.title=e.title),Object.keys(this.data.leads).length>0?(t.leads={},Object.keys(this.data.leads).forEach(n=>{t.leads[n]=e.leads[n]})):e.lead&&(t.lead=e.lead),Object.keys(this.data.taglist).length>0?(t.taglist={},Object.keys(this.data.taglist).forEach(n=>{t.taglist[n]=e.taglist[n].slice()})):e.tags.length>0&&(t.tags=e.tags.slice()),e.mimeType&&(t.mimeType=e.mimeType),e.thumbnailUri&&(t.thumbnailUri=e.thumbnailUri)}inflate(e,t){t.id=e.id,t.uri=e.uri||"",t.uris=e.uris||{},t.title=e.title||"",t.titles=e.titles||{},t.lead=e.lead||"",t.leads=e.leads||{},t.tags=e.tags||[],t.taglist=e.taglist||{},t.mimeType=e.mimeType||"",t.thumbnailUri=e.thumbnailUri||""}}var Xo=function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function a(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))},Yo={json:function(e,t,n){return Xo(this,void 0,void 0,(function*(){n&&"string"!=typeof n&&(n=JSON.stringify(n));return fetch(e,{headers:{Accept:"application/json","Content-Type":"application/json"},method:t,credentials:"same-origin",body:n}).then(n=>{if(!n.ok){const i=`fetch.json (${t} at '${e}'), error: ${n.status} - ${n.statusText}`;throw console.warn(i),new Error(i)}return n.json()}).catch(n=>{throw console.warn(`fetch.json (${t} at '${e}'), error: ${n.message}`),n})}))},text:function(e,t,n){return Xo(this,void 0,void 0,(function*(){return fetch(e,{headers:{Accept:"text/plain","Content-Type":"text/plain"},method:t,credentials:"same-origin",body:n}).then(e=>{if(!e.ok)throw new Error("status: "+e.status);return e.text()}).catch(n=>{throw console.warn(`fetch.text (${t} at '${e}'), error: ${n.message}`),n})}))},file:function(e,t,n,i=!0){return Xo(this,void 0,void 0,(function*(){const s={method:t,credentials:"include",body:n};return i||(s.headers={"Content-Type":"application/octet-stream"}),fetch(e,s).then(e=>{if(!e.ok)throw new Error("status: "+e.status);return e}).catch(n=>{throw console.warn(`fetch.file (${t} at '${e}'), error: ${n.message}`),n})}))},buffer:function(e,t,n){return Xo(this,void 0,void 0,(function*(){return fetch(e,{headers:{Accept:"application/octet-stream","Content-Type":"application/octet-stream"},method:t,credentials:"include",body:n}).then(e=>{if(!e.ok)throw new Error("status: "+e.status);return e.arrayBuffer()}).catch(n=>{throw console.warn(`fetch.buffer (${t} at '${e}'), error: ${n.message}`),n})}))}},Zo=function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function a(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))};class Jo{constructor(e){this._loadingManager=e}get(e){return Zo(this,void 0,void 0,(function*(){return this._loadingManager.itemStart(e),fetch(e,{headers:{Accept:"application/json"}}).then(t=>{if(!t.ok)throw this._loadingManager.itemError(e),new Error(`failed to fetch from '${e}', status: ${t.status} ${t.statusText}`);return this._loadingManager.itemEnd(e),t.json()})}))}}function Ko(e,t,n){const i=this;let s=!1,r=0,o=0,a=void 0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===s&&void 0!==i.onStart&&i.onStart(e,r,o),s=!0},this.itemEnd=function(e){r++,void 0!==i.onProgress&&i.onProgress(e,r,o),r===o&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)},this.resolveURL=function(e){return a?a(e):e},this.setURLModifier=function(e){return a=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=l.length;t<n;t+=2){const n=l[t],i=l[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return i}return null}}const Qo=new Ko;function ea(e){this.manager=void 0!==e?e:Qo,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(ea.prototype,{load:function(){},loadAsync:function(e,t){const n=this;return new Promise((function(i,s){n.load(e,i,t,s)}))},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});const ta={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},na={};function ia(e){ea.call(this,e)}ia.prototype=Object.assign(Object.create(ea.prototype),{constructor:ia,load:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,r=ta.get(e);if(void 0!==r)return s.manager.itemStart(e),setTimeout((function(){t&&t(r),s.manager.itemEnd(e)}),0),r;if(void 0!==na[e])return void na[e].push({onLoad:t,onProgress:n,onError:i});const o=e.match(/^data:(.*?)(;base64)?,(.*)$/);let a;if(o){const n=o[1],r=!!o[2];let a=o[3];a=decodeURIComponent(a),r&&(a=atob(a));try{let i;const r=(this.responseType||"").toLowerCase();switch(r){case"arraybuffer":case"blob":const e=new Uint8Array(a.length);for(let t=0;t<a.length;t++)e[t]=a.charCodeAt(t);i="blob"===r?new Blob([e.buffer],{type:n}):e.buffer;break;case"document":const t=new DOMParser;i=t.parseFromString(a,n);break;case"json":i=JSON.parse(a);break;default:i=a}setTimeout((function(){t&&t(i),s.manager.itemEnd(e)}),0)}catch(t){setTimeout((function(){i&&i(t),s.manager.itemError(e),s.manager.itemEnd(e)}),0)}}else{na[e]=[],na[e].push({onLoad:t,onProgress:n,onError:i}),a=new XMLHttpRequest,a.open("GET",e,!0),a.addEventListener("load",(function(t){const n=this.response,i=na[e];if(delete na[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),ta.add(e,n);for(let e=0,t=i.length;e<t;e++){const t=i[e];t.onLoad&&t.onLoad(n)}s.manager.itemEnd(e)}else{for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}s.manager.itemError(e),s.manager.itemEnd(e)}}),!1),a.addEventListener("progress",(function(t){const n=na[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onProgress&&i.onProgress(t)}}),!1),a.addEventListener("error",(function(t){const n=na[e];delete na[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}s.manager.itemError(e),s.manager.itemEnd(e)}),!1),a.addEventListener("abort",(function(t){const n=na[e];delete na[e];for(let e=0,i=n.length;e<i;e++){const i=n[e];i.onError&&i.onError(t)}s.manager.itemError(e),s.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(a.responseType=this.responseType),void 0!==this.withCredentials&&(a.withCredentials=this.withCredentials),a.overrideMimeType&&a.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const e in this.requestHeader)a.setRequestHeader(e,this.requestHeader[e]);a.send(null)}return s.manager.itemStart(e),a},setResponseType:function(e){return this.responseType=e,this},setMimeType:function(e){return this.mimeType=e,this}});var sa=function(e){ea.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};sa.prototype=Object.assign(Object.create(ea.prototype),{constructor:sa,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,t,n,i){var s=new ia(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,e=>{var n={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,n).then(t).catch(i)},n,i)},decodeDracoFile:function(e,t,n,i){var s={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,s).then(t)},decodeGeometry:function(e,t){for(var n in t.attributeTypes){var i=t.attributeTypes[n];void 0!==i.BYTES_PER_ELEMENT&&(t.attributeTypes[n]=i.name)}var s,r=JSON.stringify(t);if(sa.taskCache.has(e)){var o=sa.taskCache.get(e);if(o.key===r)return o.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var a=this.workerNextTaskID++,l=e.byteLength,c=this._getWorker(a,l).then(n=>(s=n,new Promise((n,i)=>{s._callbacks[a]={resolve:n,reject:i},s.postMessage({type:"decode",id:a,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return c.catch(()=>!0).then(()=>{s&&a&&this._releaseTask(s,a)}),sa.taskCache.set(e,{key:r,promise:c}),c},_createGeometry:function(e){var t=new gn;e.index&&t.setIndex(new Zt(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n],s=i.name,r=i.array,o=i.itemSize;t.setAttribute(s,new Zt(r,o))}return t},_loadLibrary:function(e,t){var n=new ia(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((t,i)=>{n.load(e,t,void 0,i)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{var n=t[0];e||(this.decoderConfig.wasmBinary=t[1]);var i=sa.DRACOWorker.toString(),s=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([s]))}),this.decoderPending},_getWorker:function(e,t){return this._initDecoder().then(()=>{var n;this.workerPool.length<this.workerLimit?((n=new Worker(this.workerSourceURL))._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(e){var t=e.data;switch(t.type){case"decode":n._callbacks[t.id].resolve(t);break;case"error":n._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},this.workerPool.push(n)):this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));return(n=this.workerPool[this.workerPool.length-1])._taskCosts[e]=t,n._taskLoad+=t,n})},_releaseTask:function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},debug:function(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}),sa.DRACOWorker=function(){var e,t;function n(e,t,n,i,s,r){var o=r.num_components(),a=n.num_points()*o,l=a*s.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,s),h=e._malloc(l);t.GetAttributeDataArrayForAllPoints(n,r,c,l,h);var u=new s(e.HEAPF32.buffer,h,a).slice();return e._free(h),{name:i,array:u,itemSize:o}}onmessage=function(i){var s=i.data;switch(s.type){case"init":e=s.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var r=s.buffer,o=s.taskConfig;t.then(e=>{var t=e.draco,i=new t.Decoder,a=new t.DecoderBuffer;a.Init(new Int8Array(r),r.byteLength);try{var l=function(e,t,i,s){var r,o,a=s.attributeIDs,l=s.attributeTypes,c=t.GetEncodedGeometryType(i);if(c===e.TRIANGULAR_MESH)r=new e.Mesh,o=t.DecodeBufferToMesh(i,r);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");r=new e.PointCloud,o=t.DecodeBufferToPointCloud(i,r)}if(!o.ok()||0===r.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+o.error_msg());var h={index:null,attributes:[]};for(var u in a){var d,p,f=self[l[u]];if(s.useUniqueIDs)p=a[u],d=t.GetAttributeByUniqueId(r,p);else{if(-1===(p=t.GetAttributeId(r,e[a[u]])))continue;d=t.GetAttribute(r,p)}h.attributes.push(n(e,t,r,u,f,d))}c===e.TRIANGULAR_MESH&&(h.index=function(e,t,n){var i=3*n.num_faces(),s=4*i,r=e._malloc(s);t.GetTrianglesUInt32Array(n,s,r);var o=new Uint32Array(e.HEAPF32.buffer,r,i).slice();return e._free(r),{array:o,itemSize:1}}(e,t,r));return e.destroy(r),h}(t,i,a,o),c=l.attributes.map(e=>e.array.buffer);l.index&&c.push(l.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:l},c)}catch(e){console.error(e),self.postMessage({type:"error",id:s.id,error:e.message})}finally{t.destroy(a),t.destroy(i)}})}}},sa.taskCache=new WeakMap,sa.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")},sa.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")},sa.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")},sa.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")};const ra=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,i=e.length;n<i;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}},oa=function(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)};class aa extends Ae{constructor(e,t=1){super(),this.type="Light",this.color=new Ht(e),this.intensity=t}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}aa.prototype.isLight=!0;const la=new _t,ca=new K;class ha{constructor(e=new Et,t=new Et,n=new Et,i=new Et,s=new Et,r=new Et){this.planes=[e,t,n,i,s,r]}set(e,t,n,i,s,r){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(s),o[5].copy(r),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,i=n[0],s=n[1],r=n[2],o=n[3],a=n[4],l=n[5],c=n[6],h=n[7],u=n[8],d=n[9],p=n[10],f=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(o-i,h-a,f-u,y-m).normalize(),t[1].setComponents(o+i,h+a,f+u,y+m).normalize(),t[2].setComponents(o+s,h+l,f+d,y+g).normalize(),t[3].setComponents(o-s,h-l,f-d,y-g).normalize(),t[4].setComponents(o-r,h-c,f-p,y-v).normalize(),t[5].setComponents(o+r,h+c,f+p,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),la.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(la)}intersectsSprite(e){return la.center.set(0,0,0),la.radius=.7071067811865476,la.applyMatrix4(e.matrixWorld),this.intersectsSphere(la)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(n)<i)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(ca.x=i.normal.x>0?e.max.x:e.min.x,ca.y=i.normal.y>0?e.max.y:e.min.y,ca.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(ca)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}const ua=new te,da=new K,pa=new K;class fa{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new gt(512,512),this.map=null,this.mapPass=null,this.matrix=new te,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ha,this._frameExtents=new gt(1,1),this._viewportCount=1,this._viewports=[new qt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;da.setFromMatrixPosition(e.matrixWorld),t.position.copy(da),pa.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(pa),t.updateMatrixWorld(),ua.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ua),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}function ma(){Ae.call(this),this.type="Camera",this.matrixWorldInverse=new te,this.projectionMatrix=new te,this.projectionMatrixInverse=new te}ma.prototype=Object.assign(Object.create(Ae.prototype),{constructor:ma,isCamera:!0,copy:function(e,t){return Ae.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new K),this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){Ae.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(e,t){Ae.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}});class va extends ma{constructor(e=-1,t=1,n=1,i=-1,s=.1,r=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=s,this.far=r,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,s,r){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=n-e,r=n+e,o=i+t,a=i-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=e*this.view.offsetX,r=s+e*this.view.width,o-=t*this.view.offsetY,a=o-t*this.view.height}this.projectionMatrix.makeOrthographic(s,r,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=Ae.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}va.prototype.isOrthographicCamera=!0;class ya extends fa{constructor(){super(new va(-5,5,5,-5,.5,500))}}ya.prototype.isDirectionalLightShadow=!0;class ba extends aa{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Ae.DefaultUp),this.updateMatrix(),this.target=new Ae,this.shadow=new ya}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}function xa(e=50,t=1,n=.1,i=2e3){ma.call(this),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}ba.prototype.isDirectionalLight=!0,xa.prototype=Object.assign(Object.create(ma.prototype),{constructor:xa,isPerspectiveCamera:!0,copy:function(e,t){return ma.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Z.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){const e=Math.tan(.5*Z.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Z.RAD2DEG*Math.atan(Math.tan(.5*Z.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,i,s,r){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const e=this.near;let t=e*Math.tan(.5*Z.DEG2RAD*this.fov)/this.zoom,n=2*t,i=this.aspect*n,s=-.5*i;const r=this.view;if(null!==this.view&&this.view.enabled){const e=r.fullWidth,o=r.fullHeight;s+=r.offsetX*i/e,t-=r.offsetY*n/o,i*=r.width/e,n*=r.height/o}const o=this.filmOffset;0!==o&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){const t=Ae.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});const _a=new te,wa=new K,Sa=new K;class Ma extends fa{constructor(){super(new xa(90,1,.5,500)),this._frameExtents=new gt(4,2),this._viewportCount=6,this._viewports=[new qt(2,1,1,1),new qt(0,1,1,1),new qt(3,1,1,1),new qt(1,1,1,1),new qt(3,0,1,1),new qt(1,0,1,1)],this._cubeDirections=[new K(1,0,0),new K(-1,0,0),new K(0,0,1),new K(0,0,-1),new K(0,1,0),new K(0,-1,0)],this._cubeUps=[new K(0,1,0),new K(0,1,0),new K(0,1,0),new K(0,1,0),new K(0,0,1),new K(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),wa.setFromMatrixPosition(e.matrixWorld),n.position.copy(wa),Sa.copy(n.position),Sa.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Sa),n.updateMatrixWorld(),i.makeTranslation(-wa.x,-wa.y,-wa.z),_a.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_a)}}Ma.prototype.isPointLightShadow=!0;class Ea extends aa{constructor(e,t,n=0,i=1){super(e,t),this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new Ma}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}Ea.prototype.isPointLight=!0;class Ta extends fa{constructor(){super(new xa(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,n=2*Z.RAD2DEG*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;n===t.fov&&i===t.aspect&&s===t.far||(t.fov=n,t.aspect=i,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}Ta.prototype.isSpotLightShadow=!0;class Ca extends aa{constructor(e,t,n=0,i=Math.PI/3,s=0,r=1){super(e,t),this.type="SpotLight",this.position.copy(Ae.DefaultUp),this.updateMatrix(),this.target=new Ae,this.distance=n,this.angle=i,this.penumbra=s,this.decay=r,this.shadow=new Ta}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}function Aa(e){go.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new gt(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=Z.clamp(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}function Pa(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function La(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),ea.call(this,e),this.options={premultiplyAlpha:"none"}}Ca.prototype.isSpotLight=!0,Aa.prototype=Object.create(go.prototype),Aa.prototype.constructor=Aa,Aa.prototype.isMeshPhysicalMaterial=!0,Aa.prototype.copy=function(e){return go.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new Ht).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this},Object.assign(Pa.prototype,{evaluate:function(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],s=t[n-1];e:{t:{let r;n:{i:if(!(e<i)){for(let r=n+2;;){if(void 0===i){if(e<s)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,s)}if(n===r)break;if(s=i,i=t[++n],e<i)break t}r=t.length;break n}if(e>=s)break e;{const o=t[1];e<o&&(n=2,s=o);for(let r=n-2;;){if(void 0===s)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===r)break;if(i=s,s=t[--n-1],e>=s)break t}r=n,n=0}}for(;n<r;){const i=n+r>>>1;e<t[i]?r=i:n=i+1}if(i=t[n],s=t[n-1],void 0===s)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,s,e)}this._cachedIndex=n,this.intervalChanged_(n,s,i)}return this.interpolate_(n,s,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i;for(let e=0;e!==i;++e)t[e]=n[s+e];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Pa.prototype,{beforeStart_:Pa.prototype.copySampleValue_,afterEnd_:Pa.prototype.copySampleValue_}),La.prototype=Object.assign(Object.create(ea.prototype),{constructor:La,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,r=ta.get(e);if(void 0!==r)return s.manager.itemStart(e),setTimeout((function(){t&&t(r),s.manager.itemEnd(e)}),0),r;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(s.options,{colorSpaceConversion:"none"}))})).then((function(n){ta.add(e,n),t&&t(n),s.manager.itemEnd(e)})).catch((function(t){i&&i(t),s.manager.itemError(e),s.manager.itemEnd(e)})),s.manager.itemStart(e)}});class Ra extends ea{constructor(e){super(e)}load(e,t,n,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,r=ta.get(e);if(void 0!==r)return s.manager.itemStart(e),setTimeout((function(){t&&t(r),s.manager.itemEnd(e)}),0),r;const o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function a(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),ta.add(e,this),t&&t(this),s.manager.itemEnd(e)}function l(t){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1),i&&i(t),s.manager.itemError(e),s.manager.itemEnd(e)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(e),o.src=e,o}}function Na(e){ea.call(this,e)}function Da(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Z.generateUUID()}Na.prototype=Object.assign(Object.create(ea.prototype),{constructor:Na,load:function(e,t,n,i){const s=new Dr,r=new Ra(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(e,(function(n){s.image=n;const i=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);s.format=i?1022:1023,s.needsUpdate=!0,void 0!==t&&t(s)}),n,i),s}}),Object.defineProperty(Da.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Da.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,s=this.stride;i<s;i++)this.array[e+i]=t.array[n+i];return this},set:function(e,t=0){return this.array.set(e,t),this},clone:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Z.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new Da(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Z.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const Oa=new K;function ka(e,t,n,i){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===i}Object.defineProperties(ka.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(e){this.data.needsUpdate=e}}}),Object.assign(ka.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(let t=0,n=this.data.count;t<n;t++)Oa.x=this.getX(t),Oa.y=this.getY(t),Oa.z=this.getZ(t),Oa.applyMatrix4(e),this.setXYZ(t,Oa.x,Oa.y,Oa.z);return this},applyNormalMatrix:function(e){for(let t=0,n=this.count;t<n;t++)Oa.x=this.getX(t),Oa.y=this.getY(t),Oa.z=this.getZ(t),Oa.applyNormalMatrix(e),this.setXYZ(t,Oa.x,Oa.y,Oa.z);return this},transformDirection:function(e){for(let t=0,n=this.count;t<n;t++)Oa.x=this.getX(t),Oa.y=this.getY(t),Oa.z=this.getZ(t),Oa.transformDirection(e),this.setXYZ(t,Oa.x,Oa.y,Oa.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this},setXYZW:function(e,t,n,i,s){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=s,this},clone:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new Zt(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new ka(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}});class Ia extends Dr{constructor(e,t,n,i,s,r,o,a,l){super(e,t,n,i,s,r,o,a,l),this.needsUpdate=!0}}Ia.prototype.isCanvasTexture=!0;class za extends Ut{constructor(e){super(),this.type="PointsMaterial",this.color=new Ht(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this}}za.prototype.isPointsMaterial=!0;const Ua=new RegExp("[\\[\\]\\.:\\/]","g"),Fa="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Va=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),Ba=/(WCOD+)?/.source.replace("WCOD",Fa),ja=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),$a=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Ga=new RegExp("^"+Va+Ba+ja+$a+"$"),Ha=["material","materials","bones"];function Wa(e,t,n){const i=n||qa.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function qa(e,t,n){this.path=t,this.parsedPath=n||qa.parseTrackName(t),this.node=qa.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}Object.assign(Wa.prototype,{getValue:function(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)},setValue:function(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=n.length;i!==s;++i)n[i].setValue(e,t)},bind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(qa,{Composite:Wa,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new qa.Composite(e,t,n):new qa(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(Ua,"")},parseTrackName:function(e){const t=Ga.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const e=n.nodeName.substring(i+1);-1!==Ha.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let i=0;i<e.length;i++){const s=e[i];if(s.name===t||s.uuid===t)return s;const r=n(s.children);if(r)return r}return null},i=n(e.children);if(i)return i}return null}}),Object.assign(qa.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)e[t++]=n[i]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++]},function(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let s=t.propertyIndex;if(e||(e=qa.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===i){i=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==i){if(void 0===e[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[i]}}const r=e[i];if(void 0===r){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[s]&&(s=e.morphTargetDictionary[s])}a=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=s}else void 0!==r.fromArray&&void 0!==r.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(a=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(qa.prototype,{_getValue_unbound:qa.prototype.getValue,_setValue_unbound:qa.prototype.setValue});const Xa=new K,Ya=new qt,Za=new qt,Ja=new K,Ka=new te;function Qa(e,t){On.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new te,this.bindMatrixInverse=new te}Qa.prototype=Object.assign(Object.create(On.prototype),{constructor:Qa,isSkinnedMesh:!0,copy:function(e){return On.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const e=new qt,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){On.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(e,t){const n=this.skeleton,i=this.geometry;Ya.fromBufferAttribute(i.attributes.skinIndex,e),Za.fromBufferAttribute(i.attributes.skinWeight,e),Xa.fromBufferAttribute(i.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const i=Za.getComponent(e);if(0!==i){const s=Ya.getComponent(e);Ka.multiplyMatrices(n.bones[s].matrixWorld,n.boneInverses[s]),t.addScaledVector(Ja.copy(Xa).applyMatrix4(Ka),i)}}return t.applyMatrix4(this.bindMatrixInverse)}});class el extends ts{constructor(e,t){super(e,t),this.type="LineLoop"}}el.prototype.isLineLoop=!0;const tl=new te,nl=new dt,il=new _t,sl=new K;function rl(e=new gn,t=new za){Ae.call(this),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}function ol(e,t,n,i,s,r,o){const a=nl.distanceSqToPoint(e);if(a<n){const n=new K;nl.closestPointToPoint(e,n),n.applyMatrix4(i);const l=s.ray.origin.distanceTo(n);if(l<s.near||l>s.far)return;r.push({distance:l,distanceToRay:Math.sqrt(a),point:n,index:t,face:null,object:o})}}function al(e,t,n,i){Pa.call(this,e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function ll(e,t,n,i){Pa.call(this,e,t,n,i)}function cl(e,t,n,i){Pa.call(this,e,t,n,i)}rl.prototype=Object.assign(Object.create(Ae.prototype),{constructor:rl,isPoints:!0,copy:function(e){return Ae.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,r=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),il.copy(n.boundingSphere),il.applyMatrix4(i),il.radius+=s,!1===e.ray.intersectsSphere(il))return;tl.copy(i).invert(),nl.copy(e.ray).applyMatrix4(tl);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(n.isBufferGeometry){const s=n.index,o=n.attributes.position;if(null!==s){for(let n=Math.max(0,r.start),l=Math.min(s.count,r.start+r.count);n<l;n++){const r=s.getX(n);sl.fromBufferAttribute(o,r),ol(sl,r,a,i,e,t,this)}}else{for(let n=Math.max(0,r.start),s=Math.min(o.count,r.start+r.count);n<s;n++)sl.fromBufferAttribute(o,n),ol(sl,n,a,i,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")},updateMorphTargets:function(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),al.prototype=Object.assign(Object.create(Pa.prototype),{constructor:al,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(e,t,n){const i=this.parameterPositions;let s=e-2,r=e+1,o=i[s],a=i[r];if(void 0===o)switch(this.getSettings_().endingStart){case 2401:s=e,o=2*t-n;break;case 2402:s=i.length-2,o=t+i[s]-i[s+1];break;default:s=e,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case 2401:r=e,a=2*n-t;break;case 2402:r=1,a=n+i[1]-i[0];break;default:r=e-1,a=t}const l=.5*(n-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(a-n),this._offsetPrev=s*c,this._offsetNext=r*c},interpolate_:function(e,t,n,i){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(n-t)/(i-t),f=p*p,m=f*p,g=-u*m+2*u*f-u*p,v=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,b=d*m-d*f;for(let e=0;e!==o;++e)s[e]=g*r[c+e]+v*r[l+e]+y*r[a+e]+b*r[h+e];return s}}),ll.prototype=Object.assign(Object.create(Pa.prototype),{constructor:ll,interpolate_:function(e,t,n,i){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=(n-t)/(i-t),h=1-c;for(let e=0;e!==o;++e)s[e]=r[l+e]*h+r[a+e]*c;return s}}),cl.prototype=Object.assign(Object.create(Pa.prototype),{constructor:cl,interpolate_:function(e){return this.copySampleValue_(e-1)}});const hl={arraySlice:function(e,t,n){return hl.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const i=e.length,s=new e.constructor(i);for(let r=0,o=0;o!==i;++r){const i=n[r]*t;for(let n=0;n!==t;++n)s[o++]=e[i+n]}return s},flattenJSON:function(e,t,n,i){let s=1,r=e[0];for(;void 0!==r&&void 0===r[i];)r=e[s++];if(void 0===r)return;let o=r[i];if(void 0!==o)if(Array.isArray(o))do{o=r[i],void 0!==o&&(t.push(r.time),n.push.apply(n,o)),r=e[s++]}while(void 0!==r);else if(void 0!==o.toArray)do{o=r[i],void 0!==o&&(t.push(r.time),o.toArray(n,n.length)),r=e[s++]}while(void 0!==r);else do{o=r[i],void 0!==o&&(t.push(r.time),n.push(o)),r=e[s++]}while(void 0!==r)},subclip:function(e,t,n,i,s=30){const r=e.clone();r.name=t;const o=[];for(let e=0;e<r.tracks.length;++e){const t=r.tracks[e],a=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const r=t.times[e]*s;if(!(r<n||r>=i)){l.push(t.times[e]);for(let n=0;n<a;++n)c.push(t.values[e*a+n])}}0!==l.length&&(t.times=hl.convertArray(l,t.times.constructor),t.values=hl.convertArray(c,t.values.constructor),o.push(t))}r.tracks=o;let a=1/0;for(let e=0;e<r.tracks.length;++e)a>r.tracks[e].times[0]&&(a=r.tracks[e].times[0]);for(let e=0;e<r.tracks.length;++e)r.tracks[e].shift(-1*a);return r.resetDuration(),r},makeClipAdditive:function(e,t=0,n=e,i=30){i<=0&&(i=30);const s=n.tracks.length,r=t/i;for(let t=0;t<s;++t){const i=n.tracks[t],s=i.ValueTypeName;if("bool"===s||"string"===s)continue;const o=e.tracks.find((function(e){return e.name===i.name&&e.ValueTypeName===s}));if(void 0===o)continue;let a=0;const l=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const h=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const u=i.times.length-1;let d;if(r<=i.times[0]){const e=a,t=l-a;d=hl.arraySlice(i.values,e,t)}else if(r>=i.times[u]){const e=u*l+a,t=e+l-a;d=hl.arraySlice(i.values,e,t)}else{const e=i.createInterpolant(),t=a,n=l-a;e.evaluate(r),d=hl.arraySlice(e.resultBuffer,t,n)}if("quaternion"===s){(new J).fromArray(d).normalize().conjugate().toArray(d)}const p=o.times.length;for(let e=0;e<p;++e){const t=e*h+c;if("quaternion"===s)J.multiplyQuaternionsFlat(o.values,t,d,0,o.values,t);else{const e=h-2*c;for(let n=0;n<e;++n)o.values[t+n]-=d[n]}}}return e.blendMode=2501,e}};class ul{constructor(e,t,n,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=hl.convertArray(t,this.TimeBufferType),this.values=hl.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:hl.convertArray(e.times,Array),values:hl.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new cl(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new ll(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new al(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let s=0,r=i-1;for(;s!==i&&n[s]<e;)++s;for(;-1!==r&&n[r]>t;)--r;if(++r,0!==s||r!==i){s>=r&&(r=Math.max(r,1),s=r-1);const e=this.getValueSize();this.times=hl.arraySlice(n,s,r),this.values=hl.arraySlice(this.values,s*e,r*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,s=n.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let r=null;for(let t=0;t!==s;t++){const i=n[t];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,i),e=!1;break}if(null!==r&&r>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,i,r),e=!1;break}r=i}if(void 0!==i&&hl.isTypedArray(i))for(let t=0,n=i.length;t!==n;++t){const n=i[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=hl.arraySlice(this.times),t=hl.arraySlice(this.values),n=this.getValueSize(),i=2302===this.getInterpolation(),s=e.length-1;let r=1;for(let o=1;o<s;++o){let s=!1;const a=e[o];if(a!==e[o+1]&&(1!==o||a!==e[0]))if(i)s=!0;else{const e=o*n,i=e-n,r=e+n;for(let o=0;o!==n;++o){const n=t[e+o];if(n!==t[i+o]||n!==t[r+o]){s=!0;break}}}if(s){if(o!==r){e[r]=e[o];const i=o*n,s=r*n;for(let e=0;e!==n;++e)t[s+e]=t[i+e]}++r}}if(s>0){e[r]=e[s];for(let e=s*n,i=r*n,o=0;o!==n;++o)t[i+o]=t[e+o];++r}return r!==e.length?(this.times=hl.arraySlice(e,0,r),this.values=hl.arraySlice(t,0,r*n)):(this.times=e,this.values=t),this}clone(){const e=hl.arraySlice(this.times,0),t=hl.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}ul.prototype.TimeBufferType=Float32Array,ul.prototype.ValueBufferType=Float32Array,ul.prototype.DefaultInterpolation=2301;class dl extends ul{}function pl(e,t,n,i){Pa.call(this,e,t,n,i)}dl.prototype.ValueTypeName="number",pl.prototype=Object.assign(Object.create(Pa.prototype),{constructor:pl,interpolate_:function(e,t,n,i){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=(n-t)/(i-t);let l=e*o;for(let e=l+o;l!==e;l+=4)J.slerpFlat(s,0,r,l-o,r,l,a);return s}});class fl extends ul{InterpolantFactoryMethodLinear(e){return new pl(this.times,this.values,this.getValueSize(),e)}}fl.prototype.ValueTypeName="quaternion",fl.prototype.DefaultInterpolation=2301,fl.prototype.InterpolantFactoryMethodSmooth=void 0;class ml extends ul{}ml.prototype.ValueTypeName="vector";class gl extends ul{}gl.prototype.ValueTypeName="bool",gl.prototype.ValueBufferType=Array,gl.prototype.DefaultInterpolation=2300,gl.prototype.InterpolantFactoryMethodLinear=void 0,gl.prototype.InterpolantFactoryMethodSmooth=void 0;class vl extends ul{}vl.prototype.ValueTypeName="color";class yl extends ul{}yl.prototype.ValueTypeName="string",yl.prototype.ValueBufferType=Array,yl.prototype.DefaultInterpolation=2300,yl.prototype.InterpolantFactoryMethodLinear=void 0,yl.prototype.InterpolantFactoryMethodSmooth=void 0;class bl{constructor(e,t=-1,n,i=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Z.generateUUID(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let e=0,s=n.length;e!==s;++e)t.push(xl(n[e]).scale(i));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,i=n.length;e!==i;++e)t.push(ul.toJSON(n[e]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const s=t.length,r=[];for(let e=0;e<s;e++){let o=[],a=[];o.push((e+s-1)%s,e,(e+1)%s),a.push(0,1,0);const l=hl.getKeyframeOrder(o);o=hl.sortedArray(o,1,l),a=hl.sortedArray(a,1,l),i||0!==o[0]||(o.push(s),a.push(a[0])),r.push(new dl(".morphTargetInfluences["+t[e].name+"]",o,a).scale(1/n))}return new this(e,-1,r)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},s=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],r=n.name.match(s);if(r&&r.length>1){const e=r[1];let t=i[e];t||(i[e]=t=[]),t.push(n)}}const r=[];for(const e in i)r.push(this.CreateFromMorphTargetSequence(e,i[e],t,n));return r}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,i,s){if(0!==n.length){const r=[],o=[];hl.flattenJSON(n,r,o,i),0!==r.length&&s.push(new e(t,r,o))}},i=[],s=e.name||"default",r=e.fps||30,o=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const s=l[e].keys;if(s&&0!==s.length)if(s[0].morphTargets){const e={};let t;for(t=0;t<s.length;t++)if(s[t].morphTargets)for(let n=0;n<s[t].morphTargets.length;n++)e[s[t].morphTargets[n]]=-1;for(const n in e){const e=[],r=[];for(let i=0;i!==s[t].morphTargets.length;++i){const i=s[t];e.push(i.time),r.push(i.morphTarget===n?1:0)}i.push(new dl(".morphTargetInfluence["+n+"]",e,r))}a=e.length*(r||1)}else{const r=".bones["+t[e].name+"]";n(ml,r+".position",s,"pos",i),n(fl,r+".quaternion",s,"rot",i),n(ml,r+".scale",s,"scl",i)}}if(0===i.length)return null;return new this(s,a,i,o)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function xl(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return dl;case"vector":case"vector2":case"vector3":case"vector4":return ml;case"color":return vl;case"quaternion":return fl;case"bool":case"boolean":return gl;case"string":return yl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];hl.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}function _l(){Ae.call(this),this.type="Bone"}_l.prototype=Object.assign(Object.create(Ae.prototype),{constructor:_l,isBone:!0});const wl=new te,Sl=new te;class Ml{constructor(e=[],t=[]){this.uuid=Z.generateUUID(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new te)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new te;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,s=e.length;i<s;i++){const s=e[i]?e[i].matrixWorld:Sl;wl.multiplyMatrices(s,t[i]),wl.toArray(n,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new Ml(this.bones,this.boneInverses)}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const i=e.bones[n];let s=t[i];void 0===s&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),s=new _l),this.bones.push(s),this.boneInverses.push((new te).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,s=t.length;i<s;i++){const s=t[i];e.bones.push(s.uuid);const r=n[i];e.boneInverses.push(r.toArray())}return e}}var El=function(){function e(e){ea.call(this,e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new r(e)})),this.register((function(e){return new a(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new o(e)})),this.register((function(e){return new i(e)})),this.register((function(e){return new c(e)}))}function t(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(ea.prototype),{constructor:e,load:function(e,t,n,i){var s,r=this;s=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:oa(e),this.manager.itemStart(e);var o=function(t){i?i(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)},a=new ia(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{r.parse(n,s,(function(n){t(n),r.manager.itemEnd(e)}),o)}catch(e){o(e)}}),n,o)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')},setKTX2Loader:function(e){return this.ktx2Loader=e,this},setMeshoptDecoder:function(e){return this.meshoptDecoder=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,t,i,r){var o,a={},l={};if("string"==typeof e)o=e;else if(ra(new Uint8Array(e,0,4))===h){try{a[n.KHR_BINARY_GLTF]=new p(e)}catch(e){return void(r&&r(e))}o=a[n.KHR_BINARY_GLTF].content}else o=ra(new Uint8Array(e));var c=JSON.parse(o);if(void 0===c.asset||c.asset.version[0]<2)r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var u=new j(c,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(var d=0;d<this.pluginCallbacks.length;d++){var g=this.pluginCallbacks[d](u);l[g.name]=g,a[g.name]=!0}if(c.extensionsUsed)for(d=0;d<c.extensionsUsed.length;++d){var b=c.extensionsUsed[d],x=c.extensionsRequired||[];switch(b){case n.KHR_MATERIALS_UNLIT:a[b]=new s;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[b]=new v;break;case n.KHR_DRACO_MESH_COMPRESSION:a[b]=new f(c,this.dracoLoader);break;case n.KHR_TEXTURE_TRANSFORM:a[b]=new m;break;case n.KHR_MESH_QUANTIZATION:a[b]=new y;break;default:x.indexOf(b)>=0&&void 0===l[b]&&console.warn('THREE.GLTFLoader: Unknown extension "'+b+'".')}}u.setExtensions(a),u.setPlugins(l),u.parse(i,r)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};function i(e){this.parser=e,this.name=n.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function s(){this.name=n.KHR_MATERIALS_UNLIT}function r(e){this.parser=e,this.name=n.KHR_MATERIALS_CLEARCOAT}function o(e){this.parser=e,this.name=n.KHR_MATERIALS_TRANSMISSION}function a(e){this.parser=e,this.name=n.KHR_TEXTURE_BASISU}function l(e){this.parser=e,this.name=n.EXT_TEXTURE_WEBP,this.isSupported=null}function c(e){this.name=n.EXT_MESHOPT_COMPRESSION,this.parser=e}i.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,i=t.length;n<i;n++){var s=t[n];s.extensions&&s.extensions[this.name]&&void 0!==s.extensions[this.name].light&&e._addNodeRef(this.cache,s.extensions[this.name].light)}},i.prototype._loadLight=function(e){var t=this.parser,n="light:"+e,i=t.cache.get(n);if(i)return i;var s,r=t.json,o=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e],a=new Ht(16777215);void 0!==o.color&&a.fromArray(o.color);var l=void 0!==o.range?o.range:0;switch(o.type){case"directional":(s=new ba(a)).target.position.set(0,0,-1),s.add(s.target);break;case"point":(s=new Ea(a)).distance=l;break;case"spot":(s=new Ca(a)).distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,s.angle=o.spot.outerConeAngle,s.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,s.target.position.set(0,0,-1),s.add(s.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return s.position.set(0,0,0),s.decay=2,void 0!==o.intensity&&(s.intensity=o.intensity),s.name=t.createUniqueName(o.name||"light_"+e),i=Promise.resolve(s),t.cache.add(n,i),i},i.prototype.createNodeAttachment=function(e){var t=this,n=this.parser,i=n.json.nodes[e],s=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===s?null:this._loadLight(s).then((function(e){return n._getNodeRef(t.cache,s,e)}))},s.prototype.getMaterialType=function(){return Wt},s.prototype.extendParams=function(e,t,n){var i=[];e.color=new Ht(1,1,1),e.opacity=1;var s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){var r=s.baseColorFactor;e.color.fromArray(r),e.opacity=r[3]}void 0!==s.baseColorTexture&&i.push(n.assignTexture(e,"map",s.baseColorTexture))}return Promise.all(i)},r.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Aa:null},r.prototype.extendMaterialParams=function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var s=[],r=i.extensions[this.name];if(void 0!==r.clearcoatFactor&&(t.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&s.push(n.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&s.push(n.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(s.push(n.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){var o=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new gt(o,-o)}return Promise.all(s)},o.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Aa:null},o.prototype.extendMaterialParams=function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var s=[],r=i.extensions[this.name];return void 0!==r.transmissionFactor&&(t.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&s.push(n.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(s)},a.prototype.loadTexture=function(e){var t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;var s=i.extensions[this.name],r=n.images[s.source],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r,o)},l.prototype.loadTexture=function(e){var t=this.name,n=this.parser,i=n.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;var r=s.extensions[t],o=i.images[r.source],a=n.textureLoader;if(o.uri){var l=n.options.manager.getHandler(o.uri);null!==l&&(a=l)}return this.detectSupport().then((function(s){if(s)return n.loadTextureImage(e,o,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))},l.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported},c.prototype.loadBufferView=function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var i=n.extensions[this.name],s=this.parser.getDependency("buffer",i.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([s,r.ready]).then((function(e){var t=i.byteOffset||0,n=i.byteLength||0,s=i.count,o=i.byteStride,a=new ArrayBuffer(s*o),l=new Uint8Array(e[0],t,n);return r.decodeGltfBuffer(new Uint8Array(a),s,o,l,i.mode,i.filter),a}))}return null};var h="glTF",u=1313821514,d=5130562;function p(e){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12);if(this.header={magic:ra(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==h)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var i=this.header.length-12,s=new DataView(e,12),r=0;r<i;){var o=s.getUint32(r,!0);r+=4;var a=s.getUint32(r,!0);if(r+=4,a===u){var l=new Uint8Array(e,12+r,o);this.content=ra(l)}else if(a===d){var c=12+r;this.body=e.slice(c,c+o)}r+=o}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function f(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function m(){this.name=n.KHR_TEXTURE_TRANSFORM}function g(e){go.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),r=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),o={specular:{value:(new Ht).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=o,this.onBeforeCompile=function(e){for(var a in o)e.uniforms[a]=o[a];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",r)},Object.defineProperties(this,{specular:{get:function(){return o.specular.value},set:function(e){o.specular.value=e}},specularMap:{get:function(){return o.specularMap.value},set:function(e){o.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return o.glossiness.value},set:function(e){o.glossiness.value=e}},glossinessMap:{get:function(){return o.glossinessMap.value},set:function(e){o.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function v(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return g},extendParams:function(e,t,n){var i=t.extensions[this.name];e.color=new Ht(1,1,1),e.opacity=1;var s=[];if(Array.isArray(i.diffuseFactor)){var r=i.diffuseFactor;e.color.fromArray(r),e.opacity=r[3]}if(void 0!==i.diffuseTexture&&s.push(n.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new Ht(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new Ht(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var o=i.specularGlossinessTexture;s.push(n.assignTexture(e,"glossinessMap",o)),s.push(n.assignTexture(e,"specularMap",o))}return Promise.all(s)},createMaterial:function(e){var t=new g(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=0,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function y(){this.name=n.KHR_MESH_QUANTIZATION}function b(e,t,n,i){Pa.call(this,e,t,n,i)}f.prototype.decodePrimitive=function(e,t){var n=this.json,i=this.dracoLoader,s=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,o={},a={},l={};for(var c in r){var h=R[c]||c.toLowerCase();o[h]=r[c]}for(c in e.attributes){h=R[c]||c.toLowerCase();if(void 0!==r[c]){var u=n.accessors[e.attributes[c]],d=C[u.componentType];l[h]=d,a[h]=!0===u.normalized}}return t.getDependency("bufferView",s).then((function(e){return new Promise((function(t){i.decodeDracoFile(e,(function(e){for(var n in e.attributes){var i=e.attributes[n],s=a[n];void 0!==s&&(i.normalized=s)}t(e)}),o,l)}))}))},m.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},g.prototype=Object.create(go.prototype),g.prototype.constructor=g,g.prototype.copy=function(e){return go.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},b.prototype=Object.create(Pa.prototype),b.prototype.constructor=b,b.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i*3+i,r=0;r!==i;r++)t[r]=n[s+r];return t},b.prototype.beforeStart_=b.prototype.copySampleValue_,b.prototype.afterEnd_=b.prototype.copySampleValue_,b.prototype.interpolate_=function(e,t,n,i){for(var s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=2*o,l=3*o,c=i-t,h=(n-t)/c,u=h*h,d=u*h,p=e*l,f=p-l,m=-2*d+3*u,g=d-u,v=1-m,y=g-u+h,b=0;b!==o;b++){var x=r[f+b+o],_=r[f+b+a]*c,w=r[p+b+o],S=r[p+b]*c;s[b]=v*x+y*_+m*w+g*S}return s};var x=0,_=1,w=2,S=3,M=4,E=5,T=6,C={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},A={9728:1003,9729:1006,9984:1004,9985:1007,9986:1005,9987:1008},P={33071:1001,33648:1002,10497:1e3},L={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},R={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},N={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},D={CUBICSPLINE:void 0,LINEAR:2301,STEP:2300},O="OPAQUE",k="MASK",I="BLEND";function z(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function U(e,t,n){for(var i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function F(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function V(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(n=0,i=s.length;n<i;n++)e.morphTargetDictionary[s[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function B(e){for(var t="",n=Object.keys(e).sort(),i=0,s=n.length;i<s;i++)t+=n[i]+":"+e[n[i]]+";";return t}function j(e,n){this.json=e||{},this.extensions={},this.plugins={},this.options=n||{},this.cache=new t,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new La(this.options.manager):this.textureLoader=new Na(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ia(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function $(e,t,n){var i=t.attributes,s=[];function r(t,i){return n.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(var o in i){var a=R[o]||o.toLowerCase();a in e.attributes||s.push(r(i[o],a))}if(void 0!==t.indices&&!e.index){var l=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));s.push(l)}return F(e,t),function(e,t,n){var i=t.attributes,s=new Ge;if(void 0!==i.POSITION){var r=(p=n.json.accessors[i.POSITION]).min,o=p.max;if(void 0!==r&&void 0!==o){s.set(new K(r[0],r[1],r[2]),new K(o[0],o[1],o[2]));var a=t.targets;if(void 0!==a){for(var l=new K,c=new K,h=0,u=a.length;h<u;h++){var d=a[h];if(void 0!==d.POSITION){var p;r=(p=n.json.accessors[d.POSITION]).min,o=p.max;void 0!==r&&void 0!==o?(c.setX(Math.max(Math.abs(r[0]),Math.abs(o[0]))),c.setY(Math.max(Math.abs(r[1]),Math.abs(o[1]))),c.setZ(Math.max(Math.abs(r[2]),Math.abs(o[2]))),l.max(c)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(l)}e.boundingBox=s;var f=new _t;s.getCenter(f.center),f.radius=s.min.distanceTo(s.max)/2,e.boundingSphere=f}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,n),Promise.all(s).then((function(){return void 0!==t.targets?function(e,t,n){for(var i=!1,s=!1,r=0,o=t.length;r<o;r++){if(void 0!==(c=t[r]).POSITION&&(i=!0),void 0!==c.NORMAL&&(s=!0),i&&s)break}if(!i&&!s)return Promise.resolve(e);var a=[],l=[];for(r=0,o=t.length;r<o;r++){var c=t[r];if(i){var h=void 0!==c.POSITION?n.getDependency("accessor",c.POSITION):e.attributes.position;a.push(h)}if(s){h=void 0!==c.NORMAL?n.getDependency("accessor",c.NORMAL):e.attributes.normal;l.push(h)}}return Promise.all([Promise.all(a),Promise.all(l)]).then((function(t){var n=t[0],r=t[1];return i&&(e.morphAttributes.position=n),s&&(e.morphAttributes.normal=r),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function G(e,t){var n=e.getIndex();if(null===n){var i=[],s=e.getAttribute("position");if(void 0===s)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var r=0;r<s.count;r++)i.push(r);e.setIndex(i),n=e.getIndex()}var o=n.count-2,a=[];if(2===t)for(r=1;r<=o;r++)a.push(n.getX(0)),a.push(n.getX(r)),a.push(n.getX(r+1));else for(r=0;r<o;r++)r%2==0?(a.push(n.getX(r)),a.push(n.getX(r+1)),a.push(n.getX(r+2))):(a.push(n.getX(r+2)),a.push(n.getX(r+1)),a.push(n.getX(r)));a.length/3!==o&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(a),l}return j.prototype.setExtensions=function(e){this.extensions=e},j.prototype.setPlugins=function(e){this.plugins=e},j.prototype.parse=function(e,t){var n=this,i=this.json,s=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){var r={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};U(s,r,i),F(r,i),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(r)}))).then((function(){e(r)}))})).catch(t)},j.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],i=0,s=t.length;i<s;i++)for(var r=t[i].joints,o=0,a=r.length;o<a;o++)e[r[o]].isBone=!0;for(var l=0,c=e.length;l<c;l++){var h=e[l];void 0!==h.mesh&&(this._addNodeRef(this.meshCache,h.mesh),void 0!==h.skin&&(n[h.mesh].isSkinnedMesh=!0)),void 0!==h.camera&&this._addNodeRef(this.cameraCache,h.camera)}},j.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},j.prototype._getNodeRef=function(e,t,n){if(e.refs[t]<=1)return n;var i=n.clone();return i.name+="_instance_"+e.uses[t]++,i},j.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var i=e(t[n]);if(i)return i}},j.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],i=0;i<t.length;i++){var s=e(t[i]);s&&n.push(s)}return n},j.prototype.getDependency=function(e,t){var n=e+":"+t,i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":i=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i},j.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return n.getDependency(e,i)}))),this.cache.add(e,t)}return t},j.prototype.loadBuffer=function(e){var t=this.json.buffers[e],i=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var s=this.options;return new Promise((function(e,n){i.load(z(t.uri,s.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},j.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)}))},j.prototype.loadAccessor=function(e){var t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var s=[];return void 0!==i.bufferView?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),void 0!==i.sparse&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then((function(e){var s,r=e[0],o=L[i.type],a=C[i.componentType],l=a.BYTES_PER_ELEMENT,c=l*o,h=i.byteOffset||0,u=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;if(u&&u!==c){var p=Math.floor(h/u),f="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+p+":"+i.count,m=t.cache.get(f);m||(m=new Da(new a(r,p*u,i.count*u/l),u/l),t.cache.add(f,m)),s=new ka(m,o,h%u/l,d)}else s=new Zt(null===r?new a(i.count*o):new a(r,h,i.count*o),o,d);if(void 0!==i.sparse){var g=L.SCALAR,v=C[i.sparse.indices.componentType],y=i.sparse.indices.byteOffset||0,b=i.sparse.values.byteOffset||0,x=new v(e[1],y,i.sparse.count*g),_=new a(e[2],b,i.sparse.count*o);null!==r&&(s=new Zt(s.array.slice(),s.itemSize,s.normalized));for(var w=0,S=x.length;w<S;w++){var M=x[w];if(s.setX(M,_[w*o]),o>=2&&s.setY(M,_[w*o+1]),o>=3&&s.setZ(M,_[w*o+2]),o>=4&&s.setW(M,_[w*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return s}))},j.prototype.loadTexture=function(e){var t=this.json,n=this.options,i=t.textures[e],s=t.images[i.source],r=this.textureLoader;if(s.uri){var o=n.manager.getHandler(s.uri);null!==o&&(r=o)}return this.loadTextureImage(e,s,r)},j.prototype.loadTextureImage=function(e,t,n){var i=this,s=this.json,r=this.options,o=s.textures[e],a=self.URL||self.webkitURL,l=t.uri,c=!1,h=!0;if("image/jpeg"===t.mimeType&&(h=!1),void 0!==t.bufferView)l=i.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){var n=new DataView(e,25,1).getUint8(0,!1);h=6===n||4===n||3===n}c=!0;var i=new Blob([e],{type:t.mimeType});return l=a.createObjectURL(i)}));else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");return Promise.resolve(l).then((function(e){return new Promise((function(t,i){var s=t;!0===n.isImageBitmapLoader&&(s=function(e){t(new Ia(e))}),n.load(z(e,r.path),s,void 0,i)}))})).then((function(t){!0===c&&a.revokeObjectURL(l),t.flipY=!1,o.name&&(t.name=o.name),h||(t.format=1022);var n=(s.samplers||{})[o.sampler]||{};return t.magFilter=A[n.magFilter]||1006,t.minFilter=A[n.minFilter]||1008,t.wrapS=P[n.wrapS]||1e3,t.wrapT=P[n.wrapT]||1e3,i.associations.set(t,{type:"textures",index:e}),t}))},j.prototype.assignTexture=function(e,t,i){var s=this;return this.getDependency("texture",i.index).then((function(r){if(void 0===i.texCoord||0==i.texCoord||"aoMap"===t&&1==i.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+t+" not yet supported."),s.extensions[n.KHR_TEXTURE_TRANSFORM]){var o=void 0!==i.extensions?i.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(o){var a=s.associations.get(r);r=s.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(r,o),s.associations.set(r,a)}}e[t]=r}))},j.prototype.assignFinalMaterial=function(e){var t=e.geometry,n=e.material,i=void 0!==t.attributes.tangent,s=void 0!==t.attributes.color,r=void 0===t.attributes.normal,o=!0===e.isSkinnedMesh,a=Object.keys(t.morphAttributes).length>0,l=a&&void 0!==t.morphAttributes.normal;if(e.isPoints){var c="PointsMaterial:"+n.uuid,h=this.cache.get(c);h||(h=new za,Ut.prototype.copy.call(h,n),h.color.copy(n.color),h.map=n.map,h.sizeAttenuation=!1,this.cache.add(c,h)),n=h}else if(e.isLine){c="LineBasicMaterial:"+n.uuid;var u=this.cache.get(c);u||(u=new Yi,Ut.prototype.copy.call(u,n),u.color.copy(n.color),this.cache.add(c,u)),n=u}if(i||s||r||o||a){c="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),o&&(c+="skinning:"),i&&(c+="vertex-tangents:"),s&&(c+="vertex-colors:"),r&&(c+="flat-shading:"),a&&(c+="morph-targets:"),l&&(c+="morph-normals:");var d=this.cache.get(c);d||(d=n.clone(),o&&(d.skinning=!0),s&&(d.vertexColors=!0),r&&(d.flatShading=!0),a&&(d.morphTargets=!0),l&&(d.morphNormals=!0),i&&(d.vertexTangents=!0,d.normalScale&&(d.normalScale.y*=-1),d.clearcoatNormalScale&&(d.clearcoatNormalScale.y*=-1)),this.cache.add(c,d),this.associations.set(d,this.associations.get(n))),n=d}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n},j.prototype.getMaterialType=function(){return go},j.prototype.loadMaterial=function(e){var t,i=this,s=this.json,r=this.extensions,o=s.materials[e],a={},l=o.extensions||{},c=[];if(l[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var h=r[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=h.getMaterialType(),c.push(h.extendParams(a,o,i))}else if(l[n.KHR_MATERIALS_UNLIT]){var u=r[n.KHR_MATERIALS_UNLIT];t=u.getMaterialType(),c.push(u.extendParams(a,o,i))}else{var d=o.pbrMetallicRoughness||{};if(a.color=new Ht(1,1,1),a.opacity=1,Array.isArray(d.baseColorFactor)){var p=d.baseColorFactor;a.color.fromArray(p),a.opacity=p[3]}void 0!==d.baseColorTexture&&c.push(i.assignTexture(a,"map",d.baseColorTexture)),a.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,a.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(c.push(i.assignTexture(a,"metalnessMap",d.metallicRoughnessTexture)),c.push(i.assignTexture(a,"roughnessMap",d.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,a)}))))}!0===o.doubleSided&&(a.side=2);var f=o.alphaMode||O;return f===I?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,f===k&&(a.alphaTest=void 0!==o.alphaCutoff?o.alphaCutoff:.5)),void 0!==o.normalTexture&&t!==Wt&&(c.push(i.assignTexture(a,"normalMap",o.normalTexture)),a.normalScale=new gt(1,-1),void 0!==o.normalTexture.scale&&a.normalScale.set(o.normalTexture.scale,-o.normalTexture.scale)),void 0!==o.occlusionTexture&&t!==Wt&&(c.push(i.assignTexture(a,"aoMap",o.occlusionTexture)),void 0!==o.occlusionTexture.strength&&(a.aoMapIntensity=o.occlusionTexture.strength)),void 0!==o.emissiveFactor&&t!==Wt&&(a.emissive=(new Ht).fromArray(o.emissiveFactor)),void 0!==o.emissiveTexture&&t!==Wt&&c.push(i.assignTexture(a,"emissiveMap",o.emissiveTexture)),Promise.all(c).then((function(){var s;return s=t===g?r[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new t(a),o.name&&(s.name=o.name),s.map&&(s.map.encoding=3001),s.emissiveMap&&(s.emissiveMap.encoding=3001),F(s,o),i.associations.set(s,{type:"materials",index:e}),o.extensions&&U(r,s,o),s}))},j.prototype.createUniqueName=function(e){for(var t=qa.sanitizeNodeName(e||""),n=t,i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n},j.prototype.loadGeometries=function(e){var t=this,i=this.extensions,s=this.primitiveCache;function r(e){return i[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return $(n,e,t)}))}for(var o,a,l=[],c=0,h=e.length;c<h;c++){var u,d=e[c],p=(a=void 0,(a=(o=d).extensions&&o.extensions[n.KHR_DRACO_MESH_COMPRESSION])?"draco:"+a.bufferView+":"+a.indices+":"+B(a.attributes):o.indices+":"+B(o.attributes)+":"+o.mode),f=s[p];if(f)l.push(f.promise);else u=d.extensions&&d.extensions[n.KHR_DRACO_MESH_COMPRESSION]?r(d):$(new gn,d,t),s[p]={primitive:d,promise:u},l.push(u)}return Promise.all(l)},j.prototype.loadMesh=function(e){for(var t,n=this,i=this.json,s=this.extensions,r=i.meshes[e],o=r.primitives,a=[],l=0,c=o.length;l<c;l++){var h=void 0===o[l].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new go({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),t.DefaultMaterial):this.getDependency("material",o[l].material);a.push(h)}return a.push(n.loadGeometries(o)),Promise.all(a).then((function(t){for(var i=t.slice(0,t.length-1),a=t[t.length-1],l=[],c=0,h=a.length;c<h;c++){var u,d=a[c],p=o[c],f=i[c];if(p.mode===M||p.mode===E||p.mode===T||void 0===p.mode)!0!==(u=!0===r.isSkinnedMesh?new Qa(d,f):new On(d,f)).isSkinnedMesh||u.geometry.attributes.skinWeight.normalized||u.normalizeSkinWeights(),p.mode===E?u.geometry=G(u.geometry,1):p.mode===T&&(u.geometry=G(u.geometry,2));else if(p.mode===_)u=new ss(d,f);else if(p.mode===S)u=new ts(d,f);else if(p.mode===w)u=new el(d,f);else{if(p.mode!==x)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);u=new rl(d,f)}Object.keys(u.geometry.morphAttributes).length>0&&V(u,r),u.name=n.createUniqueName(r.name||"mesh_"+e),F(u,r),p.extensions&&U(s,u,p),n.assignFinalMaterial(u),l.push(u)}if(1===l.length)return l[0];var m=new Xi;for(c=0,h=l.length;c<h;c++)m.add(l[c]);return m}))},j.prototype.loadCamera=function(e){var t,n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new xa(Z.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new va(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),F(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},j.prototype.loadSkin=function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))},j.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],n=[],i=[],s=[],r=[],o=[],a=0,l=t.channels.length;a<l;a++){var c=t.channels[a],h=t.samplers[c.sampler],u=c.target,d=void 0!==u.node?u.node:u.id,p=void 0!==t.parameters?t.parameters[h.input]:h.input,f=void 0!==t.parameters?t.parameters[h.output]:h.output;n.push(this.getDependency("node",d)),i.push(this.getDependency("accessor",p)),s.push(this.getDependency("accessor",f)),r.push(h),o.push(u)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(s),Promise.all(r),Promise.all(o)]).then((function(n){for(var i=n[0],s=n[1],r=n[2],o=n[3],a=n[4],l=[],c=0,h=i.length;c<h;c++){var u=i[c],d=s[c],p=r[c],f=o[c],m=a[c];if(void 0!==u){var g;switch(u.updateMatrix(),u.matrixAutoUpdate=!0,N[m.path]){case N.weights:g=dl;break;case N.rotation:g=fl;break;case N.position:case N.scale:default:g=ml}var v=u.name?u.name:u.uuid,y=void 0!==f.interpolation?D[f.interpolation]:2301,x=[];N[m.path]===N.weights?u.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&x.push(e.name?e.name:e.uuid)})):x.push(v);var _=p.array;if(p.normalized){var w;if(_.constructor===Int8Array)w=1/127;else if(_.constructor===Uint8Array)w=1/255;else if(_.constructor==Int16Array)w=1/32767;else{if(_.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");w=1/65535}for(var S=new Float32Array(_.length),M=0,E=_.length;M<E;M++)S[M]=_[M]*w;_=S}for(M=0,E=x.length;M<E;M++){var T=new g(x[M]+"."+N[m.path],d.array,_,y);"CUBICSPLINE"===f.interpolation&&(T.createInterpolant=function(e){return new b(this.times,this.values,this.getValueSize()/3,e)},T.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(T)}}}var C=t.name?t.name:"animation_"+e;return new bl(C,void 0,l)}))},j.prototype.loadNode=function(e){var t,n=this.json,i=this.extensions,s=this,r=n.nodes[e],o=r.name?s.createUniqueName(r.name):"";return(t=[],void 0!==r.mesh&&t.push(s.getDependency("mesh",r.mesh).then((function(e){var t=s._getNodeRef(s.meshCache,r.mesh,e);return void 0!==r.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=r.weights.length;t<n;t++)e.morphTargetInfluences[t]=r.weights[t]})),t}))),void 0!==r.camera&&t.push(s.getDependency("camera",r.camera).then((function(e){return s._getNodeRef(s.cameraCache,r.camera,e)}))),s._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)).then((function(t){var n;if((n=!0===r.isBone?new _l:t.length>1?new Xi:1===t.length?t[0]:new Ae)!==t[0])for(var a=0,l=t.length;a<l;a++)n.add(t[a]);if(r.name&&(n.userData.name=r.name,n.name=o),F(n,r),r.extensions&&U(i,n,r),void 0!==r.matrix){var c=new te;c.fromArray(r.matrix),n.applyMatrix4(c)}else void 0!==r.translation&&n.position.fromArray(r.translation),void 0!==r.rotation&&n.quaternion.fromArray(r.rotation),void 0!==r.scale&&n.scale.fromArray(r.scale);return s.associations.set(n,{type:"nodes",index:e}),n}))},j.prototype.loadScene=function(){function e(t,n,i,s){var r=i.nodes[t];return s.getDependency("node",t).then((function(e){return void 0===r.skin?e:s.getDependency("skin",r.skin).then((function(e){for(var n=[],i=0,r=(t=e).joints.length;i<r;i++)n.push(s.getDependency("node",t.joints[i]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(e.isMesh){for(var i=[],s=[],r=0,o=n.length;r<o;r++){var a=n[r];if(a){i.push(a);var l=new te;void 0!==t.inverseBindMatrices&&l.fromArray(t.inverseBindMatrices.array,16*r),s.push(l)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[r])}e.bind(new Ml(i,s),e.matrixWorld)}})),e}));var t})).then((function(t){n.add(t);var o=[];if(r.children)for(var a=r.children,l=0,c=a.length;l<c;l++){var h=a[l];o.push(e(h,t,i,s))}return Promise.all(o)}))}return function(t){var n=this.json,i=this.extensions,s=this.json.scenes[t],r=new Xi;s.name&&(r.name=this.createUniqueName(s.name)),F(r,s),s.extensions&&U(i,r,s);for(var o=s.nodes||[],a=[],l=0,c=o.length;l<c;l++)a.push(e(o[l],r,n,this));return Promise.all(a).then((function(){return r}))}}(),e}();class Tl{constructor(e){this.customDracoPath=null,this.loadingManager=e;const t=new sa;t.setDecoderPath(this.customDracoPath||"https://www.gstatic.com/draco/versioned/decoders/1.3.6/"),this.gltfLoader=new El(e),this.gltfLoader.setDRACOLoader(t)}set dracoPath(e){this.customDracoPath=e,null!==this.gltfLoader.dracoLoader&&this.gltfLoader.dracoLoader.setDecoderPath(this.customDracoPath)}isValid(e){const t=e.split(".").pop().toLowerCase();return Tl.extensions.indexOf(t)>=0}isValidMimeType(e){return Tl.mimeTypes.indexOf(e)>=0}get(e){return new Promise((t,n)=>{this.gltfLoader.load(e,e=>{t(this.createModelGroup(e))},null,t=>{console.error(`failed to load '${e}': ${t}`),n(new Error(t))})})}createModelGroup(e){const t=e.scene,n=new Xi;return t.children.forEach(e=>n.add(e)),n.traverse(e=>{if("Mesh"===e.type){const t=e;t.castShadow=!0;const n=t.material;n.map&&(n.map.encoding=3001),t.geometry.computeBoundingBox();const i=new Co;"MeshStandardMaterial"===n.type&&i.copyStandardMaterial(n),n.userData.objectSpaceNormals&&i.enableObjectSpaceNormalMap(!0),t.material=i}}),n}}Tl.extensions=["gltf","glb"],Tl.mimeTypes=["model/gltf+json","model/gltf-binary"];class Cl extends Ut{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Ht(16777215),this.specular=new Ht(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ht(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.flatShading=e.flatShading,this}}Cl.prototype.isMeshPhongMaterial=!0;var Al=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,n=/^usemtl /,i=/^usemap /,s=new K,r=new K,o=new K,a=new K,l=new K;function c(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){var i=n.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){var i=this.vertices,s=this.object.geometry.vertices;s.push(i[e+0],i[e+1],i[e+2]),s.push(i[t+0],i[t+1],i[t+2]),s.push(i[n+0],i[n+1],i[n+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){var i=this.normals,s=this.object.geometry.normals;s.push(i[e+0],i[e+1],i[e+2]),s.push(i[t+0],i[t+1],i[t+2]),s.push(i[n+0],i[n+1],i[n+2])},addFaceNormal:function(e,t,n){var i=this.vertices,c=this.object.geometry.normals;s.fromArray(i,e),r.fromArray(i,t),o.fromArray(i,n),l.subVectors(o,r),a.subVectors(s,r),l.cross(a),l.normalize(),c.push(l.x,l.y,l.z),c.push(l.x,l.y,l.z),c.push(l.x,l.y,l.z)},addColor:function(e,t,n){var i=this.colors,s=this.object.geometry.colors;void 0!==i[e]&&s.push(i[e+0],i[e+1],i[e+2]),void 0!==i[t]&&s.push(i[t+0],i[t+1],i[t+2]),void 0!==i[n]&&s.push(i[n+0],i[n+1],i[n+2])},addUV:function(e,t,n){var i=this.uvs,s=this.object.geometry.uvs;s.push(i[e+0],i[e+1]),s.push(i[t+0],i[t+1]),s.push(i[n+0],i[n+1])},addDefaultUV:function(){var e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,i,s,r,o,a,l){var c=this.vertices.length,h=this.parseVertexIndex(e,c),u=this.parseVertexIndex(t,c),d=this.parseVertexIndex(n,c);if(this.addVertex(h,u,d),this.addColor(h,u,d),void 0!==o&&""!==o){var p=this.normals.length;h=this.parseNormalIndex(o,p),u=this.parseNormalIndex(a,p),d=this.parseNormalIndex(l,p),this.addNormal(h,u,d)}else this.addFaceNormal(h,u,d);if(void 0!==i&&""!==i){var f=this.uvs.length;h=this.parseUVIndex(i,f),u=this.parseUVIndex(s,f),d=this.parseUVIndex(r,f),this.addUV(h,u,d),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,n=0,i=e.length;n<i;n++){var s=this.parseVertexIndex(e[n],t);this.addVertexPoint(s),this.addColor(s)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var n=this.vertices.length,i=this.uvs.length,s=0,r=e.length;s<r;s++)this.addVertexLine(this.parseVertexIndex(e[s],n));var o=0;for(r=t.length;o<r;o++)this.addUVLine(this.parseUVIndex(t[o],i))}};return e.startObject("",!1),e}function h(e){ea.call(this,e),this.materials=null}return h.prototype=Object.assign(Object.create(ea.prototype),{constructor:h,load:function(e,t,n,i){var s=this,r=new ia(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(function(n){try{t(s.parse(n))}catch(t){i?i(t):console.error(t),s.manager.itemError(e)}}),n,i)},setMaterials:function(e){return this.materials=e,this},parse:function(s){var r=new c;-1!==s.indexOf("\r\n")&&(s=s.replace(/\r\n/g,"\n")),-1!==s.indexOf("\\\n")&&(s=s.replace(/\\\n/g,""));for(var o=s.split("\n"),a="",l="",h=[],u="function"==typeof"".trimLeft,d=0,p=o.length;d<p;d++)if(a=o[d],0!==(a=u?a.trimLeft():a.trim()).length&&"#"!==(l=a.charAt(0)))if("v"===l){var f=a.split(/\s+/);switch(f[0]){case"v":r.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),f.length>=7?r.colors.push(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6])):r.colors.push(void 0,void 0,void 0);break;case"vn":r.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":r.uvs.push(parseFloat(f[1]),parseFloat(f[2]))}}else if("f"===l){for(var m=a.substr(1).trim().split(/\s+/),g=[],v=0,y=m.length;v<y;v++){var b=m[v];if(b.length>0){var x=b.split("/");g.push(x)}}var _=g[0];for(v=1,y=g.length-1;v<y;v++){var w=g[v],S=g[v+1];r.addFace(_[0],w[0],S[0],_[1],w[1],S[1],_[2],w[2],S[2])}}else if("l"===l){var M=a.substring(1).trim().split(" "),E=[],T=[];if(-1===a.indexOf("/"))E=M;else for(var C=0,A=M.length;C<A;C++){var P=M[C].split("/");""!==P[0]&&E.push(P[0]),""!==P[1]&&T.push(P[1])}r.addLineGeometry(E,T)}else if("p"===l){var L=a.substr(1).trim().split(" ");r.addPointGeometry(L)}else if(null!==(h=e.exec(a))){var R=(" "+h[0].substr(1).trim()).substr(1);r.startObject(R)}else if(n.test(a))r.object.startMaterial(a.substring(7).trim(),r.materialLibraries);else if(t.test(a))r.materialLibraries.push(a.substring(7).trim());else if(i.test(a))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===l){if((h=a.split(" ")).length>1){var N=h[1].trim().toLowerCase();r.object.smooth="0"!==N&&"off"!==N}else r.object.smooth=!0;(H=r.object.currentMaterial())&&(H.smooth=r.object.smooth)}else{if("\0"===a)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+a+'"')}r.finalize();var D=new Xi;if(D.materialLibraries=[].concat(r.materialLibraries),!0===!(1===r.objects.length&&0===r.objects[0].geometry.vertices.length))for(d=0,p=r.objects.length;d<p;d++){var O=r.objects[d],k=O.geometry,I=O.materials,z="Line"===k.type,U="Points"===k.type,F=!1;if(0!==k.vertices.length){(Y=new gn).setAttribute("position",new on(k.vertices,3)),k.normals.length>0&&Y.setAttribute("normal",new on(k.normals,3)),k.colors.length>0&&(F=!0,Y.setAttribute("color",new on(k.colors,3))),!0===k.hasUVIndices&&Y.setAttribute("uv",new on(k.uvs,2));for(var V,B=[],j=0,$=I.length;j<$;j++){var G=(X=I[j]).name+"_"+X.smooth+"_"+F,H=r.materials[G];if(null!==this.materials)if(H=this.materials.create(X.name),!z||!H||H instanceof Yi){if(U&&H&&!(H instanceof za)){var W=new za({size:10,sizeAttenuation:!1});Ut.prototype.copy.call(W,H),W.color.copy(H.color),W.map=H.map,H=W}}else{var q=new Yi;Ut.prototype.copy.call(q,H),q.color.copy(H.color),H=q}void 0===H&&((H=z?new Yi:U?new za({size:1,sizeAttenuation:!1}):new Cl).name=X.name,H.flatShading=!X.smooth,H.vertexColors=F,r.materials[G]=H),B.push(H)}if(B.length>1){for(j=0,$=I.length;j<$;j++){var X=I[j];Y.addGroup(X.groupStart,X.groupCount,j)}V=z?new ss(Y,B):U?new rl(Y,B):new On(Y,B)}else V=z?new ss(Y,B[0]):U?new rl(Y,B[0]):new On(Y,B[0]);V.name=O.name,D.add(V)}}else if(r.vertices.length>0){var Y;H=new za({size:1,sizeAttenuation:!1});(Y=new gn).setAttribute("position",new on(r.vertices,3)),r.colors.length>0&&void 0!==r.colors[0]&&(Y.setAttribute("color",new on(r.colors,3)),H.vertexColors=!0);var Z=new rl(Y,H);D.add(Z)}return D}}),h}(),Pl=function(e){ea.call(this,e),this.propertyNameMapping={}};Pl.prototype=Object.assign(Object.create(ea.prototype),{constructor:Pl,load:function(e,t,n,i){var s=this,r=new ia(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(function(n){try{t(s.parse(n))}catch(t){i?i(t):console.error(t),s.manager.itemError(e)}}),n,i)},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(e){function t(e){var t="",n=0,i=/ply([\s\S]*)end_header\r?\n/.exec(e);null!==i&&(t=i[1],n=new Blob([i[0]]).size);var s,r,o,a,l,c,u={comments:[],elements:[],headerLength:n,objInfo:""},d=t.split("\n");for(var p=0;p<d.length;p++){var f=d[p];if(""!==(f=f.trim()))switch(r=(o=f.split(/\s+/)).shift(),f=o.join(" "),r){case"format":u.format=o[0],u.version=o[1];break;case"comment":u.comments.push(f);break;case"element":void 0!==s&&u.elements.push(s),(s={}).name=o[0],s.count=parseInt(o[1]),s.properties=[];break;case"property":s.properties.push((a=o,l=h.propertyNameMapping,c=void 0,"list"===(c={type:a[0]}).type?(c.name=a[3],c.countType=a[1],c.itemType=a[2]):c.name=a[1],c.name in l&&(c.name=l[c.name]),c));break;case"obj_info":u.objInfo=f;break;default:console.log("unhandled",r,o)}}return void 0!==s&&u.elements.push(s),u}function n(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function i(e,t){for(var i=t.split(/\s+/),s={},r=0;r<e.length;r++)if("list"===e[r].type){for(var o=[],a=n(i.shift(),e[r].countType),l=0;l<a;l++)o.push(n(i.shift(),e[r].itemType));s[e[r].name]=o}else s[e[r].name]=n(i.shift(),e[r].type);return s}function s(e,t){var n,s={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},a="";null!==(n=/end_header\s([\s\S]*)$/.exec(e))&&(a=n[1]);for(var l=a.split("\n"),c=0,h=0,u=0;u<l.length;u++){var d=l[u];if(""!==(d=d.trim())){h>=t.elements[c].count&&(c++,h=0);var p=i(t.elements[c].properties,d);o(s,t.elements[c].name,p),h++}}return r(s)}function r(e){var t=new gn;return e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new on(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new on(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new on(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new on(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed()).setAttribute("uv",new on(e.faceVertexUvs,2)),t.computeBoundingSphere(),t}function o(e,t,n){if("vertex"===t)e.vertices.push(n.x,n.y,n.z),"nx"in n&&"ny"in n&&"nz"in n&&e.normals.push(n.nx,n.ny,n.nz),"s"in n&&"t"in n&&e.uvs.push(n.s,n.t),"red"in n&&"green"in n&&"blue"in n&&e.colors.push(n.red/255,n.green/255,n.blue/255);else if("face"===t){var i=n.vertex_indices||n.vertex_index,s=n.texcoord;3===i.length?(e.indices.push(i[0],i[1],i[2]),s&&6===s.length&&(e.faceVertexUvs.push(s[0],s[1]),e.faceVertexUvs.push(s[2],s[3]),e.faceVertexUvs.push(s[4],s[5]))):4===i.length&&(e.indices.push(i[0],i[1],i[3]),e.indices.push(i[1],i[2],i[3]))}}function a(e,t,n,i){switch(n){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,i),2];case"uint16":case"ushort":return[e.getUint16(t,i),2];case"int32":case"int":return[e.getInt32(t,i),4];case"uint32":case"uint":return[e.getUint32(t,i),4];case"float32":case"float":return[e.getFloat32(t,i),4];case"float64":case"double":return[e.getFloat64(t,i),8]}}function l(e,t,n,i){for(var s,r={},o=0,l=0;l<n.length;l++)if("list"===n[l].type){var c=[],h=(s=a(e,t+o,n[l].countType,i))[0];o+=s[1];for(var u=0;u<h;u++)s=a(e,t+o,n[l].itemType,i),c.push(s[0]),o+=s[1];r[n[l].name]=c}else s=a(e,t+o,n[l].type,i),r[n[l].name]=s[0],o+=s[1];return[r,o]}var c,h=this;if(e instanceof ArrayBuffer){var u=ra(new Uint8Array(e)),d=t(u);c="ascii"===d.format?s(u,d):function(e,t){for(var n,i={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},s="binary_little_endian"===t.format,a=new DataView(e,t.headerLength),c=0,h=0;h<t.elements.length;h++)for(var u=0;u<t.elements[h].count;u++){c+=(n=l(a,c,t.elements[h].properties,s))[1];var d=n[0];o(i,t.elements[h].name,d)}return r(i)}(e,d)}else c=s(e,t(e));return c}});class Ll{constructor(e){this.objLoader=new Al(e),this.plyLoader=new Pl(e)}isValid(e){const t=e.split(".").pop().toLowerCase();return Ll.extensions.indexOf(t)>=0}get(e){const t=e.split(".").pop().toLowerCase();return new Promise((n,i)=>{if("obj"===t)this.objLoader.load(e,t=>{const s=t.children[0].geometry;return s&&"Geometry"===s.type||"BufferGeometry"===s.type?n(s):i(new Error(`Can't parse geometry from '${e}'`))});else{if("ply"!==t)throw new Error(`Can't load geometry, unknown extension: '${t}' in '${e}'`);this.plyLoader.load(e,t=>t&&"Geometry"===t.type||"BufferGeometry"===t.type?n(t):i(new Error(`Can't parse geometry from '${e}'`)))}})}}Ll.extensions=["obj","ply"];class Rl{constructor(e){this.textureLoader=new Na(e)}isValid(e){const t=e.split(".").pop().toLowerCase();return Rl.extensions.indexOf(t)>=0}isValidMimeType(e){return Rl.mimeTypes.indexOf(e)>=0}get(e){return new Promise((t,n)=>{this.textureLoader.load(e,e=>{t(e)},null,e=>{console.error(e),n(new Error(e.message))})})}getImmediate(e){return this.textureLoader.load(e,null,null,e=>{console.error(e)})}}Rl.extensions=["jpg","png"],Rl.mimeTypes=["image/jpeg","image/png"];var Nl=function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function a(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))};class Dl{constructor(e){this._customFontPath=null,this._loadingManager=e,this._textureLoader=new Na(e),this._cache={}}set fontPath(e){this._customFontPath=e}get fontPath(){return this._customFontPath}get(e){return this._cache[e]}load(e){return Nl(this,void 0,void 0,(function*(){if(this._cache[e])return Promise.resolve(this._cache[e]);this._loadingManager.itemStart(e);const t=this.fontPath,n=t?t+e+".json":zl+e+".json",i=t?t+e+".png":zl+e+".png",s=fetch(n,{headers:{Accept:"application/json"}}).then(t=>{if(!t.ok)throw this._loadingManager.itemError(e),new Error(`failed to load bitmap font descriptor: '${n}', status: ${t.status} ${t.statusText}`);return t.json()}),r=new Promise((e,t)=>{this._textureLoader.load(i,n=>n?e(n):t(new Error(`failed to load font texture from '${i}'`)))});return Promise.all([s,r]).then(t=>{const n={descriptor:t[0],texture:t[1]};return this._cache[e]=n,this._loadingManager.itemEnd(e),n})}))}}class Ol extends j{constructor(){super(...arguments),this.ins=this.addInputs(Ol.ins),this.outs=this.addOutputs(Ol.outs),this._loadingManager=new kl(this),this._baseUrl=window.location.href,this._initialLoad=!1}get loadingManager(){return this._loadingManager}get baseUrl(){return this._baseUrl}set baseUrl(e){this._baseUrl=new URL(e,window.location.href).href}get initialLoad(){return this._initialLoad}set initialLoad(e){this._initialLoad=e}getAssetName(e){return e.split("/").pop()}getAssetUrl(e){return new URL(e,this._baseUrl).href}getAssetPath(e){const t=this._baseUrl,n=e.indexOf(t);return n>=0?e.substr(n+t.length):e}getAssetBasePath(e){const t=this.getAssetPath(e).split("/");t.pop();const n=t.join("/");return n?n+"/":n}getRelativeAssetPath(e,t){const n=this.getAssetUrl(e),i=this.getAssetUrl(t),s=n.indexOf(i);return s>=0?n.substr(s+i.length):this.getAssetPath(n)}create(){super.create()}update(){const{ins:e,outs:t}=this;if(e.busy.changed){const n=e.busy.value||this._loadingManager.isBusy;t.busy.setValue(n),n||t.completed.set()}return!0}}Ol.typeName="CVAssetManager",Ol.text="AssetManager",Ol.icon="",Ol.isSystemSingleton=!0,Ol.ins={busy:C("State.Busy")},Ol.outs={busy:C("State.Busy"),completed:D("State.Completed")};class kl extends Ko{constructor(e){super(),this._manager=e,this._isBusy=!1,this.onStart=this.onLoadingStart.bind(this),this.onProgress=this.onLoadingProgress.bind(this),this.onLoad=this.onLoadingCompleted.bind(this),this.onError=this.onLoadingError.bind(this)}get isBusy(){return this._isBusy}onLoadingStart(){this._isBusy=!0,this._manager.ins.busy.set()}onLoadingProgress(e,t,n){0}onLoadingCompleted(){this._isBusy=!1,this._manager.ins.busy.set()}onLoadingError(){this._isBusy=!1,this._manager.ins.busy.set()}}var Il=function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function a(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))};const zl="https://cdn.jsdelivr.net/gh/smithsonian/dpo-voyager@latest/assets/";class Ul extends j{constructor(e,t){super(e,t),this.systemAssetPath=null;const n=this.assetManager.loadingManager;this.jsonLoader=new Jo(n),this.modelLoader=new Tl(n),this.geometryLoader=new Ll(n),this.textureLoader=new Rl(n),this.fontReader=new Dl(n)}get assetManager(){return this.getMainComponent(Ol)}setDracoPath(e){this.modelLoader.dracoPath=e}setSystemAssetPath(e){this.fontReader.fontPath=e,this.systemAssetPath=e}getJSON(e){return Il(this,void 0,void 0,(function*(){const t=this.assetManager.getAssetUrl(e);return this.jsonLoader.get(t)}))}getText(e){return Il(this,void 0,void 0,(function*(){const t=this.assetManager.getAssetUrl(e);return Yo.text(t,"GET")}))}getModel(e){return Il(this,void 0,void 0,(function*(){const t=this.assetManager.getAssetUrl(e);return this.modelLoader.get(t)}))}getGeometry(e){return Il(this,void 0,void 0,(function*(){const t=this.assetManager.getAssetUrl(e);return this.geometryLoader.get(t)}))}getTexture(e){return Il(this,void 0,void 0,(function*(){const t=this.assetManager.getAssetUrl(e);return this.textureLoader.get(t)}))}getFont(e){return Il(this,void 0,void 0,(function*(){const t=this.assetManager.getAssetUrl(e);return this.fontReader.load(t)}))}getSystemTexture(e){return Il(this,void 0,void 0,(function*(){const t=(this.systemAssetPath||zl)+e;return this.textureLoader.get(t)}))}getSystemJSON(e){return Il(this,void 0,void 0,(function*(){const t=(this.systemAssetPath||zl)+e;return this.jsonLoader.get(t)}))}}Ul.typeName="CVAssetReader",Ul.text="AssetReader",Ul.icon="",Ul.isSystemSingleton=!0;class Fl extends j{constructor(){super(...arguments),this._activeLanguages=[],this._translations={},this.ins=this.addInputs(Fl.ins),this.outs=this.addOutputs(Fl.outs),this.updateLanguage=()=>{const{ins:e,outs:t}=this;t.language.setValue(e.language.value),this.emit({type:"tag-update"})}}get assetReader(){return this.getMainComponent(Ul)}get activeLanguages(){return this._activeLanguages}toString(){return Bi[Vi[this.ins.language.value]]}create(){super.create()}update(){const{ins:e,outs:t}=this;if(0!=this.activeLanguages.length)return e.language.changed&&this.assetReader.getSystemJSON("language/string.resources."+Vi[this.ins.language.value].toLowerCase()+".json").then(e=>{this._translations=e,this.updateLanguage()}),!0;this.addLanguage(t.language.value)}fromData(e){const t=Vi[(e=e||{}).language||"EN"];this.ins.language.setValue(isFinite(t)?t:Vi.EN),this.updateLanguage()}toData(){const e=this.ins;return{language:Vi[e.language.getValidatedValue()]}}addLanguage(e){this._activeLanguages.find(t=>t.id===e)||this._activeLanguages.push({id:e,name:Bi[Vi[e]]})}getLocalizedString(e){const t=this._translations;return void 0===t?e:t[e]||e}}Fl.typeName="CVLanguageManager",Fl.text="LanguageManager",Fl.icon="",Fl.isSystemSingleton=!0,Fl.ins={enabled:C("Language.Enabled",!1),language:L("Interface.Language",Vi,Vi.EN)},Fl.outs={language:L("Interface.Language",Vi,Vi.EN)};class Vl extends j{constructor(){super(...arguments),this.collection=new Wo,this.process=new Wo,this.images=new Wo,this.articles=new Ho,this.leadArticle=null,this.notes=[]}get language(){return this.getGraphComponent(Fl,!0)}fromDocument(e,t){if(!isFinite(t.meta))throw new Error("info property missing in node");const n=e.metas[t.meta];if(n.collection&&(this.collection.dictionary=n.collection),n.process&&(this.process.dictionary=n.process),n.images){const e={};n.images.forEach(t=>e[t.quality]=t),this.images.dictionary=e}return n.articles&&(this.articles.items=n.articles.map(e=>qo.fromJSON(e)),void 0!==n.leadArticle&&(this.leadArticle=this.articles.getAt(n.leadArticle)),this.articles.items.forEach(e=>{Object.keys(e.data.titles).forEach(e=>{this.language.addLanguage(Vi[e])})})),this.emit("load"),t.meta}toDocument(e,t){let n=null;if(this.collection.length>0&&(n={collection:this.collection.dictionary}),this.process.length>0&&(n=n||{},n.process=this.process.dictionary),this.images.length>0&&(n=n||{},n.images=this.images.items),this.articles.length>0){n=n||{};const e=this.articles.items;n.articles=e.map(e=>e.toJSON()),this.leadArticle&&(n.leadArticle=e.indexOf(this.leadArticle))}if(n){e.metas=e.metas||[];const t=e.metas.length;return e.metas.push(n),t}}}Vl.typeName="CVMeta",Vl.text="Meta",Vl.icon="document";class Bl extends j{constructor(){super(...arguments),this._title="Untitled",this._timerStart=0}startTimer(){0===this._timerStart&&(this._timerStart=Date.now())}resetTimer(){this._timerStart=0}getTimerTime(){return this._timerStart>0?Date.now()-this._timerStart:0}setTitle(e){this._title=e}sendProperty(e,t){if("function"==typeof ga){const n=void 0!==t?t.toString():void 0;ga("send","event",this._title,e,n)}}}Bl.typeName="CVAnalytics",Bl.text="Analytics",Bl.icon="",Bl.isSystemSingleton=!0;class jl extends j{constructor(){super(...arguments),this.ins=this.addInputs(jl.ins),this.outs=this.addOutputs(jl.outs)}get settingProperties(){return[this.ins.enabled,this.ins.position]}get snapshotProperties(){return[this.ins.enabled,this.ins.articleId]}get articles(){return Object.keys(this._articles).map(e=>this._articles[e])}get activeArticle(){return this.outs.article.value}get assetManager(){return this.getMainComponent(Ol)}get assetReader(){return this.getMainComponent(Ul)}get analytics(){return this.getMainComponent(Bl)}get language(){return this.getGraphComponent(Fl)}create(){super.create(),this.getGraphComponents(Vl).forEach(e=>e.on("update",this.updateArticles,this)),this.graph.components.on(Vl,this.onMetaComponent,this),this.graph.components.on(Fl,this.onLanguageComponent,this),this.updateArticles()}dispose(){this.graph.components.off(Fl,this.onLanguageComponent,this),this.graph.components.off(Vl,this.onMetaComponent,this),this.getGraphComponents(Vl).forEach(e=>e.off("update",this.updateArticles,this)),super.dispose()}update(e){const t=this.ins,n=this.outs;if(t.enabled.changed,t.articleId.changed){const e=this._articles[t.articleId.value]||null,i=e&&e.article;n.article.setValue(i),n.content.setValue(""),i&&(this.readArticle(i),this.analytics.sendProperty("Reader.ArticleId",i.defaultTitle))}return!0}readArticle(e){const t=this.outs,n=e.uri;if(n)return this.assetReader.getText(n).then(e=>this.parseArticle(e,n)).then(e=>t.content.setValue(e)).catch(e=>t.content.setValue(`<h2>Article not found at ${n}</h2>`));t.content.setValue("<h2>Can't display article: no URI.</h2>")}parseArticle(e,t){e=e.replace(/[\n\r]/g,"");const n=this.assetManager.getAssetBasePath(t);return e=e.replace(/(src=\")(.*?)(\")/g,(e,t,i,s)=>(i.startsWith("/")||i.startsWith("http")||(i=this.assetManager.getAssetUrl(n+i)),t+i+s)),Promise.resolve(e)}onMetaComponent(e){e.add&&e.object.articles.on("update",this.updateArticles,this),e.remove&&e.object.articles.off("update",this.updateArticles,this),this.updateArticles()}onLanguageComponent(e){e.add&&e.object.outs.language.on("value",this.updateLanguage,this),e.remove&&e.object.outs.language.off("value",this.updateLanguage,this)}updateArticles(){const e=this.getGraphComponents(Vl),t=this._articles={};e.forEach(e=>{const n=e.articles,i=e.node;n.items.forEach(e=>{t[e.id]={article:e,node:i}})});const n=e[0];n&&n.leadArticle?this.ins.articleId.setValue(n.leadArticle.id):this.ins.articleId.setValue("")}updateLanguage(){const e=this.ins;this.articles.forEach(e=>{e.article.language=this.language.outs.language.value}),e.articleId.set()}fromData(e){e=e||{},this.ins.setValues({enabled:!!e.enabled,position:So[e.position]||So.Overlay,articleId:e.articleId||""})}toData(){const e=this.ins,t={enabled:e.enabled.value,position:So[e.position.value]||"Overlay"};return e.articleId.value&&(t.articleId=e.articleId.value),t}}jl.typeName="CVReader",jl.text="Reader",jl.icon="",jl.ins={enabled:C("Reader.Enabled"),position:L("Reader.Position",So),articleId:A("Article.ID")},jl.outs={article:N("Article.Active",qo),content:A("Article.Content")};class $l{static registerType(e){if(this.types[e.typeName])throw new Error(`Annotation type '${e.typeName}' already registered.`);this.types[e.typeName]=e}static registerDefaultType(e){this.defaultType=e}static get typeNames(){return[this.defaultTypeName,...Object.keys(this.types).sort()]}static get defaultTypeName(){return this.defaultType.typeName}static getType(e){const t=this.types[e]||this.defaultType;if(!t)throw new Error(`type '${e}' not registered and no default type set.`);return t}static createInstance(e,t,n){return"Circle"===(t=t||e.data.style)?new(this.getType(t))(e,n):new(this.getType(t))(e)}}$l.types={},$l.defaultType=null;class Gl extends Ao{constructor(){super(...arguments),this._language=Vi.EN}get title(){return 0===Object.keys(this.data.titles).length&&(this.data.titles.EN=this.data.title),this.data.titles[Vi[this.language]]||"undefined"}set title(e){this.data.titles[Vi[this.language]]=e,this.update()}get lead(){return 0===Object.keys(this.data.leads).length&&(this.data.leads.EN=this.data.lead),this.data.leads[Vi[this.language]]||""}set lead(e){this.data.leads[Vi[this.language]]=e,this.update()}get tags(){return 0===Object.keys(this.data.taglist).length&&this.data.tags.length>0&&(this.data.taglist.EN=this.data.tags),this.data.taglist[Vi[this.language]]||[]}set tags(e){this.data.taglist[Vi[this.language]]=e,this.update()}get language(){return this._language}set language(e){this._language=e}static fromJSON(e){return new Gl(e)}init(){return{id:Ao.generateId(),title:"New Annotation",titles:{},lead:"",leads:{},marker:"",tags:[],taglist:{},articleId:"",imageUri:"",style:$l.defaultTypeName,visible:!0,expanded:!1,position:null,direction:null,scale:1,offset:0,tilt:0,azimuth:0,color:[0,.61,.87],zoneIndex:-1}}deflate(e,t){t.id=e.id,Object.keys(this.data.titles).length>0?(t.titles={},Object.keys(this.data.titles).forEach(n=>{t.titles[n]=e.titles[n]})):e.title&&(t.title=e.title),Object.keys(this.data.leads).length>0?(t.leads={},Object.keys(this.data.leads).forEach(n=>{t.leads[n]=e.leads[n]})):e.lead&&(t.lead=e.lead),e.marker&&(t.marker=e.marker),Object.keys(this.data.taglist).length>0?(t.taglist={},Object.keys(this.data.taglist).forEach(n=>{t.taglist[n]=e.taglist[n].slice()})):e.tags.length>0&&(t.tags=e.tags),e.articleId&&(t.articleId=e.articleId),e.imageUri&&(t.imageUri=e.imageUri),e.style!==$l.defaultTypeName&&(t.style=e.style),!1===e.visible&&(t.visible=e.visible),e.position&&(t.position=e.position.slice()),e.direction&&(t.direction=e.direction.slice()),1!==e.scale&&(t.scale=e.scale),0!==e.offset&&(t.offset=e.offset),0!==e.tilt&&(t.tilt=e.tilt),0!==e.azimuth&&(t.azimuth=e.azimuth);const n=e.color;return!n||1===n[0]&&1===n[1]&&1===n[2]||(t.color=n.slice()),e.zoneIndex>-1&&(t.zoneIndex=e.zoneIndex),e}inflate(e,t){t.id=e.id,t.title=e.title||"",t.titles=e.titles||{},t.lead=e.lead||"",t.leads=e.leads||{},t.marker=e.marker||"",t.tags=e.tags||[],t.taglist=e.taglist||{},t.articleId=e.articleId||"",t.imageUri=e.imageUri||"",t.style=e.style||$l.defaultTypeName,t.visible=void 0===e.visible||e.visible,t.expanded=!1,t.position=e.position.slice(),t.direction=e.direction.slice(),t.scale=void 0!==e.scale?e.scale:1,t.offset=e.offset||0,t.tilt=e.tilt||0,t.azimuth=e.azimuth||0,t.color=e.color||Gl.defaultColor.slice(),t.zoneIndex=void 0!==e.zoneIndex?e.zoneIndex:-1}}Gl.defaultColor=[0,.61,.87];class Hl{constructor(e,t){this.x=e||0,this.y=t||0}static makeZeros(){return new Hl(0,0)}static makeOnes(){return new Hl(1,1)}static makeUnitX(){return new Hl(1,0)}static makeUnitY(){return new Hl(0,1)}static makeCopy(e){return new Hl(e.x,e.y)}static makeFromScalar(e){return new Hl(e,e)}static makeFromArray(e){return new Hl(e[0],e[1])}static toString(e){return`[${e.x}, ${e.y}]`}copy(e){return this.x=e.x,this.y=e.y,this}set(e,t){return this.x=e,this.y=t,this}setFromScalar(e){return this.x=e,this.y=e,this}setFromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}setZeros(){return this.x=0,this.y=0,this}setOnes(){return this.x=1,this.y=1,this}setUnitX(){return this.x=1,this.y=0,this}setUnitY(){return this.x=0,this.y=1,this}add(e){return this.x+=e.x,this.y+=e.y,this}sub(e){return this.x-=e.x,this.y-=e.y,this}mul(e){return this.x*=e.x,this.y*=e.y,this}div(e){return this.x/=e.x,this.y/=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}subScalar(e){return this.x-=e,this.y-=e,this}mulScalar(e){return this.x*=e,this.y*=e,this}divScalar(e){return this.x/=e,this.y/=e,this}translate(e,t){return this.x+=e,this.y+=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),i=this.x,s=this.y;return this.x=t*i-n*s,this.y=n*i+t*s,this}scale(e,t){return this.x*=e,this.y*=t,this}invert(){return this.x=1/this.x,this.y=1/this.y,this}negate(){return this.x=-this.x,this.y=-this.y,this}normalize(){const e=1/Math.sqrt(this.x*this.x+this.y*this.y);return this.x*=e,this.y*=e,this}dot(e){return this.x*e.x+this.y*e.y}length(){const e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}lengthSquared(){const e=this.x,t=this.y;return e*e+t*t}distanceTo(e){const t=e.x-this.x,n=e.y-this.y;return Math.sqrt(t*t+n*n)}angle(){return Math.atan2(this.y,this.x)}angleTo(e){const t=this.x,n=this.y,i=e.x,s=e.y;return Math.acos((t*i+n*s)/(Math.sqrt(t*t+n*n)+Math.sqrt(i*i+s*s)))}min(){return this.x<this.y?this.x:this.y}max(){return this.x>this.y?this.x:this.y}isZero(){return 0===this.x&&0===this.y}clone(){return new Hl(this.x,this.y)}toArray(e,t){return e?(void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e):[this.x,this.y]}toString(){return Hl.toString(this)}}Hl.zeros=new Hl(0,0),Hl.ones=new Hl(1,1),Hl.unitX=new Hl(1,0),Hl.unitY=new Hl(0,1);class Wl{constructor(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}static makeZeros(){return new Wl(0,0,0)}static makeOnes(){return new Wl(1,1,1)}static makeUnitX(){return new Wl(1,0,0)}static makeUnitY(){return new Wl(0,1,0)}static makeUnitZ(){return new Wl(0,0,1)}static makeCopy(e){return new Wl(e.x,e.y,e.z)}static makeFromScalar(e){return new Wl(e,e,e)}static makeFromArray(e){return new Wl(e[0],e[1],e[2])}static toString(e){return`[${e.x}, ${e.y}, ${e.z}]`}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setFromScalar(e){return this.x=e,this.y=e,this.z=e,this}setFromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}setZeros(){return this.x=0,this.y=0,this.z=0,this}setOnes(){return this.x=1,this.y=1,this.z=1,this}setUnitX(){return this.x=1,this.y=0,this.z=0,this}setUnitY(){return this.x=0,this.y=1,this.z=0,this}setUnitZ(){return this.x=0,this.y=0,this.z=1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}mul(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}div(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}mulScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}divScalar(e){return this.x/=e,this.y/=e,this.z/=e,this}translate(e,t,n){return this.x+=e,this.y+=t,this.z+=n,this}rotateX(e){const t=Math.cos(e),n=Math.sin(e),i=this.y,s=this.z;return this.y=t*i-n*s,this.z=n*i+t*s,this}rotateY(e){const t=Math.cos(e),n=Math.sin(e),i=this.x,s=this.z;return this.x=t*i+n*s,this.z=-n*i+t*s,this}rotateZ(e){const t=Math.cos(e),n=Math.sin(e),i=this.x,s=this.y;return this.x=t*i-n*s,this.y=n*i+t*s,this}scale(e,t,n){return this.x*=e,this.y*=t,this.z*=n,this}invert(){return this.x=1/this.x,this.y=1/this.y,this.z=1/this.z,this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}normalize(){const e=1/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x*=e,this.y*=e,this.z*=e,this}homogenize(){return this.x/=this.z,this.y/=this.z,this.z=1,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}cross(e){const t=this.y*e.z-this.z*e.y,n=this.z*e.x-this.x*e.z,i=this.x*e.y-this.y*e.x;return this.x=t,this.y=n,this.z=i,this}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){const e=this.x,t=this.y,n=this.z;return e*e+t*t+n*n}distanceTo(e){const t=e.x-this.x,n=e.y-this.y,i=e.z-this.z;return Math.sqrt(t*t+n*n+i*i)}min(){return this.x<this.y?this.x<this.z?this.x:this.z:this.y<this.z?this.y:this.z}max(){return this.x>this.y?this.x>this.z?this.x:this.z:this.y>this.z?this.y:this.z}isZero(){return 0===this.x&&0===this.y&&0===this.z}clone(){return new Wl(this.x,this.y,this.z)}toArray(e,t){return e?(void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e):[this.x,this.y,this.z]}toVector2(e){return e?(e.x=this.x,e.y=this.y,e):new Hl(this.x,this.y)}toString(){return Wl.toString(this)}}Wl.zeros=new Wl(0,0,0),Wl.ones=new Wl(1,1,1),Wl.unitX=new Wl(1,0,0),Wl.unitY=new Wl(0,1,0),Wl.unitZ=new Wl(0,0,1);class ql{constructor(e,t,n,i){this.x=e||0,this.y=t||0,this.z=n||0,this.w=i||0}static makeZeros(){return new ql(0,0,0,0)}static makeOnes(){return new ql(1,1,1,1)}static makeUnitX(){return new ql(1,0,0,0)}static makeUnitY(){return new ql(0,1,0,0)}static makeUnitZ(){return new ql(0,0,1,0)}static makeUnitW(){return new ql(0,0,0,1)}static makeCopy(e){return new ql(e.x,e.y,e.z,e.w)}static makeFromScalar(e){return new ql(e,e,e,e)}static makeFromArray(e){return new ql(e[0],e[1],e[2],e[3])}static makeFromPosition(e){return new ql(e.x,e.y,e.z,1)}static makeFromDirection(e){return new ql(e.x,e.y,e.z,0)}static toString(e){return`[${e.x}, ${e.y}, ${e.z}, ${e.w}]`}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=void 0===i?1:i,this}setFromScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setFromArray(e,t=1){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}setPosition(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=1,this}setDirection(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=0,this}setZeros(){return this.x=0,this.y=0,this.z=0,this.w=0,this}setOnes(){return this.x=1,this.y=1,this.z=1,this.w=1,this}setUnitX(){return this.x=1,this.y=0,this.z=0,this.w=0,this}setUnitY(){return this.x=0,this.y=1,this.z=0,this.w=0,this}setUnitZ(){return this.x=0,this.y=0,this.z=1,this.w=0,this}setUnitW(){return this.x=0,this.y=0,this.z=0,this.w=1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}mul(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}div(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}normalize(){const e=1/Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}homogenize(){return this.x/=this.w,this.y/=this.w,this.z/=this.w,this.w=1,this}project(e){const t=this.dot(e)/this.lengthSquared();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}length(){const e=this.x,t=this.y,n=this.z,i=this.w;return Math.sqrt(e*e+t*t+n*n+i*i)}lengthSquared(){const e=this.x,t=this.y,n=this.z,i=this.w;return e*e+t*t+n*n+i*i}isZero(){return 0===this.x&&0===this.y&&0===this.z&&0===this.w}clone(){return new ql(this.x,this.y,this.z,this.w)}toArray(e,t){return e?(void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e):[this.x,this.y,this.z,this.w]}toVector3(e){return e?(e.x=this.x,e.y=this.y,e.z=this.z,e):new Wl(this.x,this.y,this.z)}toString(){return ql.toString(this)}}ql.zeros=new ql(0,0,0,0),ql.ones=new ql(1,1,1,1),ql.unitX=new ql(1,0,0,0),ql.unitY=new ql(0,1,0,0),ql.unitZ=new ql(0,0,1,0),ql.unitW=new ql(0,0,0,1);class Xl{constructor(e=0,t=0,n=0,i=1){e instanceof Xl?(this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w):Array.isArray(e)?(this.x=e[0]||0,this.y=e[1]||0,this.z=e[2]||0,this.w=void 0!==e[3]?e[3]:1):"string"==typeof e?this.setString(e):(this.x=e,this.y=t,this.z=n,this.w=i)}static fromString(e){return(new Xl).setString(e)}static fromArray(e){return new Xl(e)}get r(){return this.x}get g(){return this.y}get b(){return this.z}get a(){return this.w}set r(e){this.x=e}set g(e){this.y=e}set b(e){this.z=e}set a(e){this.w=e}get red(){return this.x}get green(){return this.y}get blue(){return this.z}get alpha(){return this.w}set red(e){this.x=e}set green(e){this.y=e}set blue(e){this.z=e}set alpha(e){this.w=e}get redByte(){return Math.floor(255*this.x)}get greenByte(){return Math.floor(255*this.y)}get blueByte(){return Math.floor(255*this.z)}get alphaByte(){return Math.floor(255*this.w)}set redByte(e){this.x=e/255}set greenByte(e){this.y=e/255}set blueByte(e){this.z=e/255}set alphaByte(e){this.w=e/255}inverseMultiply(e){return this.x=this.x*(1-e)+e,this.y=this.y*(1-e)+e,this.z=this.z*(1-e)+e,this}multiply(e){return this.x*=e,this.y*=e,this.z*=e,this}copy(e){this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w}clone(){return new Xl(this.x,this.y,this.z,this.w)}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=void 0===i?1:i,this}setBytes(e,t,n,i){return this.x=e/255,this.y=t/255,this.z=n/255,this.w=void 0===i?1:i/255,this}setUInt24RGB(e){return this.x=e>>16&255,this.y=e>>8&255,this.z=255&e,this.w=1,this}setUInt32RGBA(e){return this.x=e>>24&255,this.y=e>>16&255,this.z=e>>8&255,this.w=255&e,this.w=1,this}setRed(e){return this.x=e,this}setGreen(e){return this.y=e,this}setBlue(e){return this.z=e,this}setAlpha(e){return this.w=e,this}setRedByte(e){return this.x=e/255,this}setGreenByte(e){return this.y=e/255,this}setBlueByte(e){return this.z=e/255,this}setAlphaByte(e){return this.w=e/255,this}setHSV(e,t=1,n=1,i){"object"==typeof e&&(t=e.y,n=e.z,i=void 0!==e.w?e.w:i,e=e.x);const s=Math.floor(e/60),r=e/60-s,o=n*(1-t),a=n*(1-r*t),l=n*(1-(1-r)*t);let c,h,u;switch(s%6){case 0:c=n,h=l,u=o;break;case 1:c=a,h=n,u=o;break;case 2:c=o,h=n,u=l;break;case 3:c=o,h=a,u=n;break;case 4:c=l,h=o,u=n;break;case 5:c=n,h=o,u=a}return this.x=c,this.y=h,this.z=u,void 0!==i&&(this.w=i),this}setHSL(e,t=1,n=1,i){if("object"==typeof e&&(t=e.y,n=e.z,i=void 0!==e.w?e.w:i,e=e.x),0===t)this.x=this.y=this.z=n;else{function s(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}e/=360;var r=n<.5?n*(1+t):n+t-n*t,o=2*n-r;this.x=s(o,r,e+1/3),this.y=s(o,r,e),this.z=s(o,r,e-1/3)}return void 0!==i&&(this.w=i),this}fromArray(e){this.x=e[0]||0,this.y=e[1]||0,this.z=e[2]||0,this.w=void 0!==e[3]?e[3]:1}setString(e,t=1,n=!0){e=e.trim().toLowerCase();let i=(e=Xl.presets[e]||e).match(/^#?([0-9a-f]{3})$/i);if(i){const e=i[1],n=1/15;return this.x=Number.parseInt(e.charAt(0),16)*n,this.y=Number.parseInt(e.charAt(1),16)*n,this.z=Number.parseInt(e.charAt(2),16)*n,this.w=t,this}if(i=e.match(/^#?([0-9a-f]{6})$/i),i){const e=i[1],n=1/255;return this.x=Number.parseInt(e.substr(0,2),16)*n,this.y=Number.parseInt(e.substr(2,2),16)*n,this.z=Number.parseInt(e.substr(4,2),16)*n,this.w=t,this}if(0===e.indexOf("rgb")){let n=e.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i);if(n){const e=1/255;return this.x=Number.parseInt(n[1])*e,this.y=Number.parseInt(n[2])*e,this.z=Number.parseInt(n[3])*e,this.w=t,this}if(n=e.match(/^rgba\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+.*\d*)\s*\)$/i),n){const e=1/255;return this.x=Number.parseInt(n[1])*e,this.y=Number.parseInt(n[2])*e,this.z=Number.parseInt(n[3])*e,this.w=Number.parseFloat(n[4]),this}}if(0===e.indexOf("hsl")){let n=e.match(/(\d+(\.\d+)?)/g);return n&&this.setHSL(Number.parseFloat(n[0]),.01*Number.parseFloat(n[1]),.01*Number.parseFloat(n[2]),void 0!==n[3]?Number.parseFloat(n[3]):t),this}if(n)throw new RangeError("failed to parse color from string: "+e);return this}toUInt24RGB(){return Math.floor(255*this.x)<<16+Math.floor(255*this.y)<<8+Math.floor(255*this.z)}toUInt32RGBA(){return Math.floor(255*this.x)<<24+Math.floor(255*this.y)<<16+Math.floor(255*this.z)<<8+Math.floor(255*this.w)}toVector3(e){return e?(e.x=this.r,e.y=this.g,e.z=this.b,e):new Wl(this.r,this.g,this.b)}toVector4(e){return e?(e.x=this.r,e.y=this.g,e.z=this.b,e.w=this.a,e):new ql(this.r,this.g,this.b,this.a)}toHSV(e){let t=this.x,n=this.y,i=this.z,s=Math.min(t,n,i),r=Math.max(t,n,i),o=r-s,a=0,l=0===r?0:o/r,c=r;return 0!==o&&(a=60*(t===r?(n-i)/o+(n<i?6:0):n===r?(i-t)/o+2:(t-n)/o+4)),e?(e.x=a,e.y=l,e.z=c,e):new Wl(a,l,c)}toHSL(e){let t=this.x,n=this.y,i=this.z,s=Math.min(t,n,i),r=Math.max(t,n,i),o=r-s,a=0,l=0,c=.5*(r+s);return 0!==o&&(l=c>.5?o/(2-r-s):o/(r+s),a=60*(t===r?(n-i)/o+(n<i?6:0):n===r?2+(i-t)/o:4+(t-n)/o)),e?(e.x=a,e.y=l,e.z=c,e):new Wl(a,l,c)}toRGBArray(e){return e?(e[0]=this.r,e[1]=this.g,e[2]=this.b,e):[this.r,this.g,this.b]}toRGBAArray(e){return e?(e[0]=this.r,e[1]=this.g,e[2]=this.b,e[3]=this.a,e):[this.r,this.g,this.b,this.a]}toString(e=!0){if(e&&this.w<1)return`rgba(${this.redByte}, ${this.greenByte}, ${this.blueByte}, ${this.w})`;return"#"+((1<<24)+(this.redByte<<16)+(this.greenByte<<8)+this.blueByte).toString(16).slice(1)}}Xl.presets={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgrey:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};var Yl=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Zl=class extends vr{constructor(){super(),this.name="",this.index=0,this.selectedIndex=-1,this.selected=!1,this.selectable=!1,this.disabled=!1,this.icon="",this.caret=!1,this.inline=!1,this.transparent=!1,this.addEventListener("click",e=>this.onClick(e)),this.addEventListener("keydown",e=>this.onKeyDown(e))}firstConnected(){this.tabIndex=0,this.classList.add("ff-button")}shouldUpdate(e){return(e.has("selectedIndex")||e.has("index"))&&this.selectedIndex>=0&&(this.selected=this.index===this.selectedIndex),e.has("disabled")&&this.setClass("ff-disabled",this.disabled),!0}update(e){this.classList.remove("ff-inline","ff-transparent","ff-control"),this.inline?this.classList.add("ff-inline"):this.transparent?this.classList.add("ff-transparent"):this.classList.add("ff-control"),super.update(e)}render(){return Gs`${this.renderIcon()}${this.renderText()}${this.renderCaret()}`}renderIcon(){return this.icon?Gs`<ff-icon class="ff-off" name=${this.icon}></ff-icon>`:null}renderText(){return this.text?Gs`<div class="ff-text ff-off">${this.text}</div>`:null}renderCaret(){return this.caret?Gs`<div class="ff-caret-down ff-off"></div>`:null}onClick(e){this.selectable&&(this.selected=!this.selected)}onKeyDown(e){document.activeElement!==this||"Space"!==e.code&&"Enter"!==e.code||this.dispatchEvent(new MouseEvent("click",{bubbles:!0}))}};Yl([nr({type:String})],Zl.prototype,"name",void 0),Yl([nr({type:Number})],Zl.prototype,"index",void 0),Yl([nr({type:Number})],Zl.prototype,"selectedIndex",void 0),Yl([nr({type:Boolean,reflect:!0})],Zl.prototype,"selected",void 0),Yl([nr({type:Boolean})],Zl.prototype,"selectable",void 0),Yl([nr({type:Boolean})],Zl.prototype,"disabled",void 0),Yl([nr()],Zl.prototype,"text",void 0),Yl([nr()],Zl.prototype,"icon",void 0),Yl([nr({type:Boolean})],Zl.prototype,"caret",void 0),Yl([nr({type:Boolean})],Zl.prototype,"inline",void 0),Yl([nr({type:Boolean})],Zl.prototype,"transparent",void 0),Zl=Yl([yr("ff-button")],Zl);var Jl=Zl;class Kl extends xa{constructor(e=[]){super(),this.cameras=e}}Kl.prototype.isArrayCamera=!0;const Ql=new K(0,1,0),ec=new K,tc=new K,nc=new K;class ic extends jo{constructor(e,t){super(),this.isAdaptive=!0,this.annotation=e,this.matrixAutoUpdate=!1}get typeName(){return this.constructor.typeName}update(){super.update();const e=this.annotation.data;this.position.fromArray(e.position),ec.fromArray(e.direction).normalize(),this.quaternion.setFromUnitVectors(Ql,ec),this.updateMatrix()}emitClickEvent(){const e={type:"click",annotation:this.annotation,sprite:this};this.dispatchEvent(e)}emitLinkEvent(e){const t={type:"link",annotation:this.annotation,sprite:this,link:e};this.dispatchEvent(t)}isBehindCamera(e,t){let n=null;n=t instanceof Kl&&t.cameras.length>0?t.cameras[0]:t;const i=n.matrixWorld.elements;return e.updateMatrixWorld(),tc.setFromMatrixPosition(e.matrixWorld),nc.setFromMatrixPosition(n.matrixWorld),ec.set(-i[8],-i[9],-i[10]).normalize(),nc.addScaledVector(ec,n.near),nc.sub(tc),nc.angleTo(ec)<=Math.PI/2}}ic.typeName="Annotation";class sc extends $o{constructor(e){super(),this.sprite=e,this.discardEvent=this.discardEvent.bind(this),this.addEventListener("pointerdown",this.discardEvent),this.addEventListener("pointercancel",this.discardEvent),this.addEventListener("click",this.discardEvent)}firstConnected(){super.firstConnected(),this.classList.add("sv-annotation")}discardEvent(e){e.stopPropagation()}}var rc=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};const oc=["sv-q0","sv-q1","sv-q2","sv-q3"],ac=new Xl,lc=new K(0,1,0);class cc extends ic{constructor(e){super(e),this.quadrant=-1,this.adaptive=!0;const t=[];t.push(new K(0,0,0)),t.push(new K(0,1,0));const n=(new gn).setFromPoints(t),i=new Yi({color:"#009cde",transparent:!0});this.stemLine=new ts(n,i),this.stemLine.frustumCulled=!1,this.stemLine.matrixAutoUpdate=!1,this.add(this.stemLine),this.update()}update(){const e=this.annotation.data;this.stemLine.scale.setScalar(e.scale),this.stemLine.position.y=e.offset,this.stemLine.updateMatrix();this.stemLine.material.color.fromArray(e.color),super.update()}renderHTMLElement(e,t,n){super.renderHTMLElement(e,t,n,this.stemLine,lc);const i=Le.scaleLimit(this.viewAngle*Le.RAD2DEG,90,100,1,0),s=this.annotation.data.visible?i:0;this.stemLine.material.opacity=s,e.setOpacity(s),this.orientationQuadrant!==this.quadrant&&(e.classList.remove(oc[this.quadrant]),e.classList.add(oc[this.orientationQuadrant]),this.quadrant=this.orientationQuadrant),this.adaptive!==this.isAdaptive&&(this.isAdaptive?e.classList.remove("sv-static-width"):e.classList.add("sv-static-width"),this.adaptive=this.isAdaptive),this.visible=!this.isBehindCamera(this.stemLine,n)}createHTMLElement(){return new hc(this)}}cc.typeName="Standard",$l.registerDefaultType(cc);let hc=class extends sc{constructor(e){super(e),this.onClickTitle=this.onClickTitle.bind(this),this.titleElement=this.appendElement("div"),this.titleElement.classList.add("sv-title"),this.titleElement.addEventListener("click",this.onClickTitle)}firstConnected(){super.firstConnected(),this.classList.add("sv-standard-annotation")}update(e){super.update(e);const t=this.sprite.annotation.data;this.titleElement.innerText=this.sprite.annotation.title,ac.fromArray(t.color),this.style.borderColor=ac.toString()}onClickTitle(e){e.stopPropagation(),this.sprite.emitClickEvent()}};hc=rc([yr("sv-standard-annotation")],hc);var uc=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};const dc=["sv-q0","sv-q1","sv-q2","sv-q3"],pc=new Xl,fc=new K(0,1,0);class mc extends ic{constructor(e){super(e),this.quadrant=-1,this.adaptive=!0;const t=[];t.push(new K(0,0,0)),t.push(new K(0,1,0));const n=(new gn).setFromPoints(t),i=new Yi({color:"#009cde",transparent:!0});this.stemLine=new ts(n,i),this.stemLine.frustumCulled=!1,this.stemLine.matrixAutoUpdate=!1,this.add(this.stemLine),this.update()}update(){const e=this.annotation.data;this.stemLine.scale.setScalar(e.scale),this.stemLine.position.y=e.offset,this.stemLine.updateMatrix();this.stemLine.material.color.fromArray(e.color),super.update()}renderHTMLElement(e,t,n){super.renderHTMLElement(e,t,n,this.stemLine,fc);const i=Le.scaleLimit(this.viewAngle*Le.RAD2DEG,90,100,1,0),s=this.annotation.data.visible?i:0;this.stemLine.material.opacity=s,e.setOpacity(s),this.orientationQuadrant!==this.quadrant&&(e.classList.remove(dc[this.quadrant]),e.classList.add(dc[this.orientationQuadrant]),this.quadrant=this.orientationQuadrant),this.adaptive!==this.isAdaptive&&(this.isAdaptive?e.classList.remove("sv-static-width"):e.classList.add("sv-static-width"),this.adaptive=this.isAdaptive),this.visible=!this.isBehindCamera(this.stemLine,n)}createHTMLElement(){return new gc(this)}}mc.typeName="Extended",$l.registerType(mc);let gc=class extends sc{constructor(e){super(e),this.handler=0,this.isExpanded=void 0,this.onClickTitle=this.onClickTitle.bind(this),this.onClickArticle=this.onClickArticle.bind(this),this.titleElement=this.appendElement("div"),this.titleElement.classList.add("sv-title"),this.titleElement.addEventListener("click",this.onClickTitle),this.wrapperElement=this.appendElement("div"),this.contentElement=this.createElement("div",null,this.wrapperElement),this.contentElement.classList.add("sv-content")}firstConnected(){super.firstConnected(),this.classList.add("sv-extended-annotation")}update(e){super.update(e);const t=this.sprite.annotation.data;this.titleElement.innerText=this.sprite.annotation.title;const n=Gs`<p>${this.sprite.annotation.lead}</p>
            ${t.articleId?Gs`<ff-button inline text="Read more..." icon="document" @click=${this.onClickArticle}></ff-button>`:null}`;js(n,this.contentElement),pc.fromArray(t.color),this.style.borderColor=pc.toString(),this.isExpanded&&(this.contentElement.style.height="auto"),this.isExpanded!==t.expanded&&(this.isExpanded=t.expanded,window.clearTimeout(this.handler),this.isExpanded?(this.classList.add("sv-expanded"),this.contentElement.style.display="inherit",this.contentElement.style.height=this.contentElement.scrollHeight+"px"):(this.classList.remove("sv-expanded"),this.contentElement.style.height="0",this.handler=window.setTimeout(()=>this.contentElement.style.display="none",300)))}onClickTitle(e){e.stopPropagation(),this.sprite.emitClickEvent()}onClickArticle(e){e.stopPropagation(),this.sprite.emitLinkEvent(this.sprite.annotation.data.articleId)}};gc=uc([yr("sv-extended-annotation")],gc);class vc extends gn{constructor(e=.5,t=1,n=8,i=1,s=0,r=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:s,thetaLength:r},n=Math.max(3,n);const o=[],a=[],l=[],c=[];let h=e;const u=(t-e)/(i=Math.max(1,i)),d=new K,p=new gt;for(let e=0;e<=i;e++){for(let e=0;e<=n;e++){const i=s+e/n*r;d.x=h*Math.cos(i),d.y=h*Math.sin(i),a.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/t+1)/2,p.y=(d.y/t+1)/2,c.push(p.x,p.y)}h+=u}for(let e=0;e<i;e++){const t=e*(n+1);for(let e=0;e<n;e++){const i=e+t,s=i,r=i+n+1,a=i+n+2,l=i+1;o.push(s,r,l),o.push(r,a,l)}}this.setIndex(o),this.setAttribute("position",new on(a,3)),this.setAttribute("normal",new on(l,3)),this.setAttribute("uv",new on(c,2))}}class yc extends gn{constructor(e=1,t=8,n=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const s=[],r=[],o=[],a=[],l=new K,c=new gt;r.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let s=0,h=3;s<=t;s++,h+=3){const u=n+s/t*i;l.x=e*Math.cos(u),l.y=e*Math.sin(u),r.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(r[h]/e+1)/2,c.y=(r[h+1]/e+1)/2,a.push(c.x,c.y)}for(let e=1;e<=t;e++)s.push(e,e+1,0);this.setIndex(s),this.setAttribute("position",new on(r,3)),this.setAttribute("normal",new on(o,3)),this.setAttribute("uv",new on(a,2))}}class bc extends Fr{constructor(e){super(e),this.type="RawShaderMaterial"}}bc.prototype.isRawShaderMaterial=!0;var xc=n(29),_c=n(33),wc=n(34),Sc=n(38),Mc=n(39),Ec=gn;function Tc(e){Ec.call(this),"string"==typeof e&&(e={text:e}),this._opt=Object.assign({},e),e&&this.update(e)}_c(Tc,Ec),Tc.prototype.update=function(e){if("string"==typeof e&&(e={text:e}),!(e=Object.assign({},this._opt,e)).font)throw new TypeError("must specify a { font } in options");this.layout=xc(e);var t=!1!==e.flipY,n=e.font,i=n.common.scaleW,s=n.common.scaleH,r=this.layout.glyphs.filter((function(e){var t=e.data;return t.width*t.height>0}));this.visibleGlyphs=r;var o=Sc.positions(r),a=Sc.uvs(r,i,s,t),l=wc([],{clockwise:!0,type:"uint16",count:r.length});if(this.setIndex(l),this.setAttribute("position",new Zt(o,2)),this.setAttribute("uv",new Zt(a,2)),!e.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(e.multipage){var c=Sc.pages(r);this.setAttribute("page",new Zt(c,1))}},Tc.prototype.computeBoundingSphere=function(){null===this.boundingSphere&&(this.boundingSphere=new _t);var e=this.attributes.position.array,t=this.attributes.position.itemSize;if(!e||!t||e.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);Mc.computeSphere(e,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')},Tc.prototype.computeBoundingBox=function(){null===this.boundingBox&&(this.boundingBox=new Ge);var e=this.boundingBox,t=this.attributes.position.array,n=this.attributes.position.itemSize;!t||!n||t.length<2?e.makeEmpty():Mc.computeBox(t,e)};var Cc=n(40);function Ac(e){var t="number"==typeof(e=e||{}).opacity?e.opacity:1,n="number"==typeof e.alphaTest?e.alphaTest:1e-4,i=e.precision||"highp",s=e.color,r=e.map,o="boolean"!=typeof e.negate||e.negate,a=e.isWebGL2||!1;return delete e.map,delete e.color,delete e.precision,delete e.opacity,delete e.negate,delete e.isWebGL2,Cc(a?{uniforms:{opacity:{type:"f",value:t},map:{type:"t",value:r||new Dr},color:{type:"c",value:new Ht(s)}},vertexShader:["#version 300 es","in vec2 uv;","in vec4 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","out vec2 vUv;","void main() {","  vUv = uv;","  gl_Position = projectionMatrix * modelViewMatrix * position;","}"].join("\n"),fragmentShader:["#version 300 es","precision "+i+" float;","uniform float opacity;","uniform vec3 color;","uniform sampler2D map;","in vec2 vUv;","out vec4 myOutputColor;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","void main() {","  vec3 s = "+(o?"1.0 - ":"")+"texture(map, vUv).rgb;","  float sigDist = median(s.r, s.g, s.b) - 0.5;","  float alpha = clamp(sigDist/fwidth(sigDist) + 0.5, 0.0, 1.0);","  myOutputColor = vec4(color.xyz, alpha * opacity);",0===n?"":"  if (myOutputColor.a < "+n+") discard;","}"].join("\n")}:{uniforms:{opacity:{type:"f",value:t},map:{type:"t",value:r||new Dr},color:{type:"c",value:new Ht(s)}},vertexShader:["attribute vec2 uv;","attribute vec4 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * position;","}"].join("\n"),fragmentShader:["#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives : enable","#endif","precision "+i+" float;","uniform float opacity;","uniform vec3 color;","uniform sampler2D map;","varying vec2 vUv;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","void main() {","  vec3 sample = "+(o?"1.0 - ":"")+"texture2D(map, vUv).rgb;","  float sigDist = median(sample.r, sample.g, sample.b) - 0.5;","  float alpha = clamp(sigDist/fwidth(sigDist) + 0.5, 0.0, 1.0);","  gl_FragColor = vec4(color.xyz, alpha * opacity);",0===n?"":"  if (gl_FragColor.a < "+n+") discard;","}"].join("\n")},e)}var Pc=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};const Lc=new K,Rc=new K,Nc=new J,Dc=new te;class Oc extends ic{constructor(e,t){super(e),this._isExpanded=!1,this.xrScale=1,this.isWebGL2=!1,this._isExpanded=e.data.expanded,this.offset=new Xi,this.offset.matrixAutoUpdate=!1,this.add(this.offset),this.ringGeometry=new vc(.45,.5,32),this.ringMaterialA=new Wt,this.ringMaterialB=new Wt({depthFunc:6,depthWrite:!1,opacity:Oc.behindOpacity,transparent:!0}),this.ringMesh=new On(this.ringGeometry,this.ringMaterialA);const n=new On(this.ringGeometry,this.ringMaterialB),i=new On(new yc(.45,32),new Wt({color:0,opacity:.65,transparent:!0}));i.matrixAutoUpdate=!1,i.position.set(0,0,.005),i.updateMatrix(),this.anchorMesh=new On(new gn,new Wt),this.anchorMesh.frustumCulled=!1,this.offset.add(this.anchorMesh,this.ringMesh,n,i),this.markerGeometry=null,this.markerA=null,this.markerB=null,t.fontReader.load("fonts/Roboto-Bold").then(e=>{this.markerMaterialA=new bc(Ac({map:e.texture,transparent:!0,color:16777215,isWebGL2:this.isWebGL2})),this.markerMaterialB=new bc(Ac({map:e.texture,transparent:!0,opacity:Oc.behindOpacity,color:16777215,depthFunc:6,depthWrite:!1,isWebGL2:this.isWebGL2})),this.markerGeometry=new Tc({font:e.descriptor}),this.markerA=new On(this.markerGeometry,this.markerMaterialA),this.markerA.matrixAutoUpdate=!1,this.markerB=new On(this.markerGeometry,this.markerMaterialB),this.markerB.matrixAutoUpdate=!1,Wr.add(this.markerA,!1),Wr.add(this.markerB,!1),this.offset.add(this.markerA,this.markerB),this.update()}),this.update()}update(){const e=this.annotation.data,t=e.color;if(this.ringMaterialA.color.setRGB(t[0],t[1],t[2]),this.ringMaterialB.color.setRGB(t[0],t[1],t[2]),this.markerA){const t=e.marker.length>1?.013:.016,n=this.markerGeometry;n.update(e.marker),n.computeBoundingBox(),n.boundingBox.getCenter(Lc),this.markerA.position.set(-t*(Lc.x+1),t*Lc.y,.01),this.markerA.scale.set(t,-t,-1),this.markerA.updateMatrix(),this.markerB.position.set(-t*(Lc.x+1),t*Lc.y,.01),this.markerB.scale.set(t,-t,-1),this.markerB.updateMatrix()}super.update()}renderHTMLElement(e,t,n){const i=this.annotation.data;let s=null;const r=this.annotation.data.visible;n instanceof Kl&&(s=n.cameras[0]),s?Dc.copy(s.matrixWorldInverse):Dc.copy(n.matrixWorldInverse),Dc.multiply(this.matrixWorld),Dc.decompose(Lc,Nc,Rc),this.offset.quaternion.copy(Nc.invert()),this.offset.parent.matrixWorld.decompose(Lc,Nc,Rc);const o=1/Rc.x*(1/i.scale)*this.xrScale,a=t.offsetHeight+250,l=55*i.scale/a*o;let c=1;if(n.isPerspectiveCamera){const e=-Lc.set(0,0,0).applyMatrix4(Dc).z,t=n.fov*Z.DEG2RAD*.5;c=Math.tan(t)*e*l}else c=.5*n.size*l;if(this.offset.scale.setScalar(c),this.offset.position.set(0,(i.offset+1)*c*.5,0),this.offset.updateMatrix(),this.visible=!this.isBehindCamera(this.offset,n)&&r,this.visible||e.setVisible(this.visible),i.expanded){Lc.set(0,0,0).applyMatrix4(this.anchorMesh.modelViewMatrix).applyMatrix4(n.projectionMatrix),Rc.set(.6,.5,0).applyMatrix4(this.anchorMesh.modelViewMatrix).applyMatrix4(n.projectionMatrix);const i=.5*(Lc.x+1)*t.clientWidth,s=.5*(1-Lc.y)*t.clientHeight,r=.5*(Rc.x+1)*t.clientWidth-i,o=.5*(1-Rc.y)*t.clientHeight-s;let a=i+r,l=s+o;e.classList.remove("sv-align-right","sv-align-bottom"),a+e.offsetWidth>=t.offsetWidth&&(a=i-r,e.classList.add("sv-align-right")),l+e.offsetHeight>=t.offsetHeight&&(l=s-o,e.classList.add("sv-align-bottom")),e.setPosition(a,l)}this._isExpanded!==i.expanded&&(e.style.visibility="",this._isExpanded=i.expanded)}createHTMLElement(){return new kc(this)}updateHTMLElement(e){e.setVisible(this.visible),this.annotation.data.expanded&&this._isExpanded!==this.annotation.data.expanded&&(e.style.visibility="hidden"),e.requestUpdate()}}Oc.typeName="Circle",Oc.behindOpacity=.2,$l.registerType(Oc);let kc=class extends sc{constructor(e){super(e)}setVisible(e){super.setVisible(e&&this.sprite.annotation.data.expanded)}firstConnected(){super.firstConnected(),this.classList.add("sv-circle-annotation")}render(){const e=this.sprite.annotation,t=e.data;return Gs`<div class="sv-title">${e.title}</div>
            <div class="sv-content"><p>${e.lead}</p></div>
            ${t.articleId?Gs`<ff-button inline text="Read more..." icon="document" @click=${this.onClickArticle}></ff-button>`:null}`}onClickArticle(e){e.stopPropagation(),this.sprite.emitLinkEvent(this.sprite.annotation.data.articleId)}};kc=Pc([yr("sv-circle-annotation")],kc);class Ic extends eo{constructor(e,t){super(e,t),this.ins=this.addInputs(Ic.ins),this._activeAnnotation=null,this._annotations={},this._viewports=new Set,this._sprites={},this.addEvents("active-annotation","group"),this.onSpriteClick=this.onSpriteClick.bind(this),this.onSpriteLink=this.onSpriteLink.bind(this),this.on("pointer-up",this.onPointerUp,this),this.system.on("pointer-up",this.onSystemPointerUp,this),this.arManager.outs.isPresenting.on("value",this.handleARStateChange,this),this.language.outs.language.on("value",this.updateLanguage,this),this.object3D=new Go}get model(){return this.getComponent($c)}get meta(){return this.getComponent(Vl,!0)}get reader(){return this.getGraphComponent(jl,!0)}get language(){return this.getGraphComponent(Fl,!0)}get articles(){const e=this.meta;return e?e.articles:null}get arManager(){return this.system.getMainComponent(bu)}get renderer(){return this.getMainComponent(q)}get assetReader(){return this.getMainComponent(Ul)}get activeAnnotation(){return this._activeAnnotation}set activeAnnotation(e){if(e!==this._activeAnnotation){const t=this._activeAnnotation;t&&(t.set("expanded",!1),this.updateSprite(t)),this._activeAnnotation=e,e&&(e.set("expanded",!0),this.updateSprite(e));const n=this.ins;n.marker.setValue(e?e.data.marker:"",!0),n.title.setValue(e?e.title:"",!0),n.lead.setValue(e?e.lead:"",!0),n.tags.setValue(e?e.tags.join(", "):"",!0),n.style.setOption(e?e.data.style:$l.defaultTypeName,!0),n.scale.setValue(e?e.data.scale:1,!0),n.offset.setValue(e?e.data.offset:0,!0),n.tilt.setValue(e?e.data.tilt:0,!0),n.azimuth.setValue(e?e.data.azimuth:0,!0),n.color.setValue(e?e.data.color.slice():[1,1,1],!0);const i=this.articles;if(i){const t=i.items.map(e=>e.title);t.unshift("(none)"),n.article.setOptions(t);const s=e?i.getById(e.data.articleId):null;n.article.setValue(s?i.getIndexOf(s)+1:0,!0)}else n.article.setOptions(["(none)"]),n.article.setValue(0);n.image.setValue(e?e.data.imageUri:"",!0),this.emit({type:"annotation-update",annotation:e})}}setActiveAnnotationById(e){this.activeAnnotation=this._annotations[e]}update(e){super.update(e);const t=this.ins,n=this.object3D,i=this.activeAnnotation;if(t.unitScale.changed&&(n.scale.setScalar(t.unitScale.value),n.updateMatrix()),t.activeTags.changed){const e=t.activeTags.value.split(",").map(e=>e.trim()).filter(e=>e);for(const t in this._annotations){const n=this._annotations[t],i=n.tags;let s=0===i.length;e.forEach(e=>{i.indexOf(e)>=0&&(s=!0)}),n.set("visible",s),this.updateSprite(n)}}if(i){if(t.marker.changed&&i.set("marker",t.marker.value),t.title.changed&&(i.title=t.title.value),t.lead.changed&&(i.lead=t.lead.value),t.tags.changed&&(i.tags=t.tags.value.split(",").map(e=>e.trim()).filter(e=>e),this.emit({type:"tag-update"})),t.style.changed&&(i.set("style",t.style.getOptionText()),this.createSprite(i)),t.scale.changed&&i.set("scale",t.scale.value*mo(Fi.m,this.model.ins.localUnits.getValidatedValue())*.01),t.offset.changed&&i.set("offset",t.offset.value*mo(Fi.m,this.model.ins.localUnits.getValidatedValue())*.01),t.tilt.changed&&i.set("tilt",t.tilt.value),t.azimuth.changed&&i.set("azimuth",t.azimuth.value),t.color.changed&&i.set("color",t.color.value.slice()),t.image.changed&&i.set("imageUri",t.image.value),t.article.changed){const e=this.articles,n=e&&e.getAt(t.article.getValidatedValue()-1);i.set("articleId",n?n.id:"")}this.updateSprite(i),this.emit({type:"annotation-update",annotation:i})}return!0}tock(){if(this.updated)return!0}postRender(e){const t=e.viewport;this._viewports.has(t)||(t.on("dispose",this.onViewportDispose,this),this._viewports.add(t));this.object3D.render(t.overlay,e.camera)}dispose(){this.object3D.dispose(),this.off("pointer-up",this.onPointerUp,this),this.system.off("pointer-up",this.onSystemPointerUp,this),this.arManager.outs.isPresenting.off("value",this.handleARStateChange,this),this.language.outs.language.off("value",this.updateLanguage,this),this._viewports.forEach(e=>e.off("dispose",this.onViewportDispose,this)),this._viewports.clear(),super.dispose()}getAnnotations(){return Object.keys(this._annotations).map(e=>this._annotations[e])}addAnnotation(e){this._annotations[e.id]=e,this.createSprite(e),Object.keys(e.data.titles).forEach(e=>{this.language.addLanguage(Vi[e])}),Object.keys(e.data.leads).forEach(e=>{this.language.addLanguage(Vi[e])});for(const e in this._annotations){const t=this._annotations[e];if("Circle"===t.get("style")){const e=this._sprites[t.id];e&&(e.isWebGL2=this.renderer.views[0].renderer.capabilities.isWebGL2)}}this.changed=!0}removeAnnotation(e){const t=Object.keys(this._annotations);if(delete this._annotations[e.id],this.removeSprite(e),e===this.activeAnnotation){const n=Math.min(t.indexOf(e.id)+1,t.length-1);this.activeAnnotation=n<0?null:this._annotations[t[n]],e.tags.length>0&&this.emit({type:"tag-update"})}this.changed=!0}updateAnnotation(e){this.changed=!0}toJSON(){const e=super.toJSON(),t=this.toData();return t&&(e.data=t),e}fromJSON(e){e.data&&this.fromData(e.data)}toData(){const e=Object.keys(this._annotations);return 0===e.length?null:e.map(e=>this._annotations[e].toJSON())}fromData(e){e.forEach(e=>this.addAnnotation(new Gl(e))),this.emit({type:"tag-update"})}setXRScale(e){for(const t in this._annotations){const n=this._annotations[t];if("Circle"===n.get("style")){const t=this._sprites[n.id];t&&(t.xrScale=e)}}}handleARStateChange(){for(const e in this._annotations){const t=this._annotations[e];this._sprites[t.id].isAdaptive=!this.arManager.outs.isPresenting.value}}onPointerUp(e){if(e.isDragging)return;let t=e.object3D;for(;t&&!t.isHTMLSprite;)t=t.parent;const n=t&&t.annotation;n&&(this.emit({type:"click",sprite:t,annotation:n}),e.stopPropagation=!0)}onSystemPointerUp(e){e.isDragging||this.emit({type:"click",sprite:null,annotation:null})}onViewportDispose(e){this.object3D.disposeHTMLElements(e.viewport.overlay)}onSpriteClick(e){this.emit(e)}onSpriteLink(e){this.reader&&(this.reader.ins.articleId.setValue(e.annotation.data.articleId),this.reader.ins.enabled.setValue(!0))}createSprite(e){this.removeSprite(e);const t="Circle"===e.data.style?$l.createInstance(e,"Circle",this.assetReader):$l.createInstance(e);t.addEventListener("click",this.onSpriteClick),t.addEventListener("link",this.onSpriteLink),this._sprites[e.id]=t,this.object3D.add(t),this.registerPickableObject3D(t,!0)}removeSprite(e){const t=this._sprites[e.id];t&&(t.removeEventListener("click",this.onSpriteClick),t.removeEventListener("link",this.onSpriteLink),t.dispose(),this._sprites[e.id]=void 0,this.object3D.remove(t),this.unregisterPickableObject3D(t,!0))}updateSprite(e){const t=this._sprites[e.id];t&&t.update()}updateLanguage(){const e=this.ins,t=this._activeAnnotation,n=this.language;this.getAnnotations().forEach(e=>{e.language=n.outs.language.value}),e.activeTags.set();for(const e in this._annotations){const t=this._annotations[e],n=this._sprites[t.id];n&&n.update()}e.title.setValue(t?t.title:"",!0),e.lead.setValue(t?t.lead:"",!0),e.tags.setValue(t?t.tags.join(", "):"")}}Ic.typeName="CVAnnotationView",Ic.ins={unitScale:b("Transform.UnitScale",{preset:1,precision:5}),activeTags:A("Tags.Active"),title:A("Annotation.Title"),lead:A("Annotation.Lead"),marker:A("Annotation.Marker"),tags:A("Annotation.Tags"),style:R("Annotation.Style",$l.typeNames),scale:M("Annotation.Scale",{preset:1,precision:3}),offset:b("Annotation.Offset",{preset:0,precision:3}),article:R("Annotation.Article",[]),image:A("Annotation.Image"),tilt:b("Annotation.Tilt"),azimuth:b("Annotation.Azimuth"),color:T("Annotation.Color")};const zc=["Footprint_Court_1k_TMap.jpg","spruit_sunrise_1k_LDR.jpg","campbell_env.jpg"];class Uc extends j{constructor(){super(...arguments),this.ins=this.addInputs(Uc.envIns),this._texture=null,this._currentIdx=0}get assetReader(){return this.getMainComponent(Ul)}update(){const e=this.ins;if(e.dirty.changed||e.imageIndex.changed){this.getGraphComponent(Hc).models.forEach(t=>{t.object3D.traverse(t=>{const n=t.material;if(n&&n.isUberPBRMaterial&&(n.roughnessMap||n.metalnessMap))if(e.imageIndex.value!=this._currentIdx||null===this._texture)if(this._currentIdx=e.imageIndex.value,null===this._texture){const t=n.metalness;n.metalness=0,this.assetReader.getSystemTexture("images/"+zc[e.imageIndex.value]).then(e=>{this._texture=e,this._texture.mapping=303,n.envMap=this._texture,n.metalness=t,n.needsUpdate=!0})}else this.assetReader.getSystemTexture("images/"+zc[e.imageIndex.value]).then(e=>{this._texture.dispose(),this._texture=e,this._texture.mapping=303,n.envMap=this._texture,n.needsUpdate=!0});else n.envMap=this._texture,n.envMap.mapping=303,n.needsUpdate=!0})})}return!0}fromData(e){this.ins.copyValues({imageIndex:e.index})}toData(){return{index:this.ins.imageIndex.cloneValue()}}}Uc.typeName="CVEnvironment",Uc.text="Environment",Uc.envIns={imageIndex:x("Environment.Index",{preset:0,options:zc.map((function(e,t){return t.toString()}))}),dirty:D("Environment.Dirty")};const Fc=new K,Vc=new K,Bc=new J,jc=new Ge;class $c extends eo{constructor(e,t){super(e,t),this.ins=this.addInputs($c.ins),this.outs=this.addOutputs($c.outs),this._derivatives=new Do,this._activeDerivative=null,this._visible=!0,this._boxFrame=null,this._localBoundingBox=new Ge,this.object3D=new Xi}get settingProperties(){return[this.ins.visible,this.ins.quality,this.ins.localUnits,this.ins.tags,this.ins.renderOrder,this.ins.shadowSide,this.ins.shader,this.ins.override,this.ins.color,this.ins.opacity,this.ins.hiddenOpacity,this.ins.roughness,this.ins.metalness,this.ins.occlusion]}get derivatives(){return this._derivatives}get activeDerivative(){return this._activeDerivative}get localBoundingBox(){return this._localBoundingBox}get assetManager(){return this.getMainComponent(Ol)}get assetReader(){return this.getMainComponent(Ul)}get renderer(){return this.getMainComponent(q)}create(){super.create();this.node.createComponent(Ic).ins.unitScale.linkFrom(this.outs.unitScale);const e=this.renderer.outs.maxTextureSize.value;e<2048?this.ins.quality.setValue(co.Low):e<4096?this.ins.quality.setValue(co.Medium):this.ins.quality.setValue(co.High)}update(){const e=this.ins;if(e.tags.changed||e.activeTags.changed||e.visible.changed){let t=e.visible.value;if(t){const n=e.tags.value.split(",").map(e=>e.trim()).filter(e=>e),i=e.activeTags.value.split(",").map(e=>e.trim()).filter(e=>e);t=!n.length,i.forEach(e=>{n.indexOf(e)>=0&&(t=!0)})}const n=this.ins.override.value;this._visible=t,t?(this.object3D.visible=!0,n&&this.updateMaterial()):e.visible.value&&n&&this.ins.hiddenOpacity.value>0?(this.object3D.visible=!0,this.updateMaterial()):this.object3D.visible=!1}if(e.tags.changed&&this.emit({type:"tag-update"}),!this.activeDerivative&&e.autoLoad.changed&&e.autoLoad.value)this.autoLoad(e.quality.value);else if(e.quality.changed){const t=this.derivatives.select(lo.Web3D,e.quality.value);t&&t!==this.activeDerivative&&this.loadDerivative(t).catch(e=>{console.warn("Model.update - failed to load derivative"),console.warn(e)})}return e.renderOrder.changed&&this.updateRenderOrder(this.object3D,e.renderOrder.value),(e.localUnits.changed||e.globalUnits.changed)&&this.updateUnitScale(),e.shader.changed&&this.updateShader(),e.override.value&&e.shader.value===xo.Default&&(e.override.changed||e.color.changed||e.opacity.changed||e.roughness.changed||e.metalness.changed||e.occlusion.changed)&&this.updateMaterial(),e.center.changed&&this.center(),(e.position.changed||e.rotation.changed)&&this.updateMatrixFromProps(),e.dumpDerivatives.changed&&console.log(this.derivatives.toString(!0)),!0}dispose(){this.derivatives.clear(),this._activeDerivative=null,super.dispose()}center(){const e=this.object3D,t=this.ins.position;e.matrix.decompose(Fc,Bc,Vc),e.matrix.makeRotationFromQuaternion(Bc),jc.makeEmpty(),ao(e,jc,e.parent),jc.getCenter(Fc),Fc.multiplyScalar(-1).toArray(t.value),t.set()}setFromMatrix(e){const t=this.ins;e.decompose(Fc,Bc,Vc),Fc.multiplyScalar(1/this.outs.unitScale.value).toArray(t.position.value),t.position.set(),ro(Bc,$c.rotationOrder,t.rotation.value),t.rotation.set()}fromDocument(e,t){const{ins:n,outs:i}=this;if(!isFinite(t.model))throw new Error("model property missing in node");const s=e.models[t.model],r=Fi[s.units||"cm"];n.localUnits.setValue(isFinite(r)?r:Fi.cm),n.visible.setValue(void 0===s.visible||s.visible),n.tags.setValue(s.tags||""),n.renderOrder.setValue(void 0!==s.renderOrder?s.renderOrder:0);const o=po[s.shadowSide||"Back"];if(n.shadowSide.setValue(isFinite(o)?o:po.Back),n.position.reset(),n.rotation.reset(),s.translation&&n.position.copyValue(s.translation),s.rotation&&(Bc.fromArray(s.rotation),ro(Bc,$c.rotationOrder,n.rotation.value),n.rotation.set()),s.boundingBox){const e=this._localBoundingBox;e.min.fromArray(s.boundingBox.min),e.max.fromArray(s.boundingBox.max),this._boxFrame=new rs(e,"#009cde"),this.addObject3D(this._boxFrame),this._boxFrame.updateMatrixWorld(!0),i.updated.set()}if(s.derivatives&&this.derivatives.fromJSON(s.derivatives),s.material){const e=s.material;n.copyValues({override:!0,color:e.color||n.color.schema.preset,opacity:void 0!==e.opacity?e.opacity:n.opacity.schema.preset,hiddenOpacity:void 0!==e.hiddenOpacity?e.hiddenOpacity:n.hiddenOpacity.schema.preset,roughness:void 0!==e.roughness?e.roughness:n.roughness.schema.preset,metalness:void 0!==e.metalness?e.metalness:n.metalness.schema.preset,occlusion:void 0!==e.occlusion?e.occlusion:n.occlusion.schema.preset})}return s.annotations&&this.getComponent(Ic).fromData(s.annotations),this.emit({type:"tag-update"}),this.ins.autoLoad.set(),t.model}toDocument(e,t){const n={units:Fi[this.ins.localUnits.getValidatedValue()]},i=this.ins;i.visible.value||(n.visible=!1),i.tags.value&&(n.tags=i.tags.value),0!==i.renderOrder.value&&(n.renderOrder=i.renderOrder.value),i.shadowSide.value!=po.Back&&(n.shadowSide=po[this.ins.shadowSide.getValidatedValue()]);const s=i.position.value;0===s[0]&&0===s[1]&&0===s[2]||(n.translation=i.position.value);const r=i.rotation.value;0===r[0]&&0===r[1]&&0===r[2]||(so(r,$c.rotationOrder,Bc),n.rotation=Bc.toArray()),i.override.value&&(n.material={color:i.color.value,opacity:i.opacity.value,hiddenOpacity:i.hiddenOpacity.value,roughness:i.roughness.value,metalness:i.metalness.value,occlusion:i.occlusion.value}),n.boundingBox={min:this._localBoundingBox.min.toArray(),max:this._localBoundingBox.max.toArray()},n.derivatives=this.derivatives.toJSON();const o=this.getComponent(Ic).toData();o&&o.length>0&&(n.annotations=o),e.models=e.models||[];const a=e.models.length;return e.models.push(n),a}updateShader(){const e=this.ins.shader.getValidatedValue();this.object3D.traverse(t=>{const n=t.material;n&&n.isUberPBRMaterial&&n.setShaderMode(e)})}updateMaterial(){const e=this.ins;this.object3D.traverse(t=>{const n=t.material;n&&n.isUberPBRMaterial&&(n.aoMapMix.setScalar(e.occlusion.value),n.color.fromArray(e.color.value),n.opacity=this._visible?e.opacity.value:e.hiddenOpacity.value,n.transparent=n.opacity<1||!!n.alphaMap,n.roughness=e.roughness.value,n.metalness=e.metalness.value)})}updateUnitScale(){const e=this.ins.localUnits.getValidatedValue(),t=this.ins.globalUnits.getValidatedValue();this.outs.unitScale.setValue(mo(e,t)),this.updateMatrixFromProps()}updateMatrixFromProps(){const e=this.ins,t=this.outs.unitScale.value,n=this.object3D;Fc.fromArray(e.position.value).multiplyScalar(t),so(e.rotation.value,$c.rotationOrder,Bc),Vc.setScalar(t),n.matrix.compose(Fc,Bc,Vc),n.matrixWorldNeedsUpdate=!0,this.outs.updated.set()}updateRenderOrder(e,t){e.renderOrder=t,e.children.forEach(e=>this.updateRenderOrder(e,t))}autoLoad(e){const t=[],n=this.derivatives.select(lo.Web3D,co.Thumb);n&&t.push(n);const i=this.derivatives.select(lo.Web3D,e);return i&&i!==n&&t.push(i),0===t.length?(Pr.show(`No 3D derivatives available for '${this.displayName}'.`),Promise.resolve()):t.reduce((e,t)=>e.then(()=>this.loadDerivative(t)),Promise.resolve())}loadDerivative(e){return e.load(this.assetReader).then(()=>{e.model&&(this.assetManager.initialLoad||this._activeDerivative||(this.assetManager.initialLoad=!0),this._activeDerivative&&(this.removeObject3D(this._activeDerivative.model),this._activeDerivative.unload()),this._activeDerivative=e,this.addObject3D(e.model),this.renderer.activeSceneComponent.scene.updateMatrixWorld(!0),this._boxFrame&&(this.removeObject3D(this._boxFrame),this._boxFrame.geometry.dispose(),this._boxFrame=null),ao(e.model,this._localBoundingBox),this.outs.updated.set(),this.outs.quality.setValue(e.data.quality),this.ins.override.value&&this.updateMaterial(),this.ins.shadowSide.value!=po.Back&&this.object3D.traverse(e=>{const t=e.material;t&&t.isUberPBRMaterial&&(this.ins.shadowSide.value==po.Front?t.shadowSide=0:t.shadowSide=1)}),this.getGraphComponent(Uc).ins.dirty.set(),0!==this.ins.renderOrder.value&&this.updateRenderOrder(this.object3D,this.ins.renderOrder.value))}).catch(e=>Pr.show("Failed to load model derivative: "+e.message))}addObject3D(e){this.object3D.add(e),this.object3D.traverse(e=>{"Mesh"===e.type&&this.registerPickableObject3D(e,!0)})}}$c.typeName="CVModel2",$c.text="Model",$c.icon="cube",$c.rotationOrder="ZYX",$c.ins={globalUnits:L("Model.GlobalUnits",Fi,Fi.cm),localUnits:L("Model.LocalUnits",Fi,Fi.cm),quality:L("Model.Quality",co,co.High),tags:A("Model.Tags"),renderOrder:b("Model.RenderOrder",0),shadowSide:L("Model.ShadowSide",po,po.Back),activeTags:A("Model.ActiveTags"),autoLoad:C("Model.AutoLoad",!0),position:w("Model.Position"),rotation:w("Model.Rotation"),center:D("Model.Center"),shader:L("Material.Shader",xo,xo.Default),override:C("Material.Override",!1),color:T("Material.BaseColor"),opacity:_("Material.Opacity",1),hiddenOpacity:_("Material.HiddenOpacity",0),roughness:_("Material.Roughness",.8),metalness:_("Material.Metalness",.1),occlusion:_("Material.Occlusion",.3),dumpDerivatives:D("Derivatives.Dump")},$c.outs={unitScale:b("UnitScale",{preset:1,precision:5}),quality:L("LoadedQuality",co),updated:D("Updated")};const Gc=new K;class Hc extends qi{constructor(){super(...arguments),this.ins=this.addInputs(Hc.ins),this.outs=this.addOutputs(Hc.outs)}get settingProperties(){return null}get snapshotProperties(){return null}get models(){return this.getGraphComponents($c)}create(){super.create(),this.outs.boundingBox.setValue(new Ge),this.graph.components.on($c,this.onModelComponent,this),this.models.forEach(e=>{e.ins.globalUnits.linkFrom(this.ins.units),this.ins.modelUpdated.linkFrom(e.outs.updated)})}update(e){const t=this.ins,n=this.outs;return t.units.changed&&(this.updateTransformHierarchy(),this.updateModelBoundingBox(),n.units.setValue(t.units.value)),t.modelUpdated.changed&&this.updateModelBoundingBox(),t.sceneTransformed.changed&&this.updateModelBoundingBox(),!0}dispose(){this.graph.components.off($c,this.onModelComponent,this),super.dispose()}fromDocument(e,t){this.ins.units.setValue(Fi[t.units]||0),this.outs.units.setValue(Fi[t.units]||0)}toDocument(e,t){t.units=Fi[this.ins.units.getValidatedValue()]}onModelComponent(e){const t=e.object;e.add&&(t.ins.globalUnits.linkFrom(this.ins.units),this.ins.modelUpdated.linkFrom(t.outs.updated)),this.updateModelBoundingBox()}updateModelBoundingBox(){const e=this.outs.boundingBox.value;e.makeEmpty(),this.models.forEach(t=>e.expandByObject(t.object3D)),e.getSize(Gc),this.outs.boundingBox.set(),this.outs.boundingRadius.setValue(.5*Gc.length())}updateTransformHierarchy(){if(0===this.models.length)return;const e=this.ins,t=this.outs,n=mo(t.units.value,e.units.value),i=this.models[0].object3D.parent.parent;i.position.multiplyScalar(n),i.updateMatrix(),i.updateMatrixWorld(!0)}}var Wc;Hc.typeName="CVScene",Hc.text="Scene",Hc.icon="hierarchy",Hc.ins={units:L("Scene.Units",Fi,Fi.cm),modelUpdated:D("Scene.ModelUpdated"),sceneTransformed:D("Scene.Transformed")},Hc.outs={units:L("Scene.Units",Fi,Fi.cm),boundingBox:N("Models.BoundingBox",Ge),boundingRadius:b("Models.BoundingRadius")},function(e){e[e.none=0]="none",e[e.menu=1]="menu",e[e.title=2]="title",e[e.logo=4]="logo",e[e.language=8]="language"}(Wc||(Wc={}));class qc extends j{constructor(){super(...arguments),this.ins=this.addInputs(qc.ins),this.outs=this.addOutputs(qc.outs)}update(e){return!0}fromData(e){e=e||{},this.ins.setValues({visible:void 0===e.visible||e.visible,logo:void 0===e.logo||e.logo,menu:void 0===e.menu||e.menu,tools:void 0===e.tools||e.tools})}toData(){const e=this.ins;return{visible:e.visible.value,logo:e.logo.value,menu:e.menu.value,tools:e.tools.value}}isShowing(e){return(e&this.ins.visibleElements.value)===e}}qc.typeName="CVInterface",qc.ins={visible:C("Interface.Visible",!0),logo:C("Interface.Logo",!0),menu:C("Interface.Menu",!0),tools:C("Interface.Tools",!0),visibleElements:b("Interface.VisibleElements",15)},qc.outs={documentTitle:A("Document.Title")};class Xc extends j{constructor(){super(...arguments),this.ins=this.addInputs(Xc.ins),this.outs=this.addOutputs(Xc.outs)}get settingProperties(){return[this.ins.annotationsVisible,this.ins.activeTags,this.ins.sortedTags,this.ins.radioTags,this.ins.shader,this.ins.exposure,this.ins.gamma]}get snapshotProperties(){return[this.ins.annotationsVisible,this.ins.activeAnnotation,this.ins.activeTags,this.ins.shader,this.ins.exposure]}get analytics(){return this.getMainComponent(Bl)}get renderer(){return this.getMainComponent(q)}create(){super.create(),this.graph.components.on($c,this.onModelComponent,this),this.graph.components.on(Ic,this.onAnnotationsComponent,this),this.graph.components.on(Fl,this.onLanguageComponent,this)}dispose(){this.graph.components.off($c,this.onModelComponent,this),this.graph.components.off(Ic,this.onAnnotationsComponent,this),this.graph.components.off(Fl,this.onLanguageComponent,this),super.dispose()}update(e){const t=this.ins;if(t.shader.changed){const e=t.shader.getValidatedValue();this.getGraphComponents($c).forEach(t=>t.ins.shader.setValue(e))}if(t.exposure.changed&&this.renderer.ins.exposure.setValue(t.exposure.value),t.gamma.changed&&this.renderer.ins.gamma.setValue(t.gamma.value),t.quality.changed){const e=t.quality.getValidatedValue();this.getGraphComponents($c).forEach(t=>t.ins.quality.setValue(e))}if(t.activeAnnotation.changed){const e=t.activeAnnotation.value;this.getGraphComponents(Ic).forEach(t=>t.setActiveAnnotationById(e))}if(t.annotationsVisible.changed){const e=t.annotationsVisible.value;this.getGraphComponents(Ic).forEach(t=>t.ins.visible.setValue(e))}if(t.activeTags.changed){const e=t.activeTags.value;this.getGraphComponents(Ic).forEach(t=>t.ins.activeTags.setValue(e)),this.getGraphComponents($c).forEach(t=>t.ins.activeTags.setValue(e))}return t.sortedTags.changed&&this.refreshTagCloud(),this.renderer.views[0]&&3007!==this.renderer.views[0].renderer.outputEncoding&&(this.renderer.views[0].renderer.outputEncoding=3007),!0}fromData(e){const t=this.ins;t.copyValues({shader:xo[e.shader]||xo.Default,exposure:void 0!==e.exposure?e.exposure:t.exposure.schema.preset,gamma:void 0!==e.gamma?e.gamma:t.gamma.schema.preset,annotationsVisible:!!e.annotationsVisible,activeTags:e.activeTags||"",sortedTags:e.sortedTags||"",radioTags:void 0!==e.radioTags?!!e.radioTags:t.radioTags.schema.preset})}toData(){const e=this.ins,t={shader:xo[e.shader.value],exposure:e.exposure.value,gamma:e.gamma.value};return e.annotationsVisible.value&&(t.annotationsVisible=!0),e.activeTags.value&&(t.activeTags=e.activeTags.value),e.sortedTags.value&&(t.sortedTags=e.sortedTags.value),e.radioTags.value&&(t.radioTags=e.radioTags.value),t}refreshTagCloud(){const e=new Set;this.getGraphComponents($c).forEach(t=>{t.ins.tags.value.split(",").map(e=>e.trim()).filter(e=>e).forEach(t=>e.add(t))});const t=this.getGraphComponents(Ic),n=this.outs.tagCloud.value.split(",").map(e=>e.trim()).filter(e=>e);t.forEach(t=>{t.getAnnotations().forEach(t=>{t.tags.forEach(t=>{n.includes(t)||this.ins.activeTags.setValue(this.ins.activeTags.value+", "+t),e.add(t)})})});const i=Array.from(e),s=this.ins.sortedTags.value.split(",").map(e=>e.trim()).filter(e=>e);i.sort((e,t)=>{const n=s.indexOf(e),i=s.indexOf(t);return n<i?-1:n>i?1:0}),this.outs.tagCloud.setValue(i.join(", ")),this.ins.activeTags.set(),this.ins.annotationsVisible.set()}onAnnotationClick(e){const t=e.annotation?e.annotation.id:"";this.ins.activeAnnotation.setValue(t)}onModelComponent(e){const t=e.object;e.add?t.on("tag-update",this.refreshTagCloud,this):e.remove&&t.off("tag-update",this.refreshTagCloud,this)}onAnnotationsComponent(e){const t=e.object;e.add?(t.on("tag-update",this.refreshTagCloud,this),t.on("click",this.onAnnotationClick,this),t.ins.visible.setValue(this.ins.annotationsVisible.value)):e.remove&&(t.off("tag-update",this.refreshTagCloud,this),t.off("click",this.onAnnotationClick,this))}onLanguageComponent(e){const t=e.object;e.add?t.on("tag-update",this.refreshTagCloud,this):e.remove&&t.off("tag-update",this.refreshTagCloud,this)}}Xc.typeName="CVViewer",Xc.text="Viewer",Xc.icon="",Xc.ins={annotationsVisible:C("Annotations.Visible"),activeAnnotation:A("Annotations.ActiveId"),activeTags:A("Tags.Active"),sortedTags:A("Tags.Sorted"),radioTags:C("Tags.Radio"),shader:L("Renderer.Shader",xo),exposure:b("Renderer.Exposure",1),gamma:b("Renderer.Gamma",2),quality:L("Models.Quality",co,co.High)},Xc.outs={tagCloud:A("Tags.Cloud")};const Yc=new qt,Zc=(new qt,new K),Jc=new K,Kc=new te,Qc=new ue,eh=new J;var th={PI:3.141592653589793,DOUBLE_PI:6.283185307179586,HALF_PI:1.5707963267948966,QUARTER_PI:.7853981633974483,DEG2RAD:.017453292519943295,RAD2DEG:57.29577951308232,composeOrbitMatrix:function(e,t,n){const i=e.x,s=e.y,r=e.z,o=t.x,a=t.y,l=t.z,c=Math.sin(i),h=Math.cos(i),u=Math.sin(s),d=Math.cos(s),p=Math.sin(r),f=Math.cos(r),m=d*f,g=f*u*c-p*h,v=f*u*h+p*c,y=d*p,b=c*u*p+f*h,x=p*u*h-f*c,_=-u,w=d*c,S=d*h,M=(n=n||new te).elements;return M[0]=m,M[1]=y,M[2]=_,M[3]=0,M[4]=g,M[5]=b,M[6]=w,M[7]=0,M[8]=v,M[9]=x,M[10]=S,M[11]=0,M[12]=o*m+a*g+l*v,M[13]=o*y+a*b+l*x,M[14]=o*_+a*w+l*S,M[15]=1,n},decomposeOrbitMatrix:function(e,t,n){Qc.setFromRotationMatrix(e,"ZYX"),Qc.toVector3(t),Kc.copy(e).invert(),Yc.set(0,0,0,1),Yc.applyMatrix4(Kc),n.x=-Yc.x,n.y=-Yc.y,n.z=-Yc.z},isMatrix4Identity:function(e){const t=e.elements;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]},decomposeTransformMatrix:function(e,t,n,i){Kc.fromArray(e),Kc.decompose(Zc,eh,Jc),Qc.setFromQuaternion(eh,"XYZ"),Zc.toArray(t),Jc.toArray(i),Qc.toVector3(Zc),Yc.multiplyScalar(Le.RAD2DEG),Zc.toArray(n)}};const nh=new te,ih=new Ge,sh=new K,rh=new K;var oh,ah,lh;!function(e){e[e.Orbit=0]="Orbit",e[e.FirstPerson=1]="FirstPerson"}(oh||(oh={})),function(e){e[e.Off=0]="Off",e[e.Pan=1]="Pan",e[e.Orbit=2]="Orbit",e[e.Dolly=3]="Dolly",e[e.Zoom=4]="Zoom",e[e.PanDolly=5]="PanDolly",e[e.Roll=6]="Roll"}(ah||(ah={})),function(e){e[e.Off=0]="Off",e[e.Active=1]="Active",e[e.Release=2]="Release"}(lh||(lh={}));class ch{constructor(e){this.orbit=new K(0,0,0),this.offset=new K(0,0,50),this.minOrbit=new K(-90,-1/0,-1/0),this.maxOrbit=new K(90,1/0,1/0),this.minOffset=new K(-1/0,-1/0,.1),this.maxOffset=new K(1/0,1/0,1e3),this.orientationEnabled=!0,this.offsetEnabled=!0,this.mode=ah.Off,this.phase=lh.Off,this.prevPinchDist=0,this.deltaX=0,this.deltaY=0,this.deltaPinch=0,this.deltaWheel=0,this.viewportWidth=100,this.viewportHeight=100,this.camera=e}onPointer(e){if(e.isPrimary)if("pointer-down"===e.type)this.phase=lh.Active;else if("pointer-up"===e.type)return this.phase=lh.Release,!0;"pointer-down"===e.type&&(this.mode=this.getModeFromEvent(e));if(this.deltaX+=1*e.movementX,this.deltaY+=1*e.movementY,2===e.pointerCount){const t=e.activePositions,n=t[1].clientX-t[0].clientX,i=t[1].clientY-t[0].clientY,s=Math.sqrt(n*n+i*i),r=this.prevPinchDist||s;this.deltaPinch*=r>0?s/r:1,this.prevPinchDist=s}else this.deltaPinch=1,this.prevPinchDist=0;return!0}onTrigger(e){return"wheel"===e.type&&(this.deltaWheel+=Le.limit(e.wheel,-1,1),!0)}setViewportSize(e,t){this.viewportWidth=e,this.viewportHeight=t}updateController(e,t){const n=this.camera;e=e||n;const i=this.orbit,s=this.offset;th.decomposeOrbitMatrix(e.matrix,i,s),this.orbit.multiplyScalar(th.RAD2DEG),t&&(this.minOffset.min(s),this.maxOffset.max(s))}zoomExtents(e){const t=this.camera,n=this.offset;if(!t)return void console.warn("CameraController.zoomExtents - camera not set");sh.copy(this.orbit).multiplyScalar(Le.DEG2RAD),rh.setScalar(0),th.composeOrbitMatrix(sh,rh,nh),ih.copy(e).applyMatrix4(nh.transpose()),ih.getSize(sh),ih.getCenter(rh),n.x=rh.x,n.y=rh.y;const i=Math.max(sh.x/t.aspect,sh.y);if(t.isOrthographicCamera)n.z=1.1*i;else{const e=1/(2*Math.tan(t.fov*Le.DEG2RAD*.5));n.z=rh.z+i*e+.25*sh.z}this.maxOffset.z=Math.max(this.maxOffset.z,n.z+4*sh.z)}updateCamera(e,t){const n=this.camera;return e=e||n,!(!this.update()&&!t)&&(sh.copy(this.orbit).multiplyScalar(Le.DEG2RAD),rh.copy(this.offset),n.isOrthographicCamera&&(rh.z=this.maxOffset.z,n.size=this.offset.z,n.far=2*this.maxOffset.z,n.updateProjectionMatrix()),th.composeOrbitMatrix(sh,rh,e.matrix),e.matrixWorldNeedsUpdate=!0,!0)}update(){if(this.phase===lh.Off&&0===this.deltaWheel)return!1;if(0!==this.deltaWheel)return this.updatePose(0,0,.07*this.deltaWheel+1,0,0,0),this.deltaWheel=0,!0;if(this.phase===lh.Active)return(0!==this.deltaX||0!==this.deltaY||1!==this.deltaPinch)&&(this.updateByMode(),this.deltaX=0,this.deltaY=0,this.deltaPinch=1,!0);if(this.phase===lh.Release){this.deltaX*=.85,this.deltaY*=.85,this.deltaPinch=1,this.updateByMode();return Math.abs(this.deltaX)+Math.abs(this.deltaY)<.1&&(this.mode=ah.Off,this.phase=lh.Off),!0}return!1}updateByMode(){switch(this.mode){case ah.Orbit:this.updatePose(0,0,1,this.deltaY,this.deltaX,0);break;case ah.Pan:this.updatePose(this.deltaX,this.deltaY,1,0,0,0);break;case ah.Roll:this.updatePose(0,0,1,0,0,this.deltaX);break;case ah.Dolly:this.updatePose(0,0,.0075*this.deltaY+1,0,0,0);break;case ah.PanDolly:const e=.42*(this.deltaPinch-1)+1;this.updatePose(.75*this.deltaX,.75*this.deltaY,1/e,0,0,0)}}updatePose(e,t,n,i,s,r){const{orbit:o,minOrbit:a,maxOrbit:l,offset:c,minOffset:h,maxOffset:u}=this;if(this.orientationEnabled&&(o.x+=-1*i*220/this.viewportHeight,o.y+=-1*s*220/this.viewportHeight,o.z+=-1*r*220/this.viewportHeight,o.x=Le.limit(o.x,a.x,l.x),o.y=Le.limit(o.y,a.y,l.y),o.z=Le.limit(o.z,a.z,l.z)),this.offsetEnabled){const i=c.z=n*c.z;c.x+=e*i*-1/this.viewportHeight,c.y-=t*i*-1/this.viewportHeight,c.x=Le.limit(c.x,h.x,u.x),c.y=Le.limit(c.y,h.y,u.y),c.z=Le.limit(c.z,h.z,u.z)}}getModeFromEvent(e){if("mouse"===e.source){const t=e.originalEvent.button;if(0===t)return e.ctrlKey?ah.Pan:e.altKey?ah.Dolly:ah.Orbit;if(2===t)return e.altKey?ah.Roll:ah.Pan;if(1===t)return ah.Dolly}else if("touch"===e.source){const t=e.pointerCount;return 1===t?ah.Orbit:2===t?ah.PanDolly:ah.Pan}}}const hh=.5*Math.PI,uh=new Ge,dh=new K,ph=new K,fh=new K,mh=new te,gh=(new te,[new K(0,-hh,0),new K(0,hh,0),new K(-hh,0,0),new K(hh,0,0),new K(0,0,0),new K(0,Math.PI,0)]);var vh,yh,bh;!function(e){e[e.Perspective=0]="Perspective",e[e.Orthographic=1]="Orthographic"}(vh||(vh={})),function(e){e[e.None=-1]="None",e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Top=2]="Top",e[e.Bottom=3]="Bottom",e[e.Front=4]="Front",e[e.Back=5]="Back"}(yh||(yh={}));class xh extends ma{constructor(e){super(),this.isUniversalCamera=!0,this.fov=50,this.size=20,this.aspect=1,this.distance=20,this.zoom=1,this.near=.1,this.far=2e3,this.focus=10,this.filmGauge=35,this.filmOffset=0,this.view=null,this.setProjection(e)}setProjection(e){e===vh.Orthographic?(this.type="OrthographicCamera",this.isPerspectiveCamera=!1,this.isOrthographicCamera=!0):(this.type="PerspectiveCamera",this.isPerspectiveCamera=!0,this.isOrthographicCamera=!1),this.updateProjectionMatrix()}getProjection(){return this.isOrthographicCamera?vh.Orthographic:vh.Perspective}setPreset(e){e!==yh.None?(this.rotation.setFromVector3(gh[e],"XYZ"),this.position.set(0,0,this.distance).applyQuaternion(this.quaternion)):(this.rotation.set(0,0,0),this.position.set(0,0,0)),this.updateMatrix()}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Z.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Z.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Z.RAD2DEG*Math.atan(Math.tan(.5*Z.DEG2RAD*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,s,r){this.isPerspectiveCamera?xa.prototype.setViewOffset.call(this,e,t,n,i,s,r):va.prototype.setViewOffset.call(this,e,t,n,i,s,r)}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}zoomToView(){}moveToView(e){this.updateMatrixWorld(!1),uh.copy(e),mh.extractRotation(this.matrixWorldInverse),uh.applyMatrix4(mh),uh.getSize(dh),uh.getCenter(ph);const t=Math.max(dh.x/this.aspect,dh.y);fh.set(-ph.x,-ph.y,0),this.isPerspectiveCamera?fh.z=dh.z/(2*Math.tan(this.fov*Le.DEG2RAD*.5)):(this.size=.5*t,fh.z=2*dh.z,this.far=Math.max(this.far,2*fh.z)),mh.extractRotation(this.matrixWorld),fh.applyMatrix4(mh),this.matrix.decompose(this.position,this.quaternion,this.scale),this.position.copy(fh),this.updateMatrix()}updateProjectionMatrix(){const e=this.near,t=this.far,n=this.aspect,i=this.zoom,s=this.view;if(this.isOrthographicCamera){const r=this.size,o=r/(2*i),a=o*n;let l=-a,c=a,h=o,u=-o;if(s&&s.enabled){const e=i/(s.width/s.fullWidth),t=i/(s.height/s.fullHeight),o=r*n/s.width,a=r/s.height;l+=o*(s.offsetX/e),c=l+o*(s.width/e),h-=a*(s.offsetY/t),u=h-a*(s.height/t)}this.projectionMatrix.makeOrthographic(l,c,h,u,e,t)}else{let o=e*Math.tan(.5*Z.DEG2RAD*this.fov)/i,a=2*o,l=n*a,c=-.5*l;s&&s.enabled&&(c+=s.offsetX*l/s.fullWidth,o-=s.offsetY*a/s.fullHeight,l*=s.width/s.fullWidth,a*=s.height/s.fullHeight);var r=this.filmOffset;0!==r&&(c+=e*r/this.getFilmWidth()),this.projectionMatrix.makePerspective(c,c+l,o,o-a,e,t)}this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}copy(e,t){return super.copy(e,t),this.type=e.type,this.isOrthographicCamera=e.isOrthographicCamera,this.isPerspectiveCamera=e.isPerspectiveCamera,this.fov=e.fov,this.size=e.size,this.aspect=e.aspect,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this.view=e.view?Object.assign({},e.view):null,this}clone(){return(new this.constructor).copy(this)}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.size=this.size,t.object.aspect=this.aspect,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Top=2]="Top",e[e.Bottom=3]="Bottom",e[e.Front=4]="Front",e[e.Back=5]="Back",e[e.None=6]="None"}(bh||(bh={}));const _h=[];_h[bh.Left]=[0,-90,0],_h[bh.Right]=[0,90,0],_h[bh.Front]=[0,0,0],_h[bh.Back]=[0,180,0],_h[bh.Top]=[-90,0,0],_h[bh.Bottom]=[90,0,0];const wh=function(e,t){for(let n=0,i=e.length;n<i;++n)e[n]=null===e[n]?t:e[n];return e};class Sh extends eo{constructor(e,t){super(e,t),this.ins=this.addInputs(Sh.ins),this._controller=new ch,this._scene=null,this._modelBoundingBox=null,this._hasChanged=!1,this._scene=this.scene}get settingProperties(){return[this.ins.enabled,this.ins.orbit,this.ins.offset,this.ins.autoZoom,this.ins.autoRotation,this.ins.lightsFollowCamera,this.ins.minOrbit,this.ins.minOffset,this.ins.maxOrbit,this.ins.maxOffset]}get snapshotProperties(){return[this.ins.orbit,this.ins.offset]}get assetManager(){return this.getMainComponent(Ol)}get sceneNode(){return this.getSystemComponent(Hc)}create(){super.create(),this.system.on(["pointer-down","pointer-up","pointer-move"],this.onPointer,this),this.system.on("wheel",this.onTrigger,this),this.assetManager.outs.completed.on("value",this.onLoadingCompleted,this),this.sceneNode.outs.boundingBox.on("value",this.onBoundsUpdate,this)}dispose(){this.sceneNode.outs.boundingBox.off("value",this.onBoundsUpdate,this),this.assetManager.outs.completed.off("value",this.onLoadingCompleted,this),this.system.off(["pointer-down","pointer-up","pointer-move"],this.onPointer,this),this.system.off("wheel",this.onTrigger,this),super.dispose()}update(){const e=this.ins,t=this._controller,n=this._scene.activeCameraComponent,i=n?n.camera:null,{projection:s,preset:r,orbit:o,offset:a}=e;if(n&&s.changed&&(i.setProjection(s.getValidatedValue()),n.ins.projection.setValue(s.value,!0)),r.changed&&r.value!==bh.None&&o.setValue(_h[r.getValidatedValue()].slice()),i&&e.zoomExtents.changed){const e=this.getGraphComponent(Hc);this._modelBoundingBox=e.outs.boundingBox.value,t.zoomExtents(this._modelBoundingBox)}if(e.lightsFollowCamera.changed){const t=this.getLightTransform();t&&(e.lightsFollowCamera.value?(t.ins.order.setValue(je.ZXY),t.ins.rotation.reset(),t.ins.rotation.linkFrom(o,1,1)):(t.ins.rotation.unlinkFrom(o,1,1),t.ins.rotation.reset()))}const{minOrbit:l,minOffset:c,maxOrbit:h,maxOffset:u}=e;return(o.changed||a.changed)&&(t.orbit.fromArray(o.value),t.offset.fromArray(a.value)),(l.changed||c.changed||h.changed||u.changed)&&(t.minOrbit.fromArray(l.value),t.minOffset.fromArray(c.value),t.maxOrbit.fromArray(h.value),t.maxOffset.fromArray(u.value)),!0}tick(){const e=this.ins,t=this._scene.activeCameraComponent;if(!e.enabled.value||!t)return;const n=this._controller;n.camera=t.camera;const i=t.transform,s=this.changed;return!!n.updateCamera(i.object3D,s)&&(n.orbit.toArray(e.orbit.value),e.orbit.set(!0),n.offset.toArray(e.offset.value),e.offset.set(!0),e.preset.value===bh.None||e.preset.changed||e.preset.setValue(bh.None,!0),i?i.setPropertiesFromMatrix():t.setPropertiesFromMatrix(),!0)}preRender(e){this._modelBoundingBox&&e.viewport.zoomExtents(this._modelBoundingBox)}setChanged(e){this._hasChanged=e}tock(){return this._modelBoundingBox=null,!1}fromData(e){const t=(e=e||{}).orbit||{orbit:[-25,-25,0],offset:[0,0,100],minOrbit:[-90,-1/0,-1/0],minOffset:[-1/0,-1/0,.1],maxOrbit:[90,1/0,1/0],maxOffset:[1/0,1/0,1/0]};this.ins.copyValues({enabled:!!e.enabled,autoZoom:!!e.autoZoom,autoRotation:!!e.autoRotation,lightsFollowCamera:!!e.lightsFollowCamera,orbit:t.orbit,offset:t.offset,minOrbit:wh(t.minOrbit,-1/0),maxOrbit:wh(t.maxOrbit,1/0),minOffset:wh(t.minOffset,-1/0),maxOffset:wh(t.maxOffset,1/0)})}toData(){const e=this.ins,t={};return t.enabled=e.enabled.value,t.autoZoom=e.autoZoom.value,t.autoRotation=e.autoRotation.value,t.lightsFollowCamera=e.lightsFollowCamera.value,t.type="Orbit",t.orbit={orbit:e.orbit.cloneValue(),offset:e.offset.cloneValue(),minOrbit:e.minOrbit.cloneValue(),maxOrbit:e.maxOrbit.cloneValue(),minOffset:e.minOffset.cloneValue(),maxOffset:e.maxOffset.cloneValue()},t}getLightTransform(){const e=this.graph.findNodeByName("Lights");return e&&e.getComponent($e,!0)}onPointer(e){const t=e.viewport;t.camera||(this.ins.enabled.value&&this._scene.activeCameraComponent&&(this._controller.setViewportSize(t.width,t.height),this._controller.onPointer(e),e.stopPropagation=!0),this._hasChanged=!0)}onTrigger(e){const t=e.viewport;t.camera||(this.ins.enabled.value&&this._scene.activeCameraComponent&&(this._controller.setViewportSize(t.width,t.height),this._controller.onTrigger(e),e.stopPropagation=!0),this._hasChanged=!0)}onLoadingCompleted(e){this.ins.autoZoom.value&&!this._hasChanged&&this.ins.zoomExtents.set()}onBoundsUpdate(){this.ins.autoZoom.value&&this.ins.zoomExtents.set()}}var Mh;Sh.typeName="CVOrbitNavigation",Sh.text="Orbit Navigation",Sh.icon="",Sh.ins={enabled:C("Settings.Enabled",!0),preset:L("Camera.ViewPreset",bh,bh.None),projection:L("Camera.Projection",vh,vh.Perspective),lightsFollowCamera:C("Navigation.LightsFollowCam",!0),autoRotation:C("Navigation.AutoRotation",!1),zoomExtents:D("Settings.ZoomExtents"),autoZoom:C("Settings.AutoZoom",!0),orbit:w("Current.Orbit",[-25,-25,0]),offset:w("Current.Offset",[0,0,100]),minOrbit:w("Limits.Min.Orbit",[-90,-1/0,-1/0]),minOffset:w("Limits.Min.Offset",[-1/0,-1/0,.1]),maxOrbit:w("Limits.Max.Orbit",[90,1/0,1/0]),maxOffset:w("Limits.Max.Offset",[1/0,1/0,1/0])},function(e){e[e.Solid=0]="Solid",e[e.LinearGradient=1]="LinearGradient",e[e.RadialGradient=2]="RadialGradient"}(Mh||(Mh={}));class Eh extends On{constructor(){super(new Th,new Ch),this.frustumCulled=!1,this.renderOrder=-1/0,this.matrixAutoUpdate=!1}dispose(){this.geometry.dispose(),this.material.dispose()}updateMatrixWorld(e){}}class Th extends gn{constructor(){super();const e=new Da(new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),5);this.setIndex([0,1,2,0,2,3]),this.setAttribute("position",new ka(e,3,0,!1)),this.setAttribute("uv",new ka(e,2,3,!1))}}class Ch extends bc{constructor(){super(...arguments),this.depthTest=!1,this.depthWrite=!1,this.transparent=!1,this.uniforms={style:{value:Mh.LinearGradient},color0:{value:new K(.15,.2,.25)},color1:{value:new K(0,0,0)},noise:{value:.02}},this.vertexShader=["precision highp float;","attribute vec3 position;","attribute vec2 uv;","varying vec2 ndc;","void main() {","  ndc = position.xy;","  gl_Position = vec4(position, 1.0);","}"].join("\n"),this.fragmentShader=["precision highp float;","uniform vec3 color0;","uniform vec3 color1;","uniform float noise;","uniform int style;","varying vec2 ndc;","float rand(vec2 co) {","float dt = dot(co.xy ,vec2(12.9898, 78.233));","float sn = mod(dt, 3.14);","return fract(sin(sn) * 43758.5453);","}","void main() {","  float f = style == 0 ? 0.0 : (style == 1 ? ndc.y * 0.5 + 0.5 : length(ndc) * 0.707);","  gl_FragColor = vec4(mix(color0, color1, f) + noise * rand(ndc), 1.0);","}"].join("\n")}set style(e){this.uniforms.style.value=e}get style(){return this.uniforms.style.value}set color0(e){if(e instanceof Ht){const t=this.uniforms.color0.value;t.x=e.r,t.y=e.g,t.z=e.b}else this.uniforms.color0.value.copy(e)}get color0(){return this.uniforms.color0.value}set color1(e){if(e instanceof Ht){const t=this.uniforms.color1.value;t.x=e.r,t.y=e.g,t.z=e.b}else this.uniforms.color1.value.copy(e)}get color1(){return this.uniforms.color1.value}set noise(e){this.uniforms.noise.value=e}get noise(){return this.uniforms.noise.value}}class Ah extends eo{constructor(e,t){super(e,t),this.ins=this.addInputs(Ah.backgroundIns),this.object3D=new Eh}get background(){return this.object3D}update(e){super.update(e);const t=this.ins,n=this.background.material;return t.style.changed&&(n.style=t.style.getValidatedValue()),t.color0.changed&&n.color0.fromArray(t.color0.value),t.color1.changed&&n.color1.fromArray(t.color1.value),t.noise.changed&&(n.noise=t.noise.value),!0}dispose(){this.background.dispose(),super.dispose()}}Ah.typeName="CBackground",Ah.backgroundIns={style:L("Background.Style",Mh,Mh.RadialGradient),color0:T("Background.Color0",[.2,.25,.3]),color1:T("Background.Color1",[.01,.03,.05]),noise:b("Background.Noise",{min:0,max:1,bar:!0,preset:.02})};class Ph extends Ah{get settingProperties(){return[this.ins.style,this.ins.color0,this.ins.color1]}get snapshotProperties(){return[this.ins.color0,this.ins.color1]}hide(){this.background.visible=!1}show(){this.background.visible=!0}fromData(e){this.ins.copyValues({style:Mh[e.style]||Mh.Solid,color0:e.color0||[.2,.25,.3],color1:e.color1||[.01,.03,.05]})}toData(){const e=this.ins;return{style:Mh[e.style.value],color0:e.color0.cloneValue(),color1:e.color1.cloneValue()}}}Ph.typeName="CVBackground";const Lh=n(41).default,Rh=n(42).default;class Nh extends On{constructor(){super(new In(2,2,1,1),new Dh),this.geometry.rotateX(-90*Z.DEG2RAD),this.receiveShadow=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}class Dh extends Cl{constructor(e){super(e),this.defines={},this.type="FloorMaterial",this.isMeshPhongMaterial=!0,this.isFloorMaterial=!0,this.defines={},this.uniforms=Ur.merge([bo.phong.uniforms]),this.vertexShader=Rh,this.fragmentShader=Lh,this.transparent=!0,this.shininess=0}}class Oh extends eo{constructor(e,t){super(e,t),this.ins=this.addInputs(Oh.floorIns),this.object3D=new Nh}get floor(){return this.object3D}update(e){super.update(e);const t=this.ins,n=this.floor;return(t.position.changed||t.radius.changed)&&(n.position.fromArray(t.position.value),n.scale.setScalar(t.radius.value),n.updateMatrix()),t.color.changed&&n.material.color.fromArray(t.color.value),t.opacity.changed&&(n.material.opacity=t.opacity.value),!0}dispose(){this.floor.dispose(),super.dispose()}}Oh.typeName="CFloor",Oh.floorIns={position:w("Floor.Position",[0,-25,0]),radius:b("Floor.Radius",50),color:T("Floor.Color",[.6,.75,.8]),opacity:_("Floor.Opacity",.5),castShadow:C("Shadow.Cast"),receiveShadow:C("Shadow.Receive")};class kh extends Oh{constructor(e,t){super(e,t),this.ins.visible.setValue(!1),this.ins.receiveShadow.setValue(!0),this.floor.renderOrder=-1}get settingProperties(){return[this.ins.visible,this.ins.position,this.ins.radius,this.ins.color,this.ins.opacity,this.ins.receiveShadow]}get snapshotProperties(){return[this.ins.opacity]}fromData(e){e=e||{},this.ins.copyValues({visible:!!e.visible,position:e.position||[0,-25,0],radius:void 0!==e.size?e.size:50,color:e.color||[.6,.75,.8],opacity:void 0!==e.opacity?e.opacity:.5,receiveShadow:!!e.receiveShadow})}toData(){const e=this.ins;return{visible:e.visible.value,position:e.position.cloneValue(),size:e.radius.value,color:e.color.cloneValue(),opacity:e.opacity.value,receiveShadow:e.receiveShadow.value}}}kh.typeName="CVFloor",kh.text="Floor",kh.icon="";class Ih extends ss{constructor(e){super(Ih.generate(e),new Yi({color:4294967295,vertexColors:!0}))}set opacity(e){this.material.opacity=e,this.material.transparent=e<1}update(e){this.geometry&&this.geometry.dispose(),this.geometry=Ih.generate(e)}static generate(e){const t=new Ht(e.mainColor),n=new Ht(e.subColor),i=e.mainDivisions*e.subDivisions,s=e.size/i,r=.5*e.size,o=[],a=[];for(let l=0,c=0,h=-r;l<=i;++l,h+=s){o.push(-r,0,h,r,0,h),o.push(h,0,-r,h,0,r);const i=l%e.subDivisions==0?t:n;i.toArray(a,c),c+=3,i.toArray(a,c),c+=3,i.toArray(a,c),c+=3,i.toArray(a,c),c+=3}const l=new gn;return l.setAttribute("position",new on(o,3)),l.setAttribute("color",new on(a,3)),l}}const zh=new K,Uh=new K,Fh=(new te).makeRotationX(.5*Math.PI),Vh=new te;class Bh extends eo{constructor(){super(...arguments),this.ins=this.addInputs(Bh.gridIns),this.outs=this.addOutputs(Bh.gridOuts),this._lastViewport=null,this._gridProps={size:20,mainDivisions:2,subDivisions:10,mainColor:new Ht(.5,.7,.8),subColor:new Ht(.25,.35,.4)}}get settingProperties(){return[this.ins.visible,this.ins.color,this.ins.opacity]}get snapshotProperties(){return[this.ins.opacity]}get grid(){return this.object3D}create(){this.ins.pickable.setValue(!1),this.ins.visible.setValue(!1),super.create()}activate(){this.getGraphComponent(Hc).outs.boundingBox.linkTo(this.ins.boundingBox)}update(){const e=this.ins;if(e.color.changed||e.boundingBox.changed){const t=this._gridProps;if(e.color.changed){const n=t.mainColor,i=t.subColor;n.fromArray(e.color.value),i.r=.5*n.r,i.g=.5*n.g,i.b=.5*n.b}if(e.boundingBox.changed){const e=this.getGraphComponent(Hc),n=e.outs.boundingBox.value,i=e.ins.units.value;n.getSize(zh);let s=Math.max(zh.x,zh.y,zh.z),r=1;for(;s/r>5;)r*=10;s=Math.ceil(s/r)*r*2,t.size=s,this.outs.size.setValue(s),this.outs.units.setValue(i),t.mainDivisions=s/r,t.subDivisions=10,Uh.set(0,n.min.y,0)}this.object3D?this.grid.update(t):this.object3D=new Ih(t),e.boundingBox.changed&&(this.grid.position.copy(Uh),this.grid.updateMatrix())}return e.visible.changed&&(this.grid.visible=e.visible.value),e.opacity.changed&&(this.grid.opacity=e.opacity.value),!0}preRender(e){const t=e.viewport,n=this.object3D;if(t!==this._lastViewport){this._lastViewport=t;const i=e.viewport.camera;i?n.matrix.extractRotation(i.matrixWorld).multiply(Fh):n.matrix.extractRotation(Vh),n.updateMatrixWorld(!0)}}postRender(e){this.object3D.matrix.extractRotation(Vh)}fromData(e){e=e||{},this.ins.copyValues({visible:!!e.visible,color:e.color||[.5,.7,.8]})}toData(){const e=this.ins;return{visible:e.visible.cloneValue(),color:e.color.cloneValue()}}}Bh.typeName="CVGrid",Bh.text="Grid",Bh.icon="",Bh.gridIns={color:T("Grid.Color",[.5,.7,.8]),opacity:_("Grid.Opacity",1),boundingBox:N("Scene.BoundingBox",Ge)},Bh.gridOuts={size:b("Size"),units:L("Units",Fi)};class jh extends gn{constructor(e,t=12,n=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=Z.clamp(i,0,2*Math.PI);const s=[],r=[],o=[],a=1/t,l=new K,c=new gt;for(let s=0;s<=t;s++){const h=n+s*a*i,u=Math.sin(h),d=Math.cos(h);for(let n=0;n<=e.length-1;n++)l.x=e[n].x*u,l.y=e[n].y,l.z=e[n].x*d,r.push(l.x,l.y,l.z),c.x=s/t,c.y=n/(e.length-1),o.push(c.x,c.y)}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const i=t+n*e.length,r=i,o=i+e.length,a=i+e.length+1,l=i+1;s.push(r,o,l),s.push(o,a,l)}if(this.setIndex(s),this.setAttribute("position",new on(r,3)),this.setAttribute("uv",new on(o,2)),this.computeVertexNormals(),i===2*Math.PI){const n=this.attributes.normal.array,i=new K,s=new K,r=new K,o=t*e.length*3;for(let t=0,a=0;t<e.length;t++,a+=3)i.x=n[a+0],i.y=n[a+1],i.z=n[a+2],s.x=n[o+a+0],s.y=n[o+a+1],s.z=n[o+a+2],r.addVectors(i,s).normalize(),n[a+0]=n[o+a+0]=r.x,n[a+1]=n[o+a+1]=r.y,n[a+2]=n[o+a+2]=r.z}}}class $h extends Xi{constructor(){super();const e=new go({color:"white",metalness:1});e.transparent=!0;const t=new On(this.createLatheGeometry([0,0,.25,.4,.4,10]),e),n=new go({color:"#ffcd00",roughness:.8,metalness:.1});n.transparent=!0;const i=new On(this.createLatheGeometry([0,10,3.4,10,3.5,10.1,3.5,11,3.45,11.1,2.05,12.5,2,12.6,2,17.4,2.05,17.5,3.45,18.9,3.5,19,3.5,19.9,3.4,20,0,20]),n);t.matrixAutoUpdate=!1,this.add(t),i.matrixAutoUpdate=!1,this.add(i)}dispose(){}createLatheGeometry(e){const t=[];for(let n=0,i=e.length;n<i;n+=2)t.push(new gt(e[n],e[n+1]));return new jh(t,16)}}const Gh=new fe,Hh=new K,Wh=new K,qh=new K(0,1,0);var Xh;!function(e){e[e.SetStart=0]="SetStart",e[e.SetEnd=1]="SetEnd"}(Xh||(Xh={}));class Yh extends eo{constructor(e,t){super(e,t),this.ins=this.addInputs(Yh.tapeIns),this.outs=this.addOutputs(Yh.tapeOuts),this.startPin=null,this.endPin=null,this.line=null,this.object3D=new Xi,this.startPin=new $h,this.startPin.matrixAutoUpdate=!1,this.startPin.visible=!1,this.endPin=new $h,this.endPin.matrixAutoUpdate=!1,this.endPin.visible=!1;const n=[];n.push(new K(0,0,0)),n.push(new K(0,0,0));const i=(new gn).setFromPoints(n),s=new Yi;s.depthTest=!1,s.transparent=!0,this.line=new ts(i,s),this.line.visible=!1,this.object3D.add(this.startPin,this.endPin,this.line)}get settingProperties(){return[this.ins.visible]}get snapshotProperties(){return[this.ins.visible,this.ins.startPosition,this.ins.startDirection,this.ins.endPosition,this.ins.endDirection]}create(){super.create();const e=this.getGraphComponent(Hc);this.ins.boundingBox.linkFrom(e.outs.boundingBox),this.ins.globalUnits.linkFrom(e.ins.units)}update(e){super.update(e);const t=this.ins,n=this.line.geometry;if(t.boundingBox.changed&&t.boundingBox.value){t.boundingBox.value.getSize(Hh);const e=.5*Hh.length();this.startPin.scale.setScalar(.003*e),this.startPin.updateMatrix(),this.endPin.scale.setScalar(.003*e),this.endPin.updateMatrix()}if(t.visible.changed&&(t.visible.value?this.system.on("pointer-up",this.onPointerUp,this):this.system.off("pointer-up",this.onPointerUp,this)),t.globalUnits.changed&&this.updateUnitScale(),t.startPosition.changed||t.startDirection.changed){const e=this.startPin;e.position.fromArray(t.startPosition.value),Hh.fromArray(t.startDirection.value),e.quaternion.setFromUnitVectors(qh,Hh),e.updateMatrix();const i=n.attributes.position.array;i[0]=e.position.x,i[1]=e.position.y,i[2]=e.position.z,n.attributes.position.needsUpdate=!0}if(t.endPosition.changed||t.endDirection.changed){const e=this.endPin;e.position.fromArray(t.endPosition.value),Hh.fromArray(t.endDirection.value),e.quaternion.setFromUnitVectors(qh,Hh),e.updateMatrix();const i=n.attributes.position.array;i[3]=e.position.x,i[4]=e.position.y,i[5]=e.position.z,n.attributes.position.needsUpdate=!0}return Hh.fromArray(t.startPosition.value),Wh.fromArray(t.endPosition.value),this.outs.distance.setValue(Hh.distanceTo(Wh)),!0}fromData(e){this.ins.copyValues({visible:e.enabled,startPosition:e.startPosition,startDirection:e.startDirection,endPosition:e.endPosition,endDirection:e.endDirection})}toData(){const e=this.ins;return{enabled:e.visible.cloneValue(),startPosition:e.startPosition.cloneValue(),startDirection:e.startDirection.cloneValue(),endPosition:e.endPosition.cloneValue(),endDirection:e.endDirection.cloneValue()}}onPointerUp(e){if(e.isDragging||!e.component||!e.component.is($c))return;const t=e.object3D.matrixWorld;Gh.getNormalMatrix(t);const n=e.view.pickPosition(e).applyMatrix4(t),i=e.view.pickNormal(e).applyMatrix3(Gh).normalize(),{startPin:s,endPin:r,line:o,ins:a,outs:l}=this;l.state.value===Xh.SetStart?(n.toArray(a.startPosition.value),i.toArray(a.startDirection.value),a.startPosition.set(),a.startDirection.set(),s.visible=!0,r.visible=!1,o.visible=!1,l.state.setValue(Xh.SetEnd)):(n.toArray(a.endPosition.value),i.toArray(a.endDirection.value),a.endPosition.set(),a.endDirection.set(),s.visible=!0,r.visible=!0,o.visible=!0,l.state.setValue(Xh.SetStart))}updateUnitScale(){const e=this.ins,t=e.localUnits.getValidatedValue(),n=e.globalUnits.getValidatedValue();this.outs.unitScale.setValue(mo(t,n)),Hh.fromArray(e.startPosition.value),e.startPosition.setValue(Hh.multiplyScalar(this.outs.unitScale.value).toArray()),Hh.fromArray(e.endPosition.value),e.endPosition.setValue(Hh.multiplyScalar(this.outs.unitScale.value).toArray()),e.localUnits.setValue(n)}}Yh.typeName="CVTape",Yh.text="Tape",Yh.icon="",Yh.tapeIns={startPosition:w("Start.Position"),startDirection:w("Start.Direction"),endPosition:w("End.Position"),endDirection:w("End.Direction"),boundingBox:N("Scene.BoundingBox",Ge),globalUnits:L("Model.GlobalUnits",Fi,Fi.cm),localUnits:L("Model.LocalUnits",Fi,Fi.cm)},Yh.tapeOuts={state:L("Tape.State",Xh),distance:b("Tape.Distance"),unitScale:b("UnitScale",{preset:1,precision:5})};const Zh=[[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[1,0,0,0],[0,1,0,0],[0,0,1,0]];class Jh extends j{constructor(){super(...arguments),this.ins=this.addInputs(Jh.ins),this.plane=null,this.axisIndex=-1}get settingProperties(){return[this.ins.enabled]}get snapshotProperties(){return[this.ins.enabled,this.ins.axis,this.ins.position,this.ins.inverted]}create(){super.create();const e=this.getGraphComponent(Hc);this.ins.boundingBox.linkFrom(e.outs.boundingBox)}update(e){const t=this.ins;if(t.axis.changed){const e=t.axis.getValidatedValue();e===this.axisIndex?t.inverted.setValue(!t.inverted.value):(t.inverted.setValue(!1),this.axisIndex=e)}if(!t.enabled.value&&!t.enabled.changed)return!1;const n=t.axis.getValidatedValue(),i=t.inverted.value,s=n+(i?3:0),r=this.ins.boundingBox.value;if(!r)return!0;this.plane=Zh[s];const o=r.min.getComponent(n),a=r.max.getComponent(n),l=1-t.position.value;this.plane[3]=i?l*(a-o)-a:a-l*(a-o);return this.getGraphComponents($c).forEach(e=>{e.object3D.traverse(e=>{if(e.isMesh){const t=e.material;t.isUberPBRMaterial&&this.updateMaterial(t)}})}),!0}fromData(e){e=e||{},this.ins.setValues({enabled:e.enabled||!1,axis:Mo[e.axis]||Mo.X,position:e.position||0,inverted:e.inverted||!1})}toData(){const e=this.ins;return{enabled:e.enabled.value,axis:Mo[e.axis.getValidatedValue()],position:e.position.value,inverted:e.inverted.value}}updateMaterial(e){const t=this.ins;t.enabled.changed&&(e.enableCutPlane(t.enabled.value),e.needsUpdate=!0),e.cutPlaneDirection.fromArray(this.plane),e.cutPlaneColor.fromArray(t.color.value)}}Jh.typeName="CVSlicer",Jh.text="Slicer",Jh.icon="",Jh.ins={enabled:C("Slice.Enabled"),axis:L("Slice.Axis",Mo),position:b("Slice.Position",{min:0,max:1,preset:.5}),inverted:C("Slice.Inverted"),color:T("Slice.Color",[0,.61,.87]),boundingBox:N("Scene.BoundingBox",Ge)};const Kh=Math.PI,Qh=.5*Kh;var eu;!function(e){e[e.Linear=0]="Linear",e[e.EaseQuad=1]="EaseQuad",e[e.EaseInQuad=2]="EaseInQuad",e[e.EaseOutQuad=3]="EaseOutQuad",e[e.EaseCubic=4]="EaseCubic",e[e.EaseInCubic=5]="EaseInCubic",e[e.EaseOutCubic=6]="EaseOutCubic",e[e.EaseQuart=7]="EaseQuart",e[e.EaseInQuart=8]="EaseInQuart",e[e.EaseOutQuart=9]="EaseOutQuart",e[e.EaseQuint=10]="EaseQuint",e[e.EaseInQuint=11]="EaseInQuint",e[e.EaseOutQuint=12]="EaseOutQuint",e[e.EaseSine=13]="EaseSine",e[e.EaseInSine=14]="EaseInSine",e[e.EaseOutSine=15]="EaseOutSine"}(eu||(eu={}));const tu={Linear:function(e){return e},EaseQuad:function(e){return e<.5?2*e*e:(4-2*e)*e-1},EaseInQuad:function(e){return e*e},EaseOutQuad:function(e){return e*(2-e)},EaseCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},EaseInCubic:function(e){return e*e*e},EaseOutCubic:function(e){return--e*e*e+1},EaseQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},EaseInQuart:function(e){return e*e*e*e},EaseOutQuart:function(e){return 1- --e*e*e*e},EaseQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},EaseInQuint:function(e){return e*e*e*e*e},EaseOutQuint:function(e){return 1+--e*e*e*e*e},EaseSine:function(e){return-.5*(Math.cos(e*Kh)-1)},EaseInSine:function(e){return 1-Math.cos(e*Qh)},EaseOutSine:function(e){return Math.sin(e*Qh)}};class nu extends j{constructor(){super(...arguments),this.ins=this.addInputs(nu.ins),this.outs=this.addOutputs(nu.outs),this.targets=[],this.states={},this._currentValues=null,this._targetState=null,this._startTime=0,this._easingFunction=null}getState(e){return this.states[e]}setState(e){return e.id=e.id||k(6),this.states[e.id]=e,e.id}deleteState(e){delete this.states[e]}clear(){this.targets.forEach(e=>e.property.off("dispose",this.onPropertyDispose,this)),this.targets.length=0,this.states={},this._currentValues=null,this._targetState=null,this._startTime=0,this._easingFunction=null}dispose(){this.clear(),super.dispose()}tweenTo(e,t){const n=this.states[e],i=this.outs;if(n)return this._targetState=n,this._currentValues=this.getCurrentValues(),this._startTime=t,this._easingFunction=(s=n.curve,tu[eu[s]]),i.switched.setValue(!1),i.tweening.setValue(!0),i.start.set(),!0;var s}update(e){const t=this.ins,n=this.states,i=t.id.value,s=n[i];if(s){if((t.tween.changed||t.recall.changed)&&(t.curve.setValue(s.curve),t.duration.setValue(s.duration),t.threshold.setValue(s.threshold)),t.tween.changed)return this.tweenTo(i,e.secondsElapsed),!0;if(t.recall.changed)return this.setValues(s.values),!0;(t.curve.changed||t.duration.changed||t.threshold.changed)&&(s.curve=t.curve.value,s.duration=t.duration.value,s.threshold=t.threshold.value),t.store.changed&&(s.values=this.getCurrentValues()),t.delete.changed&&delete n[i]}else if(i&&t.store.changed){const e={id:this.ins.id.value,curve:this.ins.curve.getValidatedValue(),duration:this.ins.duration.value,threshold:this.ins.threshold.value,values:this.getCurrentValues()};n[e.id]=e}return!0}tick(e){const t=this._targetState;if(!t)return!1;const n=this.outs,i=this._currentValues,s=this._startTime,r=e.secondsElapsed-s,o=r/t.duration;if(o<1){const e=this._easingFunction(o),s=o>=t.threshold&&!n.switched.value;this.setValues(i,t.values,e,s),n.time.setValue(r),n.completed.setValue(o),s&&(n.switched.setValue(!0),n.switch.set())}else this.setValues(i,t.values,1,!n.switched.value),n.tweening.setValue(!1),n.time.setValue(t.duration),n.completed.setValue(1),n.end.set(),n.switched.value||n.switched.setValue(!0),this._currentValues=null,this._targetState=null,this._startTime=0,this._easingFunction=null;return!0}addTargetProperty(e){if("object"===e.type||e.schema.event)throw new Error("can't add object or event properties");if(this.getTarget(e))throw new Error("can't add, target already exists");e.on("dispose",this.onPropertyDispose,this);const t="number"===e.type&&!e.schema.options,n=e.isArray();this.targets.push({property:e,isNumber:t,isArray:n});const i=this.states,s=Object.keys(i);for(let t=0,n=s.length;t<n;++t)i[s[t]].values.push(e.cloneValue());this._currentValues&&this._currentValues.push(e.cloneValue())}removeTargetProperty(e){const t=this.getTarget(e);if(!t)throw new Error("can't remove, target doesn't exist");this.removeTarget(t)}hasTargetProperty(e){return!!this.getTarget(e)}fromJSON(e){super.fromJSON(e),e.state&&this.stateFromJSON(e.state)}stateFromJSON(e){e.targets&&(this.targets=e.targets.map(e=>{const t=this.getProperty(e.id,e.key);return{property:t,isNumber:!!t&&"number"===t.type&&!t.schema.options,isArray:!!t&&t.isArray()}})),e.states&&e.states.forEach(e=>this.states[e.id]=e),this._startTime=0}toJSON(){const e=super.toJSON(),t=this.stateToJSON();return t&&(e.state=t),e}stateToJSON(){const e={},t=this.targets;t.length>0&&(e.targets=t.map(e=>({id:e.property.group.linkable.id,key:e.property.key})));const n=Object.keys(this.states);return n.length>0&&(e.states=n.map(e=>this.states[e])),e}getTargetProperties(){return this.targets.map(e=>e.property)}onPropertyDispose(e){e.property.off("dispose",this.onPropertyDispose,this);const t=this.getTarget(e.property);this.removeTarget(t)}removeTarget(e){const t=this.targets.indexOf(e);this.targets.splice(t,1),this.removeChannel(t)}removeChannel(e){const t=this.states,n=Object.keys(t);for(let i=0,s=n.length;i<s;++i)t[n[i]].values.splice(e,1);this._currentValues&&this._currentValues.splice(e,1)}getTarget(e){return this.targets.find(t=>t.property===e)}getProperty(e,t){const n=this.system.components.getById(e);return n?n.ins[t]:null}setValues(e,t,n,i){const s=this.targets;for(let r=0,o=s.length;r<o;++r){const o=s[r],a=o.property;if(o.isNumber&&t){const i=e[r],s=t[r];if(o.isArray){let e=!1;for(let t=0,r=i.length;t<r;++t){const r=i[t]+n*(s[t]-i[t]);e=a.value[t]!==r||e,a.value[t]=r}e&&a.set()}else{const e=i+n*(s-i);e!==a.value&&a.setValue(e)}}else if(!t||i){const n=t?t[r]:e[r];if(o.isArray){let e=!1;for(let t=0,i=n.length;t<i;++t)e=a.value[t]!==n[t]||e,a.value[t]=n[t];e&&a.set()}else n!==a.value&&a.setValue(n)}}}getCurrentValues(){const e=[],t=this.targets;for(let n=0,i=t.length;n<i;++n)e.push(t[n].property.cloneValue());return e}}var iu;nu.typeName="CTweenMachine",nu.ins={id:A("Snapshot.Id"),curve:L("Tween.Curve",eu),duration:b("Tween.Duration",2),threshold:_("Tween.Threshold",.5),tween:D("Control.Tween"),recall:D("Control.Recall"),store:D("Control.Store"),delete:D("Control.Delete"),clear:D("Control.Clear")},nu.outs={count:x("Snapshots.Count"),tweening:C("Tween.IsTweening"),time:b("Tween.Time"),completed:_("Tween.Completed"),switched:C("Tween.Switched"),start:D("Tween.Start"),switch:D("Tween.Switch"),end:D("Tween.End")},function(e){e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High"}(iu||(iu={}));const su={[iu.Low]:512,[iu.Medium]:1024,[iu.High]:2048};class ru extends eo{constructor(){super(...arguments),this.ins=this.addInputs(ru.lightIns)}get light(){return this.object3D}update(e){super.update(e);const t=this.light,n=this.ins;if((n.color.changed||n.intensity.changed)&&(t.color.fromArray(n.color.value),t.intensity=n.intensity.value),(n.shadowEnabled.changed||n.shadowEnabled.value&&(n.shadowResolution.changed||n.shadowBlur.changed))&&(t.castShadow=n.shadowEnabled.value,t.shadow.radius=n.shadowBlur.value,n.shadowResolution.changed)){const e=su[n.shadowResolution.getValidatedValue()];t.shadow.mapSize.set(e,e),t.shadow.map=null}return!0}}ru.typeName="CLight",ru.lightIns={color:T("Light.Color"),intensity:b("Light.Intensity",1),shadowEnabled:C("Shadow.Enabled"),shadowResolution:L("Shadow.Resolution",iu,iu.Medium),shadowBlur:b("Shadow.Blur",1)};class ou extends nu{constructor(){super(...arguments),this.targetFeatures={}}create(){super.create();const e=this.getGraphComponent(lu);Object.keys(e.featureMap).forEach(e=>{this.targetFeatures[e]=!1}),this.targetFeatures.models=!1,this.targetFeatures.lights=!1,this.initializeTargetFeatures()}initializeTargetFeatures(){const e=this.targetFeatures;Object.keys(e).forEach(t=>e[t]=!1),e.navigation=!0,e.reader=!0,this.updateTargets()}updateTargets(){const e=this.targetFeatures,t=this.getGraphComponent(lu);Object.keys(e).forEach(n=>{const i=t[n],s=e[n];i&&this.updateComponentTarget(i,s)});this.getGraphComponents($c).forEach(t=>this.updateComponentTarget(t.transform,!!e.models));this.getGraphComponents(ru).forEach(t=>this.updateComponentTarget(t,!!e.lights))}updateComponentTarget(e,t){const n=e.snapshotProperties;n&&n.forEach(e=>{if(!e.schema.event&&"object"!==e.type){const n=this.hasTargetProperty(e);t&&!n?this.addTargetProperty(e):!t&&n&&this.removeTargetProperty(e)}})}fromData(e,t){this.clear();const n=this.targetFeatures,i=Object.keys(n);e.features?i.forEach(t=>n[t]=e.features.indexOf(t)>=0):this.initializeTargetFeatures();const s=new Set;e.targets.forEach((e,n)=>{const i=e.lastIndexOf("/"),r=e.substr(0,i),o=e.substr(i+1),a=t.get(r),l=a?a.ins[o]:null;l?this.addTargetProperty(l):(console.warn(`missing snapshot target property for '${e}'`),s.add(n))}),e.states.forEach(e=>{this.setState({id:e.id,curve:void 0!==e.curve?eu[e.curve]:eu.EaseQuad,duration:void 0!==e.duration?e.duration:2,threshold:void 0!==e.threshold?e.threshold:.5,values:e.values.filter((e,t)=>!s.has(t))})})}toData(e){const t=this.targetFeatures,n={features:Object.keys(t).filter(e=>t[e]),targets:this.targets.map(t=>{const n=t.property.group.linkable,i=t.property.key,s=e.get(n);if(!s)throw new Error(`snapshot path not registered for component '${n.displayName}'`);return s+"/"+i}),states:Object.keys(this.states).map(e=>{const t=this.states[e],n={id:t.id,values:t.values};return t.curve!==eu.EaseQuad&&(n.curve=eu[t.curve]),2!==t.duration&&(n.duration=t.duration),.5!==t.threshold&&(n.threshold=t.threshold),n})};return n.targets.length>0&&n.states.length>0?n:null}}ou.typeName="CVSnapshots";class au extends j{constructor(){super(...arguments),this.ins=this.addInputs(au.ins),this.outs=this.addOutputs(au.outs),this._tours=[]}get analytics(){return this.getMainComponent(Bl)}get language(){return this.getGraphComponent(Fl)}get snapshots(){return this.getComponent(ou)}get tours(){return this._tours}get activeSteps(){const e=this.activeTour;return e?e.steps:null}get activeTour(){return this._tours[this.outs.tourIndex.value]}get activeStep(){const e=this.activeTour;return e?e.steps[this.outs.stepIndex.value]:null}get title(){const e=this.activeTour;return 0===Object.keys(e.titles).length&&(e.titles.EN=e.title),e.titles[Vi[this.language.outs.language.value]]||"undefined"}set title(e){this.activeTour.titles[Vi[this.language.outs.language.value]]=e}get lead(){const e=this.activeTour;return 0===Object.keys(e.leads).length&&(e.leads.EN=e.lead),e.leads[Vi[this.language.outs.language.value]]||""}set lead(e){this.activeTour.leads[Vi[this.language.outs.language.value]]=e}get taglist(){const e=this.activeTour;return 0===Object.keys(e.taglist).length&&e.tags.length>0&&(e.taglist.EN=e.tags),e.taglist[Vi[this.language.outs.language.value]]||[]}set taglist(e){this.activeTour.taglist[Vi[this.language.outs.language.value]]=e}get stepTitle(){const e=this.activeStep;return e?(0===Object.keys(e.titles).length&&(e.titles.EN=e.title),e.titles[Vi[this.language.outs.language.value]]||"undefined"):null}set stepTitle(e){const t=this.activeStep;t&&(t.titles[Vi[this.language.outs.language.value]]=e)}create(){super.create(),this.language.outs.language.on("value",this.update,this)}dispose(){this.language.outs.language.off("value",this.update,this),super.dispose()}update(e){const{ins:t,outs:n}=this,i=this._tours,s=this.snapshots;if(t.enabled.changed){if(!t.enabled.value)return n.tourIndex.set(),s.tweenTo(au.sceneSnapshotId,e.secondsElapsed),s.deleteState(au.sceneSnapshotId),!0;{const e={id:au.sceneSnapshotId,curve:eu.EaseOutQuad,duration:1,threshold:0,values:s.getCurrentValues()};s.setState(e)}}const r=Math.min(i.length-1,Math.max(-1,t.tourIndex.value)),o=i[r],a=o?o.steps.length:0;n.stepCount.setValue(a);let l=-1;if((t.tourIndex.changed||t.enabled.changed)&&(r!==n.tourIndex.value&&(l=0),n.tourIndex.setValue(r),n.tourTitle.setValue(o?this.title:""),n.tourLead.setValue(o?this.lead:"")),0===a)return n.stepIndex.setValue(-1),n.stepTitle.setValue(""),!0;let c=!0;if(t.enabled.changed&&(l=n.stepIndex.value),t.stepIndex.changed&&(l=Math.min(o.steps.length-1,Math.max(0,t.stepIndex.value)),c=!1),t.first.changed&&(l=0),t.next.changed&&(l=n.stepIndex.value+1,l>=a&&(n.tourIndex.setValue(-1),n.tourTitle.setValue(""),n.tourLead.setValue(""),n.stepIndex.set(),l=-1)),t.previous.changed&&(l=(n.stepIndex.value+a-1)%a),l>=0){const e=o.steps[l];n.stepIndex.setValue(l),n.stepTitle.setValue(this.stepTitle||"undefined"),s.ins.id.setValue(e.id),c?s.ins.tween.set():s.ins.recall.set()}return!0}fromData(e){this._tours=e.map(e=>({title:e.title,titles:e.titles||{},steps:e.steps.map(e=>({title:e.title,titles:e.titles||{},id:e.id})),lead:e.lead||"",leads:e.leads||{},tags:e.tags||[],taglist:e.taglist||{}})),this._tours.forEach(e=>{Object.keys(e.titles).forEach(e=>{this.language.addLanguage(Vi[e])}),e.steps.forEach(e=>{0==Object.keys(e.titles).length&&(e.titles.EN=e.title||null)})}),this.ins.tourIndex.setValue(-1),this.outs.count.setValue(this._tours.length)}toData(){return 0===this._tours.length?null:this._tours.map(e=>{const t={steps:e.steps.map(e=>{const t={};return t.id=e.id,Object.keys(e.titles).length>0?t.titles=e.titles:e.title&&(t.title=e.title),t})};return Object.keys(e.titles).length>0?t.titles=e.titles:e.title&&(t.title=e.title),Object.keys(e.leads).length>0?t.leads=e.leads:e.lead&&(t.lead=e.lead),Object.keys(e.taglist).length>0?t.taglist=e.taglist:e.tags.length>0&&(t.tags=e.tags),t})}}au.typeName="CVTours",au.sceneSnapshotId="scene-default",au.ins={enabled:C("Tours.Enabled"),tourIndex:x("Tours.Index",-1),stepIndex:x("Step.Index"),next:D("Step.Next"),previous:D("Step.Previous"),first:D("Step.First")},au.outs={count:x("Tours.Count"),tourIndex:x("Tour.Index",-1),tourTitle:A("Tour.Title"),tourLead:A("Tour.Lead"),stepCount:x("Tour.Steps"),stepIndex:x("Step.Index"),stepTitle:A("Step.Title")};class lu extends j{get featureMap(){return this.constructor.featureMap}get transform(){return this.getComponent($e)}create(){super.create();const e=this.node,t=lu.featureMap;for(const n in t)this[n]=e.createComponent(t[n]);this.snapshots=e.createComponent(ou)}fromDocument(e,t,n){const i=e.scenes[t];if(!isFinite(i.setup))throw new Error("setup property missing in node");const s=e.setups[i.setup],r=lu.featureMap;for(const e in r){n.set(`scenes/${t}/setup/${e}`,this[e]);const i=s[e];i&&this[e].fromData(i)}s.snapshots&&this.snapshots.fromData(s.snapshots,n)}toDocument(e,t,n){let i=null;const s=lu.featureMap;for(const e in s){n.set(this[e],`scenes/${t}/setup/${e}`);const s=this[e].toData();s&&(i=i||{},i[e]=s)}const r=this.snapshots.toData(n);if(r&&(i=i||{},i.snapshots=r),i){e.setups=e.setups||[];const n=e.setups.length;e.setups.push(i),e.scenes[t].setup=n}}}lu.typeName="CVSetup",lu.featureMap={interface:qc,reader:jl,viewer:Xc,navigation:Sh,background:Ph,environment:Uc,language:Fl,floor:kh,grid:Bh,tape:Yh,slicer:Jh,tours:au};class cu extends Ut{constructor(e){super(),this.type="ShadowMaterial",this.color=new Ht(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}cu.prototype.isShadowMaterial=!0;class hu extends ba{constructor(e,t,n){super(),this.shadowMaterial=new cu,this.boundingBox=new Ge,this.size=new K,this.isAnimated=!1,this.needsUpdate=!1,this.intensity=0,this.castShadow=!0,this.frustumCulled=!1,this.floor=new On(new In,this.shadowMaterial),this.floor.rotateX(-Math.PI/2),this.floor.receiveShadow=!0,this.floor.castShadow=!1,this.floor.frustumCulled=!1,this.add(this.floor),this.shadow.camera.up.set(0,0,1),t.add(this),this.target=t,this.setModel(e,n)}setModel(e,t){this.boundingBox.copy(e.outs.boundingBox.value),e.outs.boundingBox.value.getSize(this.size);const{boundingBox:n,size:i}=this;if(this.isAnimated){const e=2*Math.max(i.x,i.y,i.z);i.y=e,n.expandByVector(i.subScalar(e).multiplyScalar(-.5)),n.max.y=n.min.y+e,i.set(e,e,e)}const s=.001*i.y;this.position.y=n.max.y+s,n.getCenter(this.floor.position),this.setSoftness(t)}setSoftness(e){const t=Math.pow(2,9-3*e);this.setMapSize(t)}setMapSize(e){const{camera:t,mapSize:n,map:i}=this.shadow,{size:s,boundingBox:r}=this;null!=i&&(i.dispose(),this.shadow.map=null),this.isAnimated&&(e*=2);const o=Math.floor(s.x>s.z?e:e*s.x/s.z),a=Math.floor(s.x>s.z?e*s.z/s.x:e);n.set(o,a);const l=2.5*s.x/o,c=2.5*s.z/a;t.left=-r.max.x-l,t.right=-r.min.x+l,t.bottom=r.min.z-c,t.top=r.max.z+c,this.setScaleAndOffset(t.zoom,0),this.shadow.updateMatrices(this),this.floor.scale.set(s.x+2*l,s.z+2*c,1),this.needsUpdate=!0}setIntensity(e){this.shadowMaterial.opacity=e,e>0?(this.visible=!0,this.floor.visible=!0):(this.visible=!1,this.floor.visible=!1)}getIntensity(){return this.shadowMaterial.opacity}setRotation(e){this.shadow.camera.up.set(Math.sin(e),0,Math.cos(e)),this.shadow.updateMatrices(this)}setScaleAndOffset(e,t){const n=this.size.y,i=1/e,s=.001*n;this.floor.position.y=2*s-n+t*i;const{camera:r}=this.shadow;r.zoom=e,r.near=0,r.far=n*e-t,r.projectionMatrix.makeOrthographic(r.left*e,r.right*e,r.top*e,r.bottom*e,r.near,r.far),r.projectionMatrixInverse.copy(r.projectionMatrix).invert()}dispose(){const{floor:e,shadowMaterial:t}=this;e.geometry.dispose(),t.dispose(),this.floor=null,this.shadowMaterial=null}}class uu extends ru{constructor(e,t){super(e,t),this.ins=this.addInputs(uu.dirLightIns),this.object3D=new ba,this.light.target.matrixAutoUpdate=!1}get light(){return this.object3D}update(e){super.update(e);const t=this.light,n=this.ins;if((n.position.changed||n.target.changed)&&(t.position.fromArray(n.position.value),t.target.position.fromArray(n.target.value),t.updateMatrix(),t.target.updateMatrix()),n.shadowSize.changed){const e=t.shadow.camera,i=.5*n.shadowSize.value;e.left=e.bottom=-i,e.right=e.top=i,e.updateProjectionMatrix()}return!0}onAddToParent(e){super.onAddToParent(e),e.add(this.light.target)}onRemoveFromParent(e){super.onRemoveFromParent(e),e.remove(this.light.target)}}uu.typeName="CDirectionalLight",uu.dirLightIns={position:w("Light.Position"),target:w("Light.Target",[0,-1,0]),shadowSize:b("Shadow.Size",100)};class du extends uu{get settingProperties(){return[this.ins.color,this.ins.intensity,this.ins.shadowEnabled,this.ins.shadowSize,this.ins.shadowResolution,this.ins.shadowBlur]}get snapshotProperties(){return[this.ins.color,this.ins.intensity]}fromDocument(e,t){if(!isFinite(t.light))throw new Error("light property missing in node");const n=e.lights[t.light],i=this.ins;if("directional"!==n.type)throw new Error("light type mismatch: not a directional light");return i.copyValues({color:void 0!==n.color?n.color:i.color.schema.preset,intensity:void 0!==n.intensity?n.intensity:i.intensity.schema.preset,position:i.position.schema.preset,target:i.target.schema.preset,shadowEnabled:n.shadowEnabled||!1,shadowSize:void 0!==n.shadowSize?n.shadowSize:i.shadowSize.schema.preset,shadowResolution:void 0!==n.shadowResolution?iu[n.shadowResolution]||0:i.shadowResolution.schema.preset,shadowBlur:void 0!==n.shadowBlur?n.shadowBlur:i.shadowBlur.schema.preset}),t.light}toDocument(e,t){const n=this.ins,i={color:n.color.cloneValue(),intensity:n.intensity.value,type:"directional"};n.shadowEnabled.value&&(i.shadowEnabled=!0,n.shadowSize.isDefault()||(i.shadowSize=n.shadowSize.value),n.shadowBlur.isDefault()||(i.shadowBlur=n.shadowBlur.value),n.shadowResolution.isDefault()||(i.shadowResolution=iu[n.shadowResolution.value])),e.lights=e.lights||[];const s=e.lights.length;return e.lights.push(i),s}}du.typeName="CVDirectionalLight",du.text="Directional Light",du.icon="bulb";var pu=function(e,t,n,i){return new(n||(n=Promise))((function(s,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function a(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}l((i=i.apply(e,t||[])).next())}))};const fu=new te,mu=new K,gu=new K,vu=new Ge,yu=new J;class bu extends j{constructor(){super(...arguments),this._shadowRoot=null,this.ins=this.addInputs(bu.ins),this.outs=this.addOutputs(bu.outs),this.arLink=document.createElement("a"),this.raycaster=new pt,this.initialHitTestSource=null,this.inputSource=null,this.transientHitTestSource=null,this.refSpace=null,this.frame=null,this.vScene=null,this.camera=null,this.cameraParent=null,this.cachedView=null,this.cachedQuality=null,this.cachedNearPlane=0,this.xrCamera=null,this.hitPlane=null,this.selectionRing=null,this.session=null,this.setup=null,this.originalUnits=null,this.isTranslating=!1,this.isRotating=!1,this.isScaling=!1,this.lastDragValueX=0,this.lastDragValueY=0,this.totalDrag=0,this.lastScale=0,this.lastHitPosition=new K,this.lastFrameTime=0,this.targetOpacity=0,this.modelFloorOffset=0,this.optimalCameraDistance=0,this.shadow=null,this.lightTransform=null,this.lightsToReset=[],this.featuresToReset=[],this.onSessionEnded=()=>{this.outs.isPresenting.setValue(!1);const e=this.renderer.views[0].renderer;this.resetScene();const t=this.initialHitTestSource;null!=t&&(t.cancel(),this.initialHitTestSource=null);const n=this.transientHitTestSource;null!=n&&(n.cancel(),this.transientHitTestSource=null),this.refSpace=null,this.frame=null,this.inputSource=null,this.xrCamera=null,this.cachedView=null;const i=this.session;i&&(i.removeEventListener("end",this.onSessionEnded),i.removeEventListener("selectstart",this.onSelectStart),i.removeEventListener("selectend",this.onSelectEnd),this.session=null),this.setup.reader.ins.enabled.off("value",this.endSession,this),e.setAnimationLoop(null),e.xr.enabled=!1,this.outs.isPlaced.setValue(!1),this.setup.navigation.ins.enabled.setValue(!0),this.renderer.views[0].render()},this.render=(e,t)=>{this.frame=t;const n=this.renderer.views[0].renderer,{camera:i,xrCamera:s}=this;if(!t||!t.getViewerPose(this.refSpace))return;if(!s&&this.session){const e=n.xr.getCamera(this.camera);return void(this.xrCamera=e.cameras[0])}if(s&&(i.position.setFromMatrixPosition(s.matrixWorld),s.projectionMatrixInverse.copy(s.projectionMatrix).invert(),i.projectionMatrix.fromArray(s.projectionMatrix.elements),i.projectionMatrixInverse.copy(s.projectionMatrix).invert()),null!=this.initialHitTestSource&&s){const e=this.vScene.scene,{position:t}=e,n=2*this.sceneNode.outs.boundingRadius.value+s.near,r=s.matrixWorld.elements;t.set(-r[8],-r[9],-r[10]).normalize(),t.multiplyScalar(n),t.add(i.position),vu.getCenter(mu),t.add(mu.negate()),e.updateMatrix(),e.updateMatrixWorld()}if(this.setInitialPosition(t),this.handleInput(t),this.outs.isPlaced.value){const t=e-this.lastFrameTime;this.updateOpacity(t,this.targetOpacity),this.lastFrameTime=e}const r=n.getContext();r.depthMask(!1),r.clear(r.DEPTH_BUFFER_BIT),r.depthMask(!0),n.render(this.vScene.scene,this.camera)},this.onSelectStart=e=>{const t=this.vScene.scene,n=this.transientHitTestSource;if(null==n)return;this.targetOpacity=.5;const i=this.frame.getHitTestResultsForTransientInput(n);if(1===i.length){this.inputSource=e.inputSource;const{axes:t}=this.inputSource.gamepad,n=this.raycaster;n.setFromCamera({x:t[0],y:-t[1]},this.xrCamera);const i=n.intersectObject(this.hitPlane);i.length>0?(this.isTranslating=!0,this.lastHitPosition.copy(i[0].point)):this.isRotating=!0,this.lastDragValueX=t[0],this.lastDragValueY=t[1]}else 2===i.length&&(this.isScaling=!0,this.lastScale=this.getFingerSeparation(i)/t.scale.x)},this.onSelectEnd=()=>{this.targetOpacity=0,this.totalDrag=0,this.isTranslating=!1,this.isRotating=!1,this.isScaling=!1,this.inputSource=null}}get renderer(){return this.getMainComponent(q)}get pulse(){return this.getMainComponent(G)}get sceneNode(){return this.getSystemComponent(Hc)}get analytics(){return this.system.getMainComponent(Bl)}get assetManager(){return this.getMainComponent(Ol)}get shadowRoot(){return this._shadowRoot}set shadowRoot(e){this._shadowRoot=e}update(){const{ins:e,outs:t}=this;if(e.enabled.changed){let n=e.enabled.value;n&&(Oi?(this.launchWebXR(),this.analytics.sendProperty("AR.Enabled","WebXR")):Ui?(this.launchSceneViewer(),this.analytics.sendProperty("AR.Enabled","SceneViewer")):Ii&&zi?(this.launchQuickLook(),this.analytics.sendProperty("AR.Enabled","QuickLook")):(n=!1,this.analytics.sendProperty("AR.Enabled","Unavailable"))),t.enabled.setValue(n)}return!0}launchWebXR(){const e=this.renderer.views[0].renderer,t=this.vScene=this.renderer.activeSceneComponent,n=this.camera=t.activeCamera;this.cameraParent=n.parent,console.log(this);if(!(this.setup=this.getSystemComponent(lu)))return!1;const i=this.sceneNode.getGraphComponents($c);(i[0]?i[0].derivatives.get(lo.Web3D,co.AR):null)&&(this.setup.navigation.setChanged(!0),this.cachedQuality=i[0].ins.quality.value,i.forEach(e=>{e.ins.quality.setValue(co.AR)}),e.setAnimationLoop((e,t)=>this.render(e,t)),navigator.xr.requestSession("immersive-ar",{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay"],domOverlay:{root:this.shadowRoot.querySelector("ff-viewport-overlay")}}).then(t=>this.onSessionStarted(e,t)))}onSessionStarted(e,t){return pu(this,void 0,void 0,(function*(){const n=this.renderer.views[0].renderer.getContext();yield n.makeXRCompatible(),t.updateRenderState({baseLayer:new XRWebGLLayer(t,n,{alpha:!0})}),this.setupScene(),e.xr.enabled=!0,e.xr.setReferenceSpaceType("local"),e.xr.setSession(t),t.addEventListener("end",this.onSessionEnded),this.refSpace=yield t.requestReferenceSpace("local");const i=yield t.requestReferenceSpace("viewer"),s=20*Math.PI/180,r=new XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(s),z:-Math.cos(s)});t.requestHitTestSource({space:i,offsetRay:r}).then(e=>{this.initialHitTestSource=e}),this.outs.isPresenting.setValue(!0),this.session=t,this.lastFrameTime=performance.now(),this.setup.reader.ins.enabled.on("value",this.endSession,this)}))}endSession(){this.session&&this.session.end()}setupScene(){const{cameraParent:e,setup:t,featuresToReset:n}=this,i=this.sceneNode;e&&e.remove(this.camera),this.setup.background.hide(),this.setup.navigation.ins.enabled.setValue(!1);const s=i.graph.findNodeByName("Lights");(this.lightTransform=s.getComponent($e,!0)).ins.rotation.reset(),n.push(t.floor.ins.visible.value?1:0),n.push(t.grid.ins.visible.value?1:0),n.push(t.tape.ins.visible.value?1:0),n.push(t.slicer.ins.enabled.value?1:0),n.push(t.viewer.ins.shader.value),t.floor.ins.visible.setValue(!1),t.grid.ins.visible.setValue(!1),t.tape.ins.visible.setValue(!1),t.slicer.ins.enabled.setValue(!1),t.viewer.ins.shader.value!==xo.Default&&t.viewer.ins.shader.setValue(xo.Default);(this.originalUnits=i.ins.units.getValidatedValue())!=Fi.m&&this.sceneNode.ins.units.setValue(Fi.m);i.getGraphComponents(Ic).forEach(e=>{e.setXRScale(2)});i.getGraphComponents(du).forEach(e=>{e.ins.shadowEnabled.value&&(e.ins.shadowEnabled.setValue(!1),this.lightsToReset.push(e))}),this.pulse.pulse(Date.now()),i.update(null);(this.shadow=new hu(this.sceneNode,this.vScene.scene,.5)).setIntensity(.3),vu.copy(this.sceneNode.outs.boundingBox.value),vu.getSize(mu),this.cachedNearPlane=this.camera.near,Math.max(mu.x,mu.y,mu.z)<.5&&(this.camera.near=.01)}resetScene(){const{camera:e,cameraParent:t,setup:n,featuresToReset:i}=this,s=this.vScene.scene;t&&t.add(e),e.position.set(0,0,0),e.rotation.set(0,0,0),e.near=this.cachedNearPlane,e.updateMatrix(),this.lightTransform.object3D.rotation.set(0,0,0),this.lightTransform.object3D.updateMatrix(),this.sceneNode.ins.units.setValue(this.originalUnits),s.position.setScalar(0),s.rotation.y=0,s.scale.setScalar(1),s.updateMatrix(),s.updateMatrixWorld(!0),i.reverse(),n.floor.ins.visible.setValue(!!i.pop()),n.grid.ins.visible.setValue(!!i.pop()),n.tape.ins.visible.setValue(!!i.pop()),n.slicer.ins.enabled.setValue(!!i.pop());const r=i.pop();r!==xo.Default&&n.viewer.ins.shader.setValue(r);this.sceneNode.getGraphComponents(Ic).forEach(e=>{e.setXRScale(1)}),this.lightsToReset.forEach(e=>{e.ins.shadowEnabled.setValue(!0)}),this.lightsToReset.length=0,n.background.show();this.sceneNode.getGraphComponents($c).forEach(e=>{e.ins.quality.setValue(this.cachedQuality)});const o=this.hitPlane;null!=o&&(s.remove(o),o.geometry.dispose(),o.material.dispose(),this.hitPlane=null);const a=this.selectionRing;null!=a&&(s.remove(a),a.geometry.dispose(),a.material.dispose(),this.selectionRing=null);const l=this.shadow;null!=l&&(s.remove(l),l.dispose(),this.shadow=null),e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix()}setInitialPosition(e){const t=this.initialHitTestSource;if(null==t)return;const n=e.getHitTestResults(t);if(0==n.length)return;const i=n[0],s=this.getHitPoint(i);if(null==s)return;this.placeModel(s),t.cancel(),this.initialHitTestSource=null;const{session:r}=e;r.addEventListener("selectstart",this.onSelectStart),r.addEventListener("selectend",this.onSelectEnd),r.requestHitTestSourceForTransientInput({profile:"generic-touchscreen"}).then(e=>{this.transientHitTestSource=e})}getHitPoint(e){const t=e.getPose(this.refSpace);if(null==t)return null;const n=fu.fromArray(t.transform.matrix);return n.elements[5]>.75?gu.setFromMatrixPosition(n):null}handleInput(e){const t=this.transientHitTestSource;if(null==t)return;if(!this.isTranslating&&!this.isScaling&&!this.isRotating)return;const n=e.getHitTestResultsForTransientInput(t),i=this.vScene.scene,s=i.scale.x;if(this.isScaling)if(n.length<2)this.isScaling=!1;else{const e=this.getFingerSeparation(n)/this.lastScale;i.scale.setScalar(e),i.position.y=this.lastHitPosition.y-this.modelFloorOffset*i.scale.y,i.updateMatrix(),i.updateMatrixWorld(),this.shadow.setScaleAndOffset(e,0),this.updateBoundingBox()}else{if(2===n.length)return this.isTranslating=!1,this.isRotating=!1,this.isScaling=!0,void(this.lastScale=this.getFingerSeparation(n)/s);if(this.isRotating){const e=this.inputSource.gamepad.axes[0];i.rotation.y+=1.5*(e-this.lastDragValueX),i.updateMatrix(),yu.copy(i.quaternion),yu.invert(),this.lightTransform.object3D.rotation.setFromQuaternion(yu),this.lightTransform.object3D.updateMatrix(),this.shadow.setRotation(i.rotation.y),this.lastDragValueX=e}else if(this.isTranslating){const e=this.inputSource.gamepad.axes,t=e[0]-this.lastDragValueX,s=e[1]-this.lastDragValueY;this.totalDrag+=Math.hypot(t,s),n.forEach(e=>{if(this.totalDrag<.01||e.inputSource!==this.inputSource||e.results.length<1)return;const t=this.getHitPoint(e.results[0]);null!=t&&(mu.copy(t),mu.sub(this.lastHitPosition),i.position.add(mu),i.updateMatrix(),i.updateMatrixWorld(),this.lastHitPosition.copy(t),this.updateBoundingBox())})}}}getFingerSeparation(e){const t=e[0].inputSource.gamepad.axes,n=e[1].inputSource.gamepad.axes,i=n[0]-t[0],s=n[1]-t[1];return Math.sqrt(i*i+s*s)}placeModel(e){const t=this.vScene.scene,{min:n,max:i}=vu,s=this.sceneNode.outs.boundingRadius.value,r=Math.max(1.25*(i.x-n.x),.15),o=Math.max(1.25*(i.z-n.z),.15),a=(n.x+i.x)/2,l=(n.z+i.z)/2;this.lastHitPosition.copy(e);const c=this.hitPlane=new On(new In(r,o),new Wt);c.position.set(a,n.y,l),c.rotation.set(-Math.PI/2,0,0),c.visible=!1,t.add(c);const h=new si,u=new si,d=r>o?.025*r:.025*o;this.roundedRect(h,-r/2,-o/2,r,o,.5*d),this.roundedRect(u,-r/2+d,-o/2+d,r-2*d,o-2*d,.4*d),h.holes.push(u);let p=new Di(h);const f=this.selectionRing=new On(p,new Wt({side:2,opacity:0}));f.position.set(a,n.y,l),f.rotation.set(-Math.PI/2,0,0),f.material.transparent=!0,f.visible=!1,t.add(f),this.modelFloorOffset=n.y,t.position.set(e.x,e.y-n.y,e.z),t.updateMatrix(),t.updateMatrixWorld(!0),this.updateBoundingBox(),this.pulse.pulse(Date.now());const m=this.camera.position.clone(),g=e.clone().sub(m);if(g.length()<s){const n=g.normalize();m.sub(n.multiplyScalar(1.5*s));const r=new dt(m,n.normalize()),o=new K;i.y+=10,r.intersectBox(this.sceneNode.outs.boundingBox.value,o),i.y-=10,null!=o&&(t.position.x+=e.x-o.x,t.position.z+=e.z-o.z,t.updateMatrix(),t.updateMatrixWorld(!0))}this.updateBoundingBox(),this.outs.isPlaced.setValue(!0)}launchSceneViewer(){const e=this.sceneNode.getGraphComponents($c),t=e.findIndex(e=>null!==e.derivatives.get(lo.App3D,co.AR)),n=t>-1?e[t].derivatives.get(lo.App3D,co.AR):null;if(n){const e=this.arLink,t=n.findAsset(ho.Model),i=`intent://arvr.google.com/scene-viewer/1.0?file=${this.assetManager.getAssetUrl(t.data.uri)}&mode=ar_only#Intent;scheme=https;package=com.google.ar.core;action=android.intent.action.VIEW;end;`;e.setAttribute("href",i),e.click()}}launchQuickLook(){const e=this.sceneNode.getGraphComponents($c),t=e.findIndex(e=>null!==e.derivatives.get(lo.iOSApp3D,co.AR)),n=t>-1?e[t].derivatives.get(lo.iOSApp3D,co.AR):null;if(n){const e=this.arLink,t=n.findAsset(ho.Model),i=this.assetManager.getAssetUrl(t.data.uri);e.setAttribute("rel","ar");const s=document.createElement("img");e.appendChild(s),e.setAttribute("href",i.toString()),e.click(),e.removeChild(s)}}updateBoundingBox(){this.sceneNode.ins.sceneTransformed.set()}updateOpacity(e,t){const n=this.selectionRing.material,i=n.opacity;if(t===i)return;const s=t-i;n.opacity=s>0?Math.min(i+.002*e,t):Math.max(i-.002*e,t),this.selectionRing.visible=n.opacity>0}roundedRect(e,t,n,i,s,r){e.moveTo(t,n+r),e.lineTo(t,n+s-r),e.quadraticCurveTo(t,n+s,t+r,n+s),e.lineTo(t+i-r,n+s),e.quadraticCurveTo(t+i,n+s,t+i,n+s-r),e.lineTo(t+i,n+r),e.quadraticCurveTo(t+i,n,t+i-r,n),e.lineTo(t+r,n),e.quadraticCurveTo(t,n,t,n+r)}}bu.typeName="CVARManager",bu.text="ARManager",bu.icon="",bu.isSystemSingleton=!0,bu.ins={enabled:C("State.Enabled")},bu.outs={enabled:C("State.Enabled"),available:C("State.Available",ki),isPlaced:C("AR.Placed",!1),isPresenting:C("AR.Presenting",!1)};var xu,_u,wu=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);if(n)return n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):""};class Su{constructor(e,t){this._args=e,this._props=t,this._args=e,this._state=null}get name(){return this._props.name||this._props.do.name.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())}do(){if(this._state)throw new Error("undo should be called before execute can be applied again");this._state=this._props.do.apply(this._props.target,this._args)}undo(){if(!this._props.undo)throw new Error("can't undo this command");if(!this._state)throw new Error("execute should be called before undo can be applied");this._props.undo.call(this._props.target,this._state),this._state=null}canDo(){return!this._props.canDo||this._props.canDo()}canUndo(){return!!this._props.undo}}class Mu extends o{constructor(e){super(),this.addEvent("update"),this.stack=[],this.pointer=-1,this.capacity=void 0!==e?e:Mu.defaultCapacity}register(e){let t;t="function"==typeof e?e:t=>new Su(t,e);return(...e)=>{const n=t(e);this.do(n)}}setCapacity(e){for(this.capacity=e;this.stack.length>e;)this.stack.shift(),this.pointer--;this.pointer<0&&(this.stack=[],this.pointer=-1)}do(e){console.log(`Commander.do - '${e.name}'`),e.do(),e.canUndo()&&(this.stack.splice(this.pointer+1),this.stack.push(e),this.stack.length>this.capacity&&this.stack.shift(),this.pointer=this.stack.length-1,this.emit("update"))}undo(){if(this.pointer>=0){this.stack[this.pointer].undo(),this.pointer--,this.emit("update")}}redo(){if(this.pointer<this.stack.length-1){this.pointer++;this.stack[this.pointer].do(),this.emit("update")}}clear(){this.stack.length>0&&(this.stack=[],this.pointer=-1,this.emit("update"))}canUndo(){return this.pointer>=0}canRedo(){return this.pointer<this.stack.length-1}getUndoText(){return this.pointer>=0?"Undo "+this.stack[this.pointer].name:"Can't Undo"}getRedoText(){return this.pointer<this.stack.length-1?"Redo "+this.stack[this.pointer+1].name:"Can't Redo"}}Mu.defaultCapacity=30;class Eu extends o{constructor(){super(),this._dict={},this.addEvent("type")}add(e){if(Array.isArray(e))return void e.forEach(e=>this.add(e));const t=e.typeName;if(!t)throw new Error("type must have a 'typeName' member");if(this._dict[t])throw new Error(`type '${t}' already registered`);this._dict[t]=e,this.emit({type:"type",add:!0,remove:!1,classType:e})}remove(e){if(Array.isArray(e))return void e.forEach(e=>this.remove(e));const t=e.typeName;if(!t)throw new Error("type must have a 'typeName' member");if(!this._dict[t])throw new Error(`type '${t}' not registered`);delete this._dict[t],this.emit({type:"type",add:!1,remove:!0,classType:e})}getType(e){let t=e;return"function"==typeof e?t=e.typeName:"object"==typeof e&&(t=e.constructor.typeName),this._dict[t]}createInstance(e,...t){const n=this.getType(e);if(!n)throw new Error(`type '${e}' not registered`);return new n(...t)}}class Tu extends o{constructor(e){super({knownEvents:!1}),this.nodes=new V(B),this.components=new V(j),this.registry=e||new Eu,this.graph=new Ne(this,null),this.graph.activate()}getComponent(e,t=!1){return this.components.get(e,t)}getComponents(e){return this.components.getArray(e)}getComponentsByTag(e){return this.components.getByTag(e)}hasComponents(e){return this.components.has(e)}getMainComponent(e,t=!1){return this.graph.components.get(e,t)}getMainComponents(e){return this.graph.components.getArray(e)}getMainComponentsByTag(e){return this.graph.components.getByTag(e)}hasMainComponents(e){return this.graph.components.has(e)}getNode(e,t=!1){return this.nodes.get(e,t)}getNodes(e){return this.nodes.getArray(e)}getNodesByTag(e){return this.nodes.getByTag(e)}hasNodes(e){return this.nodes.has(e)}getMainNode(e,t=!1){return this.graph.nodes.get(e,t)}getMainNodes(e){return this.graph.nodes.getArray(e)}getMainNodesByTag(e){return this.graph.nodes.getByTag(e)}hasMainNodes(e){return this.graph.nodes.has(e)}findNodeByName(e,t){const n=this.nodes.getArray(t);for(let t=0,i=n.length;t<i;++t)if(n[t].name===e)return n[t]}toJSON(){return this.graph.toJSON()}fromJSON(e){this.graph.clear(),this.graph.fromJSON(e)}toString(e=!1){const t=this.nodes.getArray(),n=this.components.count(),i=`System - ${t.length} nodes, ${n} components.`;return e?i+"\n"+t.map(e=>e.toString(!0)).join("\n"):i}_addNode(e){this.nodes.add(e)}_removeNode(e){this.nodes.remove(e)}_addNodeTag(e,t){this.nodes.addByTag(e,t)}_removeNodeTag(e,t){this.nodes.removeByTag(e,t)}_addComponent(e){if(e.isSystemSingleton&&this.components.has(e))throw new Error(`only one component of type '${e.typeName}' allowed per system`);this.components.add(e)}_removeComponent(e){this.components.remove(e)}_addComponentTag(e,t){this.components.addByTag(e,t)}_removeComponentTag(e,t){this.components.removeByTag(e,t)}}class Cu extends j{createActions(e){return{}}}Cu.typeName="CController",Cu.isSystemSingleton=!0;class Au extends Cu{constructor(e,t){super(e,t),this.outs=this.addOutputs(Au.selOuts),this.multiSelect=!1,this.exclusiveSelect=!0,this.selectedNodes=new V(B),this.selectedComponents=new V(j),this._activeGraph=null,this.addEvents("select-node","select-component","active-graph","update"),this.selectedNodes.on(B,e=>this.onSelectNode(e.object,e.add)),this.selectedComponents.on(j,e=>this.onSelectComponent(e.object,e.add)),this._activeGraph=this.system.graph}getSelectedNode(e){return this.selectedNodes.get(e,!0)}getSelectedNodes(e){return this.selectedNodes.getArray(e)}getSelectedComponent(e){return this.selectedComponents.get(e,!0)}getSelectedComponents(e){return this.selectedComponents.getArray(e)}get activeGraph(){return this._activeGraph}set activeGraph(e){if(e!==this.activeGraph){this.clearSelection();const t=this._activeGraph;this._activeGraph=e,this.onActiveGraph(e),this.emit({type:"active-graph",previous:t,next:e})}}hasParentGraph(){return this._activeGraph&&this._activeGraph.parent}activateParentGraph(){this._activeGraph&&this._activeGraph.parent.graph&&(this.activeGraph=this._activeGraph.parent.graph)}hasChildGraph(){return this.selectedComponents.has(De)}activateChildGraph(){const e=this.selectedComponents.get(De,!0);e&&(this.activeGraph=e.innerGraph)}create(){super.create(),this.system.nodes.on(B,this.onSystemNode,this),this.system.components.on(j,this.onSystemComponent,this)}dispose(){this.system.nodes.off(B,this.onSystemNode,this),this.system.components.off(j,this.onSystemComponent,this),super.dispose()}createActions(e){return{selectNode:e.register({name:"Select Node",do:this.selectNode,target:this}),selectComponent:e.register({name:"Select Component",do:this.selectComponent,target:this}),clearSelection:e.register({name:"Clear Selection",do:this.clearSelection,target:this})}}nodeContainsSelectedComponent(e){const t=e.components.getArray();for(let e=0,n=t.length;e<n;++e)if(this.selectedComponents.contains(t[e]))return!0;return!1}selectNode(e,t=!1){this.activeGraph=e.graph;const n=this.selectedNodes,i=this.multiSelect&&t;e&&n.contains(e)?i&&n.remove(e):(this.exclusiveSelect&&this.selectedComponents.clear(),i||n.clear(),e&&n.add(e)),this.updateStats()}selectComponent(e,t=!1){this.activeGraph=e.graph;const n=this.selectedComponents,i=this.multiSelect&&t;e&&n.contains(e)?i&&n.remove(e):(this.exclusiveSelect&&this.selectedNodes.clear(),i||n.clear(),e&&n.add(e)),this.updateStats()}clearSelection(){this.selectedNodes.clear(),this.selectedComponents.clear(),this.updateStats()}onSelectNode(e,t){}onSelectComponent(e,t){}onActiveGraph(e){}onSystemNode(e){e.remove&&this.selectedNodes.contains(e.object)&&(this.selectedNodes.remove(e.object),this.updateStats())}onSystemComponent(e){e.remove&&this.selectedComponents.contains(e.object)&&(this.selectedComponents.remove(e.object),this.updateStats())}updateStats(){const e=this.outs;e.selNodeCount.setValue(this.selectedNodes.length),e.selComponentCount.setValue(this.selectedComponents.length)}}Au.typeName="CSelection",Au.selOuts={selNodeCount:x("Selection.Nodes"),selComponentCount:x("Selection.Components")},function(e){e[e.Node=0]="Node",e[e.Graph=1]="Graph",e[e.Main=2]="Main",e[e.System=3]="System"}(xu||(xu={}));class Pu extends j{constructor(){super(...arguments),this._scope=xu.Node,this._scopedNode=null,this._scopedGraph=null,this._activeComponent=null}get componentType(){return this.constructor.componentType}get followComponentSelection(){return this.constructor.followComponentSelection}get followNodeSelection(){return this.constructor.followNodeSelection}get retainSelection(){return this.constructor.retainSelection}get scope(){return this._scope}set scope(e){this._scope=e,this._activeComponent&&!this.isComponentInScope(this._activeComponent)&&(this.activeComponent=null)}get scopedNode(){return this._scopedNode}set scopedNode(e){e!==this._scopedNode&&(this._scopedNode=e,this._activeComponent&&!this.isComponentInScope(this._activeComponent)&&(this.activeComponent=null),this.onScopedComponents(),this.emit({type:"scoped-components"}))}get scopedGraph(){return this._scopedGraph}set scopedGraph(e){e!==this._scopedGraph&&(this._scopedGraph=e,this._activeComponent&&!this.isComponentInScope(this._activeComponent)&&(this.activeComponent=null),this.onScopedComponents(),this.emit({type:"scoped-components"}))}get scopedComponents(){switch(this._scope){case xu.Node:return(this._scopedNode||this.node).getComponents(this.componentType);case xu.Graph:return(this._scopedGraph?this._scopedGraph.innerGraph:this.graph).getComponents(this.componentType);case xu.Main:return this.getMainComponents(this.componentType);case xu.System:return this.getSystemComponents(this.componentType)}}get activeComponent(){return this._activeComponent}set activeComponent(e){const t=this.activeComponent;if(e!==t){if(t&&this.deactivateComponent(t),e){if(!this.isComponentInScope(e))throw new Error("can't activate, component out of scope");this.activateComponent(e)}this._activeComponent=e,this.onActiveComponent(t,e),this.emit({type:"active-component",previous:t,next:e})}}get selection(){return this.getSystemComponent(Au)}create(){super.create(),this.system.components.on(j,this.onComponent,this),this.followComponentSelection&&this.selection.selectedComponents.on(this.componentType,this.onSelectComponent,this),this.followNodeSelection&&this.selection.selectedNodes.on(B,this.onSelectNode,this)}dispose(){this.activeComponent&&(this.activeComponent=null),this.system.components.off(j,this.onComponent,this),this.followComponentSelection&&this.selection.selectedComponents.off(this.componentType,this.onSelectComponent,this),this.followNodeSelection&&this.selection.selectedNodes.off(B,this.onSelectNode,this),super.dispose()}activateComponent(e){}deactivateComponent(e){}onActiveComponent(e,t){}onScopedComponents(){}onComponent(e){e.remove&&e.object===this.activeComponent&&(this.activeComponent=null),this.isComponentInScope(e.object)&&(this.onScopedComponents(),this.emit({type:"scoped-components"}))}onSelectComponent(e){const t=e.object;this.isComponentInScope(t)&&(e.add?this.activeComponent=t:e.remove&&!this.retainSelection&&t===this.activeComponent&&(this.activeComponent=null))}onSelectNode(e){const t=e.object;if(this.isNodeInScope(t)){const n=t.getComponent(this.componentType);n&&this.onSelectComponent({type:n.typeName,object:n,add:e.add,remove:e.remove})}}isComponentInScope(e){if(!e.is(this.componentType))return!1;switch(this._scope){case xu.Node:const t=this._scopedNode||this.node;return e.node===t;case xu.Graph:const n=this._scopedGraph?this._scopedGraph.innerGraph:this.graph;return e.graph===n;case xu.Main:return e.graph===this.system.graph;case xu.System:return!0}return!1}isNodeInScope(e){switch(this._scope){case xu.Node:return e===(this._scopedNode||this.node);case xu.Graph:const t=this._scopedGraph?this._scopedGraph.innerGraph:this.graph;return e.graph===t;case xu.Main:return e.graph===this.system.graph;case xu.System:return!0}}}Pu.typeName="CComponentProvider",Pu.componentType=j,Pu.followComponentSelection=!0,Pu.followNodeSelection=!1,Pu.retainSelection=!0,function(e){e[e.Graph=0]="Graph",e[e.Main=1]="Main",e[e.System=2]="System"}(_u||(_u={}));class Lu extends j{constructor(){super(...arguments),this._scope=_u.Graph,this._scopedGraph=null,this._activeNode=null}get nodeType(){return this.constructor.nodeType}get followNodeSelection(){return this.constructor.followNodeSelection}get followComponentSelection(){return this.constructor.followComponentSelection}get retainSelection(){return this.constructor.retainSelection}get scope(){return this._scope}set scope(e){this._scope=e,this._activeNode&&!this.isNodeInScope(this._activeNode)&&(this.activeNode=null)}get scopedGraph(){return this._scopedGraph}set scopedGraph(e){e!==this._scopedGraph&&(this._scopedGraph=e,this._activeNode&&!this.isNodeInScope(this._activeNode)&&(this.activeNode=null),this.onScopedNodes(),this.emit({type:"scoped-nodes"}))}get scopedNodes(){switch(this._scope){case _u.Graph:return(this._scopedGraph?this._scopedGraph.innerGraph:this.graph).getNodes(this.nodeType);case _u.Main:return this.getMainNodes(this.nodeType);case _u.System:return this.getSystemNodes(this.nodeType)}}get activeNode(){return this._activeNode}set activeNode(e){const t=this.activeNode;if(e!==t){if(t&&this.deactivateNode(t),e){if(!this.isNodeInScope(e))throw new Error("can't activate, node out of scope");this.activateNode(e)}this._activeNode=e,this.onActiveNode(t,e),this.emit({type:"active-node",previous:t,next:e})}}get selection(){return this.getSystemComponent(Au)}create(){super.create(),this.system.nodes.on(B,this.onNode,this),this.followNodeSelection&&this.selection.selectedNodes.on(this.nodeType,this.onSelectNode,this),this.followComponentSelection&&this.selection.selectedComponents.on(j,this.onSelectComponent,this)}dispose(){this.activeNode&&(this.activeNode=null),this.system.nodes.off(B,this.onNode,this),this.followNodeSelection&&this.selection.selectedNodes.off(this.nodeType,this.onSelectNode,this),this.followComponentSelection&&this.selection.selectedComponents.off(j,this.onSelectComponent,this),super.dispose()}activateNode(e){}deactivateNode(e){}onActiveNode(e,t){}onScopedNodes(){}onNode(e){e.remove&&e.object===this.activeNode&&(this.activeNode=null),this.isNodeInScope(e.object)&&(this.onScopedNodes(),this.emit({type:"scoped-nodes"}))}onSelectNode(e){const t=e.object;this.isNodeInScope(t)&&(e.add?this.activeNode=t:e.remove&&!this.retainSelection&&t===this.activeNode&&(this.activeNode=null))}onSelectComponent(e){const t=e.object.node;t.is(this.nodeType)&&this.onSelectNode({type:t.typeName,object:t,add:e.add,remove:e.remove})}isNodeInScope(e){if(!e.is(this.nodeType))return!1;switch(this._scope){case _u.Graph:const t=this._scopedGraph?this._scopedGraph.innerGraph:this.graph;return e.graph===t;case _u.Main:return e.graph===this.system.graph;case _u.System:return!0}return!1}}Lu.typeName="CNodeProvider",Lu.nodeType=B,Lu.followNodeSelection=!0,Lu.followComponentSelection=!1,Lu.retainSelection=!0;const Ru=new K,Nu=new te;class Du extends ss{constructor(e,t){t=Object.assign({},Du.defaultProps,t);const n=new Ge;n.makeEmpty(),ao(e,n);const i=t.length,s=[n.min.x,n.min.y,n.min.z],r=[n.max.x,n.max.y,n.max.z],o=[(r[0]-s[0])*i,(r[1]-s[1])*i,(r[2]-s[2])*i];let a;a=isFinite(o[0])&&isFinite(o[1])&&isFinite(o[2])?[s[0],s[1],s[2],s[0]+o[0],s[1],s[2],s[0],s[1],s[2],s[0],s[1]+o[1],s[2],s[0],s[1],s[2],s[0],s[1],s[2]+o[2],r[0],s[1],s[2],r[0]-o[0],s[1],s[2],r[0],s[1],s[2],r[0],s[1]+o[1],s[2],r[0],s[1],s[2],r[0],s[1],s[2]+o[2],s[0],r[1],s[2],s[0]+o[0],r[1],s[2],s[0],r[1],s[2],s[0],r[1]-o[1],s[2],s[0],r[1],s[2],s[0],r[1],s[2]+o[2],s[0],s[1],r[2],s[0]+o[0],s[1],r[2],s[0],s[1],r[2],s[0],s[1]+o[1],r[2],s[0],s[1],r[2],s[0],s[1],r[2]-o[2],s[0],r[1],r[2],s[0]+o[0],r[1],r[2],s[0],r[1],r[2],s[0],r[1]-o[1],r[2],s[0],r[1],r[2],s[0],r[1],r[2]-o[2],r[0],s[1],r[2],r[0]-o[0],s[1],r[2],r[0],s[1],r[2],r[0],s[1]+o[1],r[2],r[0],s[1],r[2],r[0],s[1],r[2]-o[2],r[0],r[1],s[2],r[0]-o[0],r[1],s[2],r[0],r[1],s[2],r[0],r[1]-o[1],s[2],r[0],r[1],s[2],r[0],r[1],s[2]+o[2],r[0],r[1],r[2],r[0]-o[0],r[1],r[2],r[0],r[1],r[2],r[0],r[1]-o[1],r[2],r[0],r[1],r[2],r[0],r[1],r[2]-o[2]]:[-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1,0,0,1];const l=new gn;l.setAttribute("position",new on(a,3));super(l,new Yi({color:t.color,depthTest:!1})),this.renderOrder=1,this.onBeforeRender=()=>{e.updateMatrixWorld(!1),this.matrixWorld.copy(e.matrixWorld)}}dispose(){this.parent&&this.parent.remove(this),this.geometry.dispose()}static expandBoundingBox(e,t,n){const i=e.geometry;if(void 0!==i){let s=e;for(Nu.identity();s&&s!==t;)Nu.premultiply(s.matrix),s=s.parent;if(i.isGeometry){const e=i.vertices;for(let t=0,i=e.length;t<i;++t)Ru.copy(e[t]).applyMatrix4(Nu),n.expandByPoint(Ru)}else if(i.isBufferGeometry){const e=i.attributes.position;if(void 0!==e)for(let t=0,i=e.count;t<i;++t)Ru.fromBufferAttribute(e,t).applyMatrix4(Nu),n.expandByPoint(Ru)}}const s=e.children;for(let e=0,i=s.length;e<i;++e)Du.expandBoundingBox(s[e],t,n)}}Du.defaultProps={color:new Ht("#ffd633"),length:.25};const Ou={viewportPicking:C("Viewport.Picking",!0),viewportBrackets:C("Viewport.Brackets",!0)};class ku extends Au{constructor(){super(...arguments),this.ins=this.addInputs(Ou),this._brackets=new Map,this._sceneTracker=null}create(){super.create(),this.system.on("pointer-up",this.onPointerUp,this),this._sceneTracker=new z(this.system.components,Kr,e=>{e.on("after-render",this.onSceneAfterRender,this)},e=>{e.off("after-render",this.onSceneAfterRender,this)})}dispose(){this._sceneTracker.dispose(),this.system.off("pointer-up",this.onPointerUp,this),this._sceneTracker.dispose(),super.dispose()}update(){return!0}onSelectNode(e,t){super.onSelectNode(e,t);const n=e.getComponent($e,!0);n&&this.updateBracket(n,t)}onSelectComponent(e,t){super.onSelectComponent(e,t),(e instanceof eo||e instanceof $e)&&this.updateBracket(e,t)}onPointerUp(e){this.ins.viewportPicking.value&&e.isPrimary&&!e.isDragging&&(e.component?this.selectComponent(e.component,e.ctrlKey):e.ctrlKey||this.clearSelection())}onSceneAfterRender(e){if(!this.ins.viewportBrackets.value)return;const t=e.context.renderer,n=e.context.camera;for(let e of this._brackets)t.render(e[1],n)}updateBracket(e,t){if(e){if(t){if(e.object3D){const t=new Du(e.object3D);this._brackets.set(e,t)}}else{const t=this._brackets.get(e);t&&(this._brackets.delete(e),t.dispose())}this.changed=!0}}}ku.typeName="CPickSelection";const Iu=function(e,t){const n=document.createElement("a");n.download=t,n.href=e,document.body.appendChild(n),n.click(),document.body.removeChild(n)};var zu=function(e,t){"object"==typeof e&&(e=JSON.stringify(e));const n=window.URL.createObjectURL(new Blob([e],{type:"text/json"}));Iu(n,t)};class Uu extends De{constructor(e,t){super(e,t),this.ins=this.addInputs(Uu.rgIns),this._object3D=null,this._isAttached=!1,this._object3D=new Ae,this._object3D.matrixAutoUpdate=!1}get transform(){return this.node.components.get($e,!0)}get scene(){const e=this.transform;return e?e.getParentComponent(Kr,!0):void 0}get object3D(){return this._object3D}create(){super.create(),this.innerRoots.filter(e=>e.is($e)).forEach(e=>this._object3D.add(e.object3D)),this.trackComponent($e,e=>this.ins.visible.value&&this.attachObject3D(e),e=>this.detachObject3D(e))}dispose(){this.detachObject3D(this.transform),this.innerRoots.filter(e=>e.is($e)).forEach(e=>this._object3D.remove(e.object3D)),super.dispose()}update(e){super.update(e);const t=this.ins;if(t.visible.changed){const e=this.transform;t.visible.value?this.attachObject3D(e):this.detachObject3D(e)}return!0}onAddInnerRoot(e){e.is($e)&&this._object3D.add(e.object3D)}onRemoveInnerRoot(e){e.is($e)&&this._object3D.remove(e.object3D)}attachObject3D(e){this._isAttached||e&&(e.object3D.add(this._object3D),this._isAttached=!0)}detachObject3D(e){this._isAttached&&e&&(e.object3D.remove(this._object3D),this._isAttached=!1)}}Uu.typeName="CRenderGraph",Uu.rgIns={visible:C("Graph.Visible",!0)};var Fu=n(20),Vu=n.n(Fu),Bu=n(21),ju=n(22),$u=n(23),Gu=n(24),Hu=n(25);const Wu=new K,qu=new K,Xu=new ue,Yu=new J;class Zu extends eo{constructor(e,t){super(e,t),this.ins=this.addInputs(Zu.camIns),this.object3D=new xh}get camera(){return this.object3D}update(){const{autoActivate:e,activate:t}=this.ins;if(t.changed||e.changed&&e.value){const e=this.scene;e&&(e.activeCameraComponent=this)}const n=this.camera,{position:i,rotation:s,projection:r,fov:o,size:a,zoom:l,near:c,far:h}=this.ins;return(i.changed||s.changed)&&(n.position.fromArray(i.value),n.rotation.fromArray(s.value),n.updateMatrix()),r.changed&&n.setProjection(r.getValidatedValue()),n.fov=o.value,n.size=a.value,n.zoom=l.value,n.near=c.value,n.far=h.value,n.updateProjectionMatrix(),!0}dispose(){const e=this.scene;e&&e.activeCameraComponent===this&&(e.activeCameraComponent=null),super.dispose()}setPropertiesFromMatrix(e){const t=!e;e=e||this.object3D.matrix;const{position:n,rotation:i,order:s}=this.ins;e.decompose(Wu,Yu,qu),Wu.toArray(n.value);const r=s.getOptionText();Xu.setFromQuaternion(Yu,r),Xu.toVector3(Wu),Wu.multiplyScalar(Le.RAD2DEG).toArray(i.value),n.set(t),i.set(t)}}Zu.typeName="CCamera",Zu.camIns={autoActivate:C("Camera.AutoActivate",!0),activate:D("Camera.Activate"),position:w("Transform.Position"),rotation:w("Transform.Rotation"),order:L("Transform.Order",je,je.ZYX),projection:L("Projection.Type",vh,vh.Perspective),fov:b("Projection.FovY",52),size:b("Projection.Size",20),zoom:b("Projection.Zoom",1),near:b("Frustum.ZNear",.01),far:b("Frustum.ZFar",1e4)};class Ju extends Zu{get settingProperties(){return[this.ins.projection,this.ins.fov,this.ins.size,this.ins.near,this.ins.far]}fromDocument(e,t){if(!isFinite(t.camera))throw new Error("camera property missing in node");const n=e.cameras[t.camera];return"perspective"===n.type?this.ins.copyValues({projection:vh.Perspective,fov:n.perspective.yfov,near:n.perspective.znear,far:n.perspective.zfar}):this.ins.copyValues({projection:vh.Orthographic,size:n.orthographic.ymag,near:n.orthographic.znear,far:n.orthographic.zfar}),t.camera}toDocument(e,t){const n=this.ins,i={};n.projection.getValidatedValue()===vh.Perspective?(i.type="perspective",i.perspective={yfov:n.fov.value,znear:n.near.value,zfar:n.far.value}):(i.type="orthographic",i.orthographic={ymag:n.size.value,znear:n.near.value,zfar:n.far.value}),e.cameras=e.cameras||[];const s=e.cameras.length;return e.cameras.push(i),s}}Ju.typeName="CVCamera",Ju.text="Camera",Ju.icon="video";new K;class Ku extends ru{constructor(e,t){super(e,t),this.ins=this.addInputs(Ku.pointLightIns),this.object3D=new Ea}get light(){return this.object3D}update(e){super.update(e);const t=this.light,n=this.ins;return n.position.changed&&(t.position.fromArray(n.position.value),t.updateMatrix()),(n.distance.changed||n.decay.changed)&&(t.distance=n.distance.value,t.decay=n.decay.value),t.updateMatrix(),!0}}Ku.typeName="CPointLight",Ku.pointLightIns={position:w("Light.Position"),distance:b("Light.Distance"),decay:b("Light.Decay",1)};class Qu extends Ku{get settingProperties(){return[this.ins.color,this.ins.intensity,this.ins.distance,this.ins.decay,this.ins.shadowEnabled,this.ins.shadowResolution,this.ins.shadowBlur]}get snapshotProperties(){return[this.ins.color,this.ins.intensity]}fromDocument(e,t){if(!isFinite(t.light))throw new Error("light property missing in node");const n=e.lights[t.light],i=this.ins;if("point"!==n.type)throw new Error("light type mismatch: not a point light");return n.point=n.point||{},i.copyValues({color:void 0!==n.color?n.color:i.color.schema.preset,intensity:void 0!==n.intensity?n.intensity:i.intensity.schema.preset,position:i.position.schema.preset,distance:n.point.distance||i.distance.schema.preset,decay:void 0!==n.point.decay?n.point.decay:i.decay.schema.preset,shadowEnabled:n.shadowEnabled||!1,shadowResolution:void 0!==n.shadowResolution&&iu[n.shadowResolution]||1,shadowBlur:void 0!==n.shadowBlur?n.shadowBlur:i.shadowBlur.schema.preset}),t.light}toDocument(e,t){const n=this.ins,i={color:n.color.cloneValue(),intensity:n.intensity.value,point:{distance:n.distance.value,decay:n.decay.value},type:"point"};n.shadowEnabled.value&&(i.shadowEnabled=!0,n.shadowBlur.isDefault()||(i.shadowBlur=n.shadowBlur.value),n.shadowResolution.isDefault()||(i.shadowResolution=iu[n.shadowResolution.value])),e.lights=e.lights||[];const s=e.lights.length;return e.lights.push(i),s}}Qu.typeName="CVPointLight",Qu.text="Point Light",Qu.icon="bulb";class ed extends ru{constructor(e,t){super(e,t),this.ins=this.addInputs(ed.spotLightIns),this.object3D=new Ca,this.light.target.matrixAutoUpdate=!1}get light(){return this.object3D}update(e){super.update(e);const t=this.light,n=this.ins;return(n.position.changed||n.target.changed)&&(t.position.fromArray(n.position.value),t.target.position.fromArray(n.target.value),t.updateMatrix(),t.target.updateMatrix()),(n.distance.changed||n.decay.changed||n.angle.changed||n.penumbra.changed)&&(t.distance=n.distance.value,t.decay=n.decay.value,t.angle=n.angle.value*Z.DEG2RAD,t.penumbra=n.penumbra.value),!0}onAddToParent(e){super.onAddToParent(e),e.add(this.light.target)}onRemoveFromParent(e){super.onRemoveFromParent(e),e.remove(this.light.target)}}ed.typeName="CSpotLight",ed.spotLightIns={position:w("Light.Position"),target:w("Light.Target",[0,-1,0]),distance:b("Light.Distance"),decay:b("Light.Decay",1),angle:b("Light.Angle",45),penumbra:_("Light.Penumbra",.5)};class td extends ed{get settingProperties(){return[this.ins.color,this.ins.intensity,this.ins.distance,this.ins.decay,this.ins.angle,this.ins.penumbra,this.ins.shadowEnabled,this.ins.shadowResolution,this.ins.shadowBlur]}get snapshotProperties(){return[this.ins.color,this.ins.intensity]}fromDocument(e,t){if(!isFinite(t.light))throw new Error("light property missing in node");const n=e.lights[t.light],i=this.ins;if("spot"!==n.type)throw new Error("light type mismatch: not a spot light");return n.spot=n.spot||{},i.copyValues({color:void 0!==n.color?n.color:i.color.schema.preset,intensity:void 0!==n.intensity?n.intensity:i.intensity.schema.preset,position:i.position.schema.preset,target:i.target.schema.preset,distance:n.spot.distance||i.distance.schema.preset,decay:void 0!==n.spot.decay?n.spot.decay:i.decay.schema.preset,angle:void 0!==n.spot.angle?n.spot.angle:i.angle.schema.preset,penumbra:n.spot.penumbra||i.penumbra.schema.preset,shadowEnabled:n.shadowEnabled||!1,shadowResolution:void 0!==n.shadowResolution&&iu[n.shadowResolution]||1,shadowBlur:void 0!==n.shadowBlur?n.shadowBlur:i.shadowBlur.schema.preset}),t.light}toDocument(e,t){const n=this.ins,i={color:n.color.cloneValue(),intensity:n.intensity.value,spot:{distance:n.distance.value,decay:n.decay.value,angle:n.angle.value,penumbra:n.penumbra.value},type:"spot"};n.shadowEnabled.value&&(i.shadowEnabled=!0,n.shadowBlur.isDefault()||(i.shadowBlur=n.shadowBlur.value),n.shadowResolution.isDefault()||(i.shadowResolution=iu[n.shadowResolution.value])),e.lights=e.lights||[];const s=e.lights.length;return e.lights.push(i),s}}td.typeName="CVSpotLight",td.text="Spot Light",td.icon="bulb";class nd extends B{get transform(){return this.components.get(qi)}get meta(){return this.components.get(Vl,!0)}get model(){return this.components.get($c,!0)}get camera(){return this.components.get(Ju,!0)}get light(){return this.components.get(ru,!0)}get scene(){return this.components.get(Hc,!0)}createComponents(){this.name="Node",this.createComponent(qi)}createModel(){this.name="Model",this.createComponent(Vl),this.createComponent($c)}fromDocument(e,t,n){const i=e.nodes[t];this.transform.fromData(i),n.set("node/"+t,this.transform);let s="Node";if(isFinite(i.meta)&&(this.createComponent(Vl).fromDocument(e,i),n.set("meta/"+i.meta,this.meta),s="Meta"),isFinite(i.model)&&(this.createComponent($c).fromDocument(e,i),n.set("model/"+i.model,this.model),s="Model"),isFinite(i.camera)&&(this.createComponent(Ju).fromDocument(e,i),n.set("camera/"+i.camera,this.camera),s="Camera"),isFinite(i.light)){const t=e.lights[i.light].type;switch(t){case"directional":this.createComponent(du).fromDocument(e,i),s="Directional Light";break;case"point":this.createComponent(Qu).fromDocument(e,i),s="Point Light";break;case"spot":this.createComponent(td).fromDocument(e,i),s="Spot Light";break;default:throw new Error(`unknown light type: '${t}'`)}n.set("light/"+i.light,this.light)}this.name=i.name||s;const r=i.children;r&&r.forEach(t=>{const i=this.graph.createCustomNode(nd);this.transform.addChild(i.transform),i.fromDocument(e,t,n)})}toDocument(e,t,n){n=n||{meta:!0,setup:!0,model:!0,camera:!0,light:!0},e.nodes=e.nodes||[];const i=e.nodes.length,s=this.transform.toData();e.nodes.push(s),t.set(this.transform,"node/"+i),this.name&&(s.name=this.name),this.model&&n.model&&(s.model=this.model.toDocument(e,s),t.set(this.model,"model/"+s.model)),this.camera&&n.camera&&(s.camera=this.camera.toDocument(e,s),t.set(this.camera,"camera/"+s.camera)),this.light&&n.light&&(s.light=this.light.toDocument(e,s),t.set(this.light,"light/"+s.light)),this.meta&&n.meta&&(s.meta=this.meta.toDocument(e,s),t.set(this.meta,"info/"+s.meta));return this.transform.children.map(e=>e.node).filter(e=>e.is(nd)).forEach(i=>{if(i.hasNodeComponents(n)){const r=i.toDocument(e,t,n);s.children=s.children||[],s.children.push(r)}}),i}hasNodeComponents(e){if(!e)return!0;const t=this.transform,n=this.components;return!(!e.model||!n.has($c)&&!t.hasChildComponents($c,!0))||(!(!e.camera||!n.has(Ju)&&!t.hasChildComponents(Ju,!0))||!(!e.light||!n.has(ru)&&!t.hasChildComponents(ru,!0)))}}nd.typeName="NVNode";class id extends nd{get setup(){return this.components.get(lu,!0)}createComponents(){this.createComponent(Hc),this.createComponent(lu),this.createComponent(Vl)}fromDocument(e,t,n){const i=e.scenes[t];i.name&&(this.name=i.name),this.scene.fromDocument(e,i);const s=i.nodes;s&&s.forEach(t=>{const i=this.graph.createCustomNode(nd);this.transform.addChild(i.transform),i.fromDocument(e,t,n)}),isFinite(i.meta)&&(this.meta.fromDocument(e,i),n.set("meta/"+i.meta,this.meta)),isFinite(i.setup)&&this.setup.fromDocument(e,t,n)}toDocument(e,t,n){e.scenes=e.scenes||[];const i=e.scenes.length,s={units:"cm"};e.scenes.push(s),this.name&&(s.name=this.name),this.scene.toDocument(e,s);return this.transform.children.map(e=>e.node).filter(e=>e.is(nd)).forEach(i=>{if(i.hasNodeComponents(n)){const r=i.toDocument(e,t,n);s.nodes=s.nodes||[],s.nodes.push(r)}}),n&&!n.setup||(this.meta&&(s.meta=this.meta.toDocument(e,s),t.set(this.meta,"meta/"+s.meta)),this.setup&&this.setup.toDocument(e,i,t)),i}}id.typeName="NVScene";class sd extends Uu{constructor(e,t){super(e,t),this.titles={},this.ins=this.addInputs(sd.ins),this.outs=this.addOutputs(sd.outs),this.innerGraph.createCustomNode(id),this.ins.active.setValue(!1),this.ins.visible.setValue(!1)}get root(){return this.innerNodes.get(id)}get setup(){return this.innerComponents.get(lu)}get assetPath(){return this.outs.assetPath.value}get assetBaseName(){let e=this.assetPath;const t=e.indexOf(".svx.json");return t>=0&&(e=e.substr(0,t)),e}get analytics(){return this.getMainComponent(Bl)}create(){super.create(),this.innerGraph.components.on(Vl,this.onMetaComponent,this),this.setup.language.outs.language.on("value",this.updateTitle,this)}dispose(){this.setup.language.outs.language.off("value",this.updateTitle,this),this.innerGraph.components.off(Vl,this.onMetaComponent,this),super.dispose()}update(e){super.update(e);const{ins:t,outs:n}=this;if(t.dumpJson.changed){const e=this.deflateDocument();console.log("-------------------- VOYAGER DOCUMENT --------------------"),console.log(JSON.stringify(e,(e,t)=>"number"==typeof t?parseFloat(t.toFixed(5)):t,2))}if(t.dumpTree.changed&&(console.log("-------------------- VOYAGER DOCUMENT --------------------"),this.dump()),t.download.changed){const e=n.assetPath.value.split("/").pop()||"voyager-document.json";zu(this.deflateDocument(),e)}if(t.title.changed&&this.titles){const e=this.setup.language;this.titles[Vi[e.outs.language.value]]=t.title.value,n.title.setValue(t.title.value)}return!0}clearNodeTree(){this.root.transform.children.slice().forEach(e=>e.node.dispose())}openDocument(e,t,n){if(!sd.validator.validate(e))throw new Error("document schema validation failed");n||this.clearNodeTree(),this.onMetaComponent({type:"CVMeta",object:this.root.meta,add:!0,remove:!1});let i="object"==typeof n?n:this.root;if(i.graph!==this.innerGraph)throw new Error("invalid parent node");const s=new Map;if(i instanceof id)i.fromDocument(e,e.scene,s);else{e.scenes[e.scene].nodes.forEach(t=>{const n=this.innerGraph.createCustomNode(nd);i.transform.addChild(n.transform),n.fromDocument(e,t,s)})}t&&(this.outs.assetPath.setValue(t),this.name=this.getMainComponent(Ol).getAssetName(t))}appendModel(e,t,n){if(n&&n.graph!==this.innerGraph)throw new Error("invalid parent node");if(this.isEmpty())throw new Error("empty document, can't append model");n=n||this.root;const i=this.innerGraph.createCustomNode(nd);n.transform.addChild(i.transform),i.createModel();i.model.derivatives.createModelAsset(e,t)}appendGeometry(e,t,n,i,s,r){if(r&&r.graph!==this.innerGraph)throw new Error("invalid parent node");if(this.isEmpty())throw new Error("empty document, can't append geometry");r=r||this.root;const o=this.innerGraph.createCustomNode(nd);r.transform.addChild(o.transform),o.createModel();o.model.derivatives.createMeshAsset(e,t,n,i,s)}deflateDocument(e){if(this.isEmpty())throw new Error("empty document, can't serialize");const t={asset:{type:sd.mimeType,version:sd.version,generator:"Voyager",copyright:"(c) Smithsonian Institution. All rights reserved."},scene:0,scenes:[]},n=new Map;return t.scene=this.root.toDocument(t,n,e),t}onMetaComponent(e){const t=e.object,n=this.ins.title,i=this.setup.language;e.add&&!n.value&&t.once("load",()=>{this.titles=t.collection.get("titles")||{},0===Object.keys(this.titles).length&&(this.titles[Vi[i.outs.language.value]]=t.collection.get("title")||"",t.collection.dictionary.titles=this.titles);const e=this.titles[Vi[i.outs.language.value]];n.setValue(e),this.analytics.setTitle(e)})}updateTitle(){const e=this.setup.language,t=this.titles[Vi[e.outs.language.value]];this.ins.title.setValue(t||"Missing Title")}}sd.typeName="CVDocument",sd.mimeType="application/si-dpo-3d.document+json",sd.version="1.0",sd.validator=new class{constructor(){this._schemaValidator=new Vu.a({schemas:[Bu,ju,$u,Gu,Hu],allErrors:!0}),this._validateDocument=this._schemaValidator.getSchema("https://schemas.3d.si.edu/voyager/document.schema.json")}validate(e){return!!this._validateDocument(e)||(console.warn(this._schemaValidator.errorsText(this._validateDocument.errors,{separator:", ",dataVar:"document"})),!1)}},sd.ins={dumpJson:D("Document.DumpJSON"),dumpTree:D("Document.DumpTree"),download:D("Document.Download"),title:A("Document.Title")},sd.outs={assetPath:P("Asset.Path",{preset:"document.svx.json"}),title:A("Document.Title")};class rd extends Pu{constructor(e,t){super(e,t),this.outs=this.addOutputs(rd.outs),this.scope=xu.Node}createDocument(e,t){const n=this.node.createComponent(sd);return this.activeComponent=n,e&&n.openDocument(e,t),n}amendDocument(e,t,n){const i=this.activeComponent;if(!i)throw new Error("no active document, can't amend");return i.openDocument(e,t,n),i}appendModel(e,t){const n=this.activeComponent;if(!n)throw new Error("no active document, can't append model");return n.appendModel(e,t),n}appendGeometry(e,t,n,i,s){const r=this.activeComponent;if(!r)throw new Error("no active document, can't append geometry");return r.appendGeometry(e,t,n,i,s),r}removeActiveDocument(){const e=this.activeComponent;e&&e.dispose()}activateComponent(e){e.ins.visible.setValue(!0),e.ins.active.setValue(!0)}deactivateComponent(e){e.ins.visible.setValue(!1),e.ins.active.setValue(!1)}onActiveComponent(e,t){this.outs.activeDocument.setValue(t)}onScopedComponents(){this.outs.changedDocuments.set()}}rd.typeName="CVDocumentProvider",rd.componentType=sd,rd.outs={activeDocument:N("Documents.Active",sd),changedDocuments:D("Documents.Changed")};class od extends j{constructor(){super(...arguments),this.ins=this.addInputs(od.ins)}get model(){return this.getComponent($c)}update(e){return!0}}od.typeName="CVAnnotations",od.ins={};class ad extends B{get pulse(){return this.components.get(G)}get renderer(){return this.components.get(q)}get fullscreen(){return this.components.get($)}get selection(){return this.components.get(ku)}get assetManager(){return this.components.get(Ol)}get assetReader(){return this.components.get(Ul)}get analytics(){return this.components.get(Bl)}get arManager(){return this.components.get(bu)}createComponents(){this.createComponent(G),this.createComponent(q),this.createComponent($),this.createComponent(Ol),this.createComponent(Ul),this.createComponent(Bl),this.createComponent(bu);this.createComponent(ku).ins.viewportBrackets.setValue(!1)}}ad.typeName="NVEngine";class ld extends Lu{constructor(e,t){super(e,t),this.outs=this.addOutputs(ld.outs),this.scope=_u.Graph}get documentProvider(){return this.getComponent(rd)}create(){super.create(),this.documentProvider.on("active-component",this.onActiveDocument,this)}dispose(){this.documentProvider.off("active-component",this.onActiveDocument,this),super.dispose()}onActiveDocument(e){this.scopedGraph=e.next}onActiveNode(e,t){this.outs.activeNode.setValue(t);const n=this.selection;t?n.nodeContainsSelectedComponent(t)||n.selectNode(t):e&&n.clearSelection()}onScopedNodes(){this.outs.changedNodes.set()}}ld.typeName="CVNodeProvider",ld.nodeType=nd,ld.followComponentSelection=!0,ld.outs={activeNode:N("Nodes.Active",nd),changedNodes:D("Nodes.Changed")};class cd extends B{get scene(){return this.components.get(Kr)}get documentProvider(){return this.components.get(rd)}get nodeProvider(){return this.components.get(ld)}createComponents(){this.createComponent(Kr,"Master Scene"),this.createComponent(rd),this.createComponent(ld)}}cd.typeName="NVDocuments";var hd=[De,G,Pu,Lu,nu,q,$,ku,Kr,B,Bl,bu,Ol,Ul,sd,rd,Hc,lu,qi,Vl,$c,od,Ic,Ju,du,Qu,td,qc,Xc,jl,Sh,Ph,kh,Bh,Yh,Jh,au,ou,Uc,Fl,ad,cd,id,nd];class ud extends j{constructor(){super(...arguments),this.activeDocument=null}get documentProvider(){return this.getGraphComponent(rd)}startObserving(){const e=this.documentProvider;e.on("active-component",this.onActiveDocumentEvent,this),e.activeComponent&&(this.activeDocument=e.activeComponent,this.onActiveDocument(null,e.activeComponent))}stopObserving(){const e=this.documentProvider;e.off("active-component",this.onActiveDocumentEvent,this),e.activeComponent&&(this.activeDocument=null,this.onActiveDocument(e.activeComponent,null))}onActiveDocument(e,t){}onActiveDocumentEvent(e){this.activeDocument=e.next,this.onActiveDocument(e.previous,e.next)}}ud.typeName="CVDocumentObserver";class dd extends ud{constructor(){super(...arguments),this.activeNode=null}get nodeProvider(){return this.getGraphComponent(ld)}startObserving(){super.startObserving();const e=this.nodeProvider;e.on("active-node",this.onActiveNodeEvent,this),e.activeNode&&(this.activeNode=e.activeNode,this.onActiveNode(null,e.activeNode))}stopObserving(){const e=this.nodeProvider;e.off("active-node",this.onActiveNodeEvent,this),e.activeNode&&(this.activeNode=null,this.onActiveNode(e.activeNode,null)),super.stopObserving()}onActiveNode(e,t){}onActiveNodeEvent(e){this.activeNode=e.next,this.onActiveNode(e.previous,e.next)}}dd.typeName="CVNodeObserver";var pd=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};class fd extends vr{constructor(e){super(),this.system=e}}pd([nr({attribute:!1})],fd.prototype,"system",void 0);class md extends fd{constructor(){super(...arguments),this.activeDocument=null}get documentProvider(){return this.system.getMainComponent(rd)}connected(){const e=this.documentProvider;e.on("active-component",this.onActiveDocumentEvent,this);const t=e.activeComponent;t&&(this.activeDocument=t,this.onActiveDocument(null,t))}disconnected(){this.documentProvider.off("active-component",this.onActiveDocumentEvent,this);const e=this.activeDocument;e&&(this.activeDocument=null,this.onActiveDocument(e,null))}onActiveDocument(e,t){}onActiveDocumentEvent(e){this.activeDocument=e.next,this.onActiveDocument(e.previous,e.next)}}class gd extends md{constructor(){super(...arguments),this.activeNode=null}get nodeProvider(){return this.system.getMainComponent(ld)}connected(){super.connected();const e=this.nodeProvider;e.on("active-node",this.onActiveNodeEvent,this),e.activeNode&&(this.activeNode=e.activeNode,this.onActiveNode(null,e.activeNode))}disconnected(){const e=this.nodeProvider;e.off("active-node",this.onActiveNodeEvent,this),e.activeNode&&(this.activeNode=null,this.onActiveNode(e.activeNode,null)),super.disconnected()}onActiveNode(e,t){this.requestUpdate()}onActiveNodeEvent(e){this.activeNode=e.next,this.onActiveNode(e.previous,e.next)}}var vd=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};class yd extends dd{constructor(){super(...arguments),this.ins=this.addInputs(yd.toolIns),this.outs=this.addOutputs(yd.toolOuts),this._isActiveTool=!1}get isActiveTool(){return this._isActiveTool}dispose(){this._isActiveTool&&this.deactivateTool(),super.dispose()}createView(){throw new Error("must override")}activateTool(){this._isActiveTool=!0,this.startObserving()}deactivateTool(){this.stopObserving(),this._isActiveTool=!1}}yd.typeName="CVTool",yd.toolIns={},yd.toolOuts={};class bd extends gd{constructor(e){super(e.system),this.tool=null,this.tool=e}get analytics(){return this.system.getMainComponent(Bl)}firstConnected(){this.classList.add("sv-group","sv-tool-view")}connected(){super.connected(),this.tool.on("update",this.onUpdate,this)}disconnected(){this.tool.off("update",this.onUpdate,this),super.disconnected()}}vd([nr({attribute:!1})],bd.prototype,"tool",void 0);class xd extends Pu{constructor(e,t){super(e,t),this.ins=this.addInputs(xd.ins),this.scope=xu.Node}get analytics(){return this.getMainComponent(Bl)}update(e){const t=this.ins;return t.visible.changed&&t.visible.value&&!this.activeComponent&&(this.activeComponent=this.scopedComponents[0]),!0}activateComponent(e){e.activateTool(),this.analytics.sendProperty("Tools.ActiveTool",e.text)}deactivateComponent(e){e.deactivateTool()}onActiveComponent(e,t){}}xd.typeName="CVToolProvider",xd.isSystemSingleton=!0,xd.componentType=yd,xd.ins={visible:C("Tools.Visible")};var _d=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let wd=class extends vr{constructor(){super(...arguments),this.property=null,this.name="",this.options=null,this.indexMap=null,this.language=null}firstConnected(){this.classList.add("sv-property-view","sv-property-options")}update(e){if(!this.property)throw new Error("missing property attribute");if("number"!==this.property.type||!this.property.schema.options)throw new Error("not an options property");if(e.has("property")){const t=e.get("property");t&&t.off("value",this.onUpdate,this),this.property&&this.property.on("value",this.onUpdate,this)}super.update(e)}render(){const e=this.property,t=this.indexMap,n=this.name||e.name,i=this.options||e.schema.options,s=e.value,r=this.language;let o;return o=t?t.map(e=>Gs`<ff-button .text=${r?r.getLocalizedString(i[e]):i[e]} .index=${e} .selectedIndex=${s} @click=${this.onButtonClick}>
                    </ff-button>`):i.map((e,t)=>Gs`<ff-button .text=${r?r.getLocalizedString(e):e} .index=${t} .selectedIndex=${s} @click=${this.onButtonClick}>
                    </ff-button>`),Gs`<label class="ff-label ff-off">${n}</label><div class="sv-options">${o}</div>`}onButtonClick(e){const t=e.target.index;this.property.setValue(t)}};_d([nr({attribute:!1})],wd.prototype,"property",void 0),_d([nr({type:String})],wd.prototype,"name",void 0),_d([nr({attribute:!1})],wd.prototype,"options",void 0),_d([nr({attribute:!1})],wd.prototype,"indexMap",void 0),_d([nr({attribute:!1})],wd.prototype,"language",void 0),wd=_d([yr("sv-property-options")],wd);var Sd=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Md=class extends vr{constructor(){super(...arguments),this.property=null,this.name="",this.text="",this.icon=""}firstConnected(){this.classList.add("sv-property-view","sv-property-event")}update(e){if(!this.property)throw new Error("missing property attribute");if(!this.property.schema.event)throw new Error(`not an event property: '${this.property.path}'`);if(e.has("property")){const t=e.get("property");t&&t.off("value",this.onUpdate,this),this.property&&this.property.on("value",this.onUpdate,this)}super.update(e)}render(){const e=this.property,t=this.name||e.name,n=this.text,i=this.icon;return Gs`<label class="ff-label ff-off">${t}</label>
            <div class="sv-options">
                <ff-button .text=${n} .icon=${i} @click=${this.onButtonClick}></ff-button>
            </div>`}onButtonClick(e){this.property.set()}};Sd([nr({attribute:!1})],Md.prototype,"property",void 0),Sd([nr({type:String})],Md.prototype,"name",void 0),Sd([nr({type:String})],Md.prototype,"text",void 0),Sd([nr({type:String})],Md.prototype,"icon",void 0),Md=Sd([yr("sv-property-event")],Md);var Ed=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};class Td extends yd{createView(){return new Cd(this)}}Td.typeName="CVViewTool",Td.text="View",Td.icon="eye";let Cd=class extends bd{firstConnected(){super.firstConnected(),this.classList.add("sv-view-tool-view")}render(){const e=this.activeDocument;if(!e)return Gs``;const t=this.tool,n=e.setup.navigation,i=e.setup.language,s=n.ins.projection,r=n.ins.preset,o=n.ins.zoomExtents,a=[bh.Front,bh.Back,bh.Left,bh.Right,bh.Top,bh.Bottom];return Gs`<div class="sv-section"><ff-button class="sv-section-lead" transparent icon=${t.icon}></ff-button>
            <div class="sv-tool-controls">
                <sv-property-options .property=${s} .language=${i} name=${i.getLocalizedString("Projection")}></sv-property-options>
                <sv-property-options .property=${r} .language=${i} name=${i.getLocalizedString("View")} .indexMap=${a}></sv-property-options>
                <sv-property-event .property=${o} name=${i.getLocalizedString("Center")} icon="zoom"></sv-property-event>
            </div>
        </div>`}onActiveDocument(e,t){this.requestUpdate()}};Cd=Ed([yr("sv-view-tool-view")],Cd);var Ad=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};class Pd extends yd{createView(){return new Ld(this)}}Pd.typeName="CVRenderTool",Pd.text="Material",Pd.icon="palette";let Ld=class extends bd{constructor(){super(...arguments),this.viewer=null}firstConnected(){super.firstConnected(),this.classList.add("sv-group","sv-render-tool-view")}render(){const e=this.tool,t=this.activeDocument,n=this.viewer;if(!n)return Gs``;const i=n.ins.shader,s=t.setup.language;return Gs`<div class="sv-section"><ff-button class="sv-section-lead" transparent icon=${e.icon}></ff-button>
            <div class="sv-tool-controls">
                <sv-property-options .property=${i} .language=${s} name=${s.getLocalizedString("Material")}></sv-property-options>
            </div>
        </div>`}onActiveDocument(e,t){this.viewer&&(this.viewer.ins.shader.off("value",this.onUpdate,this),this.viewer=null),t&&(this.viewer=t.setup.viewer,this.viewer.ins.shader.on("value",this.onUpdate,this))}};Ld=Ad([yr("sv-render-tool-view")],Ld);var Rd=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};class Nd extends yd{createView(){return new Dd(this)}}Nd.typeName="CVEnvironmentTool",Nd.text="Environment",Nd.icon="environment";let Dd=class extends bd{firstConnected(){super.firstConnected(),this.classList.add("sv-group","sv-environment-tool-view")}render(){const e=this.tool;if(!this.activeDocument)return Gs`No active document`;const t=this.activeDocument.setup,n=t.grid,i=t.floor,s=t.background,r=s.ins.style.getValidatedValue()===Mh.Solid,o=t.environment,a=t.language;return Gs`<div class="sv-section"><ff-button class="sv-section-lead" transparent icon=${e.icon}></ff-button>
            <div class="sv-tool-controls">
                <sv-property-options .property=${s.ins.style} .language=${a} .options=${["Solid","Linear","Radial"]} name=${a.getLocalizedString("Background")}></sv-property-options>
                <sv-property-color class="sv-nogap" .property=${s.ins.color0} name=" "></sv-property-color>
                ${r?null:Gs`<sv-property-color class="sv-nogap" .property=${s.ins.color1} name=" "></sv-property-color>`}
                <sv-property-boolean .property=${n.ins.visible} .language=${a} name=${a.getLocalizedString("Grid")}></sv-property-boolean>
                <sv-property-color class="sv-nogap" .property=${n.ins.color} name=" "></sv-property-color>
                <sv-property-boolean .property=${i.ins.visible} .language=${a} name=${a.getLocalizedString("Floor")}></sv-property-boolean>
                <sv-property-color class="sv-nogap" .property=${i.ins.color} name=" "></sv-property-color>
                <sv-property-options .property=${o.ins.imageIndex} name="Env Map"></sv-property-options>
            </div>
        </div>`}onActiveDocument(e,t){if(e){e.setup.background.ins.style.off("value",this.onUpdate,this)}if(t){t.setup.background.ins.style.on("value",this.onUpdate,this)}this.requestUpdate()}};Dd=Rd([yr("sv-environment-tool-view")],Dd);var Od=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let kd=class extends vr{constructor(){super(...arguments),this.property=null,this.name="",this.text=null,this.language=null}firstConnected(){this.classList.add("sv-property-view","sv-property-boolean")}update(e){if(!this.property)throw new Error("missing property attribute");if("boolean"!==this.property.type)throw new Error("not a boolean property");if(e.has("property")){const t=e.get("property");t&&t.off("value",this.onUpdate,this),this.property&&this.property.on("value",this.onUpdate,this)}super.update(e)}render(){const e=this.property,t=this.name||e.name,n=this.text,i=this.language;let s=e.value?Array.isArray(n)?n[1]:n||"On":Array.isArray(n)?n[0]:n||"Off";return Gs`<label class="ff-label ff-off">${t}</label>
            <ff-button .text=${i?i.getLocalizedString(s):s} ?selected=${e.value} @click=${this.onButtonClick}></ff-button>`}onButtonClick(e){this.property.setValue(!this.property.value)}};Od([nr({attribute:!1})],kd.prototype,"property",void 0),Od([nr({type:String})],kd.prototype,"name",void 0),Od([nr({attribute:!1})],kd.prototype,"text",void 0),Od([nr({attribute:!1})],kd.prototype,"language",void 0),kd=Od([yr("sv-property-boolean")],kd);class Id{constructor(e){this.isEnabled=!0,this._isDragging=!1,this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this.target=e,this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerup",this.onPointerUp),e.addEventListener("pointercancel",this.onPointerUp)}get isDragging(){return this._isDragging}get startX(){return this._startX}get startY(){return this._startY}onPointerDown(e){e.isPrimary&&this.isEnabled&&(this._isDragging=!0,this._startX=this._lastX=e.clientX,this._startY=this._lastY=e.clientY,this.target.setPointerCapture(e.pointerId),this.target.dragStart(e)),e.stopPropagation(),e.preventDefault()}onPointerMove(e){if(e.isPrimary&&this._isDragging){const t=e.clientX-this._lastX;this._lastX=e.clientX;const n=e.clientY-this._lastY;this._lastY=e.clientY,this.target.dragMove(e,t,n)}e.stopPropagation(),e.preventDefault()}onPointerUp(e){this._isDragging&&e.isPrimary&&(this.target.dragEnd(e),this.target.releasePointerCapture(e.pointerId),this._isDragging=!1),e.stopPropagation(),e.preventDefault()}}var zd=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Ud=class extends vr{constructor(){super(),this.direction="horizontal",this.value=0,this._isVertical=!1,this._offsetX=0,this._offsetY=0,this._knob=(new vr).addClass("ff-knob").setStyle({display:"block",position:"relative "}),new Id(this)}dragStart(e){const t=this._knob,n=this.getBoundingClientRect();e.target===this._knob?(this._offsetX=e.clientX-t.offsetLeft+.5*(t.clientWidth-t.offsetWidth),this._offsetY=e.clientY-t.offsetTop+.5*(t.clientHeight-t.offsetHeight)):(this._offsetX=n.left+.8*t.clientWidth,this._offsetY=n.top+.8*t.clientHeight),this.dragMove(e)}dragMove(e){const t=this._knob,n=e.clientX-this._offsetX,i=e.clientY-this._offsetY;let s=this._isVertical?1-i/(this.clientHeight-t.clientHeight):n/(this.clientWidth-t.clientWidth);s=Le.limit(s,0,1),s!==this.value&&(this.value=s,this.emitChangeEvent(!0))}dragEnd(){this.emitChangeEvent(!1)}firstConnected(){this.setStyle({position:"relative",touchAction:"none"}),this.setAttribute("touch-action","none"),this.setAttribute("tabindex","0"),this.classList.add("ff-control","ff-linear-slider"),this.appendChild(this._knob)}update(e){if(e.has("direction")&&(this._isVertical="vertical"===this.direction,this.setClass("ff-horizontal",!this._isVertical),this.setClass("ff-vertical",this._isVertical)),e.has("value")){const e=Le.limit(this.value,0,1),t=this._isVertical?0:100*e,n=this._isVertical?100*(1-e):0;this._knob.style.left=t.toFixed(3)+"%",this._knob.style.top=n.toFixed(3)+"%"}super.update(e)}emitChangeEvent(e){this.dispatchEvent(new CustomEvent("change",{detail:{value:this.value,isDragging:e},bubbles:!0}))}};zd([nr({type:String})],Ud.prototype,"direction",void 0),zd([nr({type:Number})],Ud.prototype,"value",void 0),Ud=zd([yr("ff-linear-slider")],Ud);var Fd=Ud,Vd=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Bd=class extends vr{constructor(){super(...arguments),this.property=null,this.name="",this.min=void 0,this.max=void 0}firstConnected(){super.firstConnected(),this.classList.add("sv-property-view","sv-property-slider")}update(e){if(!this.property)throw new Error("missing property attribute");if("number"!==this.property.type)throw new Error(`not a number property: '${this.property.path}'`);if(e.has("property")){const t=e.get("property");t&&t.off("value",this.onUpdate,this),this.property&&this.property.on("value",this.onUpdate,this)}super.update(e)}render(){const e=this.property,t=this.name||e.name,n=e.getValidatedValue(),i=isFinite(this.min)?this.min:e.schema.min,s=isFinite(this.max)?this.max:e.schema.max;return Gs`<label class="ff-label ff-off">${t}</label>
            <ff-linear-slider .value=${(n-i)/(s-i)} @change=${this.onSliderChange}></ff-linear-slider>`}onSliderChange(e){const t=this.property,n=isFinite(this.min)?this.min:t.schema.min,i=isFinite(this.max)?this.max:t.schema.max,s=n+e.detail.value*(i-n);t.setValue(s)}};Vd([nr({attribute:!1})],Bd.prototype,"property",void 0),Vd([nr({type:String})],Bd.prototype,"name",void 0),Vd([nr({type:Number})],Bd.prototype,"min",void 0),Vd([nr({type:Number})],Bd.prototype,"max",void 0),Bd=Vd([yr("sv-property-slider")],Bd);var jd=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let $d=class extends vr{constructor(){super(...arguments),this.name="",this.index=0,this.text="",this.placeholder="",this.align="left",this.initialValue="",this.requestFocus=!1}get inputElement(){return this.getElementsByTagName("input").item(0)}focus(){this.requestFocus=!0,this.performUpdate()}hasFocus(){return this.inputElement===document.activeElement}firstConnected(){this.classList.add("ff-control","ff-line-edit")}shouldUpdate(e){return!this.hasFocus()&&super.shouldUpdate(e)}render(){return Gs`<input
            type="text" .value=${this.text} placeholder=${this.placeholder}
            @keydown=${this.onKeyDown} @change=${this.onChange} @input=${this.onInput}
            @focus=${this.onFocus} @blur=${this.onBlur}
            style="box-sizing: border-box; width:100%; text-align: ${this.align};">`}updated(){this.requestFocus&&(this.requestFocus=!1,this.inputElement.focus())}onKeyDown(e){const t=e.target;"Enter"===e.key?(this.commit(t),t.blur()):"Escape"===e.key&&(this.revert(t),t.blur())}onChange(e){e.stopPropagation(),e.preventDefault(),this.text=e.target.value,this.dispatchChangeEvent(this.text,!1)}onInput(e){e.stopPropagation(),e.preventDefault(),this.text=e.target.value,this.dispatchChangeEvent(this.text,!0)}onFocus(e){this.initialValue=e.target.value,e.target.select()}onBlur(e){this.commit(e.target),this.requestUpdate()}revert(e){e.value=this.initialValue,this.dispatchChangeEvent(e.value,!1)}commit(e){this.initialValue=e.value,this.dispatchChangeEvent(e.value,!1)}dispatchChangeEvent(e,t){this.dispatchEvent(new CustomEvent("change",{detail:{text:e,isEditing:t}}))}};jd([nr({type:String})],$d.prototype,"name",void 0),jd([nr({type:Number})],$d.prototype,"index",void 0),jd([nr({type:String})],$d.prototype,"text",void 0),jd([nr({type:String})],$d.prototype,"placeholder",void 0),jd([nr({type:String})],$d.prototype,"align",void 0),$d=jd([yr("ff-line-edit")],$d);var Gd=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Hd=class extends vr{constructor(){super(),this.value=new Hl,this._offsetX=0,this._offsetY=0,this._knob=(new vr).addClass("ff-knob").setStyle({display:"block",position:"relative "}),new Id(this)}setXY(e,t){this.value.set(e,t),this.requestUpdate()}dragStart(e){const t=this._knob,n=this.getBoundingClientRect();e.target===this._knob?(this._offsetX=e.clientX-t.offsetLeft+.5*(t.clientWidth-t.offsetWidth),this._offsetY=e.clientY-t.offsetTop+.5*(t.clientHeight-t.offsetHeight)):(this._offsetX=n.left+.8*t.clientWidth,this._offsetY=n.top+.8*t.clientHeight),this.dragMove(e)}dragMove(e){const t=this._knob,n=e.clientX-this._offsetX,i=e.clientY-this._offsetY;let s=n/(this.clientWidth-t.clientWidth);s=Le.limit(s,0,1);let r=1-i/(this.clientHeight-t.clientHeight);r=Le.limit(r,0,1),s===this.value.x&&r===this.value.y||(this.value=this.value.set(s,r),this.emitChangeEvent(!0))}dragEnd(){this.emitChangeEvent(!1)}firstConnected(){this.setStyle({position:"relative",touchAction:"none"}),this.setAttribute("touch-action","none"),this.setAttribute("tabindex","0"),this.classList.add("ff-control","ff-vector-slider"),this.appendChild(this._knob)}update(e){const t=100*this.value.x,n=100*(1-this.value.y);this._knob.style.left=t.toFixed(3)+"%",this._knob.style.top=n.toFixed(3)+"%",super.update(e)}emitChangeEvent(e){this.dispatchEvent(new CustomEvent("change",{detail:{value:this.value,isDragging:e},bubbles:!0}))}};Gd([nr({attribute:!1})],Hd.prototype,"value",void 0),Hd=Gd([yr("ff-vector-slider")],Hd);var Wd=Hd,qd=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};const Xd=new Xl;let Yd=class extends vr{constructor(){super(),this.color=new Xl,this.alpha=!1,this.numeric=!1,this.onLumSatChange=this.onLumSatChange.bind(this),this.onHueChange=this.onHueChange.bind(this),this.onAlphaChange=this.onAlphaChange.bind(this),this.addEventListener("click",e=>e.stopPropagation()),this._hsv=new Wl,this._lumSatSlider=(new Wd).on("change",this.onLumSatChange),this._hueSlider=(new Fd).addClass("ff-hue-slider").on("change",this.onHueChange),this._hueSlider.direction="vertical"}firstConnected(){this.classList.add("ff-flex-column","ff-control","ff-color-edit")}update(e){e.has("color")&&this.color.toHSV(this._hsv),e.has("alpha")&&(this.alpha&&!this._alphaSlider?(this._alphaSlider=(new Fd).addClass("ff-alpha-slider").on("change",this.onAlphaChange),this._alphaSlider.direction="vertical"):!this.alpha&&this._alphaSlider&&this._alphaSlider.remove()),super.update(e)}render(){let e=null;if(this.numeric){const t=this.color,n=t.toString(!1).substr(1),i=this.alpha?Gs`
                <div class="ff-text">A</div><ff-line-edit name="alphaByte" text=${t.alphaByte} align="center" @change=${this.onNumericEdit}></ff-line-edit>
            `:null;e=Gs`<div class="ff-flex-row ff-numeric-controls">
                <div class="ff-text">R</div><ff-line-edit name="redByte" text=${t.redByte} align="center" @change=${this.onNumericEdit}></ff-line-edit>
                <div class="ff-text">G</div><ff-line-edit name="greenByte" text=${t.greenByte} align="center" @change=${this.onNumericEdit}></ff-line-edit>
                <div class="ff-text">B</div><ff-line-edit name="blueByte" text=${t.blueByte} align="center" @change=${this.onNumericEdit}></ff-line-edit>
                ${i}
                <div class="ff-text">#</div><ff-line-edit name="string" text=${n} class="ff-wide" align="center" @change=${this.onNumericEdit}></ff-line-edit>
            </div>`}return Gs`<div class="ff-flex-row ff-slider-controls">
                ${this._lumSatSlider}${this._hueSlider}${this._alphaSlider}
            </div>${e}`}updated(){this._hueSlider.value=1-this._hsv.x/360;const e=`linear-gradient(to bottom, transparent, black), linear-gradient(to right, white, ${Xd.setHSV(this._hsv.x).toString(!1)})`;if(this._lumSatSlider.style.backgroundImage=e,this._lumSatSlider.setXY(this._hsv.y,this._hsv.z),this.alpha){const e=this.color.toString(!1),t=getComputedStyle(this._alphaSlider).color,n=`linear-gradient(to top, transparent, ${e}), repeating-linear-gradient(-45deg, transparent, transparent 8px, ${t} 8px, ${t} 16px)`;this._alphaSlider.style.backgroundImage=n,this._alphaSlider.value=this.color.alpha}}onLumSatChange(e){e.stopPropagation();const t=e.detail.value;this._hsv.y=t.x,this._hsv.z=t.y,this.color.setHSV(this._hsv),this.requestUpdate(),this.emitChangeEvent(e.detail.isDragging)}onHueChange(e){e.stopPropagation(),this._hsv.x=360*(1-e.target.value),this.color.setHSV(this._hsv),this.requestUpdate(),this.emitChangeEvent(e.detail.isDragging)}onAlphaChange(e){e.stopPropagation(),this.color.alpha=e.target.value,this.requestUpdate(),this.emitChangeEvent(e.detail.isDragging)}onNumericEdit(e){e.stopPropagation();const t=e.target.name;if("string"===t)this.color.setString(e.detail.text,1,!1);else{let n=parseInt(e.detail.text);if(!isFinite(n))return;this.color[t]=Le.limit(n,0,255)}this.color.toHSV(this._hsv),this.requestUpdate(),this.emitChangeEvent(e.detail.isEditing)}emitChangeEvent(e){this.dispatchEvent(new CustomEvent("change",{detail:{color:this.color,isDragging:e},bubbles:!0}))}};qd([nr({attribute:!1})],Yd.prototype,"color",void 0),qd([nr({type:Boolean})],Yd.prototype,"alpha",void 0),qd([nr({type:Boolean})],Yd.prototype,"numeric",void 0),Yd=qd([yr("ff-color-edit")],Yd);var Zd=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Jd=class extends vr{constructor(){super(),this.property=null,this.name="",this.color=new Xl,this.pickerActive=!1,this.onPointerDown=this.onPointerDown.bind(this)}firstConnected(){super.firstConnected(),this.classList.add("sv-property-view","sv-property-color")}connected(){document.addEventListener("pointerdown",this.onPointerDown,{capture:!0,passive:!0})}disconnected(){document.removeEventListener("pointerdown",this.onPointerDown)}update(e){if(!this.property)throw new Error("missing property attribute");if("number"!==this.property.type||3!==this.property.elementCount)throw new Error(`not an color property: '${this.property.path}'`);if(e.has("property")){const t=e.get("property");t&&t.off("value",this.onPropertyChange,this),this.property&&(this.property.on("value",this.onPropertyChange,this),this.color.fromArray(this.property.value))}super.update(e)}render(){const e=this.property,t=this.name||e.name,n=this.color.toString();return Gs`<label class="ff-label ff-off">${t}</label>
            <ff-button style="background-color: ${n}" @click=${this.onButtonClick}></ff-button>
            ${this.pickerActive?Gs`<ff-color-edit .color=${this.color} @change=${this.onColorEditChange}></ff-color-edit>`:null}`}onButtonClick(e){this.pickerActive=!this.pickerActive,this.requestUpdate()}onColorEditChange(e){this.property.setValue(e.detail.color.toRGBArray())}onPropertyChange(e){this.color.fromArray(e),this.requestUpdate()}onPointerDown(e){this.pickerActive&&(e.composedPath()[0]instanceof Node&&this.contains(e.composedPath()[0])||(this.pickerActive=!1,this.requestUpdate()))}};Zd([nr({attribute:!1})],Jd.prototype,"property",void 0),Zd([nr({type:String})],Jd.prototype,"name",void 0),Jd=Zd([yr("sv-property-color")],Jd);var Kd=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};class Qd extends yd{constructor(){super(...arguments),this.lights=[],this.ins=this.addInputs(Qd.ins),this.outs=this.addOutputs(Qd.outs)}update(e){return this.outs.light.setValue(this.lights[this.ins.light.getValidatedValue()]),!0}createView(){return new ep(this)}onActiveDocument(e,t){this.lights=t?t.getInnerComponents(ru):[],this.ins.light.setOptions(this.lights.map(e=>e.node.name)),this.outs.light.setValue(this.lights[0]),super.onActiveDocument(e,t)}}Qd.typeName="CVLightTool",Qd.text="Lights",Qd.icon="bulb",Qd.ins={light:R("Tool.Light",[])},Qd.outs={light:N("Tool.SelectedLight",ru)};let ep=class extends bd{constructor(){super(...arguments),this.lights=null}firstConnected(){super.firstConnected(),this.classList.add("sv-group","sv-light-tool-view")}connected(){super.connected(),this.tool.outs.light.on("value",this.onUpdate,this)}disconnected(){this.tool.outs.light.off("value",this.onUpdate,this),super.disconnected()}render(){const e=this.tool,t=e.lights,n=this.activeDocument;if(!t||!n)return Gs`No editable lights in this scene.`;const i=e.outs.light.value,s=n.setup.navigation,r=n.setup.language,o=i?Gs`<div class="sv-section">
            <ff-button class="sv-section-lead" transparent icon="cog"></ff-button>
            <div class="sv-tool-controls">
                <!-- <sv-property-boolean .property=${i.ins.visible} name="Switch"></sv-property-boolean> -->
                <sv-property-slider .property=${i.ins.intensity} name=${r.getLocalizedString("Intensity")} min="0" max="2"></sv-property-slider>
                <sv-property-color .property=${i.ins.color} name=${r.getLocalizedString("Color")}></sv-property-color>
            </div>
        </div>`:null;return Gs`${o}<div class="sv-section"><ff-button class="sv-section-lead" transparent icon=${e.icon}></ff-button>
            <div class="sv-tool-controls">
                <!-- <sv-property-boolean .property=${s.ins.lightsFollowCamera} name="Follow Camera"></sv-property-boolean> -->
                <sv-property-options .property=${e.ins.light} .language=${r} name=${r.getLocalizedString("Select Scene Light")}></sv-property-options>
            </div>
        </div>`}onActiveDocument(e,t){e&&e.setup.navigation.ins.lightsFollowCamera.off("value",this.onUpdate,this),t&&t.setup.navigation.ins.lightsFollowCamera.on("value",this.onUpdate,this),this.requestUpdate()}};ep=Kd([yr("sv-light-tool-view")],ep);var tp=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let np=class extends vr{constructor(){super(...arguments),this.property=null,this.name=""}firstConnected(){this.classList.add("sv-property-view","sv-property-string")}update(e){if(!this.property)throw new Error("missing property attribute");if("string"!==this.property.type)throw new Error(`not a string property: '${this.property.path}'`);if(e.has("property")){const t=e.get("property");t&&t.off("value",this.onUpdate,this),this.property&&this.property.on("value",this.onUpdate,this)}super.update(e)}render(){const e=this.property,t=this.name||e.name,n=e.value;return Gs`<label class="ff-label ff-off">${t}</label>
            <div class="ff-string">${n}</div>`}};tp([nr({attribute:!1})],np.prototype,"property",void 0),tp([nr({type:String})],np.prototype,"name",void 0),np=tp([yr("sv-property-string")],np);var ip=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};class sp extends yd{createView(){return new rp(this)}}sp.typeName="CVTapeTool",sp.text="Measure",sp.icon="tape";let rp=class extends bd{firstConnected(){super.firstConnected(),this.classList.add("sv-group","sv-tape-tool-view")}render(){const e=this.activeDocument;if(!e)return Gs``;const t=this.tool,n=e.setup.tape,i=n.ins.visible,s=n.outs.state.value,r=n.outs.distance.value,o=e.setup.language;let a;if(i.value)if(0===r)a=o.getLocalizedString("Tap on model to set start of tape")+".";else if(s===Xh.SetStart){const t=e.root.scene.ins.units.getOptionText();a=`${r.toFixed(2)} ${t}`}else a=o.getLocalizedString("Tap on model to set end of tape")+".";else a=o.getLocalizedString("Switch on to take measurements")+".";return Gs`<div class="sv-section"><ff-button class="sv-section-lead" transparent icon=${t.icon}></ff-button>
            <div class="sv-tool-controls">
                <sv-property-boolean .property=${i} .language=${o} name=${o.getLocalizedString("Tape Tool")}></sv-property-boolean>
                <div class="sv-property-view"><label class="ff-label ff-off">${o.getLocalizedString("Measured Distance")}</label>
                <div class="ff-string">${a}</div></div>
            </div></div>`}onActiveDocument(e,t){e&&e.setup.tape.off("update",this.onUpdate,this),t&&t.setup.tape.on("update",this.onUpdate,this),this.requestUpdate()}};rp=ip([yr("sv-tape-tool-view")],rp);var op=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};class ap extends yd{createView(){return new lp(this)}}ap.typeName="CVSliceTool",ap.text="Slice",ap.icon="knife";let lp=class extends bd{firstConnected(){super.firstConnected(),this.classList.add("sv-group","sv-slice-tool-view")}render(){const e=this.activeDocument;if(!e)return Gs``;const t=this.tool,n=e.setup.slicer,i=n.ins.enabled,s=n.ins.axis,r=n.ins.position,o=e.setup.language;return Gs`<div class="sv-section"><ff-button class="sv-section-lead" transparent icon=${t.icon}></ff-button>
            <div class="sv-tool-controls">
                <sv-property-boolean .property=${i} .language=${o} name=${o.getLocalizedString("Slice Tool")}></sv-property-boolean>
                <sv-property-options .property=${s} .language=${o} name=${o.getLocalizedString("Axis")}></sv-property-options>
                <sv-property-slider .property=${r} name=${o.getLocalizedString("Position")}></sv-property-slider>
            </div>
        </div>`}onActiveDocument(e,t){this.requestUpdate()}};lp=op([yr("sv-slice-tool-view")],lp);class cp extends B{get toolProvider(){return this.getComponent(xd)}createComponents(){this.createComponent(xd),this.createComponent(Td),this.createComponent(Pd),this.createComponent(Nd),this.createComponent(Qd),this.createComponent(sp),this.createComponent(ap)}}cp.typeName="NVTools";var hp=[ld,xd,Td,Pd,Nd,Qd,sp,ap,cp],up=n(26);class dp{constructor(e,t,n){this.props=t||{},console.log(dp.splashMessage);const i=new Eu;i.add(hd),i.add(hp),this.commander=new Mu;const s=this.system=new Tu(i),r=s.graph.createCustomNode(ad);s.graph.createCustomNode(cp),s.graph.createCustomNode(cd),this.analytics.startTimer(),e&&new Vg(this).appendTo(e),n||(this.documentProvider.createDocument(up),this.evaluateProps()),r.pulse.start()}get assetManager(){return this.system.getMainComponent(Ol)}get assetReader(){return this.system.getMainComponent(Ul)}get documentProvider(){return this.system.getMainComponent(rd)}get analytics(){return this.system.getMainComponent(Bl)}setBaseUrl(e){this.assetManager.baseUrl=e}loadDocument(e,t,n,i){const s=co[n];return this.assetReader.getJSON(e).then(n=>(t=void 0===t?!n.lights&&!n.cameras:t,this.documentProvider.amendDocument(n,e,t))).then(e=>(isFinite(s)&&e.setup.viewer.ins.quality.setValue(s),e))}loadModel(e,t){return this.documentProvider.appendModel(e,t)}loadGeometry(e,t,n,i,s){return this.documentProvider.appendGeometry(e,t,n,i,s)}evaluateProps(){const e=this.props,t=this.assetManager;e.root=e.root||wu("root")||wu("r"),e.dracoRoot=e.dracoRoot||wu("dracoRoot")||wu("dr"),e.resourceRoot=e.resourceRoot||wu("resourceRoot")||wu("rr"),e.document=e.document||wu("document")||wu("d"),e.model=e.model||wu("model")||wu("m"),e.geometry=e.geometry||wu("geometry")||wu("g"),e.texture=e.texture||wu("texture")||wu("t"),e.occlusion=e.occlusion||wu("occlusion")||wu("o"),e.normals=e.normals||wu("normals")||wu("n"),e.quality=e.quality||wu("quality")||wu("q"),e.uiMode=e.uiMode||wu("uiMode")||wu("u");const n=e.root||e.document||e.model||e.geometry;if(this.setBaseUrl(new URL(n||".",window.location).href),e.uiMode){let t=0,n=!1;const i=Object.values(Wc).filter(e=>"string"==typeof e);e.uiMode.split("|").forEach(e=>{const s=e.toLowerCase();i.includes(s)&&(t+=Wc[s],n=!0)}),n&&this.documentProvider.activeComponent.setup.interface.ins.visibleElements.setValue(t)}e.dracoRoot&&this.assetReader.setDracoPath(e.dracoRoot),e.resourceRoot&&this.assetReader.setSystemAssetPath(e.resourceRoot),e.document?(e.document=e.root?e.document:t.getAssetName(e.document),this.loadDocument(e.document,void 0,e.quality,e.uiMode).catch(e=>Pr.show("Failed to load document: "+e.message,"error"))):e.model?(e.model=e.root?e.model:t.getAssetName(e.model),this.loadModel(e.model,e.quality)):e.geometry?(e.geometry=e.root?e.geometry:t.getAssetName(e.geometry),e.texture=e.root?e.texture:t.getAssetName(e.texture),e.occlusion=e.root?e.occlusion:t.getAssetName(e.occlusion),e.normals=e.root?e.normals:t.getAssetName(e.normals),this.loadGeometry(e.geometry,e.texture,e.occlusion,e.normals,e.quality)):this.loadDocument("document.svx.json",void 0).catch(()=>{})}toggleAnnotations(){const e=this.system.getMainComponent(rd).activeComponent.setup.viewer.ins,t=this.system.getMainComponent(xd).ins;t.visible.value&&t.visible.setValue(!1),e.annotationsVisible.setValue(!e.annotationsVisible.value),this.analytics.sendProperty("Annotations.Visible",e.annotationsVisible.value)}toggleReader(){const e=this.system.getMainComponent(rd).activeComponent.setup.reader.ins;e.enabled.setValue(!e.enabled.value),this.analytics.sendProperty("Reader.Enabled",e.enabled.value)}toggleTours(){const e=this.system.getMainComponent(rd).activeComponent.setup.tours.ins,t=this.system.getMainComponent(rd).activeComponent.setup.reader.ins;e.enabled.value?e.enabled.setValue(!1):(t.enabled.value&&t.enabled.setValue(!1),e.enabled.setValue(!0),e.tourIndex.setValue(-1)),this.analytics.sendProperty("Tours.Enabled",e.enabled.value)}toggleTools(){const e=this.system.getMainComponent(xd).ins,t=this.system.getMainComponent(rd).activeComponent.setup.viewer.ins;t.annotationsVisible.value&&t.annotationsVisible.setValue(!1),e.visible.setValue(!e.visible.value),this.analytics.sendProperty("Tools.Visible",e.visible.value)}enableAR(){this.system.getMainComponent(bu).ins.enabled.setValue(!0),this.analytics.sendProperty("AR.enabled",!0)}getArticles(){return this.system.getMainComponent(rd).activeComponent.setup.reader.articles.map(e=>e.article.data)}getCameraOrbit(){return this.system.getMainComponent(rd).activeComponent.setup.navigation.ins.orbit.value.slice(0,2)}setCameraOrbit(e,t){const n=this.system.getMainComponent(rd).activeComponent.setup.navigation.ins,i=parseFloat(e),s=parseFloat(t);isNaN(i)||isNaN(s)?console.log("Error: setCameraOrbit param is not a number."):n.orbit.setValue([i,s,0])}setBackgroundColor(e,t){const n=this.system.getMainComponent(rd).activeComponent.setup.background.ins,i=document.createElement("div");if(i.id="temp-color",document.getElementsByTagName("voyager-explorer")[0].appendChild(i),i.style.color=e,""!==i.style.color){const e=getComputedStyle(i).color.split("(")[1].split(")")[0].split(",").map(e=>parseInt(e)/255);n.color0.setValue(e)}else console.log("Error: Color0 param is invalid.");if(t)if(i.style.color=t,""!==i.style.color){const e=getComputedStyle(i).color.split("(")[1].split(")")[0].split(",").map(e=>parseInt(e)/255);n.color1.setValue(e)}else console.log("Error: Color1 param is invalid.");document.getElementsByTagName("voyager-explorer")[0].removeChild(i)}setBackgroundStyle(e){const t=this.system.getMainComponent(rd).activeComponent.setup.background.ins,n=Object.values(_o).filter(e=>"string"==typeof e).find(t=>t.toLowerCase()===e.toLowerCase());void 0!==n?t.style.setValue(_o[n]):console.log("Error: Style param is invalid.")}}dp.splashMessage="\n  _________       .__  __  .__                        .__                ________ ________   \n /   _____/ _____ |__|/  |_|  |__   __________   ____ |__|____    ____   \\_____  \\\\______ \\  \n \\_____  \\ /     \\|  \\   __\\  |  \\ /  ___/  _ \\ /    \\|  \\__  \\  /    \\    _(__  < |    |  \\ \n /        \\  Y Y  \\  ||  | |   Y  \\\\___ (  <_> )   |  \\  |/ __ \\|   |  \\  /       \\|    `   \\\n/_______  /__|_|  /__||__| |___|  /____  >____/|___|  /__(____  /___|  / /______  /_______  /\n        \\/      \\/              \\/     \\/           \\/        \\/     \\/         \\/        \\/ \n    \nVoyager - 3D Explorer and Tool Suite\n3D Foundation Project\n(c) 2019 Smithsonian Institution\n\nhttps://3d.si.edu\nhttps://github.com/smithsonian/dpo-voyager\n\n-----------------------------------------------------\nVersion: Voyager Explorer v0.13.0  PROD\n-----------------------------------------------------\n    ",window.VoyagerExplorer=dp;class pp{constructor(e,t,n){this._type=e,this._callback=t,this._context=n,this._publishers=[]}on(...e){return e.forEach(e=>{this._publishers.push(e),e.on(this._type,this._callback,this._context)}),this}off(){return this._publishers.forEach(e=>e.off(this._type,this._callback,this._context)),this._publishers.length=0,this}}class fp{constructor(e){this.next=null,this.activePositions=[],this.activeType="",this.centerX=0,this.centerY=0,this.startX=0,this.startY=0,this.isDragging=!1,this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUpOrCancel=this.onPointerUpOrCancel.bind(this),this.onDoubleClick=this.onDoubleClick.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),e&&(e.addEventListener("pointerdown",this.onPointerDown),e.addEventListener("pointermove",this.onPointerMove),e.addEventListener("pointerup",this.onPointerUpOrCancel),e.addEventListener("pointercancel",this.onPointerUpOrCancel),e.addEventListener("contextmenu",this.onContextMenu),e.addEventListener("wheel",this.onWheel))}onPointerDown(e){if(this.activeType&&e.pointerType!==this.activeType)return;0===this.activePositions.length&&(this.startX=e.clientX,this.startY=e.clientY,this.isDragging=!1),this.activeType=e.pointerType,this.activePositions.push({id:e.pointerId,clientX:e.clientX,clientY:e.clientY}),e.currentTarget.setPointerCapture(e.pointerId);const t=this.createManipPointerEvent(e,"pointer-down");this.sendPointerEvent(t)&&e.stopPropagation()}onPointerMove(e){const t=this.activePositions;for(let n=0,i=t.length;n<i;++n){const i=t[n];e.pointerId===i.id&&(i.clientX=e.clientX,i.clientY=e.clientY)}if(t.length>0&&!this.isDragging){Math.abs(e.clientX-this.startX)+Math.abs(e.clientY-this.startY)>4&&(this.isDragging=!0)}const n=t.length?"pointer-move":"pointer-hover",i=this.createManipPointerEvent(e,n);this.sendPointerEvent(i)&&e.stopPropagation()}onPointerUpOrCancel(e){const t=this.activePositions;let n=!1;for(let i=0,s=t.length;i<s;++i)if(e.pointerId===t[i].id){t.splice(i,1),n=!0;break}if(!n)return;const i=this.createManipPointerEvent(e,"pointer-up");0===t.length&&(this.activeType=""),this.sendPointerEvent(i)&&e.stopPropagation(),e.preventDefault()}onDoubleClick(e){this.sendTriggerEvent(this.createManipTriggerEvent(e,"double-click"))&&e.preventDefault()}onContextMenu(e){this.sendTriggerEvent(this.createManipTriggerEvent(e,"context-menu")),e.preventDefault()}onWheel(e){this.sendTriggerEvent(this.createManipTriggerEvent(e,"wheel"))&&e.preventDefault()}createManipPointerEvent(e,t){let n=0,i=0,s=0,r=0,o=0,a=0;const l=this.activePositions,c=l.length;if(c>0){for(let e=0;e<c;++e)n+=l[e].clientX,i+=l[e].clientY;n/=c,i/=c,"pointer-move"!==t&&"pointer-hover"!==t||(o=n-this.centerX,a=i-this.centerY),this.centerX=n,this.centerY=i}else n=this.centerX,i=this.centerY;const h=e.currentTarget;if(h instanceof Element){const t=h.getBoundingClientRect();s=e.clientX-t.left,r=e.clientY-t.top}return{originalEvent:e,type:t,source:e.pointerType,isPrimary:e.isPrimary,isDragging:this.isDragging,activePositions:l,pointerCount:c,centerX:n,centerY:i,localX:s,localY:r,movementX:o,movementY:a,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey}}createManipTriggerEvent(e,t){let n=0;"wheel"===t&&(n=e.deltaY);let i=0,s=0;const r=e.currentTarget;if(r instanceof Element){const t=r.getBoundingClientRect();i=e.clientX-t.left,s=e.clientY-t.top}return{originalEvent:e,type:t,wheel:n,centerX:e.clientX,centerY:e.clientY,localX:i,localY:s,shiftKey:e.shiftKey,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey}}sendPointerEvent(e){return this.next&&this.next.onPointer(e)}sendTriggerEvent(e){return this.next&&this.next.onTrigger(e)}}class mp extends Dr{constructor(e,t,n,i,s,r,o,a,l,c,h,u){super(null,r,o,a,l,c,i,s,h,u),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==l?l:1003,this.minFilter=void 0!==c?c:1003,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}function gp(){let e=null,t=!1,n=null,i=null;function s(t,r){n(t,r),i=e.requestAnimationFrame(s)}return{start:function(){!0!==t&&null!==n&&(i=e.requestAnimationFrame(s),t=!0)},stop:function(){e.cancelAnimationFrame(i),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function vp(e,t){const n=t.isWebGL2,i=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),i.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=i.get(t);n&&(e.deleteBuffer(n.buffer),i.delete(t))},update:function(t,s){if(t.isGLBufferAttribute){const e=i.get(t);return void((!e||e.version<t.version)&&i.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const r=i.get(t);void 0===r?i.set(t,function(t,i){const s=t.array,r=t.usage,o=e.createBuffer();e.bindBuffer(i,o),e.bufferData(i,s,r),t.onUploadCallback();let a=e.FLOAT;return s instanceof Float32Array?a=e.FLOAT:s instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):s instanceof Uint16Array?t.isFloat16BufferAttribute?n?a=e.HALF_FLOAT:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=e.UNSIGNED_SHORT:s instanceof Int16Array?a=e.SHORT:s instanceof Uint32Array?a=e.UNSIGNED_INT:s instanceof Int32Array?a=e.INT:s instanceof Int8Array?a=e.BYTE:s instanceof Uint8Array&&(a=e.UNSIGNED_BYTE),{buffer:o,type:a,bytesPerElement:s.BYTES_PER_ELEMENT,version:t.version}}(t,s)):r.version<t.version&&(!function(t,i,s){const r=i.array,o=i.updateRange;e.bindBuffer(s,t),-1===o.count?e.bufferSubData(s,0,r):(n?e.bufferSubData(s,o.offset*r.BYTES_PER_ELEMENT,r,o.offset,o.count):e.bufferSubData(s,o.offset*r.BYTES_PER_ELEMENT,r.subarray(o.offset,o.offset+o.count)),o.count=-1)}(r.buffer,t,s),r.version=t.version)}}}mp.prototype.isDataTexture=!0;class yp extends gn{constructor(e=1,t=1,n=1,i=1,s=1,r=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:s,depthSegments:r};const o=this;i=Math.floor(i),s=Math.floor(s),r=Math.floor(r);const a=[],l=[],c=[],h=[];let u=0,d=0;function p(e,t,n,i,s,r,p,f,m,g,v){const y=r/m,b=p/g,x=r/2,_=p/2,w=f/2,S=m+1,M=g+1;let E=0,T=0;const C=new K;for(let r=0;r<M;r++){const o=r*b-_;for(let a=0;a<S;a++){const u=a*y-x;C[e]=u*i,C[t]=o*s,C[n]=w,l.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[n]=f>0?1:-1,c.push(C.x,C.y,C.z),h.push(a/m),h.push(1-r/g),E+=1}}for(let e=0;e<g;e++)for(let t=0;t<m;t++){const n=u+t+S*e,i=u+t+S*(e+1),s=u+(t+1)+S*(e+1),r=u+(t+1)+S*e;a.push(n,i,r),a.push(i,s,r),T+=6}o.addGroup(d,T,v),d+=T,u+=E}p("z","y","x",-1,-1,n,t,e,r,s,0),p("z","y","x",1,-1,n,t,-e,r,s,1),p("x","z","y",1,1,e,n,t,i,r,2),p("x","z","y",1,-1,e,n,-t,i,r,3),p("x","y","z",1,-1,e,t,n,i,s,4),p("x","y","z",-1,-1,e,t,-n,i,s,5),this.setIndex(a),this.setAttribute("position",new on(l,3)),this.setAttribute("normal",new on(c,3)),this.setAttribute("uv",new on(h,2))}}function bp(e,t,n,i,s){const r=new Ht(0);let o,a,l=0,c=null,h=0,u=null;function d(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,s)}return{getClearColor:function(){return r},setClearColor:function(e,t=1){r.set(e),l=t,d(r,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,d(r,l)},render:function(n,s,p,f){let m=!0===s.isScene?s.background:null;m&&m.isTexture&&(m=t.get(m));const g=e.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(m=null),null===m?d(r,l):m&&m.isColor&&(d(m,1),f=!0),(e.autoClear||f)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||306===m.mapping)?(void 0===a&&(a=new On(new yp(1,1,1),new Fr({name:"BackgroundCubeMaterial",uniforms:Ir(bo.cube.uniforms),vertexShader:bo.cube.vertexShader,fragmentShader:bo.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(a)),a.material.uniforms.envMap.value=m,a.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,c===m&&h===m.version&&u===e.toneMapping||(a.material.needsUpdate=!0,c=m,h=m.version,u=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null)):m&&m.isTexture&&(void 0===o&&(o=new On(new In(2,2),new Fr({name:"BackgroundMaterial",uniforms:Ir(bo.background.uniforms),vertexShader:bo.background.vertexShader,fragmentShader:bo.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(o)),o.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),o.material.uniforms.uvTransform.value.copy(m.matrix),c===m&&h===m.version&&u===e.toneMapping||(o.material.needsUpdate=!0,c=m,h=m.version,u=e.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null))}}}function xp(e,t,n,i){const s=e.getParameter(e.MAX_VERTEX_ATTRIBS),r=i.isWebGL2?null:t.get("OES_vertex_array_object"),o=i.isWebGL2||null!==r,a={},l=d(null);let c=l;function h(t){return i.isWebGL2?e.bindVertexArray(t):r.bindVertexArrayOES(t)}function u(t){return i.isWebGL2?e.deleteVertexArray(t):r.deleteVertexArrayOES(t)}function d(e){const t=[],n=[],i=[];for(let e=0;e<s;e++)t[e]=0,n[e]=0,i[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:i,object:e,attributes:{},index:null}}function p(){const e=c.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function f(e){m(e,0)}function m(n,s){const r=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;if(r[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),a[n]!==s){(i.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,s),a[n]=s}}function g(){const t=c.newAttributes,n=c.enabledAttributes;for(let i=0,s=n.length;i<s;i++)n[i]!==t[i]&&(e.disableVertexAttribArray(i),n[i]=0)}function v(t,n,s,r,o,a){!0!==i.isWebGL2||s!==e.INT&&s!==e.UNSIGNED_INT?e.vertexAttribPointer(t,n,s,r,o,a):e.vertexAttribIPointer(t,n,s,o,a)}function y(){b(),c!==l&&(c=l,h(c.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(s,l,u,y,b){let x=!1;if(o){const t=function(t,n,s){const o=!0===s.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[n.id];void 0===c&&(c={},l[n.id]=c);let h=c[o];void 0===h&&(h=d(i.isWebGL2?e.createVertexArray():r.createVertexArrayOES()),c[o]=h);return h}(y,u,l);c!==t&&(c=t,h(c.object)),x=function(e,t){const n=c.attributes,i=e.attributes;let s=0;for(const e in i){const t=n[e],r=i[e];if(void 0===t)return!0;if(t.attribute!==r)return!0;if(t.data!==r.data)return!0;s++}return c.attributesNum!==s||c.index!==t}(y,b),x&&function(e,t){const n={},i=e.attributes;let s=0;for(const e in i){const t=i[e],r={};r.attribute=t,t.data&&(r.data=t.data),n[e]=r,s++}c.attributes=n,c.attributesNum=s,c.index=t}(y,b)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===u.id&&c.wireframe===e||(c.geometry=y.id,c.program=u.id,c.wireframe=e,x=!0)}!0===s.isInstancedMesh&&(x=!0),null!==b&&n.update(b,e.ELEMENT_ARRAY_BUFFER),x&&(!function(s,r,o,a){if(!1===i.isWebGL2&&(s.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const l=a.attributes,c=o.getAttributes(),h=r.defaultAttributeValues;for(const t in c){const i=c[t];if(i>=0){const r=l[t];if(void 0!==r){const t=r.normalized,s=r.itemSize,o=n.get(r);if(void 0===o)continue;const l=o.buffer,c=o.type,h=o.bytesPerElement;if(r.isInterleavedBufferAttribute){const n=r.data,o=n.stride,u=r.offset;n&&n.isInstancedInterleavedBuffer?(m(i,n.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)):f(i),e.bindBuffer(e.ARRAY_BUFFER,l),v(i,s,c,t,o*h,u*h)}else r.isInstancedBufferAttribute?(m(i,r.meshPerAttribute),void 0===a._maxInstanceCount&&(a._maxInstanceCount=r.meshPerAttribute*r.count)):f(i),e.bindBuffer(e.ARRAY_BUFFER,l),v(i,s,c,t,0,0)}else if("instanceMatrix"===t){const t=n.get(s.instanceMatrix);if(void 0===t)continue;const r=t.buffer,o=t.type;m(i+0,1),m(i+1,1),m(i+2,1),m(i+3,1),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(i+0,4,o,!1,64,0),e.vertexAttribPointer(i+1,4,o,!1,64,16),e.vertexAttribPointer(i+2,4,o,!1,64,32),e.vertexAttribPointer(i+3,4,o,!1,64,48)}else if("instanceColor"===t){const t=n.get(s.instanceColor);if(void 0===t)continue;const r=t.buffer,o=t.type;m(i,1),e.bindBuffer(e.ARRAY_BUFFER,r),e.vertexAttribPointer(i,3,o,!1,12,0)}else if(void 0!==h){const n=h[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(i,n);break;case 3:e.vertexAttrib3fv(i,n);break;case 4:e.vertexAttrib4fv(i,n);break;default:e.vertexAttrib1fv(i,n)}}}}g()}(s,l,u,y),null!==b&&e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const n=t[e];for(const e in n)u(n[e].object),delete n[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const n=t[e];for(const e in n)u(n[e].object),delete n[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const n=a[t];if(void 0===n[e.id])continue;const i=n[e.id];for(const e in i)u(i[e].object),delete i[e];delete n[e.id]}},initAttributes:p,enableAttribute:f,disableUnusedAttributes:g}}function _p(e,t,n,i){const s=i.isWebGL2;let r;this.setMode=function(e){r=e},this.render=function(t,i){e.drawArrays(r,t,i),n.update(i,r,1)},this.renderInstances=function(i,o,a){if(0===a)return;let l,c;if(s)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](r,i,o,a),n.update(o,r,a)}}function wp(e,t,n){let i;function s(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const r="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let o=void 0!==n.precision?n.precision:"highp";const a=s(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=!0===n.logarithmicDepthBuffer,c=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),u=e.getParameter(e.MAX_TEXTURE_SIZE),d=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),f=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),m=e.getParameter(e.MAX_VARYING_VECTORS),g=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),v=h>0,y=r||t.has("OES_texture_float");return{isWebGL2:r,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");i=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:s,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:h,maxTextureSize:u,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:r?e.getParameter(e.MAX_SAMPLES):0}}function Sp(e){const t=this;let n=null,i=0,s=!1,r=!1;const o=new Et,a=new fe,l={value:null,needsUpdate:!1};function c(){l.value!==n&&(l.value=n,l.needsUpdate=i>0),t.numPlanes=i,t.numIntersection=0}function h(e,n,i,s){const r=null!==e?e.length:0;let c=null;if(0!==r){if(c=l.value,!0!==s||null===c){const t=i+4*r,s=n.matrixWorldInverse;a.getNormalMatrix(s),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,n=i;t!==r;++t,n+=4)o.copy(e[t]).applyMatrix4(s,a),o.normal.toArray(c,n),c[n+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=r,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,r){const o=0!==e.length||t||0!==i||s;return s=t,n=h(e,r,0),i=e.length,o},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1,c()},this.setState=function(t,o,a){const u=t.clippingPlanes,d=t.clipIntersection,p=t.clipShadows,f=e.get(t);if(!s||null===u||0===u.length||r&&!p)r?h(null):c();else{const e=r?0:i,t=4*e;let s=f.clippingState||null;l.value=s,s=h(u,o,t,a);for(let e=0;e!==t;++e)s[e]=n[e];f.clippingState=s,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=e}}}class Mp extends Ae{constructor(e,t,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new xa(90,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new K(1,0,0)),this.add(i);const s=new xa(90,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new K(-1,0,0)),this.add(s);const r=new xa(90,1,e,t);r.layers=this.layers,r.up.set(0,0,1),r.lookAt(new K(0,1,0)),this.add(r);const o=new xa(90,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new K(0,-1,0)),this.add(o);const a=new xa(90,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new K(0,0,1)),this.add(a);const l=new xa(90,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new K(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,s,r,o,a,l]=this.children,c=e.xr.enabled,h=e.getRenderTarget();e.xr.enabled=!1;const u=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,i),e.setRenderTarget(n,1),e.render(t,s),e.setRenderTarget(n,2),e.render(t,r),e.setRenderTarget(n,3),e.render(t,o),e.setRenderTarget(n,4),e.render(t,a),n.texture.generateMipmaps=u,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(h),e.xr.enabled=c}}class Ep extends Dr{constructor(e,t,n,i,s,r,o,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:301,n,i,s,r,o=void 0!==o?o:1022,a,l,c),this._needsFlipEnvMap=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}Ep.prototype.isCubeTexture=!0;class Tp extends kr{constructor(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),super(e,e,t),t=t||{},this.texture=new Ep(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:1006,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=1023,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new yp(5,5,5),s=new Fr({name:"CubemapFromEquirect",uniforms:Ir(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});s.uniforms.tEquirect.value=t;const r=new On(i,s),o=t.minFilter;1008===t.minFilter&&(t.minFilter=1006);return new Mp(1,10,this).update(e,r),t.minFilter=o,r.geometry.dispose(),r.material.dispose(),this}clear(e,t,n,i){const s=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,n,i);e.setRenderTarget(s)}}function Cp(e){let t=new WeakMap;function n(e,t){return 303===t?e.mapping=301:304===t&&(e.mapping=302),e}function i(e){const n=e.target;n.removeEventListener("dispose",i);const s=t.get(n);void 0!==s&&(t.delete(n),s.dispose())}return{get:function(s){if(s&&s.isTexture){const r=s.mapping;if(303===r||304===r){if(t.has(s)){return n(t.get(s).texture,s.mapping)}{const r=s.image;if(r&&r.height>0){const o=e.getRenderTarget(),a=new Tp(r.height/2);return a.fromEquirectangularTexture(e,s),t.set(s,a),e.setRenderTarget(o),s.addEventListener("dispose",i),n(a.texture,s.mapping)}return null}}}return s},dispose:function(){t=new WeakMap}}}function Ap(e){const t={};function n(n){if(void 0!==t[n])return t[n];let i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=e.getExtension(n)}return t[n]=i,i}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Pp(e,t,n,i){const s={},r=new WeakMap;function o(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);a.removeEventListener("dispose",o),delete s[a.id];const l=r.get(a);l&&(t.remove(l),r.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e){const n=[],i=e.index,s=e.attributes.position;let o=0;if(null!==i){const e=i.array;o=i.version;for(let t=0,i=e.length;t<i;t+=3){const i=e[t+0],s=e[t+1],r=e[t+2];n.push(i,s,s,r,r,i)}}else{const e=s.array;o=s.version;for(let t=0,i=e.length/3-1;t<i;t+=3){const e=t+0,i=t+1,s=t+2;n.push(e,i,i,s,s,e)}}const a=new(ln(n)>65535?sn:tn)(n,1);a.version=o;const l=r.get(e);l&&t.remove(l),r.set(e,a)}return{get:function(e,t){return!0===s[t.id]||(t.addEventListener("dispose",o),s[t.id]=!0,n.memory.geometries++),t},update:function(n){const i=n.attributes;for(const n in i)t.update(i[n],e.ARRAY_BUFFER);const s=n.morphAttributes;for(const n in s){const i=s[n];for(let n=0,s=i.length;n<s;n++)t.update(i[n],e.ARRAY_BUFFER)}},getWireframeAttribute:function(e){const t=r.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return r.get(e)}}}function Lp(e,t,n,i){const s=i.isWebGL2;let r,o,a;this.setMode=function(e){r=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,i){e.drawElements(r,i,o,t*a),n.update(i,r,1)},this.renderInstances=function(i,l,c){if(0===c)return;let h,u;if(s)h=e,u="drawElementsInstanced";else if(h=t.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](r,l,o,i*a,c),n.update(l,r,c)}}function Rp(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(n,i,s){switch(t.calls++,i){case e.TRIANGLES:t.triangles+=s*(n/3);break;case e.LINES:t.lines+=s*(n/2);break;case e.LINE_STRIP:t.lines+=s*(n-1);break;case e.LINE_LOOP:t.lines+=s*n;break;case e.POINTS:t.points+=s*n;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Np(e,t){return e[0]-t[0]}function Dp(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Op(e){const t={},n=new Float32Array(8),i=[];for(let e=0;e<8;e++)i[e]=[e,0];return{update:function(s,r,o,a){const l=s.morphTargetInfluences,c=void 0===l?0:l.length;let h=t[r.id];if(void 0===h){h=[];for(let e=0;e<c;e++)h[e]=[e,0];t[r.id]=h}for(let e=0;e<c;e++){const t=h[e];t[0]=e,t[1]=l[e]}h.sort(Dp);for(let e=0;e<8;e++)e<c&&h[e][1]?(i[e][0]=h[e][0],i[e][1]=h[e][1]):(i[e][0]=Number.MAX_SAFE_INTEGER,i[e][1]=0);i.sort(Np);const u=o.morphTargets&&r.morphAttributes.position,d=o.morphNormals&&r.morphAttributes.normal;let p=0;for(let e=0;e<8;e++){const t=i[e],s=t[0],o=t[1];s!==Number.MAX_SAFE_INTEGER&&o?(u&&r.getAttribute("morphTarget"+e)!==u[s]&&r.setAttribute("morphTarget"+e,u[s]),d&&r.getAttribute("morphNormal"+e)!==d[s]&&r.setAttribute("morphNormal"+e,d[s]),n[e]=o,p+=o):(u&&!0===r.hasAttribute("morphTarget"+e)&&r.deleteAttribute("morphTarget"+e),d&&!0===r.hasAttribute("morphNormal"+e)&&r.deleteAttribute("morphNormal"+e),n[e]=0)}const f=r.morphTargetsRelative?1:1-p;a.getUniforms().setValue(e,"morphTargetBaseInfluence",f),a.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function kp(e,t,n,i){let s=new WeakMap;function r(e){const t=e.target;t.removeEventListener("dispose",r),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(o){const a=i.render.frame,l=o.geometry,c=t.get(o,l);return s.get(c)!==a&&(t.update(c),s.set(c,a)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",r)&&o.addEventListener("dispose",r),n.update(o.instanceMatrix,e.ARRAY_BUFFER),null!==o.instanceColor&&n.update(o.instanceColor,e.ARRAY_BUFFER)),c},dispose:function(){s=new WeakMap}}}Tp.prototype.isWebGLCubeRenderTarget=!0;class Ip extends Dr{constructor(e=null,t=1,n=1,i=1){super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}}Ip.prototype.isDataTexture2DArray=!0;class zp extends Dr{constructor(e=null,t=1,n=1,i=1){super(null),this.image={data:e,width:t,height:n,depth:i},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}}zp.prototype.isDataTexture3D=!0;const Up=new Dr,Fp=new Ip,Vp=new zp,Bp=new Ep,jp=[],$p=[],Gp=new Float32Array(16),Hp=new Float32Array(9),Wp=new Float32Array(4);function qp(e,t,n){const i=e[0];if(i<=0||i>0)return e;const s=t*n;let r=jp[s];if(void 0===r&&(r=new Float32Array(s),jp[s]=r),0!==t){i.toArray(r,0);for(let i=1,s=0;i!==t;++i)s+=n,e[i].toArray(r,s)}return r}function Xp(e,t){if(e.length!==t.length)return!1;for(let n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function Yp(e,t){for(let n=0,i=t.length;n<i;n++)e[n]=t[n]}function Zp(e,t){let n=$p[t];void 0===n&&(n=new Int32Array(t),$p[t]=n);for(let i=0;i!==t;++i)n[i]=e.allocateTextureUnit();return n}function Jp(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Kp(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Xp(n,t))return;e.uniform2fv(this.addr,t),Yp(n,t)}}function Qp(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Xp(n,t))return;e.uniform3fv(this.addr,t),Yp(n,t)}}function ef(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Xp(n,t))return;e.uniform4fv(this.addr,t),Yp(n,t)}}function tf(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Xp(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Yp(n,t)}else{if(Xp(n,i))return;Wp.set(i),e.uniformMatrix2fv(this.addr,!1,Wp),Yp(n,i)}}function nf(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Xp(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Yp(n,t)}else{if(Xp(n,i))return;Hp.set(i),e.uniformMatrix3fv(this.addr,!1,Hp),Yp(n,i)}}function sf(e,t){const n=this.cache,i=t.elements;if(void 0===i){if(Xp(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Yp(n,t)}else{if(Xp(n,i))return;Gp.set(i),e.uniformMatrix4fv(this.addr,!1,Gp),Yp(n,i)}}function rf(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function of(e,t){const n=this.cache;Xp(n,t)||(e.uniform2iv(this.addr,t),Yp(n,t))}function af(e,t){const n=this.cache;Xp(n,t)||(e.uniform3iv(this.addr,t),Yp(n,t))}function lf(e,t){const n=this.cache;Xp(n,t)||(e.uniform4iv(this.addr,t),Yp(n,t))}function cf(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function hf(e,t){const n=this.cache;Xp(n,t)||(e.uniform2uiv(this.addr,t),Yp(n,t))}function uf(e,t){const n=this.cache;Xp(n,t)||(e.uniform3uiv(this.addr,t),Yp(n,t))}function df(e,t){const n=this.cache;Xp(n,t)||(e.uniform4uiv(this.addr,t),Yp(n,t))}function pf(e,t,n){const i=this.cache,s=n.allocateTextureUnit();i[0]!==s&&(e.uniform1i(this.addr,s),i[0]=s),n.safeSetTexture2D(t||Up,s)}function ff(e,t,n){const i=this.cache,s=n.allocateTextureUnit();i[0]!==s&&(e.uniform1i(this.addr,s),i[0]=s),n.setTexture3D(t||Vp,s)}function mf(e,t,n){const i=this.cache,s=n.allocateTextureUnit();i[0]!==s&&(e.uniform1i(this.addr,s),i[0]=s),n.safeSetTextureCube(t||Bp,s)}function gf(e,t,n){const i=this.cache,s=n.allocateTextureUnit();i[0]!==s&&(e.uniform1i(this.addr,s),i[0]=s),n.setTexture2DArray(t||Fp,s)}function vf(e,t){e.uniform1fv(this.addr,t)}function yf(e,t){const n=qp(t,this.size,2);e.uniform2fv(this.addr,n)}function bf(e,t){const n=qp(t,this.size,3);e.uniform3fv(this.addr,n)}function xf(e,t){const n=qp(t,this.size,4);e.uniform4fv(this.addr,n)}function _f(e,t){const n=qp(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function wf(e,t){const n=qp(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function Sf(e,t){const n=qp(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Mf(e,t){e.uniform1iv(this.addr,t)}function Ef(e,t){e.uniform2iv(this.addr,t)}function Tf(e,t){e.uniform3iv(this.addr,t)}function Cf(e,t){e.uniform4iv(this.addr,t)}function Af(e,t){e.uniform1uiv(this.addr,t)}function Pf(e,t){e.uniform2uiv(this.addr,t)}function Lf(e,t){e.uniform3uiv(this.addr,t)}function Rf(e,t){e.uniform4uiv(this.addr,t)}function Nf(e,t,n){const i=t.length,s=Zp(n,i);e.uniform1iv(this.addr,s);for(let e=0;e!==i;++e)n.safeSetTexture2D(t[e]||Up,s[e])}function Df(e,t,n){const i=t.length,s=Zp(n,i);e.uniform1iv(this.addr,s);for(let e=0;e!==i;++e)n.safeSetTextureCube(t[e]||Bp,s[e])}function Of(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Jp;case 35664:return Kp;case 35665:return Qp;case 35666:return ef;case 35674:return tf;case 35675:return nf;case 35676:return sf;case 5124:case 35670:return rf;case 35667:case 35671:return of;case 35668:case 35672:return af;case 35669:case 35673:return lf;case 5125:return cf;case 36294:return hf;case 36295:return uf;case 36296:return df;case 35678:case 36198:case 36298:case 36306:case 35682:return pf;case 35679:case 36299:case 36307:return ff;case 35680:case 36300:case 36308:case 36293:return mf;case 36289:case 36303:case 36311:case 36292:return gf}}(t.type)}function kf(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return vf;case 35664:return yf;case 35665:return bf;case 35666:return xf;case 35674:return _f;case 35675:return wf;case 35676:return Sf;case 5124:case 35670:return Mf;case 35667:case 35671:return Ef;case 35668:case 35672:return Tf;case 35669:case 35673:return Cf;case 5125:return Af;case 36294:return Pf;case 36295:return Lf;case 36296:return Rf;case 35678:case 36198:case 36298:case 36306:case 35682:return Nf;case 35680:case 36300:case 36308:case 36293:return Df}}(t.type)}function If(e){this.id=e,this.seq=[],this.map={}}kf.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Yp(t,e)},If.prototype.setValue=function(e,t,n){const i=this.seq;for(let s=0,r=i.length;s!==r;++s){const r=i[s];r.setValue(e,t[r.id],n)}};const zf=/(\w+)(\])?(\[|\.)?/g;function Uf(e,t){e.seq.push(t),e.map[t.id]=t}function Ff(e,t,n){const i=e.name,s=i.length;for(zf.lastIndex=0;;){const r=zf.exec(i),o=zf.lastIndex;let a=r[1];const l="]"===r[2],c=r[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===s){Uf(n,void 0===c?new Of(a,e,t):new kf(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new If(a),Uf(n,e)),n=e}}}function Vf(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const n=e.getActiveUniform(t,i);Ff(n,e.getUniformLocation(t,n.name),this)}}function Bf(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),i}Vf.prototype.setValue=function(e,t,n,i){const s=this.map[t];void 0!==s&&s.setValue(e,n,i)},Vf.prototype.setOptional=function(e,t,n){const i=t[n];void 0!==i&&this.setValue(e,n,i)},Vf.upload=function(e,t,n,i){for(let s=0,r=t.length;s!==r;++s){const r=t[s],o=n[r.id];!1!==o.needsUpdate&&r.setValue(e,o.value,i)}},Vf.seqWithValue=function(e,t){const n=[];for(let i=0,s=e.length;i!==s;++i){const s=e[i];s.id in t&&n.push(s)}return n};let jf=0;function $f(e){switch(e){case 3e3:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function Gf(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),s=e.getShaderInfoLog(t).trim();if(i&&""===s)return"";return"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+s+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function Hf(e,t){const n=$f(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Wf(e,t){const n=$f(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function qf(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Xf(e){return""!==e}function Yf(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Zf(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Jf=/^[ \t]*#include +<([\w\d./]+)>/gm;function Kf(e){return e.replace(Jf,Qf)}function Qf(e,t){const n=vo[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Kf(n)}const em=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,tm=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function nm(e){return e.replace(tm,sm).replace(em,im)}function im(e,t,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),sm(e,t,n,i)}function sm(e,t,n,i){let s="";for(let e=parseInt(t);e<parseInt(n);e++)s+=i.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return s}function rm(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function om(e,t,n,i){const s=e.getContext(),r=n.defines;let o=n.vertexShader,a=n.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case 301:case 302:t="ENVMAP_TYPE_CUBE";break;case 306:case 307:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),h=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case 302:case 307:t="ENVMAP_MODE_REFRACTION"}return t}(n),u=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),d=e.gammaFactor>0?e.gammaFactor:1,p=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Xf).join("\n")}(n),f=function(e){const t=[];for(const n in e){const i=e[n];!1!==i&&t.push("#define "+n+" "+i)}return t.join("\n")}(r),m=s.createProgram();let g,v,y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(g=[f].filter(Xf).join("\n"),g.length>0&&(g+="\n"),v=[p,f].filter(Xf).join("\n"),v.length>0&&(v+="\n")):(g=[rm(n),"#define SHADER_NAME "+n.shaderName,f,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+d,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Xf).join("\n"),v=[p,rm(n),"#define SHADER_NAME "+n.shaderName,f,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+d,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+c:"",n.envMap?"#define "+h:"",n.envMap?"#define "+u:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?vo.tonemapping_pars_fragment:"",0!==n.toneMapping?qf("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",vo.encodings_pars_fragment,n.map?Hf("mapTexelToLinear",n.mapEncoding):"",n.matcap?Hf("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?Hf("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?Hf("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?Hf("lightMapTexelToLinear",n.lightMapEncoding):"",Wf("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Xf).join("\n")),o=Kf(o),o=Yf(o,n),o=Zf(o,n),a=Kf(a),a=Yf(a,n),a=Zf(a,n),o=nm(o),a=nm(a),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",g=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in","300 es"===n.glslVersion?"":"out highp vec4 pc_fragColor;","300 es"===n.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const b=y+g+o,x=y+v+a,_=Bf(s,s.VERTEX_SHADER,b),w=Bf(s,s.FRAGMENT_SHADER,x);if(s.attachShader(m,_),s.attachShader(m,w),void 0!==n.index0AttributeName?s.bindAttribLocation(m,0,n.index0AttributeName):!0===n.morphTargets&&s.bindAttribLocation(m,0,"position"),s.linkProgram(m),e.debug.checkShaderErrors){const e=s.getProgramInfoLog(m).trim(),t=s.getShaderInfoLog(_).trim(),n=s.getShaderInfoLog(w).trim();let i=!0,r=!0;if(!1===s.getProgramParameter(m,s.LINK_STATUS)){i=!1;const t=Gf(s,_,"vertex"),n=Gf(s,w,"fragment");console.error("THREE.WebGLProgram: shader error: ",s.getError(),"gl.VALIDATE_STATUS",s.getProgramParameter(m,s.VALIDATE_STATUS),"gl.getProgramInfoLog",e,t,n)}else""!==e?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",e):""!==t&&""!==n||(r=!1);r&&(this.diagnostics={runnable:i,programLog:e,vertexShader:{log:t,prefix:g},fragmentShader:{log:n,prefix:v}})}let S,M;return s.deleteShader(_),s.deleteShader(w),this.getUniforms=function(){return void 0===S&&(S=new Vf(s,m)),S},this.getAttributes=function(){return void 0===M&&(M=function(e,t){const n={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let s=0;s<i;s++){const i=e.getActiveAttrib(t,s).name;n[i]=e.getAttribLocation(t,i)}return n}(s,m)),M},this.destroy=function(){i.releaseStatesOfProgram(this),s.deleteProgram(m),this.program=void 0},this.name=n.shaderName,this.id=jf++,this.cacheKey=t,this.usedTimes=1,this.program=m,this.vertexShader=_,this.fragmentShader=w,this}function am(e,t,n,i,s,r){const o=[],a=i.isWebGL2,l=i.logarithmicDepthBuffer,c=i.floatVertexTextures,h=i.maxVertexUniforms,u=i.vertexTextures;let d=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},f=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function m(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=3e3,t}return{getParameters:function(s,o,f,g,v){const y=g.fog,b=s.isMeshStandardMaterial?g.environment:null,x=t.get(s.envMap||b),_=p[s.type],w=v.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(c)return 1024;{const e=h,n=Math.floor((e-20)/4),i=Math.min(n,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}}(v):0;let S,M;if(null!==s.precision&&(d=i.getMaxPrecision(s.precision),d!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",d,"instead.")),_){const e=bo[_];S=e.vertexShader,M=e.fragmentShader}else S=s.vertexShader,M=s.fragmentShader;const E=e.getRenderTarget();return{isWebGL2:a,shaderID:_,shaderName:s.type,vertexShader:S,fragmentShader:M,defines:s.defines,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:d,instancing:!0===v.isInstancedMesh,instancingColor:!0===v.isInstancedMesh&&null!==v.instanceColor,supportsVertexTextures:u,outputEncoding:null!==E?m(E.texture):e.outputEncoding,map:!!s.map,mapEncoding:m(s.map),matcap:!!s.matcap,matcapEncoding:m(s.matcap),envMap:!!x,envMapMode:x&&x.mapping,envMapEncoding:m(x),envMapCubeUV:!!x&&(306===x.mapping||307===x.mapping),lightMap:!!s.lightMap,lightMapEncoding:m(s.lightMap),aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,emissiveMapEncoding:m(s.emissiveMap),bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:1===s.normalMapType,tangentSpaceNormalMap:0===s.normalMapType,clearcoatMap:!!s.clearcoatMap,clearcoatRoughnessMap:!!s.clearcoatRoughnessMap,clearcoatNormalMap:!!s.clearcoatNormalMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,alphaMap:!!s.alphaMap,gradientMap:!!s.gradientMap,sheen:!!s.sheen,transmissionMap:!!s.transmissionMap,combine:s.combine,vertexTangents:s.normalMap&&s.vertexTangents,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&v.geometry.attributes.color&&4===v.geometry.attributes.color.itemSize,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.displacementMap||s.transmissionMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.transmissionMap||!s.displacementMap),fog:!!y,useFog:s.fog,fogExp2:y&&y.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:l,skinning:s.skinning&&w>0,maxBones:w,useVertexTexture:c,morphTargets:s.morphTargets,morphNormals:s.morphNormals,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:r.numPlanes,numClipIntersection:r.numIntersection,dithering:s.dithering,shadowMapEnabled:e.shadowMap.enabled&&f.length>0,shadowMapType:e.shadowMap.type,toneMapping:s.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,alphaTest:s.alphaTest,doubleSided:2===s.side,flipSided:1===s.side,depthPacking:void 0!==s.depthPacking&&s.depthPacking,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:a||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:a||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:a||n.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<f.length;e++)n.push(t[f[e]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=p[e.type];let n;if(t){const e=bo[t];n=Ur.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let i;for(let e=0,t=o.length;e<t;e++){const t=o[e];if(t.cacheKey===n){i=t,++i.usedTimes;break}}return void 0===i&&(i=new om(e,n,t,s),o.push(i)),i},releaseProgram:function(e){if(0==--e.usedTimes){const t=o.indexOf(e);o[t]=o[o.length-1],o.pop(),e.destroy()}},programs:o}}function lm(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,i){e.get(t)[n]=i},dispose:function(){e=new WeakMap}}}function cm(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function hm(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function um(e){const t=[];let n=0;const i=[],s=[],r={id:-1};function o(i,s,o,a,l,c){let h=t[n];const u=e.get(o);return void 0===h?(h={id:i.id,object:i,geometry:s,material:o,program:u.program||r,groupOrder:a,renderOrder:i.renderOrder,z:l,group:c},t[n]=h):(h.id=i.id,h.object=i,h.geometry=s,h.material=o,h.program=u.program||r,h.groupOrder=a,h.renderOrder=i.renderOrder,h.z=l,h.group=c),n++,h}return{opaque:i,transparent:s,init:function(){n=0,i.length=0,s.length=0},push:function(e,t,n,r,a,l){const c=o(e,t,n,r,a,l);(!0===n.transparent?s:i).push(c)},unshift:function(e,t,n,r,a,l){const c=o(e,t,n,r,a,l);(!0===n.transparent?s:i).unshift(c)},finish:function(){for(let e=n,i=t.length;e<i;e++){const n=t[e];if(null===n.id)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.program=null,n.group=null}},sort:function(e,t){i.length>1&&i.sort(e||cm),s.length>1&&s.sort(t||hm)}}}function dm(e){let t=new WeakMap;return{get:function(n,i){let s;return!1===t.has(n)?(s=new um(e),t.set(n,[s])):i>=t.get(n).length?(s=new um(e),t.get(n).push(s)):s=t.get(n)[i],s},dispose:function(){t=new WeakMap}}}function pm(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new K,color:new Ht};break;case"SpotLight":n={position:new K,direction:new K,color:new Ht,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new K,color:new Ht,distance:0,decay:0};break;case"HemisphereLight":n={direction:new K,skyColor:new Ht,groundColor:new Ht};break;case"RectAreaLight":n={color:new Ht,position:new K,halfWidth:new K,halfHeight:new K}}return e[t.id]=n,n}}}let fm=0;function mm(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function gm(e,t){const n=new pm,i=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gt};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gt,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)s.probe.push(new K);const r=new K,o=new te,a=new te;return{setup:function(r){let o=0,a=0,l=0;for(let e=0;e<9;e++)s.probe[e].set(0,0,0);let c=0,h=0,u=0,d=0,p=0,f=0,m=0,g=0;r.sort(mm);for(let e=0,t=r.length;e<t;e++){const t=r[e],v=t.color,y=t.intensity,b=t.distance,x=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)o+=v.r*y,a+=v.g*y,l+=v.b*y;else if(t.isLightProbe)for(let e=0;e<9;e++)s.probe[e].addScaledVector(t.sh.coefficients[e],y);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,s.directionalShadow[c]=n,s.directionalShadowMap[c]=x,s.directionalShadowMatrix[c]=t.shadow.matrix,f++}s.directional[c]=e,c++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(v).multiplyScalar(y),e.distance=b,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,s.spotShadow[u]=n,s.spotShadowMap[u]=x,s.spotShadowMatrix[u]=t.shadow.matrix,g++}s.spot[u]=e,u++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(v).multiplyScalar(y),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),s.rectArea[d]=e,d++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=i.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,s.pointShadow[h]=n,s.pointShadowMap[h]=x,s.pointShadowMatrix[h]=t.shadow.matrix,m++}s.point[h]=e,h++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(y),e.groundColor.copy(t.groundColor).multiplyScalar(y),s.hemi[p]=e,p++}}d>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(s.rectAreaLTC1=yo.LTC_FLOAT_1,s.rectAreaLTC2=yo.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(s.rectAreaLTC1=yo.LTC_HALF_1,s.rectAreaLTC2=yo.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=o,s.ambient[1]=a,s.ambient[2]=l;const v=s.hash;v.directionalLength===c&&v.pointLength===h&&v.spotLength===u&&v.rectAreaLength===d&&v.hemiLength===p&&v.numDirectionalShadows===f&&v.numPointShadows===m&&v.numSpotShadows===g||(s.directional.length=c,s.spot.length=u,s.rectArea.length=d,s.point.length=h,s.hemi.length=p,s.directionalShadow.length=f,s.directionalShadowMap.length=f,s.pointShadow.length=m,s.pointShadowMap.length=m,s.spotShadow.length=g,s.spotShadowMap.length=g,s.directionalShadowMatrix.length=f,s.pointShadowMatrix.length=m,s.spotShadowMatrix.length=g,v.directionalLength=c,v.pointLength=h,v.spotLength=u,v.rectAreaLength=d,v.hemiLength=p,v.numDirectionalShadows=f,v.numPointShadows=m,v.numSpotShadows=g,s.version=fm++)},setupView:function(e,t){let n=0,i=0,l=0,c=0,h=0;const u=t.matrixWorldInverse;for(let t=0,d=e.length;t<d;t++){const d=e[t];if(d.isDirectionalLight){const e=s.directional[n];e.direction.setFromMatrixPosition(d.matrixWorld),r.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(u),n++}else if(d.isSpotLight){const e=s.spot[l];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),e.direction.setFromMatrixPosition(d.matrixWorld),r.setFromMatrixPosition(d.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const e=s.rectArea[c];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),a.identity(),o.copy(d.matrixWorld),o.premultiply(u),a.extractRotation(o),e.halfWidth.set(.5*d.width,0,0),e.halfHeight.set(0,.5*d.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(d.isPointLight){const e=s.point[i];e.position.setFromMatrixPosition(d.matrixWorld),e.position.applyMatrix4(u),i++}else if(d.isHemisphereLight){const e=s.hemi[h];e.direction.setFromMatrixPosition(d.matrixWorld),e.direction.transformDirection(u),e.direction.normalize(),h++}}},state:s}}function vm(e,t){const n=new gm(e,t),i=[],s=[];return{init:function(){i.length=0,s.length=0},state:{lightsArray:i,shadowsArray:s,lights:n},setupLights:function(){n.setup(i)},setupLightsView:function(e){n.setupView(i,e)},pushLight:function(e){i.push(e)},pushShadow:function(e){s.push(e)}}}function ym(e,t){let n=new WeakMap;return{get:function(i,s=0){let r;return!1===n.has(i)?(r=new vm(e,t),n.set(i,[r])):s>=n.get(i).length?(r=new vm(e,t),n.get(i).push(r)):r=n.get(i)[s],r},dispose:function(){n=new WeakMap}}}class bm extends Ut{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}bm.prototype.isMeshDepthMaterial=!0;class xm extends Ut{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new K,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}xm.prototype.isMeshDistanceMaterial=!0;function _m(e,t,n){let i=new ha;const s=new gt,r=new gt,o=new qt,a=[],l=[],c={},h=n.maxTextureSize,u={0:1,1:0,2:2},d=new Fr({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new gt},radius:{value:4}},vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}\n",fragmentShader:"\nuniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n\n#include <packing>\n\nvoid main() {\n\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\n\t// This seems totally useless but it's a crazy work around for a Adreno compiler bug\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\n\t\t#ifdef HORIZONTAL_PASS\n\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\n\t\t#else\n\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\n\t\t#endif\n\n\t}\n\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n\n}\n"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const f=new gn;f.setAttribute("position",new Zt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new On(f,d),g=this;function v(n,i){const s=t.update(m);d.uniforms.shadow_pass.value=n.map.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(i,null,s,d,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(i,null,s,p,m,null)}function y(e,t,n){const i=e<<0|t<<1|n<<2;let s=a[i];return void 0===s&&(s=new bm({depthPacking:3201,morphTargets:e,skinning:t}),a[i]=s),s}function b(e,t,n){const i=e<<0|t<<1|n<<2;let s=l[i];return void 0===s&&(s=new xm({morphTargets:e,skinning:t}),l[i]=s),s}function x(t,n,i,s,r,o,a){let l=null,h=y,d=t.customDepthMaterial;if(!0===s.isPointLight&&(h=b,d=t.customDistanceMaterial),void 0===d){let e=!1;!0===i.morphTargets&&(e=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);let s=!1;!0===t.isSkinnedMesh&&(!0===i.skinning?s=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t));l=h(e,s,!0===t.isInstancedMesh)}else l=d;if(e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){const e=l.uuid,t=i.uuid;let n=c[e];void 0===n&&(n={},c[e]=n);let s=n[t];void 0===s&&(s=l.clone(),n[t]=s),l=s}return l.visible=i.visible,l.wireframe=i.wireframe,l.side=3===a?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:u[i.side],l.clipShadows=i.clipShadows,l.clippingPlanes=i.clippingPlanes,l.clipIntersection=i.clipIntersection,l.wireframeLinewidth=i.wireframeLinewidth,l.linewidth=i.linewidth,!0===s.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(s.matrixWorld),l.nearDistance=r,l.farDistance=o),l}function _(n,s,r,o,a){if(!1===n.visible)return;if(n.layers.test(s.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,n.matrixWorld);const i=t.update(n),s=n.material;if(Array.isArray(s)){const t=i.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],h=s[c.materialIndex];if(h&&h.visible){const t=x(n,i,h,o,r.near,r.far,a);e.renderBufferDirect(r,null,i,t,n,c)}}}else if(s.visible){const t=x(n,i,s,o,r.near,r.far,a);e.renderBufferDirect(r,null,i,t,n,null)}}const l=n.children;for(let e=0,t=l.length;e<t;e++)_(l[e],s,r,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),u=e.getActiveMipmapLevel(),d=e.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(let l=0,c=t.length;l<c;l++){const c=t[l],u=c.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;s.copy(u.mapSize);const p=u.getFrameExtents();if(s.multiply(p),r.copy(u.mapSize),(s.x>h||s.y>h)&&(s.x>h&&(r.x=Math.floor(h/p.x),s.x=r.x*p.x,u.mapSize.x=r.x),s.y>h&&(r.y=Math.floor(h/p.y),s.y=r.y*p.y,u.mapSize.y=r.y)),null===u.map&&!u.isPointLightShadow&&3===this.type){const e={minFilter:1006,magFilter:1006,format:1023};u.map=new kr(s.x,s.y,e),u.map.texture.name=c.name+".shadowMap",u.mapPass=new kr(s.x,s.y,e),u.camera.updateProjectionMatrix()}if(null===u.map){const e={minFilter:1003,magFilter:1003,format:1023};u.map=new kr(s.x,s.y,e),u.map.texture.name=c.name+".shadowMap",u.camera.updateProjectionMatrix()}e.setRenderTarget(u.map),e.clear();const f=u.getViewportCount();for(let e=0;e<f;e++){const t=u.getViewport(e);o.set(r.x*t.x,r.y*t.y,r.x*t.z,r.y*t.w),d.viewport(o),u.updateMatrices(c,e),i=u.getFrustum(),_(n,a,u.camera,c,this.type)}u.isPointLightShadow||3!==this.type||v(u,a),u.needsUpdate=!1}g.needsUpdate=!1,e.setRenderTarget(l,c,u)}}function wm(e,t,n){const i=n.isWebGL2;const s=new function(){let t=!1;const n=new qt;let i=null;const s=new qt(0,0,0,0);return{setMask:function(n){i===n||t||(e.colorMask(n,n,n,n),i=n)},setLocked:function(e){t=e},setClear:function(t,i,r,o,a){!0===a&&(t*=o,i*=o,r*=o),n.set(t,i,r,o),!1===s.equals(n)&&(e.clearColor(t,i,r,o),s.copy(n))},reset:function(){t=!1,i=null,s.set(-1,0,0,0)}}},r=new function(){let t=!1,n=null,i=null,s=null;return{setTest:function(t){t?k(e.DEPTH_TEST):I(e.DEPTH_TEST)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);i=t}},setLocked:function(e){t=e},setClear:function(t){s!==t&&(e.clearDepth(t),s=t)},reset:function(){t=!1,n=null,i=null,s=null}}},o=new function(){let t=!1,n=null,i=null,s=null,r=null,o=null,a=null,l=null,c=null;return{setTest:function(n){t||(n?k(e.STENCIL_TEST):I(e.STENCIL_TEST))},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,o){i===t&&s===n&&r===o||(e.stencilFunc(t,n,o),i=t,s=n,r=o)},setOp:function(t,n,i){o===t&&a===n&&l===i||(e.stencilOp(t,n,i),o=t,a=n,l=i)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,i=null,s=null,r=null,o=null,a=null,l=null,c=null}}};let a={},l=null,c={},h=null,u=!1,d=null,p=null,f=null,m=null,g=null,v=null,y=null,b=!1,x=null,_=null,w=null,S=null,M=null;const E=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let T=!1,C=0;const A=e.getParameter(e.VERSION);-1!==A.indexOf("WebGL")?(C=parseFloat(/^WebGL (\d)/.exec(A)[1]),T=C>=1):-1!==A.indexOf("OpenGL ES")&&(C=parseFloat(/^OpenGL ES (\d)/.exec(A)[1]),T=C>=2);let P=null,L={};const R=new qt(0,0,e.canvas.width,e.canvas.height),N=new qt(0,0,e.canvas.width,e.canvas.height);function D(t,n,i){const s=new Uint8Array(4),r=e.createTexture();e.bindTexture(t,r),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(let t=0;t<i;t++)e.texImage2D(n+t,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,s);return r}const O={};function k(t){!0!==a[t]&&(e.enable(t),a[t]=!0)}function I(t){!1!==a[t]&&(e.disable(t),a[t]=!1)}O[e.TEXTURE_2D]=D(e.TEXTURE_2D,e.TEXTURE_2D,1),O[e.TEXTURE_CUBE_MAP]=D(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),s.setClear(0,0,0,1),r.setClear(1),o.setClear(0),k(e.DEPTH_TEST),r.setFunc(3),V(!1),B(1),k(e.CULL_FACE),F(0);const z={100:e.FUNC_ADD,101:e.FUNC_SUBTRACT,102:e.FUNC_REVERSE_SUBTRACT};if(i)z[103]=e.MIN,z[104]=e.MAX;else{const e=t.get("EXT_blend_minmax");null!==e&&(z[103]=e.MIN_EXT,z[104]=e.MAX_EXT)}const U={200:e.ZERO,201:e.ONE,202:e.SRC_COLOR,204:e.SRC_ALPHA,210:e.SRC_ALPHA_SATURATE,208:e.DST_COLOR,206:e.DST_ALPHA,203:e.ONE_MINUS_SRC_COLOR,205:e.ONE_MINUS_SRC_ALPHA,209:e.ONE_MINUS_DST_COLOR,207:e.ONE_MINUS_DST_ALPHA};function F(t,n,i,s,r,o,a,l){if(0!==t){if(!1===u&&(k(e.BLEND),u=!0),5===t)r=r||n,o=o||i,a=a||s,n===p&&r===g||(e.blendEquationSeparate(z[n],z[r]),p=n,g=r),i===f&&s===m&&o===v&&a===y||(e.blendFuncSeparate(U[i],U[s],U[o],U[a]),f=i,m=s,v=o,y=a),d=t,b=null;else if(t!==d||l!==b){if(100===p&&100===g||(e.blendEquation(e.FUNC_ADD),p=100,g=100),l)switch(t){case 1:e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.ONE,e.ONE);break;case 3:e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA);break;case 4:e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);break;case 2:e.blendFunc(e.SRC_ALPHA,e.ONE);break;case 3:e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR);break;case 4:e.blendFunc(e.ZERO,e.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}f=null,m=null,v=null,y=null,d=t,b=l}}else!0===u&&(I(e.BLEND),u=!1)}function V(t){x!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),x=t)}function B(t){0!==t?(k(e.CULL_FACE),t!==_&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):I(e.CULL_FACE),_=t}function j(t,n,i){t?(k(e.POLYGON_OFFSET_FILL),S===n&&M===i||(e.polygonOffset(n,i),S=n,M=i)):I(e.POLYGON_OFFSET_FILL)}function $(t){void 0===t&&(t=e.TEXTURE0+E-1),P!==t&&(e.activeTexture(t),P=t)}return{buffers:{color:s,depth:r,stencil:o},enable:k,disable:I,bindFramebuffer:function(t,n){null===n&&null!==l&&(n=l),c[t]!==n&&(e.bindFramebuffer(t,n),c[t]=n)},bindXRFramebuffer:function(t){t!==l&&(e.bindFramebuffer(e.FRAMEBUFFER,t),l=t)},useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:F,setMaterial:function(t,n){2===t.side?I(e.CULL_FACE):k(e.CULL_FACE);let i=1===t.side;n&&(i=!i),V(i),1===t.blending&&!1===t.transparent?F(0):F(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),r.setFunc(t.depthFunc),r.setTest(t.depthTest),r.setMask(t.depthWrite),s.setMask(t.colorWrite);const a=t.stencilWrite;o.setTest(a),a&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),j(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?k(e.SAMPLE_ALPHA_TO_COVERAGE):I(e.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:V,setCullFace:B,setLineWidth:function(t){t!==w&&(T&&e.lineWidth(t),w=t)},setPolygonOffset:j,setScissorTest:function(t){t?k(e.SCISSOR_TEST):I(e.SCISSOR_TEST)},activeTexture:$,bindTexture:function(t,n){null===P&&$();let i=L[P];void 0===i&&(i={type:void 0,texture:void 0},L[P]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||O[t]),i.type=t,i.texture=n)},unbindTexture:function(){const t=L[P];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===R.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),R.copy(t))},viewport:function(t){!1===N.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),N.copy(t))},reset:function(){e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SCISSOR_TEST),e.disable(e.STENCIL_TEST),e.disable(e.SAMPLE_ALPHA_TO_COVERAGE),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.blendFuncSeparate(e.ONE,e.ZERO,e.ONE,e.ZERO),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(e.LESS),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.clearStencil(0),e.cullFace(e.BACK),e.frontFace(e.CCW),e.polygonOffset(0,0),e.activeTexture(e.TEXTURE0),e.bindFramebuffer(e.FRAMEBUFFER,null),!0===i&&(e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null),e.bindFramebuffer(e.READ_FRAMEBUFFER,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),a={},P=null,L={},l=null,c={},h=null,u=!1,d=null,p=null,f=null,m=null,g=null,v=null,y=null,b=!1,x=null,_=null,w=null,S=null,M=null,R.set(0,0,e.canvas.width,e.canvas.height),N.set(0,0,e.canvas.width,e.canvas.height),s.reset(),r.reset(),o.reset()}}}function Sm(e,t,n,i,s,r,o){const a=s.isWebGL2,l=s.maxTextures,c=s.maxCubemapSize,h=s.maxTextureSize,u=s.maxSamples,d=new WeakMap;let p,f=!1;try{f="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function m(e,t){return f?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function g(e,t,n,i){let s=1;if((e.width>i||e.height>i)&&(s=i/Math.max(e.width,e.height)),s<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const i=t?Z.floorPowerOfTwo:Math.floor,r=i(s*e.width),o=i(s*e.height);void 0===p&&(p=m(r,o));const a=n?m(r,o):p;a.width=r,a.height=o;return a.getContext("2d").drawImage(e,0,0,r,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+r+"x"+o+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function v(e){return Z.isPowerOfTwo(e.width)&&Z.isPowerOfTwo(e.height)}function y(e,t){return e.generateMipmaps&&t&&1003!==e.minFilter&&1006!==e.minFilter}function b(t,n,s,r){e.generateMipmap(t);i.get(n).__maxMipLevel=Math.log2(Math.max(s,r))}function x(n,i,s){if(!1===a)return i;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let r=i;return i===e.RED&&(s===e.FLOAT&&(r=e.R32F),s===e.HALF_FLOAT&&(r=e.R16F),s===e.UNSIGNED_BYTE&&(r=e.R8)),i===e.RGB&&(s===e.FLOAT&&(r=e.RGB32F),s===e.HALF_FLOAT&&(r=e.RGB16F),s===e.UNSIGNED_BYTE&&(r=e.RGB8)),i===e.RGBA&&(s===e.FLOAT&&(r=e.RGBA32F),s===e.HALF_FLOAT&&(r=e.RGBA16F),s===e.UNSIGNED_BYTE&&(r=e.RGBA8)),r!==e.R16F&&r!==e.R32F&&r!==e.RGBA16F&&r!==e.RGBA32F||t.get("EXT_color_buffer_float"),r}function _(t){return 1003===t||1004===t||1005===t?e.NEAREST:e.LINEAR}function w(t){const n=t.target;n.removeEventListener("dispose",w),function(t){const n=i.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),i.remove(t)}(n),n.isVideoTexture&&d.delete(n),o.memory.textures--}function S(t){const n=t.target;n.removeEventListener("dispose",S),function(t){const n=t.texture,s=i.get(t),r=i.get(n);if(!t)return;void 0!==r.__webglTexture&&e.deleteTexture(r.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(s.__webglFramebuffer[t]),s.__webglDepthbuffer&&e.deleteRenderbuffer(s.__webglDepthbuffer[t]);else e.deleteFramebuffer(s.__webglFramebuffer),s.__webglDepthbuffer&&e.deleteRenderbuffer(s.__webglDepthbuffer),s.__webglMultisampledFramebuffer&&e.deleteFramebuffer(s.__webglMultisampledFramebuffer),s.__webglColorRenderbuffer&&e.deleteRenderbuffer(s.__webglColorRenderbuffer),s.__webglDepthRenderbuffer&&e.deleteRenderbuffer(s.__webglDepthRenderbuffer);i.remove(n),i.remove(t)}(n),o.memory.textures--}let M=0;function E(t,s){const r=i.get(t);if(t.isVideoTexture&&function(e){const t=o.render.frame;d.get(e)!==t&&(d.set(e,t),e.update())}(t),t.version>0&&r.__version!==t.version){const e=t.image;if(void 0===e)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==e.complete)return void R(r,t,s);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(e.TEXTURE0+s),n.bindTexture(e.TEXTURE_2D,r.__webglTexture)}function T(t,s){const o=i.get(t);t.version>0&&o.__version!==t.version?function(t,i,s){if(6!==i.image.length)return;L(t,i),n.activeTexture(e.TEXTURE0+s),n.bindTexture(e.TEXTURE_CUBE_MAP,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const o=i&&(i.isCompressedTexture||i.image[0].isCompressedTexture),l=i.image[0]&&i.image[0].isDataTexture,h=[];for(let e=0;e<6;e++)h[e]=o||l?l?i.image[e].image:i.image[e]:g(i.image[e],!1,!0,c);const u=h[0],d=v(u)||a,p=r.convert(i.format),f=r.convert(i.type),m=x(i.internalFormat,p,f);let _;if(P(e.TEXTURE_CUBE_MAP,i,d),o){for(let t=0;t<6;t++){_=h[t].mipmaps;for(let s=0;s<_.length;s++){const r=_[s];1023!==i.format&&1022!==i.format?null!==p?n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,s,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,s,m,r.width,r.height,0,p,f,r.data)}}t.__maxMipLevel=_.length-1}else{_=i.mipmaps;for(let t=0;t<6;t++)if(l){n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,m,h[t].width,h[t].height,0,p,f,h[t].data);for(let i=0;i<_.length;i++){const s=_[i].image[t].image;n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,m,s.width,s.height,0,p,f,s.data)}}else{n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,m,p,f,h[t]);for(let i=0;i<_.length;i++){const s=_[i];n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+t,i+1,m,p,f,s.image[t])}}t.__maxMipLevel=_.length}y(i,d)&&b(e.TEXTURE_CUBE_MAP,i,u.width,u.height);t.__version=i.version,i.onUpdate&&i.onUpdate(i)}(o,t,s):(n.activeTexture(e.TEXTURE0+s),n.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture))}const C={1e3:e.REPEAT,1001:e.CLAMP_TO_EDGE,1002:e.MIRRORED_REPEAT},A={1003:e.NEAREST,1004:e.NEAREST_MIPMAP_NEAREST,1005:e.NEAREST_MIPMAP_LINEAR,1006:e.LINEAR,1007:e.LINEAR_MIPMAP_NEAREST,1008:e.LINEAR_MIPMAP_LINEAR};function P(n,r,o){if(o?(e.texParameteri(n,e.TEXTURE_WRAP_S,C[r.wrapS]),e.texParameteri(n,e.TEXTURE_WRAP_T,C[r.wrapT]),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,C[r.wrapR]),e.texParameteri(n,e.TEXTURE_MAG_FILTER,A[r.magFilter]),e.texParameteri(n,e.TEXTURE_MIN_FILTER,A[r.minFilter])):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n!==e.TEXTURE_3D&&n!==e.TEXTURE_2D_ARRAY||e.texParameteri(n,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),1001===r.wrapS&&1001===r.wrapT||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,e.TEXTURE_MAG_FILTER,_(r.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,_(r.minFilter)),1003!==r.minFilter&&1006!==r.minFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(1015===r.type&&!1===t.has("OES_texture_float_linear"))return;if(!1===a&&1016===r.type&&!1===t.has("OES_texture_half_float_linear"))return;(r.anisotropy>1||i.get(r).__currentAnisotropy)&&(e.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r.anisotropy,s.getMaxAnisotropy())),i.get(r).__currentAnisotropy=r.anisotropy)}}function L(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",w),t.__webglTexture=e.createTexture(),o.memory.textures++)}function R(t,i,s){let o=e.TEXTURE_2D;i.isDataTexture2DArray&&(o=e.TEXTURE_2D_ARRAY),i.isDataTexture3D&&(o=e.TEXTURE_3D),L(t,i),n.activeTexture(e.TEXTURE0+s),n.bindTexture(o,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE);const l=function(e){return!a&&(1001!==e.wrapS||1001!==e.wrapT||1003!==e.minFilter&&1006!==e.minFilter)}(i)&&!1===v(i.image),c=g(i.image,l,!1,h),u=v(c)||a,d=r.convert(i.format);let p,f=r.convert(i.type),m=x(i.internalFormat,d,f);P(o,i,u);const _=i.mipmaps;if(i.isDepthTexture)m=e.DEPTH_COMPONENT,a?m=1015===i.type?e.DEPTH_COMPONENT32F:1014===i.type?e.DEPTH_COMPONENT24:1020===i.type?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT16:1015===i.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===i.format&&m===e.DEPTH_COMPONENT&&1012!==i.type&&1014!==i.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=1012,f=r.convert(i.type)),1027===i.format&&m===e.DEPTH_COMPONENT&&(m=e.DEPTH_STENCIL,1020!==i.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=1020,f=r.convert(i.type))),n.texImage2D(e.TEXTURE_2D,0,m,c.width,c.height,0,d,f,null);else if(i.isDataTexture)if(_.length>0&&u){for(let t=0,i=_.length;t<i;t++)p=_[t],n.texImage2D(e.TEXTURE_2D,t,m,p.width,p.height,0,d,f,p.data);i.generateMipmaps=!1,t.__maxMipLevel=_.length-1}else n.texImage2D(e.TEXTURE_2D,0,m,c.width,c.height,0,d,f,c.data),t.__maxMipLevel=0;else if(i.isCompressedTexture){for(let t=0,s=_.length;t<s;t++)p=_[t],1023!==i.format&&1022!==i.format?null!==d?n.compressedTexImage2D(e.TEXTURE_2D,t,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(e.TEXTURE_2D,t,m,p.width,p.height,0,d,f,p.data);t.__maxMipLevel=_.length-1}else if(i.isDataTexture2DArray)n.texImage3D(e.TEXTURE_2D_ARRAY,0,m,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(i.isDataTexture3D)n.texImage3D(e.TEXTURE_3D,0,m,c.width,c.height,c.depth,0,d,f,c.data),t.__maxMipLevel=0;else if(_.length>0&&u){for(let t=0,i=_.length;t<i;t++)p=_[t],n.texImage2D(e.TEXTURE_2D,t,m,d,f,p);i.generateMipmaps=!1,t.__maxMipLevel=_.length-1}else n.texImage2D(e.TEXTURE_2D,0,m,d,f,c),t.__maxMipLevel=0;y(i,u)&&b(o,i,c.width,c.height),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function N(t,s,o,a){const l=s.texture,c=r.convert(l.format),h=r.convert(l.type),u=x(l.internalFormat,c,h);a===e.TEXTURE_3D||a===e.TEXTURE_2D_ARRAY?n.texImage3D(a,0,u,s.width,s.height,s.depth,0,c,h,null):n.texImage2D(a,0,u,s.width,s.height,0,c,h,null),n.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,o,a,i.get(l).__webglTexture,0),n.bindFramebuffer(e.FRAMEBUFFER,null)}function D(t,n,i){if(e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer){let s=e.DEPTH_COMPONENT16;if(i){const t=n.depthTexture;t&&t.isDepthTexture&&(1015===t.type?s=e.DEPTH_COMPONENT32F:1014===t.type&&(s=e.DEPTH_COMPONENT24));const i=k(n);e.renderbufferStorageMultisample(e.RENDERBUFFER,i,s,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,s,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}else if(n.depthBuffer&&n.stencilBuffer){if(i){const t=k(n);e.renderbufferStorageMultisample(e.RENDERBUFFER,t,e.DEPTH24_STENCIL8,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height);e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)}else{const t=n.texture,s=r.convert(t.format),o=r.convert(t.type),a=x(t.internalFormat,s,o);if(i){const t=k(n);e.renderbufferStorageMultisample(e.RENDERBUFFER,t,a,n.width,n.height)}else e.renderbufferStorage(e.RENDERBUFFER,a,n.width,n.height)}e.bindRenderbuffer(e.RENDERBUFFER,null)}function O(t){const s=i.get(t),r=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,s){if(s&&s.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(e.FRAMEBUFFER,t),!s.depthTexture||!s.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(s.depthTexture).__webglTexture&&s.depthTexture.image.width===s.width&&s.depthTexture.image.height===s.height||(s.depthTexture.image.width=s.width,s.depthTexture.image.height=s.height,s.depthTexture.needsUpdate=!0),E(s.depthTexture,0);const r=i.get(s.depthTexture).__webglTexture;if(1026===s.depthTexture.format)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,r,0);else{if(1027!==s.depthTexture.format)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,r,0)}}(s.__webglFramebuffer,t)}else if(r){s.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(e.FRAMEBUFFER,s.__webglFramebuffer[i]),s.__webglDepthbuffer[i]=e.createRenderbuffer(),D(s.__webglDepthbuffer[i],t,!1)}else n.bindFramebuffer(e.FRAMEBUFFER,s.__webglFramebuffer),s.__webglDepthbuffer=e.createRenderbuffer(),D(s.__webglDepthbuffer,t,!1);n.bindFramebuffer(e.FRAMEBUFFER,null)}function k(e){return a&&e.isWebGLMultisampleRenderTarget?Math.min(u,e.samples):0}let I=!1,z=!1;this.allocateTextureUnit=function(){const e=M;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),M+=1,e},this.resetTextureUnits=function(){M=0},this.setTexture2D=E,this.setTexture2DArray=function(t,s){const r=i.get(t);t.version>0&&r.__version!==t.version?R(r,t,s):(n.activeTexture(e.TEXTURE0+s),n.bindTexture(e.TEXTURE_2D_ARRAY,r.__webglTexture))},this.setTexture3D=function(t,s){const r=i.get(t);t.version>0&&r.__version!==t.version?R(r,t,s):(n.activeTexture(e.TEXTURE0+s),n.bindTexture(e.TEXTURE_3D,r.__webglTexture))},this.setTextureCube=T,this.setupRenderTarget=function(t){const s=t.texture,l=i.get(t),c=i.get(s);t.addEventListener("dispose",S),c.__webglTexture=e.createTexture(),c.__version=s.version,o.memory.textures++;const h=!0===t.isWebGLCubeRenderTarget,u=!0===t.isWebGLMultisampleRenderTarget,d=s.isDataTexture3D||s.isDataTexture2DArray,p=v(t)||a;if(!a||1022!==s.format||1015!==s.type&&1016!==s.type||(s.format=1023,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),h){l.__webglFramebuffer=[];for(let t=0;t<6;t++)l.__webglFramebuffer[t]=e.createFramebuffer()}else if(l.__webglFramebuffer=e.createFramebuffer(),u)if(a){l.__webglMultisampledFramebuffer=e.createFramebuffer(),l.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,l.__webglColorRenderbuffer);const i=r.convert(s.format),o=r.convert(s.type),a=x(s.internalFormat,i,o),c=k(t);e.renderbufferStorageMultisample(e.RENDERBUFFER,c,a,t.width,t.height),n.bindFramebuffer(e.FRAMEBUFFER,l.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,l.__webglColorRenderbuffer),e.bindRenderbuffer(e.RENDERBUFFER,null),t.depthBuffer&&(l.__webglDepthRenderbuffer=e.createRenderbuffer(),D(l.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(e.FRAMEBUFFER,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){n.bindTexture(e.TEXTURE_CUBE_MAP,c.__webglTexture),P(e.TEXTURE_CUBE_MAP,s,p);for(let n=0;n<6;n++)N(l.__webglFramebuffer[n],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+n);y(s,p)&&b(e.TEXTURE_CUBE_MAP,s,t.width,t.height),n.bindTexture(e.TEXTURE_CUBE_MAP,null)}else{let i=e.TEXTURE_2D;if(d)if(a){i=s.isDataTexture3D?e.TEXTURE_3D:e.TEXTURE_2D_ARRAY}else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");n.bindTexture(i,c.__webglTexture),P(i,s,p),N(l.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,i),y(s,p)&&b(e.TEXTURE_2D,s,t.width,t.height),n.bindTexture(e.TEXTURE_2D,null)}t.depthBuffer&&O(t)},this.updateRenderTargetMipmap=function(t){const s=t.texture;if(y(s,v(t)||a)){const r=t.isWebGLCubeRenderTarget?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,o=i.get(s).__webglTexture;n.bindTexture(r,o),b(r,s,t.width,t.height),n.bindTexture(r,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(a){const s=i.get(t);n.bindFramebuffer(e.READ_FRAMEBUFFER,s.__webglMultisampledFramebuffer),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,s.__webglFramebuffer);const r=t.width,o=t.height;let a=e.COLOR_BUFFER_BIT;t.depthBuffer&&(a|=e.DEPTH_BUFFER_BIT),t.stencilBuffer&&(a|=e.STENCIL_BUFFER_BIT),e.blitFramebuffer(0,0,r,o,0,0,r,o,a,e.NEAREST),n.bindFramebuffer(e.FRAMEBUFFER,s.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===I&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),I=!0),e=e.texture),E(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===z&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),z=!0),e=e.texture),T(e,t)}}function Mm(e,t,n){const i=n.isWebGL2;return{convert:function(n){let s;if(1009===n)return e.UNSIGNED_BYTE;if(1017===n)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===n)return e.UNSIGNED_SHORT_5_5_5_1;if(1019===n)return e.UNSIGNED_SHORT_5_6_5;if(1010===n)return e.BYTE;if(1011===n)return e.SHORT;if(1012===n)return e.UNSIGNED_SHORT;if(1013===n)return e.INT;if(1014===n)return e.UNSIGNED_INT;if(1015===n)return e.FLOAT;if(1016===n)return i?e.HALF_FLOAT:(s=t.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===n)return e.ALPHA;if(1022===n)return e.RGB;if(1023===n)return e.RGBA;if(1024===n)return e.LUMINANCE;if(1025===n)return e.LUMINANCE_ALPHA;if(1026===n)return e.DEPTH_COMPONENT;if(1027===n)return e.DEPTH_STENCIL;if(1028===n)return e.RED;if(1029===n)return e.RED_INTEGER;if(1030===n)return e.RG;if(1031===n)return e.RG_INTEGER;if(1032===n)return e.RGB_INTEGER;if(1033===n)return e.RGBA_INTEGER;if(33776===n||33777===n||33778===n||33779===n){if(s=t.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(33776===n)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===n)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===n)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===n)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===n||35841===n||35842===n||35843===n){if(s=t.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(35840===n)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===n)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===n)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===n)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===n)return s=t.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===n||37496===n)&&(s=t.get("WEBGL_compressed_texture_etc"),null!==s)){if(37492===n)return s.COMPRESSED_RGB8_ETC2;if(37496===n)return s.COMPRESSED_RGBA8_ETC2_EAC}return 37808===n||37809===n||37810===n||37811===n||37812===n||37813===n||37814===n||37815===n||37816===n||37817===n||37818===n||37819===n||37820===n||37821===n||37840===n||37841===n||37842===n||37843===n||37844===n||37845===n||37846===n||37847===n||37848===n||37849===n||37850===n||37851===n||37852===n||37853===n?(s=t.get("WEBGL_compressed_texture_astc"),null!==s?n:null):36492===n?(s=t.get("EXT_texture_compression_bptc"),null!==s?n:null):1020===n?i?e.UNSIGNED_INT_24_8:(s=t.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function Em(){this._targetRay=null,this._grip=null,this._hand=null}function Tm(e,t){const n=this,i=e.state;let s=null,r=1,o=null,a="local-floor",l=null;const c=[],h=new Map,u=new xa;u.layers.enable(1),u.viewport=new qt;const d=new xa;d.layers.enable(2),d.viewport=new qt;const p=[u,d],f=new Kl;f.layers.enable(1),f.layers.enable(2);let m=null,g=null;function v(e){const t=h.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function y(){h.forEach((function(e,t){e.disconnect(t)})),h.clear(),m=null,g=null,i.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),M.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function b(e){const t=s.inputSources;for(let e=0;e<c.length;e++)h.set(t[e],c[e]);for(let t=0;t<e.removed.length;t++){const n=e.removed[t],i=h.get(n);i&&(i.dispatchEvent({type:"disconnected",data:n}),h.delete(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t],i=h.get(n);i&&i.dispatchEvent({type:"connected",data:n})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=c[e];return void 0===t&&(t=new Em,c[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=c[e];return void 0===t&&(t=new Em,c[e]=t),t.getGripSpace()},this.getHand=function(e){let t=c[e];return void 0===t&&(t=new Em,c[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getSession=function(){return s},this.setSession=async function(e){if(s=e,null!==s){s.addEventListener("select",v),s.addEventListener("selectstart",v),s.addEventListener("selectend",v),s.addEventListener("squeeze",v),s.addEventListener("squeezestart",v),s.addEventListener("squeezeend",v),s.addEventListener("end",y),s.addEventListener("inputsourceschange",b);const e=t.getContextAttributes();!0!==e.xrCompatible&&await t.makeXRCompatible();const i={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:r},l=new XRWebGLLayer(s,t,i);s.updateRenderState({baseLayer:l}),o=await s.requestReferenceSpace(a),M.setContext(s),M.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const x=new K,_=new K;function w(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.getCamera=function(e){f.near=d.near=u.near=e.near,f.far=d.far=u.far=e.far,m===f.near&&g===f.far||(s.updateRenderState({depthNear:f.near,depthFar:f.far}),m=f.near,g=f.far);const t=e.parent,n=f.cameras;w(f,t);for(let e=0;e<n.length;e++)w(n[e],t);e.matrixWorld.copy(f.matrixWorld),e.matrix.copy(f.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);const i=e.children;for(let e=0,t=i.length;e<t;e++)i[e].updateMatrixWorld(!0);return 2===n.length?function(e,t,n){x.setFromMatrixPosition(t.matrixWorld),_.setFromMatrixPosition(n.matrixWorld);const i=x.distanceTo(_),s=t.projectionMatrix.elements,r=n.projectionMatrix.elements,o=s[14]/(s[10]-1),a=s[14]/(s[10]+1),l=(s[9]+1)/s[5],c=(s[9]-1)/s[5],h=(s[8]-1)/s[0],u=(r[8]+1)/r[0],d=o*h,p=o*u,f=i/(-h+u),m=f*-h;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(f),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+f,v=a+f,y=d-m,b=p+(i-m),w=l*a/v*g,S=c*a/v*g;e.projectionMatrix.makePerspective(y,b,w,S,g,v)}(f,u,d):f.projectionMatrix.copy(u.projectionMatrix),f};let S=null;const M=new gp;M.setAnimationLoop((function(e,t){if(l=t.getViewerPose(o),null!==l){const e=l.views,t=s.renderState.baseLayer;i.bindXRFramebuffer(t.framebuffer);let n=!1;e.length!==f.cameras.length&&(f.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const s=e[i],r=t.getViewport(s),o=p[i];o.matrix.fromArray(s.transform.matrix),o.projectionMatrix.fromArray(s.projectionMatrix),o.viewport.set(r.x,r.y,r.width,r.height),0===i&&f.matrix.copy(o.matrix),!0===n&&f.cameras.push(o)}}const n=s.inputSources;for(let e=0;e<c.length;e++){const i=c[e],s=n[e];i.update(s,t,o)}S&&S(e,t)})),this.setAnimationLoop=function(e){S=e},this.dispose=function(){}}function Cm(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);const i=e.get(n).envMap;if(i){t.envMap.value=i,t.flipEnvMap.value=i.isCubeTexture&&i._needsFlipEnvMap?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;const s=e.get(i).__maxMipLevel;void 0!==s&&(t.maxMipLevel.value=s)}let s,r;n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?s=n.map:n.specularMap?s=n.specularMap:n.displacementMap?s=n.displacementMap:n.normalMap?s=n.normalMap:n.bumpMap?s=n.bumpMap:n.roughnessMap?s=n.roughnessMap:n.metalnessMap?s=n.metalnessMap:n.alphaMap?s=n.alphaMap:n.emissiveMap?s=n.emissiveMap:n.clearcoatMap?s=n.clearcoatMap:n.clearcoatNormalMap?s=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(s=n.clearcoatRoughnessMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),t.uvTransform.value.copy(s.matrix)),n.aoMap?r=n.aoMap:n.lightMap&&(r=n.lightMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uv2Transform.value.copy(r.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,1===n.side&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),1===n.side&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias);e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,i,s,r){i.isMeshBasicMaterial?t(e,i):i.isMeshLambertMaterial?(t(e,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,i)):i.isMeshToonMaterial?(t(e,i),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshPhongMaterial?(t(e,i),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshStandardMaterial?(t(e,i),i.isMeshPhysicalMaterial?function(e,t){n(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap);t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate());e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}(e,i):n(e,i)):i.isMeshMatcapMaterial?(t(e,i),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDepthMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isMeshDistanceMaterial?(t(e,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,i)):i.isMeshNormalMaterial?(t(e,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,i)):i.isPointsMaterial?function(e,t,n,i){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*i,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let s;t.map?s=t.map:t.alphaMap&&(s=t.alphaMap);void 0!==s&&(!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uvTransform.value.copy(s.matrix))}(e,i,s,r):i.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);let n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,i):i.isShadowMaterial?(e.color.value.copy(i.color),e.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function Am(e){const t=void 0!==(e=e||{}).canvas?e.canvas:function(){const e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,i=void 0!==e.alpha&&e.alpha,s=void 0===e.depth||e.depth,r=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",h=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let u=null,d=null;const p=[],f=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const m=this;let g=!1,v=0,y=0,b=null,x=-1,_=null;const w=new qt,S=new qt;let M=null,E=t.width,T=t.height,C=1,A=null,P=null;const L=new qt(0,0,E,T),R=new qt(0,0,E,T);let N=!1;const D=new ha;let O=!1,k=!1;const I=new te,z=new K,U={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function F(){return null===b?C:1}let V,B,j,$,G,H,W,q,X,Y,J,Q,ee,ne,ie,se,re,oe,ae,le,ce,he,ue=n;function de(e,n){for(let i=0;i<e.length;i++){const s=e[i],r=t.getContext(s,n);if(null!==r)return r}return null}try{const e={alpha:i,depth:s,stencil:r,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if(t.addEventListener("webglcontextlost",me,!1),t.addEventListener("webglcontextrestored",ge,!1),null===ue){const t=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&t.shift(),ue=de(t,e),null===ue)throw de(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ue.getShaderPrecisionFormat&&(ue.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function pe(){V=new Ap(ue),B=new wp(ue,V,e),V.init(B),ce=new Mm(ue,V,B),j=new wm(ue,V,B),$=new Rp(ue),G=new lm,H=new Sm(ue,V,j,G,B,ce,$),W=new Cp(m),q=new vp(ue,B),he=new xp(ue,V,q,B),X=new Pp(ue,q,$,he),Y=new kp(ue,X,q,$),oe=new Op(ue),ie=new Sp(G),J=new am(m,W,V,B,he,ie),Q=new Cm(G),ee=new dm(G),ne=new ym(V,B),re=new bp(m,W,j,Y,a),se=new _m(m,Y,B),ae=new _p(ue,V,$,B),le=new Lp(ue,V,$,B),$.programs=J.programs,m.capabilities=B,m.extensions=V,m.properties=G,m.renderLists=ee,m.shadowMap=se,m.state=j,m.info=$}pe();const fe=new Tm(m,ue);function me(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function ge(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const e=$.autoReset,t=se.enabled,n=se.autoUpdate,i=se.needsUpdate,s=se.type;pe(),$.autoReset=e,se.enabled=t,se.autoUpdate=n,se.needsUpdate=i,se.type=s}function ve(e){const t=e.target;t.removeEventListener("dispose",ve),function(e){(function(e){const t=G.get(e).programs;void 0!==t&&t.forEach((function(e){J.releaseProgram(e)}))})(e),G.remove(e)}(t)}this.xr=fe,this.getContext=function(){return ue},this.getContextAttributes=function(){return ue.getContextAttributes()},this.forceContextLoss=function(){const e=V.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=V.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return C},this.setPixelRatio=function(e){void 0!==e&&(C=e,this.setSize(E,T,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new gt),e.set(E,T)},this.setSize=function(e,n,i){fe.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(E=e,T=n,t.width=Math.floor(e*C),t.height=Math.floor(n*C),!1!==i&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new gt),e.set(E*C,T*C).floor()},this.setDrawingBufferSize=function(e,n,i){E=e,T=n,C=i,t.width=Math.floor(e*i),t.height=Math.floor(n*i),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new qt),e.copy(w)},this.getViewport=function(e){return e.copy(L)},this.setViewport=function(e,t,n,i){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,n,i),j.viewport(w.copy(L).multiplyScalar(C).floor())},this.getScissor=function(e){return e.copy(R)},this.setScissor=function(e,t,n,i){e.isVector4?R.set(e.x,e.y,e.z,e.w):R.set(e,t,n,i),j.scissor(S.copy(R).multiplyScalar(C).floor())},this.getScissorTest=function(){return N},this.setScissorTest=function(e){j.setScissorTest(N=e)},this.setOpaqueSort=function(e){A=e},this.setTransparentSort=function(e){P=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new Ht),e.copy(re.getClearColor())},this.setClearColor=function(){re.setClearColor.apply(re,arguments)},this.getClearAlpha=function(){return re.getClearAlpha()},this.setClearAlpha=function(){re.setClearAlpha.apply(re,arguments)},this.clear=function(e,t,n){let i=0;(void 0===e||e)&&(i|=ue.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=ue.DEPTH_BUFFER_BIT),(void 0===n||n)&&(i|=ue.STENCIL_BUFFER_BIT),ue.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",me,!1),t.removeEventListener("webglcontextrestored",ge,!1),ee.dispose(),ne.dispose(),G.dispose(),W.dispose(),Y.dispose(),he.dispose(),fe.dispose(),fe.removeEventListener("sessionstart",be),fe.removeEventListener("sessionend",xe),_e.stop()},this.renderBufferImmediate=function(e,t){he.initAttributes();const n=G.get(e);e.hasPositions&&!n.position&&(n.position=ue.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=ue.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=ue.createBuffer()),e.hasColors&&!n.color&&(n.color=ue.createBuffer());const i=t.getAttributes();e.hasPositions&&(ue.bindBuffer(ue.ARRAY_BUFFER,n.position),ue.bufferData(ue.ARRAY_BUFFER,e.positionArray,ue.DYNAMIC_DRAW),he.enableAttribute(i.position),ue.vertexAttribPointer(i.position,3,ue.FLOAT,!1,0,0)),e.hasNormals&&(ue.bindBuffer(ue.ARRAY_BUFFER,n.normal),ue.bufferData(ue.ARRAY_BUFFER,e.normalArray,ue.DYNAMIC_DRAW),he.enableAttribute(i.normal),ue.vertexAttribPointer(i.normal,3,ue.FLOAT,!1,0,0)),e.hasUvs&&(ue.bindBuffer(ue.ARRAY_BUFFER,n.uv),ue.bufferData(ue.ARRAY_BUFFER,e.uvArray,ue.DYNAMIC_DRAW),he.enableAttribute(i.uv),ue.vertexAttribPointer(i.uv,2,ue.FLOAT,!1,0,0)),e.hasColors&&(ue.bindBuffer(ue.ARRAY_BUFFER,n.color),ue.bufferData(ue.ARRAY_BUFFER,e.colorArray,ue.DYNAMIC_DRAW),he.enableAttribute(i.color),ue.vertexAttribPointer(i.color,3,ue.FLOAT,!1,0,0)),he.disableUnusedAttributes(),ue.drawArrays(ue.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,i,s,r){null===t&&(t=U);const o=s.isMesh&&s.matrixWorld.determinant()<0,a=Ce(e,t,i,s);j.setMaterial(i,o);let l=n.index;const c=n.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let h,u=1;!0===i.wireframe&&(l=X.getWireframeAttribute(n),u=2),(i.morphTargets||i.morphNormals)&&oe.update(s,n,i,a),he.setup(s,i,a,n,l);let d=ae;null!==l&&(h=q.get(l),d=le,d.setIndex(h));const p=null!==l?l.count:c.count,f=n.drawRange.start*u,m=n.drawRange.count*u,g=null!==r?r.start*u:0,v=null!==r?r.count*u:1/0,y=Math.max(f,g),b=Math.min(p,f+m,g+v)-1,x=Math.max(0,b-y+1);if(0!==x){if(s.isMesh)!0===i.wireframe?(j.setLineWidth(i.wireframeLinewidth*F()),d.setMode(ue.LINES)):d.setMode(ue.TRIANGLES);else if(s.isLine){let e=i.linewidth;void 0===e&&(e=1),j.setLineWidth(e*F()),s.isLineSegments?d.setMode(ue.LINES):s.isLineLoop?d.setMode(ue.LINE_LOOP):d.setMode(ue.LINE_STRIP)}else s.isPoints?d.setMode(ue.POINTS):s.isSprite&&d.setMode(ue.TRIANGLES);if(s.isInstancedMesh)d.renderInstances(y,x,s.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(y,x,e)}else d.render(y,x)}},this.compile=function(e,t){d=ne.get(e),d.init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(d.pushLight(e),e.castShadow&&d.pushShadow(e))})),d.setupLights(),e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let i=0;i<n.length;i++){Ee(n[i],e,t)}else Ee(n,e,t)}))};let ye=null;function be(){_e.stop()}function xe(){_e.start()}const _e=new gp;function we(e,t,n,i){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)d.pushLight(e),e.castShadow&&d.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||D.intersectsSprite(e)){i&&z.setFromMatrixPosition(e.matrixWorld).applyMatrix4(I);const t=Y.update(e),s=e.material;s.visible&&u.push(e,t,s,n,z.z,null)}}else if(e.isImmediateRenderObject)i&&z.setFromMatrixPosition(e.matrixWorld).applyMatrix4(I),u.push(e,null,e.material,n,z.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==$.render.frame&&(e.skeleton.update(),e.skeleton.frame=$.render.frame),!e.frustumCulled||D.intersectsObject(e))){i&&z.setFromMatrixPosition(e.matrixWorld).applyMatrix4(I);const t=Y.update(e),s=e.material;if(Array.isArray(s)){const i=t.groups;for(let r=0,o=i.length;r<o;r++){const o=i[r],a=s[o.materialIndex];a&&a.visible&&u.push(e,t,a,n,z.z,o)}}else s.visible&&u.push(e,t,s,n,z.z,null)}const s=e.children;for(let e=0,r=s.length;e<r;e++)we(s[e],t,n,i)}function Se(e,t,n){const i=!0===t.isScene?t.overrideMaterial:null;for(let s=0,r=e.length;s<r;s++){const r=e[s],o=r.object,a=r.geometry,l=null===i?r.material:i,c=r.group;if(n.isArrayCamera){const e=n.cameras;for(let n=0,i=e.length;n<i;n++){const i=e[n];o.layers.test(i.layers)&&(j.viewport(w.copy(i.viewport)),d.setupLightsView(i),Me(o,t,i,a,l,c))}}else Me(o,t,n,a,l,c)}}function Me(e,t,n,i,s,r){if(e.onBeforeRender(m,t,n,i,s,r),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){const i=Ce(n,t,s,e);j.setMaterial(s),he.reset(),function(e,t){e.render((function(e){m.renderBufferImmediate(e,t)}))}(e,i)}else m.renderBufferDirect(n,t,i,s,e,r);e.onAfterRender(m,t,n,i,s,r)}function Ee(e,t,n){!0!==t.isScene&&(t=U);const i=G.get(e),s=d.state.lights,r=d.state.shadowsArray,o=s.state.version,a=J.getParameters(e,s.state,r,t,n),l=J.getProgramCacheKey(a);let c=i.programs;i.environment=e.isMeshStandardMaterial?t.environment:null,i.fog=t.fog,i.envMap=W.get(e.envMap||i.environment),void 0===c&&(e.addEventListener("dispose",ve),c=new Map,i.programs=c);let h=c.get(l);if(void 0!==h){if(i.currentProgram===h&&i.lightsStateVersion===o)return Te(e,a),h}else a.uniforms=J.getUniforms(e),e.onBeforeCompile(a,m),h=J.acquireProgram(a,l),c.set(l,h),i.uniforms=a.uniforms;const u=i.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(u.clippingPlanes=ie.uniform),Te(e,a),i.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),i.lightsStateVersion=o,i.needsLights&&(u.ambientLightColor.value=s.state.ambient,u.lightProbe.value=s.state.probe,u.directionalLights.value=s.state.directional,u.directionalLightShadows.value=s.state.directionalShadow,u.spotLights.value=s.state.spot,u.spotLightShadows.value=s.state.spotShadow,u.rectAreaLights.value=s.state.rectArea,u.ltc_1.value=s.state.rectAreaLTC1,u.ltc_2.value=s.state.rectAreaLTC2,u.pointLights.value=s.state.point,u.pointLightShadows.value=s.state.pointShadow,u.hemisphereLights.value=s.state.hemi,u.directionalShadowMap.value=s.state.directionalShadowMap,u.directionalShadowMatrix.value=s.state.directionalShadowMatrix,u.spotShadowMap.value=s.state.spotShadowMap,u.spotShadowMatrix.value=s.state.spotShadowMatrix,u.pointShadowMap.value=s.state.pointShadowMap,u.pointShadowMatrix.value=s.state.pointShadowMatrix);const p=h.getUniforms(),f=Vf.seqWithValue(p.seq,u);return i.currentProgram=h,i.uniformsList=f,h}function Te(e,t){const n=G.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas}function Ce(e,t,n,i){!0!==t.isScene&&(t=U),H.resetTextureUnits();const s=t.fog,r=n.isMeshStandardMaterial?t.environment:null,o=null===b?m.outputEncoding:b.texture.encoding,a=W.get(n.envMap||r),l=!0===n.vertexColors&&i.geometry.attributes.color&&4===i.geometry.attributes.color.itemSize,c=G.get(n),h=d.state.lights;if(!0===O&&(!0===k||e!==_)){const t=e===_&&n.id===x;ie.setState(n,e,t)}let u=!1;n.version===c.__version?c.needsLights&&c.lightsStateVersion!==h.state.version||c.outputEncoding!==o||i.isInstancedMesh&&!1===c.instancing?u=!0:i.isInstancedMesh||!0!==c.instancing?c.envMap!==a||n.fog&&c.fog!==s?u=!0:void 0===c.numClippingPlanes||c.numClippingPlanes===ie.numPlanes&&c.numIntersection===ie.numIntersection?c.vertexAlphas!==l&&(u=!0):u=!0:u=!0:(u=!0,c.__version=n.version);let p=c.currentProgram;!0===u&&(p=Ee(n,t,i));let f=!1,g=!1,v=!1;const y=p.getUniforms(),w=c.uniforms;if(j.useProgram(p.program)&&(f=!0,g=!0,v=!0),n.id!==x&&(x=n.id,g=!0),f||_!==e){if(y.setValue(ue,"projectionMatrix",e.projectionMatrix),B.logarithmicDepthBuffer&&y.setValue(ue,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),_!==e&&(_=e,g=!0,v=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=y.map.cameraPosition;void 0!==t&&t.setValue(ue,z.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&y.setValue(ue,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&y.setValue(ue,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){y.setOptional(ue,i,"bindMatrix"),y.setOptional(ue,i,"bindMatrixInverse");const e=i.skeleton;if(e){const t=e.bones;if(B.floatVertexTextures){if(null===e.boneTexture){let n=Math.sqrt(4*t.length);n=Z.ceilPowerOfTwo(n),n=Math.max(n,4);const i=new Float32Array(n*n*4);i.set(e.boneMatrices);const s=new mp(i,n,n,1023,1015);e.boneMatrices=i,e.boneTexture=s,e.boneTextureSize=n}y.setValue(ue,"boneTexture",e.boneTexture,H),y.setValue(ue,"boneTextureSize",e.boneTextureSize)}else y.setOptional(ue,e,"boneMatrices")}}var S,M;return(g||c.receiveShadow!==i.receiveShadow)&&(c.receiveShadow=i.receiveShadow,y.setValue(ue,"receiveShadow",i.receiveShadow)),g&&(y.setValue(ue,"toneMappingExposure",m.toneMappingExposure),c.needsLights&&(M=v,(S=w).ambientLightColor.needsUpdate=M,S.lightProbe.needsUpdate=M,S.directionalLights.needsUpdate=M,S.directionalLightShadows.needsUpdate=M,S.pointLights.needsUpdate=M,S.pointLightShadows.needsUpdate=M,S.spotLights.needsUpdate=M,S.spotLightShadows.needsUpdate=M,S.rectAreaLights.needsUpdate=M,S.hemisphereLights.needsUpdate=M),s&&n.fog&&Q.refreshFogUniforms(w,s),Q.refreshMaterialUniforms(w,n,C,T),Vf.upload(ue,c.uniformsList,w,H)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Vf.upload(ue,c.uniformsList,w,H),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&y.setValue(ue,"center",i.center),y.setValue(ue,"modelViewMatrix",i.modelViewMatrix),y.setValue(ue,"normalMatrix",i.normalMatrix),y.setValue(ue,"modelMatrix",i.matrixWorld),p}_e.setAnimationLoop((function(e){ye&&ye(e)})),"undefined"!=typeof window&&_e.setContext(window),this.setAnimationLoop=function(e){ye=e,fe.setAnimationLoop(e),null===e?_e.stop():_e.start()},fe.addEventListener("sessionstart",be),fe.addEventListener("sessionend",xe),this.render=function(e,t){let n,i;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),i=arguments[3]),void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===fe.enabled&&!0===fe.isPresenting&&(t=fe.getCamera(t)),!0===e.isScene&&e.onBeforeRender(m,e,t,n||b),d=ne.get(e,f.length),d.init(),f.push(d),I.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),D.setFromProjectionMatrix(I),k=this.localClippingEnabled,O=ie.init(this.clippingPlanes,k,t),u=ee.get(e,p.length),u.init(),p.push(u),we(e,t,0,m.sortObjects),u.finish(),!0===m.sortObjects&&u.sort(A,P),!0===O&&ie.beginShadows();const s=d.state.shadowsArray;se.render(s,e,t),d.setupLights(),d.setupLightsView(t),!0===O&&ie.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),re.render(u,e,t,i);const r=u.opaque,o=u.transparent;r.length>0&&Se(r,e,t),o.length>0&&Se(o,e,t),null!==b&&(H.updateRenderTargetMipmap(b),H.updateMultisampleRenderTarget(b)),!0===e.isScene&&e.onAfterRender(m,e,t),j.buffers.depth.setTest(!0),j.buffers.depth.setMask(!0),j.buffers.color.setMask(!0),j.setPolygonOffset(!1),he.resetDefaultState(),x=-1,_=null,f.pop(),d=f.length>0?f[f.length-1]:null,p.pop(),u=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return b},this.setRenderTarget=function(e,t=0,n=0){b=e,v=t,y=n,e&&void 0===G.get(e).__webglFramebuffer&&H.setupRenderTarget(e);let i=null,s=!1,r=!1;if(e){const n=e.texture;(n.isDataTexture3D||n.isDataTexture2DArray)&&(r=!0);const o=G.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=o[t],s=!0):i=e.isWebGLMultisampleRenderTarget?G.get(e).__webglMultisampledFramebuffer:o,w.copy(e.viewport),S.copy(e.scissor),M=e.scissorTest}else w.copy(L).multiplyScalar(C).floor(),S.copy(R).multiplyScalar(C).floor(),M=N;if(j.bindFramebuffer(ue.FRAMEBUFFER,i),j.viewport(w),j.scissor(S),j.setScissorTest(M),s){const i=G.get(e.texture);ue.framebufferTexture2D(ue.FRAMEBUFFER,ue.COLOR_ATTACHMENT0,ue.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.__webglTexture,n)}else if(r){const i=G.get(e.texture),s=t||0;ue.framebufferTextureLayer(ue.FRAMEBUFFER,ue.COLOR_ATTACHMENT0,i.__webglTexture,n||0,s)}},this.readRenderTargetPixels=function(e,t,n,i,s,r,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=G.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){j.bindFramebuffer(ue.FRAMEBUFFER,a);try{const o=e.texture,a=o.format,l=o.type;if(1023!==a&&ce.convert(a)!==ue.getParameter(ue.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=1016===l&&(V.has("EXT_color_buffer_half_float")||B.isWebGL2&&V.has("EXT_color_buffer_float"));if(!(1009===l||ce.convert(l)===ue.getParameter(ue.IMPLEMENTATION_COLOR_READ_TYPE)||1015===l&&(B.isWebGL2||V.has("OES_texture_float")||V.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");ue.checkFramebufferStatus(ue.FRAMEBUFFER)===ue.FRAMEBUFFER_COMPLETE?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-s&&ue.readPixels(t,n,i,s,ce.convert(a),ce.convert(l),r):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==b?G.get(b).__webglFramebuffer:null;j.bindFramebuffer(ue.FRAMEBUFFER,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){const i=Math.pow(2,-n),s=Math.floor(t.image.width*i),r=Math.floor(t.image.height*i),o=ce.convert(t.format);H.setTexture2D(t,0),ue.copyTexImage2D(ue.TEXTURE_2D,n,o,e.x,e.y,s,r,0),j.unbindTexture()},this.copyTextureToTexture=function(e,t,n,i=0){const s=t.image.width,r=t.image.height,o=ce.convert(n.format),a=ce.convert(n.type);H.setTexture2D(n,0),ue.pixelStorei(ue.UNPACK_FLIP_Y_WEBGL,n.flipY),ue.pixelStorei(ue.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),ue.pixelStorei(ue.UNPACK_ALIGNMENT,n.unpackAlignment),t.isDataTexture?ue.texSubImage2D(ue.TEXTURE_2D,i,e.x,e.y,s,r,o,a,t.image.data):t.isCompressedTexture?ue.compressedTexSubImage2D(ue.TEXTURE_2D,i,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):ue.texSubImage2D(ue.TEXTURE_2D,i,e.x,e.y,o,a,t.image),0===i&&n.generateMipmaps&&ue.generateMipmap(ue.TEXTURE_2D),j.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,i,s=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const{width:r,height:o,data:a}=n.image,l=ce.convert(i.format),c=ce.convert(i.type);let h;if(i.isDataTexture3D)H.setTexture3D(i,0),h=ue.TEXTURE_3D;else{if(!i.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");H.setTexture2DArray(i,0),h=ue.TEXTURE_2D_ARRAY}ue.pixelStorei(ue.UNPACK_FLIP_Y_WEBGL,i.flipY),ue.pixelStorei(ue.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),ue.pixelStorei(ue.UNPACK_ALIGNMENT,i.unpackAlignment);const u=ue.getParameter(ue.UNPACK_ROW_LENGTH),d=ue.getParameter(ue.UNPACK_IMAGE_HEIGHT),p=ue.getParameter(ue.UNPACK_SKIP_PIXELS),f=ue.getParameter(ue.UNPACK_SKIP_ROWS),g=ue.getParameter(ue.UNPACK_SKIP_IMAGES);ue.pixelStorei(ue.UNPACK_ROW_LENGTH,r),ue.pixelStorei(ue.UNPACK_IMAGE_HEIGHT,o),ue.pixelStorei(ue.UNPACK_SKIP_PIXELS,e.min.x),ue.pixelStorei(ue.UNPACK_SKIP_ROWS,e.min.y),ue.pixelStorei(ue.UNPACK_SKIP_IMAGES,e.min.z),ue.texSubImage3D(h,s,t.x,t.y,t.z,e.max.x-e.min.x+1,e.max.y-e.min.y+1,e.max.z-e.min.z+1,l,c,a),ue.pixelStorei(ue.UNPACK_ROW_LENGTH,u),ue.pixelStorei(ue.UNPACK_IMAGE_HEIGHT,d),ue.pixelStorei(ue.UNPACK_SKIP_PIXELS,p),ue.pixelStorei(ue.UNPACK_SKIP_ROWS,f),ue.pixelStorei(ue.UNPACK_SKIP_IMAGES,g),0===s&&i.generateMipmaps&&ue.generateMipmap(h),j.unbindTexture()},this.initTexture=function(e){H.setTexture2D(e,0),j.unbindTexture()},this.resetState=function(){v=0,y=0,b=null,j.reset(),he.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Object.assign(Em.prototype,{constructor:Em,getHandSpace:function(){return null===this._hand&&(this._hand=new Xi,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Xi,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Xi,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(e,t,n){let i=null,s=null,r=null;const o=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==o&&(i=t.getPose(e.targetRaySpace,n),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale))),l&&e.hand){r=!0;for(const i of e.hand.values()){const e=t.getJointPose(i,n);if(void 0===l.joints[i.jointName]){const e=new Xi;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[i.jointName]=e,l.add(e)}const s=l.joints[i.jointName];null!==e&&(s.matrix.fromArray(e.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.jointRadius=e.radius),s.visible=null!==e}const i=l.joints["index-finger-tip"],s=l.joints["thumb-tip"],o=i.position.distanceTo(s.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),null!==s&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale)));return null!==o&&(o.visible=null!==i),null!==a&&(a.visible=null!==s),null!==l&&(l.visible=null!==r),this}}),Object.assign(Tm.prototype,de.prototype);var Pm,Lm=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};!function(e){e[e.TopLeft=0]="TopLeft",e[e.TopCenter=1]="TopCenter",e[e.TopRight=2]="TopRight",e[e.BottomLeft=3]="BottomLeft",e[e.BottomCenter=4]="BottomCenter",e[e.BottomRight=5]="BottomRight"}(Pm||(Pm={}));let Rm=class extends vr{constructor(){super(),this.labels=[],this.labels.push({},{},{},{},{},{})}setLabel(e,t,n,i){this.labels[e][t]={text:n,className:i},this.requestUpdate()}unsetLabel(e,t){delete this.labels[e][t],this.requestUpdate()}firstConnected(){this.classList.add("ff-container","ff-viewport-overlay")}render(){const e=this.labels;return Gs`<div class="ff-row">
            <div class="ff-labels ff-top-left">${Object.keys(e[Pm.TopLeft]).map(t=>{const n=e[Pm.TopLeft][t];return Gs`<div class=${"ff-label "+n.className||!1}>${n.text}</div>`})}</div>
            <div class="ff-labels ff-top-center">${Object.keys(e[Pm.TopCenter]).map(t=>{const n=e[Pm.TopCenter][t];return Gs`<div class=${"ff-label "+n.className||!1}>${n.text}</div>`})}</div>
            <div class="ff-labels ff-top-right">${Object.keys(e[Pm.TopRight]).map(t=>{const n=e[Pm.TopRight][t];return Gs`<div class=${"ff-label "+n.className||!1}>${n.text}</div>`})}</div>
        </div><div class="ff-row">
            <div class="ff-labels ff-bottom-left">${Object.keys(e[Pm.BottomLeft]).map(t=>{const n=e[Pm.BottomLeft][t];return Gs`<div class=${"ff-label "+n.className||!1}>${n.text}</div>`})}</div>
            <div class="ff-labels ff-bottom-center">${Object.keys(e[Pm.BottomCenter]).map(t=>{const n=e[Pm.BottomCenter][t];return Gs`<div class=${"ff-label "+n.className||!1}>${n.text}</div>`})}</div>
            <div class="ff-labels ff-bottom-right">${Object.keys(e[Pm.BottomRight]).map(t=>{const n=e[Pm.BottomRight][t];return Gs`<div class=${"ff-label "+n.className||!1}>${n.text}</div>`})}</div>
        </div>`}};Rm=Lm([yr("ff-viewport-overlay")],Rm);var Nm,Dm=Rm;class Om extends o{constructor(e){super(),this.next=null,this._canvasWidth=1,this._canvasHeight=1,this._overlay=null,this._camera=null,this._controller=null,this.addEvent("dispose"),this.next=null,e=e||{},this._relRect={x:e.x||0,y:e.y||0,width:e.width||1,height:e.height||1},this._absRect={x:0,y:0,width:1,height:1},e.overlay&&(this._overlay=e.overlay)}get x(){return this._absRect.x}get y(){return this._absRect.y}get width(){return this._absRect.width}get height(){return this._absRect.height}get canvasWidth(){return this._canvasWidth}get canvasHeight(){return this._canvasHeight}get camera(){return this._camera}get controller(){return this._controller}get overlay(){return this._overlay}set overlay(e){this._overlay=e,this.updateGeometry()}dispose(){this.emit({type:"dispose",viewport:this}),this._overlay&&(this._overlay.remove(),this._overlay=null)}setSize(e,t,n,i){const s=this._relRect;s.x=e,s.y=t,s.width=n,s.height=i,this.updateGeometry()}setCanvasSize(e,t){this._canvasWidth=e,this._canvasHeight=t,this.updateGeometry(),this._controller&&this._controller.setViewportSize(e,t)}setBuiltInCamera(e,t){this._camera?this._camera.setProjection(e):(this._camera=new xh(e),this._camera.matrixAutoUpdate=!1),void 0!==t&&(this._camera.setPreset(t),this.overlay.setLabel(Pm.TopRight,"view",yh[t],"ff-label-box"))}unsetBuiltInCamera(){this._camera=null,this._controller=null,this.overlay.unsetLabel(Pm.TopRight,"view")}enableCameraControl(e){return!e&&this._controller?this._controller=null:e&&this._camera&&(this._controller||(this._controller=new ch(this._camera),this._controller.setViewportSize(this.width,this.height),this._controller.updateController())),this._controller}zoomExtents(e){const t=this._camera,n=this._controller;t&&n&&(n.zoomExtents(e),n.updateCamera(null,!0))}isInside(e){return this.isPointInside(e.localX,e.localY)}isPointInside(e,t){const n=this._absRect;return t=this.canvasHeight-t,e>=n.x&&e<n.x+n.width&&t>=n.y&&t<n.y+n.height}getDevicePoint(e,t,n){const i=this._absRect,s=(e-i.x)/i.width*2-1,r=(this.canvasHeight-t-i.y)/i.height*2-1;return n?n.set(s,r):new gt(s,r)}getDeviceX(e){const t=this._absRect;return(e-t.x)/t.width*2-1}getDeviceY(e){const t=this._absRect;return(this.canvasHeight-e-t.y)/t.height*2-1}updateCamera(e){let t=e;if(this._camera&&(t=this._camera,this._controller&&this._controller.updateCamera()),!t)return;const n=this._absRect,i=n.width/n.height;if(i!==t.userData.aspect)if(t.userData.aspect=i,t.isUniversalCamera||t.isPerspectiveCamera)t.aspect=i,t.updateProjectionMatrix();else if(t.isOrthographicCamera){const e=.5*(t.top-t.bottom);t.left=-e*i,t.right=e*i,t.updateProjectionMatrix()}return t}applyViewport(e){const t=this._absRect;e.setViewport(t.x,t.y,t.width,t.height),e.viewport=this}applyPickViewport(e,t){const n=this._absRect,i=t.localX-n.x,s=this.canvasHeight-t.localY-n.y;e.viewport.set(-i,-s,n.width,n.height)}toViewportEvent(e){const t=e;return t.viewport=this,t.deviceX=this.getDeviceX(e.localX),t.deviceY=this.getDeviceY(e.localY),t}onPointer(e){return!!this._controller&&this._controller.onPointer(e)}onTrigger(e){return!!this._controller&&this._controller.onTrigger(e)}toString(){return`Viewport (x: ${this.x}, y: ${this.y}, width: ${this.width}, height: ${this.height})`}updateGeometry(){const e=this._relRect,t=this._absRect,n=this._canvasWidth,i=this._canvasHeight;t.x=Math.round(e.x*n),t.y=Math.round(e.y*i),t.width=Math.round(e.width*n),t.height=Math.round(e.height*i);const s=this._overlay;if(s){const e=this.canvasHeight-t.y-t.height;s.style.left=t.x?t.x.toFixed()+"px":"0",s.style.top=e?e.toFixed()+"px":"0",s.style.width=t.width.toFixed()+"px",s.style.height=t.height.toFixed()+"px"}}}class km extends o{constructor(e,t,n){super(),this.viewports=[],this.rendererComponent=null,this.targetViewport=null,this.targetObject3D=null,this.targetComponent=null,this.targetScene=null,this.targetCamera=null,this.defaultScene=new qr,this.defaultCamera=new xh,this.system=e,this.canvas=t,this.overlay=n,this.renderer=new Am({canvas:t,antialias:!0}),this.renderer.autoClear=!1,this.renderer.gammaFactor=2,this.renderer.outputEncoding=3001,this.picker=new Wr(this.renderer)}dispose(){this.renderer.dispose(),this.viewports.forEach(e=>e.dispose())}get canvasWidth(){return this.canvas.width}get canvasHeight(){return this.canvas.height}attach(){const e=this.canvasWidth,t=this.canvasHeight;this.viewports.forEach(n=>n.setCanvasSize(e,t)),this.renderer.setSize(e,t,!1),this.rendererComponent=this.system.getComponent(q,!0),this.rendererComponent.attachView(this)}detach(){this.rendererComponent=this.system.getComponent(q,!0),this.rendererComponent.detachView(this),this.rendererComponent=null}renderImage(e,t,n,i){const s=this.canvas.width,r=this.canvas.height;this.setRenderSize(e,t),this.render();const o=this.canvas.toDataURL(n,i);return this.setRenderSize(s,r),o}render(){const e=this.rendererComponent.activeSceneComponent;if(!e)return;let t=e.scene,n=e.activeCamera;t&&n||(t=this.defaultScene,n=this.defaultCamera);const i=this.renderer;i.clear(),i.__view=this;const s=this.viewports;for(let e=0,r=s.length;e<r;++e){const r=s[e];i.__viewport=r;const o=r.updateCamera(n);r.applyViewport(this.renderer),i.render(t,o)}}setRenderSize(e,t){this.canvas.width=e,this.canvas.height=t,this.viewports.forEach(n=>n.setCanvasSize(e,t)),this.renderer.xr.isPresenting||this.renderer.setSize(e,t,!1)}resize(){this.setRenderSize(this.canvas.clientWidth,this.canvas.clientHeight),this.renderer.xr.isPresenting||this.render()}setViewportCount(e){const t=this.viewports;for(let n=e;n<t.length;++n)t[n].dispose();for(let n=t.length;n<e;++n){const e=(new Dm).appendTo(this.overlay);t[n]=new Om,t[n].setCanvasSize(this.canvasWidth,this.canvasHeight),t[n].overlay=e}t.length=e}getViewportCount(){return this.viewports.length}onPointer(e){if(!this.system)return!1;let t=!1,n=!1;"pointer-hover"===e.type?n=!0:e.isPrimary&&"pointer-down"===e.type&&(n=!0,t=!0);const i=this.routeEvent(e,n,t);if(i){const e=i.component;if(e){e.emit(i);const t=e.getComponent(ze);!i.stopPropagation&&t&&t.propagateUp(!1,!0,i)}if(i.stopPropagation||this.system.emit(i),!i.stopPropagation){i.viewport.onPointer(i)&&this.system.getMainComponent(q).forceRender()}return!0}return!1}onTrigger(e){if(!this.system)return!1;const t=this.routeEvent(e,!0,!0);if(t){const e=t.component;if(e){e.emit(t);const n=e.getComponent(ze);!t.stopPropagation&&n&&n.propagateUp(!1,!0,t)}if(t.stopPropagation||this.system.emit(t),!t.stopPropagation){t.viewport.onTrigger(t)&&this.system.getMainComponent(q).forceRender()}return!0}return!1}pickPosition(e,t,n){return this.picker.pickPosition(this.targetScene,this.targetCamera,e,t,n)}pickNormal(e,t){return this.picker.pickNormal(this.targetScene,this.targetCamera,e,t)}routeEvent(e,t,n){let i=this.targetViewport,s=this.targetObject3D,r=this.targetComponent;if(t){i=null;const t=this.viewports;for(let n=0,s=t.length;n<s;++n){const s=t[n];if(s.isInside(e)){i=s;break}}}if(!i)return null;const o=e;if(o.view=this,o.viewport=i,o.deviceX=i.getDeviceX(e.localX),o.deviceY=i.getDeviceY(e.localY),o.stopPropagation=!1,n){const t=this.rendererComponent.activeSceneComponent,n=this.targetScene=t&&t.scene,i=this.targetCamera=t&&t.activeCamera;if(s=null,r=null,n&&i)if(s=this.picker.pickObject(n,i,e),void 0===s)0;else{let e=s;for(;e&&!r;)r=e.userData.component,r||(e=e.parent);0}}return o.object3D=s,o.component=r,this.targetViewport=i,this.targetObject3D=s,this.targetComponent=r,o}}!function(e){e[e.Single=0]="Single",e[e.HorizontalSplit=1]="HorizontalSplit",e[e.VerticalSplit=2]="VerticalSplit",e[e.Quad=3]="Quad"}(Nm||(Nm={}));class Im extends km{constructor(e,t,n){super(e,t,n),this._layout=Nm.Quad,this._horizontalSplit=.5,this._verticalSplit=.5,this.addEvent("layout"),this.layout=Nm.Single}set layout(e){if(e===this._layout)return;this._layout=e;const t=this.viewports;switch(this._layout){case Nm.Single:this.setViewportCount(1);break;case Nm.HorizontalSplit:case Nm.VerticalSplit:this.setViewportCount(2);break;case Nm.Quad:this.setViewportCount(4)}this.updateSplitPositions(),t[1]&&(t[1].setBuiltInCamera(vh.Orthographic,yh.Top),t[1].enableCameraControl(!0).orientationEnabled=!1),t[2]&&(t[2].setBuiltInCamera(vh.Orthographic,yh.Left),t[2].enableCameraControl(!0).orientationEnabled=!1),t[3]&&(t[3].setBuiltInCamera(vh.Orthographic,yh.Front),t[3].enableCameraControl(!0).orientationEnabled=!1),this.emit({type:"layout",layout:e})}get layout(){return this._layout}set horizontalSplit(e){this._horizontalSplit=e,this.updateSplitPositions()}get horizontalSplit(){return this._horizontalSplit}set verticalSplit(e){this._verticalSplit=e,this.updateSplitPositions()}get verticalSplit(){return this._verticalSplit}updateSplitPositions(){const e=this._horizontalSplit,t=this._verticalSplit;switch(this._layout){case Nm.Single:this.viewports[0].setSize(0,0,1,1);break;case Nm.HorizontalSplit:this.viewports[0].setSize(0,0,e,1),this.viewports[1].setSize(e,0,1-e,1);break;case Nm.VerticalSplit:this.viewports[0].setSize(0,1-t,1,t),this.viewports[1].setSize(0,0,1,1-t);break;case Nm.Quad:this.viewports[0].setSize(0,1-t,e,t),this.viewports[1].setSize(e,1-t,1-e,t),this.viewports[2].setSize(0,0,e,1-t),this.viewports[3].setSize(e,0,1-e,1-t)}}}var zm,Um=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Fm=zm=class extends vr{constructor(){super(),this.direction="horizontal",this.width=5,this.margin=20,this.detached=!1,this._isActive=!1,this._offset=0,this._position=0,this.addEventListener("pointerdown",e=>this.onPointerDown(e)),this.addEventListener("pointermove",e=>this.onPointerMove(e)),this.addEventListener("pointerup",e=>this.onPointerUpOrCancel(e)),this.addEventListener("pointercancel",e=>this.onPointerUpOrCancel(e))}get position(){return this._position}isHorizontal(){return"horizontal"===this.direction}update(e){super.update(e);const t=this.isHorizontal(),n=this.width;this.setStyle({padding:t?`0 ${n}px`:n+"px 0",margin:t?`0 ${-n}px`:-n+"px 0",cursor:t?"col-resize":"row-resize"})}firstUpdated(){this.classList.add("ff-splitter"),this.setAttribute("touch-action","none"),this.setStyle({position:"relative",display:"block",zIndex:"1",touchAction:"none"})}onPointerDown(e){if(e.isPrimary){e.stopPropagation(),e.preventDefault(),this._isActive=!0,this.setPointerCapture(e.pointerId);const t=this.getBoundingClientRect();this._offset=this.isHorizontal()?t.left+.5*t.width-e.clientX:t.top+.5*t.height-e.clientY}}onPointerMove(e){if(e.isPrimary&&this._isActive){e.stopPropagation(),e.preventDefault();const t=this.parentElement;if(!t)return;const n=t.getBoundingClientRect(),i=this.isHorizontal(),s=i?n.width:n.height;let r=this._offset+(i?e.clientX-n.left:e.clientY-n.top),o=r/s;if(!this.detached){const e=this.previousElementSibling,n=this.nextElementSibling;if(e instanceof HTMLElement&&n instanceof HTMLElement){const a=Array.from(t.children);let l=0,c=s,h=!1;a.forEach(t=>{if(t instanceof zm)return;if(t===e||t===n)return void(h=!0);const s=t.getBoundingClientRect(),r=i?s.width:s.height;c-=r,h||(l+=r)});const u=this.margin,d=c-u;r-=l,r=r<u?u:r>d?d:r;const p=(c-r)/s;o=r/s,e.style.flexBasis=(100*o).toFixed(3)+"%",n.style.flexBasis=(100*p).toFixed(3)+"%",setTimeout(()=>window.dispatchEvent(new CustomEvent("resize")),0)}}this._position=o,this.dispatchEvent(new CustomEvent(zm.changeEvent,{detail:{direction:this.direction,position:this._position,isDragging:!0}}))}}onPointerUpOrCancel(e){e.isPrimary&&(e.stopPropagation(),e.preventDefault(),this._isActive=!1,this.dispatchEvent(new CustomEvent(zm.changeEvent,{detail:{direction:this.direction,position:this._position,isDragging:!1}})))}};Fm.changeEvent="ff-splitter-change",Um([nr({type:String})],Fm.prototype,"direction",void 0),Um([nr({type:Number})],Fm.prototype,"width",void 0),Um([nr({type:Number})],Fm.prototype,"margin",void 0),Um([nr({type:Boolean})],Fm.prototype,"detached",void 0),Fm=zm=Um([yr("ff-splitter")],Fm);var Vm,Bm=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};!function(e){e[e.Single=0]="Single",e[e.HorizontalSplit=1]="HorizontalSplit",e[e.VerticalSplit=2]="VerticalSplit",e[e.Quad=3]="Quad"}(Vm||(Vm={}));let jm=class extends vr{constructor(){super(...arguments),this.layout=Vm.Single,this.horizontalPosition=.5,this.verticalPosition=.5}firstConnected(){this.classList.add("ff-quad-splitter")}render(){const e=this.layout;if(e===Vm.Single)return Gs``;const t=[];return e!==Vm.HorizontalSplit&&e!==Vm.Quad||t.push(Gs`
                <div class="ff-horizontal" style="position:absolute; top:0; bottom:0; left:0; right:0; display:flex;">
                    <div class="ff-left" style="flex:1 1;"></div>
                    <ff-splitter direction="horizontal" position=${this.horizontalPosition} @ff-splitter-change=${this.onSplitterChange}></ff-splitter>
                    <div style="flex:1 1;"></div>
                </div>
            `),e!==Vm.VerticalSplit&&e!==Vm.Quad||t.push(Gs`
                <div class="ff-vertical" style="position:absolute; top:0; bottom:0; left:0; right:0; display:flex; flex-direction: column">
                    <div class="ff-top" style="flex:1 1;"></div>
                    <ff-splitter direction="vertical" position=${this.verticalPosition} @ff-splitter-change=${this.onSplitterChange}></ff-splitter>
                    <div style="flex:1 1;"></div>
                </div>
            `),Gs`${t}`}onSplitterChange(e){"horizontal"===e.detail.direction?this.horizontalPosition=e.detail.position:this.verticalPosition=e.detail.position,this.onChange&&this.onChange({layout:this.layout,horizontalSplit:this.horizontalPosition,verticalSplit:this.verticalPosition,isDragging:e.detail.isDragging})}};Bm([nr({attribute:!1})],jm.prototype,"layout",void 0),Bm([nr({attribute:!1})],jm.prototype,"horizontalPosition",void 0),Bm([nr({attribute:!1})],jm.prototype,"verticalPosition",void 0),jm=Bm([yr("ff-quad-splitter")],jm);var $m=jm,Gm=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Hm=class extends fd{constructor(e){super(e),this.view=null,this.canvas=null,this.overlay=null,this.splitter=null,this.onResize=this.onResize.bind(this),this.manipTarget=new fp,this.addEventListener("pointerdown",this.manipTarget.onPointerDown),this.addEventListener("pointermove",this.manipTarget.onPointerMove),this.addEventListener("pointerup",this.manipTarget.onPointerUpOrCancel),this.addEventListener("pointercancel",this.manipTarget.onPointerUpOrCancel),this.ownerDocument.addEventListener("pointermove",this.manipTarget.onPointerMove),this.ownerDocument.addEventListener("pointerup",this.manipTarget.onPointerUpOrCancel),this.ownerDocument.addEventListener("pointercancel",this.manipTarget.onPointerUpOrCancel),this.addEventListener("wheel",this.manipTarget.onWheel),this.addEventListener("contextmenu",this.manipTarget.onContextMenu)}firstConnected(){this.classList.add("sv-scene-view"),this.style.touchAction="none",this.setAttribute("touch-action","none"),this.canvas=this.appendElement("canvas",{display:"block",width:"100%",height:"100%"}),this.overlay=this.appendElement("div",{position:"absolute",top:"0",bottom:"0",left:"0",right:"0",overflow:"hidden"}),this.overlay.classList.add("sv-content-overlay"),this.splitter=this.appendElement($m,{position:"absolute",top:"0",bottom:"0",left:"0",right:"0",overflow:"hidden"}),this.splitter.onChange=e=>{this.view.horizontalSplit=e.horizontalSplit,this.view.verticalSplit=e.verticalSplit},this.view=new Im(this.system,this.canvas,this.overlay),this.view.on("layout",e=>this.splitter.layout=e.layout),this.view.layout=Vm.Single,this.splitter.layout=Vm.Single,this.manipTarget.next=this.view}connected(){this.view.attach(),window.addEventListener("resize",this.onResize),window.dispatchEvent(new CustomEvent("resize"))}disconnected(){this.view.detach(),window.removeEventListener("resize",this.onResize)}onResize(){this.view.resize()}};Hm=Gm([yr("sv-scene-view")],Hm);var Wm,qm=Hm,Xm=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Ym=Wm=class extends vr{constructor(){super(...arguments),this.visible=!1}firstConnected(){super.firstConnected(),this.classList.add("sv-spinner")}render(){return this.style.visibility=this.visible?"visible":"hidden",Wm.template}};Ym.template=Gs`<div class="sv-spinner-wheel"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve"><style type="text/css">.st0{fill:none;stroke:#009ADE;stroke-width:5;stroke-miterlimit:10;}.st1{fill:none;stroke:#FFCD00;stroke-width:5;stroke-miterlimit:10;}</style><circle class="st0" cx="256.6" cy="256" r="252"/><path class="st1" d="M408.6,307c-16.3-28-42.1-28.4-45.3-28.3c0,0,0-0.1,0-0.1L472,256l-108.7-22.6l0,0c1.1-1,22.3-19.7,54-20.2 c23.9-0.4,44.6-29.6,31.4-52.1c0,0-3.9,35.4-48.6,23.6c-31.4-8.3-49.9,9.7-52,12l0,0l60.9-93L316,164.5c0,0,0,0,0,0 c0.1-1.4,1.8-29.6,23.9-52.4c16.7-17.2,10.6-52.5-14.6-59.1c0,0,22.2,27.8-17.7,51c-28.1,16.3-28.4,42.1-28.3,45.3l-0.1,0 L256.6,40.5l-22.7,108.7c0,0,0,0,0,0c-0.9-1-19.7-22.2-20.2-54c-0.4-23.9-29.6-44.6-52.1-31.4c0,0,35.3,3.9,23.6,48.6 c-8.3,31.5,9.8,49.9,12,52.1l0,0l-93-60.9l0,0l0,0l49.6,75.7l11.3,17.2c0,0,0,0,0,0c-0.9,0-29.4-1.6-52.5-23.9 c-17.2-16.7-52.5-10.6-59.1,14.6c0,0,27.8-22.2,51,17.7c16.4,28.1,42.3,28.4,45.3,28.3c0,0,0,0,0,0L41.1,256l108.8,22.7v0 c-0.7,0.7-22,19.7-54,20.2c-23.9,0.4-44.6,29.6-31.4,52.1c0,0,3.9-35.4,48.6-23.6c31.5,8.3,50-9.9,52.1-12c0,0,0,0.1,0.1,0.1 l-60.9,92.9l92.9-60.9c0,1-1.6,29.5-23.9,52.5c-16.7,17.2-10.6,52.5,14.6,59.1c0,0-22.2-27.8,17.7-51c28.1-16.4,28.4-42.2,28.3-45.3 c0,0,0.1,0,0.1,0l22.7,108.7l22.7-108.7l0,0c0.8,0.9,19.7,22.1,20.2,54c0.4,23.9,29.6,44.6,52.1,31.4c0,0-35.3-3.9-23.6-48.5 c8.3-31.5-9.8-49.9-12-52.1c0,0,0.1,0,0.1-0.1l92.9,60.9l-32.1-49.1L348,315.4l0,0c1.3,0.1,29.6,1.7,52.4,23.9 c17.2,16.7,52.5,10.6,59.1-14.6C459.6,324.7,431.8,346.9,408.6,307z"/></svg></div>`,Xm([nr({type:Boolean})],Ym.prototype,"visible",void 0),Ym=Wm=Xm([yr("sv-spinner")],Ym);var Zm=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Jm=class extends md{constructor(){super(...arguments),this.reader=null,this.language=null}firstConnected(){super.firstConnected(),this.classList.add("sv-reader-view")}renderMenuEntry(e){const t=e.article;return Gs`<div class="sv-entry" @click=${e=>this.onClickArticle(e,t.id)}>
            <h1>${t.title}</h1>
            <p>${t.lead}</p>
        </div>`}render(){const e=this.reader,t=this.language;if(!e)return Gs`<div class="ff-placeholder">Please select a document to display its articles.</div>`;if(!e.activeArticle){const n=e.articles;return Gs`<div class="sv-left"></div><div class="sv-article">
                <ff-button class="sv-nav-button" inline title=${t.getLocalizedString("Close Article Reader")} icon="close" @click=${this.onClickClose}></ff-button>
                ${n.map(e=>this.renderMenuEntry(e))}
            </div><div class="sv-right"></div>`}return Gs`<div class="sv-left"></div><div class="sv-article">
                <ff-button class="sv-nav-button" inline title=${t.getLocalizedString("Close Article Reader")} icon="close" @click=${this.onClickClose}></ff-button>
                <ff-button class="sv-nav-button" inline title=${t.getLocalizedString("Article Menu")} icon="bars" @click=${this.onClickMenu}></ff-button>
                <div class="sv-container"></div>
            </div><div class="sv-right"></div>`}onClickMenu(e){e.stopPropagation(),this.reader.ins.articleId.setValue("")}onClickClose(e){e.stopPropagation(),this.dispatchEvent(new CustomEvent("close"))}onClickArticle(e,t){this.reader.ins.articleId.setValue(t)}updated(e){super.updated(e);const t=this.reader;if(t&&t.activeArticle){this.getElementsByClassName("sv-container").item(0).innerHTML=t.outs.content.value}}onActiveDocument(e,t){e&&(e.setup.language.outs.language.off("value",this.onUpdate,this),this.reader.outs.content.off("value",this.onUpdate,this),this.reader.outs.article.off("value",this.onUpdate,this),this.language=null,this.reader=null),t&&(this.reader=t.setup.reader,this.language=t.setup.language,this.reader.outs.content.on("value",this.onUpdate,this),this.reader.outs.article.on("value",this.onUpdate,this),t.setup.language.outs.language.on("value",this.onUpdate,this))}};Jm=Zm([yr("sv-reader-view")],Jm);var Km=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Qm=class extends md{get arManager(){return this.system.getMainComponent(bu)}firstConnected(){super.firstConnected()}render(){const e=this.arManager.outs;return!e.isPlaced.value&&e.isPresenting.value?Gs`<div class="sv-ar-prompt">
                <div class="sv-content">
                    <div><ff-icon class="ff-off ff-icon sv-ar-icon" name="device-move"}></ff-icon></div>
                    Move the device to place your Smithsonian object!<br><br>**BETA**
                </div>
            </div>`:null}onActiveDocument(e,t){e&&(this.arManager.outs.isPlaced.off("value",this.onUpdate,this),this.arManager.outs.isPresenting.off("value",this.onUpdate,this)),t&&(this.arManager.outs.isPlaced.on("value",this.onUpdate,this),this.arManager.outs.isPresenting.on("value",this.onUpdate,this)),this.requestUpdate()}};Qm=Km([yr("sv-ar-prompt-container")],Qm);var eg=Qm,tg=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let ng=class extends md{constructor(){super(...arguments),this.documentProps=new pp("value",this.onUpdate,this),this.shareButtonSelected=!1}get analytics(){return this.system.getMainComponent(Bl)}get arManager(){return this.system.getMainComponent(bu)}firstConnected(){super.firstConnected(),this.classList.add("sv-ar-menu-container")}connected(){super.connected()}disconnected(){super.disconnected()}render(){const e=this.activeDocument;if(!e)return Gs``;const t=this.arManager.outs,n=e.setup.viewer.ins.annotationsVisible.value;return t.isPlaced.value&&t.isPresenting.value?Gs`<div class="sv-ar-menu">
        ${Gs`<ff-button icon="comment" title="Show/Hide Annotations"
            ?selected=${n} @click=${this.onToggleAnnotations}></ff-button>`}
        </div>`:null}onToggleReader(){const e=this.activeDocument.setup.reader.ins;e.enabled.setValue(!e.enabled.value),this.analytics.sendProperty("Reader.Enabled",e.enabled.value)}onToggleAnnotations(){const e=this.activeDocument.setup.viewer.ins;e.annotationsVisible.setValue(!e.annotationsVisible.value),this.analytics.sendProperty("Annotations.Visible",e.annotationsVisible.value)}onActiveDocument(e,t){if(e&&(this.documentProps.off(),this.arManager.outs.isPlaced.off("value",this.onUpdate,this),this.arManager.outs.isPresenting.off("value",this.onUpdate,this)),t){const e=t.setup;this.documentProps.on(e.viewer.ins.annotationsVisible),this.arManager.outs.isPlaced.on("value",this.onUpdate,this),this.arManager.outs.isPresenting.on("value",this.onUpdate,this)}this.requestUpdate()}};ng=tg([yr("sv-ar-menu")],ng);var ig=ng,sg=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let rg=class extends md{constructor(){super(...arguments),this.sceneView=null,this.documentProps=new pp("value",this.onUpdate,this)}get analytics(){return this.system.getMainComponent(Bl)}get assetManager(){return this.system.getMainComponent(Ol)}get reader(){return this.activeDocument?this.activeDocument.setup.reader:null}get tours(){return this.activeDocument?this.activeDocument.setup.tours:null}get renderer(){return this.system.getMainComponent(q)}get arManager(){return this.system.getMainComponent(bu)}firstConnected(){this.classList.add("sv-content-view"),this.sceneView=new qm(this.system)}connected(){super.connected(),this.assetManager.outs.busy.on("value",this.performUpdate,this)}disconnected(){this.assetManager.outs.busy.off("value",this.performUpdate,this),super.disconnected()}render(){const e=this.system,t=this.assetManager.outs.busy.value,n=this.assetManager.initialLoad;let i=!1,s=So.Overlay,r=!1;const o=this.reader,a=this.tours,l=this.arManager.shadowRoot.querySelector("ff-viewport-overlay");l&&(null===this.arManager.shadowRoot.querySelector("sv-ar-prompt-container")&&l.append(new eg(this.system)),null===this.arManager.shadowRoot.querySelector("sv-ar-menu")&&l.append(new ig(this.system))),a&&(r=a.ins.enabled.value&&-1===a.outs.tourIndex.value),o&&(i=!r&&o.ins.enabled.value,s=o.ins.position.value,!0===this.mobileCheck()&&(s=So.Overlay));const c=this.sceneView;if(i&&s===So.Overlay||r?c.classList.contains("sv-blur")||setTimeout(()=>{c.classList.add("sv-blur"),this.renderer.views[0].render()},1):c.classList.remove("sv-blur"),!t&&n&&(this.analytics.sendProperty("Loading.Time",this.analytics.getTimerTime()/1e3),this.analytics.resetTimer(),this.assetManager.initialLoad=!1),i){if(s===So.Right)return Gs`<div class="ff-fullsize sv-content-split">
                    <div class="ff-splitter-section" style="flex-basis: 60%">
                        ${c}
                    </div>
                    <ff-splitter direction="horizontal"></ff-splitter>
                        <div class="ff-splitter-section" style="flex-basis: 40%; max-width: 500px;">
                            <div class="sv-reader-container">
                                <sv-reader-view .system=${e} @close=${this.onReaderClose} ></sv-reader-view>
                            </div>
                        </div>
                    </div>
                    <sv-spinner ?visible=${t}></sv-spinner>`;if(s===So.Overlay)return Gs`<div class="ff-fullsize sv-content-stack">${c}
                    <div class="sv-reader-container">
                        <sv-reader-view .system=${e} @close=${this.onReaderClose}></sv-reader-view>
                    </div>
                    <sv-spinner ?visible=${t}></sv-spinner></div>`}return Gs`<div class="ff-fullsize sv-content-only">${c}</div>
            <sv-spinner ?visible=${t}></sv-spinner>`}onReaderClose(){this.reader.ins.enabled.setValue(!1)}onActiveDocument(e,t){e&&this.documentProps.off(),t&&this.documentProps.on(t.setup.reader.ins.position,t.setup.reader.ins.enabled,t.setup.tours.outs.tourIndex),this.requestUpdate()}mobileCheck(){var e,t=!1;return e=navigator.userAgent||navigator.vendor,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t}};rg=sg([yr("sv-content-view")],rg);var og=rg,ag=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let lg=class extends vr{constructor(){super(),this.mode="radio",this.selectionIndex=-1,this.observer=new MutationObserver(this.onObserver),this.selectedButton=null,this.addEventListener("click",e=>this.onClick(e))}firstConnected(){this.classList.add("ff-button-group"),this.parseChildren()}connected(){this.observer.observe(this,{childList:!0})}disconnected(){this.observer.disconnect()}onObserver(e){e.forEach(e=>{"childList"===e.type&&this.parseChildren()})}onClick(e){let t=e.target;for(;t&&t!==this&&!(t instanceof Jl);)t=t.parentElement;t instanceof Jl&&(t.selected?"exclusive"===this.mode&&(t.selected=!1,this.selectedButton=null,this.selectionIndex=-1):(this.selectedButton&&(this.selectedButton.selected=!1),this.selectedButton=t,this.selectedButton.selected=!0,this.selectionIndex=this.getButtons().indexOf(t)))}parseChildren(){const e=this.getButtons();this.selectedButton&&(this.selectionIndex=e.indexOf(this.selectedButton),this.selectionIndex<0&&(this.selectedButton.selected=!1,this.selectedButton=null)),(this.selectionIndex<0||this.selectionIndex>=e.length)&&(this.selectionIndex="radio"===this.mode?0:-1),this.selectionIndex>=0&&(this.selectedButton=e[this.selectionIndex],this.selectedButton.selected=!0)}getButtons(){return this.getChildrenArray().filter(e=>e instanceof Jl)}};ag([nr({type:String})],lg.prototype,"mode",void 0),ag([nr({type:Number})],lg.prototype,"selectionIndex",void 0),lg=ag([yr("ff-button-group")],lg);var cg,hg=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let ug=cg=class extends vr{firstConnected(){super.firstConnected(),this.classList.add("sv-logo")}render(){return Gs`<div class="sv-short">${cg.sunburst}</div><div class="sv-full">${cg.sunburst}${cg.smithsonian}</div>`}};ug.sunburst=Gs`<div class="sv-sunburst"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 158 158"><defs><style>.si-blue{fill:#009cde;}.si-yellow{fill:#ffcd00;}</style></defs><title>si-sunburst</title><circle class="si-blue" cx="79.02" cy="79" r="79.02"/><path class="si-yellow" d="M126.69,95c-5.12-8.8-13.2-8.9-14.2-8.87v0L146.59,79l-34.1-7.1h0a27.63,27.63,0,0,1,16.93-6.32c7.5-.11,14-9.29,9.85-16.35,0,0-1.23,11.09-15.23,7.39-9.84-2.6-15.63,3-16.32,3.77h0l19.09-29.14L97.67,50.32h0a27.47,27.47,0,0,1,7.49-16.44c5.23-5.39,3.33-16.47-4.59-18.53,0,0,7,8.71-5.54,16-8.8,5.13-8.9,13.21-8.88,14.21h0L79,11.43l-7.1,34.11h0a27.53,27.53,0,0,1-6.33-16.93c-.11-7.5-9.29-14-16.35-9.86,0,0,11.09,1.24,7.39,15.23C54,43.85,59.7,49.64,60.4,50.31h0L31.24,31.22h0L46.8,55l3.54,5.39h0a27.55,27.55,0,0,1-16.45-7.5c-5.39-5.22-16.47-3.32-18.53,4.59,0,0,8.71-7,16,5.55,5.14,8.82,13.26,8.89,14.22,8.87h0L11.45,79l34.1,7.11h0a27.56,27.56,0,0,1-16.93,6.32c-7.51.12-14,9.3-9.86,16.35,0,0,1.24-11.08,15.24-7.39,9.88,2.61,15.67-3.1,16.32-3.78l0,0L31.25,126.79,60.38,107.7a27.51,27.51,0,0,1-7.5,16.44c-5.22,5.39-3.32,16.47,4.59,18.53,0,0-7-8.71,5.55-16,8.82-5.14,8.89-13.25,8.87-14.21h0L79,146.57l7.11-34.09h0a27.67,27.67,0,0,1,6.33,16.94c.11,7.5,9.29,14,16.34,9.85,0,0-11.08-1.23-7.39-15.23,2.61-9.86-3.07-15.65-3.77-16.32l0,0,29.13,19.09L116.73,111.4l-9-13.76h0a27.64,27.64,0,0,1,16.45,7.5c5.38,5.23,16.47,3.33,18.53-4.59C142.69,100.55,134,107.52,126.69,95Z"/></svg></div>`,ug.smithsonian=Gs`<div class="sv-smithsonian"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 990 158"><defs><style>.si-white{fill:#fff;}</style></defs><title>si-text-neg</title><path class="si-white" d="M67,44.45C63.37,31.73,58.2,18,40.91,18c-15.3,0-22.06,11.13-22.06,21.86,0,14.51,9.54,21.27,25.24,29.42,15.5,8,34.39,17.29,34.39,39.55,0,20.87-17.69,37.57-44.13,37.57a69.28,69.28,0,0,1-19.48-3,67.3,67.3,0,0,1-9.74-4.18C3.54,135.09,1,118-.23,108.46l5.76-1.4c3.18,12.13,12.12,32.2,32.6,32.2C53,139.26,62,129.92,62,115.41,62,100.7,51.05,93.75,36.14,85.8,23.42,79,3.34,69.1,3.34,46.64c0-19.08,15.31-35.38,41-35.38,9.14,0,17.49,2.18,25,4.57.8,7.16,1.79,14.91,3.38,27.43Z"/><path class="si-white" d="M200.32,143.44v-5.17c11.73-1.19,13.91-2,13.91-16.1V89c0-14.12-5-23.06-17.49-23.06-7.15,0-14.71,4-22.26,10.33a46.33,46.33,0,0,1,.6,8.35v38.76c0,12.52,1.79,13.72,12.72,14.91v5.17H145.26v-5.17c12.33-1.19,14.12-2.19,14.12-15.31V88.78c0-14.71-5.17-22.86-17.3-22.86-8,0-15.7,5.37-21.66,10.33V123c0,12.92,1.59,14.12,11.33,15.31v5.17H89.81v-5.17c13.12-1.19,14.9-2.39,14.9-15.31V81.82c0-12.72-.59-13.71-12.12-15.5V61.74c8.75-1.59,18.88-4.17,27.63-8.14V69.7c4.17-2.79,8.55-6.37,14.51-10.14,5.17-3.18,9.94-5.37,16.3-5.37,9.54,0,18.08,6,22.06,16.3a185.42,185.42,0,0,1,16.5-11.13c4.17-2.78,9.34-5.17,14.9-5.17,15.51,0,25.25,10.93,25.25,30.41V123c0,13.32,1.59,14.12,12.92,15.31v5.17Z"/><path class="si-white" d="M253.59,143.44v-5.17c12.52-1.19,13.91-2.39,13.91-15.9V81.42c0-12.32-.6-13.12-12.52-15.1V61.55a125.21,125.21,0,0,0,28.22-7.76v68.58c0,13.51,1.39,14.71,14.12,15.9v5.17ZM264.12,26.76a10.22,10.22,0,0,1,10.14-10.33c5.56,0,9.94,4.37,9.94,10.33A10.18,10.18,0,0,1,274.06,36.9,10.42,10.42,0,0,1,264.12,26.76Z"/><path class="si-white" d="M343.82,143.24a20.14,20.14,0,0,1-8.34,2.58c-12.53,0-19.48-7.95-19.48-23.65V64.33H302.28l-.79-2,5.36-5.76H316V42.07L328.92,29l2.78.4V56.58h22.46c1.79,2,1.19,6.36-1.19,7.75H331.7v51.08c0,16.1,6.56,19.08,11.53,19.08s9.54-2,12.32-3.38l1.79,5.17Z"/><path class="si-white" d="M420,143.44v-5.17c11.53-1.19,13.12-2.39,13.12-15.31V90c0-16.3-6.17-24.45-19.48-24.45-7.56,0-15.11,3.78-20.67,10.14V123c0,12.73,1,14.12,12.72,15.31v5.17H363.5v-5.17c11.92-1,13.71-2.19,13.71-15.31V28.15c0-12.52-.39-13.51-13.51-14.71V8.87a218.64,218.64,0,0,0,29.22-6.95V68.7c6.95-7.15,17.69-14.51,28.42-14.51,16.1,0,27.43,10.14,27.43,34V123c0,13.12,1.39,14.32,13.12,15.31v5.17Z"/><path class="si-white" d="M522.91,80c-3.78-11.73-10.74-19.68-20.48-19.68-7.55,0-12.92,6-12.92,13.72,0,8.94,8,13.51,16.9,17.29,14.91,6.16,25,13.32,25,27,0,18.09-16.89,27.43-32.79,27.43-10.14,0-19.28-3.77-22.86-6.76-1.39-2.78-3.18-16.29-3.18-23.45l5.17-1c3.57,13.11,12.52,24.64,24.45,24.64a13.86,13.86,0,0,0,14.11-13.91c0-8.75-5.77-13.52-15.7-18.09-11.93-5.56-24.85-12.12-24.85-27.43,0-13.91,11.93-25.64,30.21-25.64a46.23,46.23,0,0,1,17.69,3.38c1.59,4.57,3.78,16.3,4.38,21.27Z"/><path class="si-white" d="M633,98.52c0,32-23.45,47.3-43.13,47.3-27.23,0-43.53-21.86-43.53-43.92,0-32.8,25.44-47.71,43.53-47.71C614.54,54.19,633,73.87,633,98.52Zm-68.18-3c0,25,10.94,43.72,27.24,43.72,12.32,0,22.46-9.14,22.46-36.37,0-23.26-9.35-42.14-26.64-42.14C575.58,60.75,564.84,73.07,564.84,95.54Z"/><path class="si-white" d="M700.6,143.44v-5.17c11.73-1.19,13.12-2.78,13.12-16.5V88.58c0-13.72-4.77-22.66-18.09-22.66-8,0-15.7,5-21.66,10.14v46.71c0,13.51,1.19,14.31,12.92,15.5v5.17H643.75v-5.17c13.52-1.39,14.52-2.39,14.52-15.5V81.62c0-12.72-1.2-13.32-11.93-15.3V61.74C655.88,60,665.22,57.57,674,53.6V69.5c4-3,8.34-6,13.31-9.35,5.57-3.57,10.74-6,16.5-6,15.7,0,25.64,10.93,25.64,30.21v38.37c0,13.51,1,14.31,12.52,15.5v5.17Z"/><path class="si-white" d="M753.08,143.44v-5.17c12.52-1.19,13.91-2.39,13.91-15.9V81.42c0-12.32-.6-13.12-12.52-15.1V61.55a125.35,125.35,0,0,0,28.22-7.76v68.58c0,13.51,1.39,14.71,14.11,15.9v5.17ZM763.61,26.76a10.22,10.22,0,0,1,10.14-10.33c5.56,0,9.93,4.37,9.93,10.33A10.18,10.18,0,0,1,773.55,36.9,10.42,10.42,0,0,1,763.61,26.76Z"/><path class="si-white" d="M869.74,145.82a16.26,16.26,0,0,1-9.34-3.77,20.82,20.82,0,0,1-4.77-9c-8,5.37-17.49,12.72-23.45,12.72-14.12,0-23.85-11.72-23.85-24.25,0-9.74,5.16-15.9,16.1-19.67,11.92-4,26.43-9.35,30.8-12.92V85.4c0-14.31-6.75-22.46-16.69-22.46a11.23,11.23,0,0,0-8.95,4c-2.58,2.59-4.37,7-6,13.12a5.53,5.53,0,0,1-5.76,4.57c-3.58,0-8.75-4-8.75-8.54,0-3,2.59-5.17,6.36-8,5.57-4,18.49-11.73,29.82-13.92a25.93,25.93,0,0,1,16.3,5.37c6.95,5.76,8.94,13.91,8.94,24.25v37c0,8.94,3.58,11.92,7,11.92a15.11,15.11,0,0,0,7.15-2.18l2,5.17ZM855.23,95.73c-4.17,2.19-13.71,6.36-17.88,8.35-7.76,3.58-12.13,7.36-12.13,14.51,0,10.34,7.95,15.31,14.11,15.31,5.17-.2,12.13-3.58,15.9-7.16Z"/><path class="si-white" d="M948.66,143.44v-5.17c11.72-1.19,13.12-2.78,13.12-16.5V88.58c0-13.72-4.77-22.66-18.09-22.66-8,0-15.71,5-21.67,10.14v46.71c0,13.51,1.2,14.31,12.92,15.5v5.17H891.81v-5.17c13.52-1.39,14.51-2.39,14.51-15.5V81.62c0-12.72-1.19-13.32-11.92-15.3V61.74C903.93,60,913.28,57.57,922,53.6V69.5c4-3,8.35-6,13.32-9.35,5.56-3.57,10.73-6,16.5-6,15.7,0,25.64,10.93,25.64,30.21v38.37c0,13.51,1,14.31,12.52,15.5v5.17Z"/></svg></div>`,ug=cg=hg([yr("sv-logo")],ug);var dg=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let pg=class extends vr{constructor(){super(),this.anchor=null,this.portal=null,this.position=void 0,this.align=void 0,this.justify=void 0,this.positionX=0,this.positionY=0,this.offsetX=0,this.offsetY=0,this.keepVisible=!1,this.modal=!1,this._modalPlane=null,this.onResize=this.onResize.bind(this),this.onCaptureEvent=this.onCaptureEvent.bind(this),this.onEatEvent=this.onEatEvent.bind(this)}close(){this.dispatchEvent(new CustomEvent("close"))}connected(){if(this.calculatePosition(),window.addEventListener("resize",this.onResize),this.modal){const e=this._modalPlane=this.createElement("div");e.classList.add("ff-modal-plane"),e.addEventListener("mousedown",this.onEatEvent),e.addEventListener("contextmenu",this.onEatEvent),e.addEventListener("pointerdown",this.onEatEvent),this.parentElement.appendChild(e),setTimeout(()=>e.classList.add("ff-transition"))}else document.addEventListener("mousedown",this.onCaptureEvent,{capture:!0,passive:!0})}disconnected(){window.removeEventListener("resize",this.onResize),this._modalPlane?(this._modalPlane.remove(),this._modalPlane=null):document.removeEventListener("mousedown",this.onCaptureEvent)}firstConnected(){super.firstConnected(),this.setStyle({position:"fixed",zIndex:"1000"}),this.classList.add("ff-popup")}updated(){this.isConnected&&this.calculatePosition()}calculatePosition(){let e,t;const n=this.getBoundingClientRect();let i;if(t=this.portal?this.portal.getBoundingClientRect():{left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight},"center"===this.position)i=this.center(n,t);else if("anchor"===this.position){const s=this.anchor||this.parentElement;s&&(e=s.getBoundingClientRect(),i=this.positionToAnchor(n,e,t))}else i={x:this.positionX,y:this.positionY};this.keepVisible&&"center"!==this.position&&(i=this.keepElementVisible(i,n,t)),this.style.left=Math.round(i.x)+"px",this.style.top=Math.round(i.y)+"px"}center(e,t){return{x:Math.round(.5*(t.width-e.width)),y:Math.round(.5*(t.height-e.height))}}positionToAnchor(e,t,n){const i=this.align,s=this.justify,r=this.offsetX,o=this.offsetY,a={x:0,y:0};switch(i){case"start":a.x="start"!==s&&"end"!==s?t.left-e.width-r:t.left;break;case"end":a.x="start"!==s&&"end"!==s?t.right+r:t.right-e.width;break;case"fixed":a.x=this.positionX;break;default:a.x=t.left+.5*(t.width-e.width)}switch(s){case"start":a.y=t.top-e.height-o;break;case"end":a.y=t.bottom+o;break;case"fixed":a.y=this.positionY;break;default:a.y=t.top+.5*(t.height-e.height)}return a.x+=this.offsetX,a.y+=this.offsetY,a}keepElementVisible(e,t,n){const i=this.offsetX,s=this.offsetY;return t.width>n.width?e.x=.5*(n.width-t.width):e.x<n.left+i?e.x=n.left+i:e.x+t.width+i>n.right&&(e.x=n.right-t.width-i),t.height>n.height?e.y=.5*(n.height-t.height):e.y<n.top+s?e.y=n.top+s:e.y+t.height+s>n.bottom&&(e.y=n.bottom-t.height-s),e}onResize(){this.calculatePosition()}onCaptureEvent(e){e.target instanceof Node&&this.contains(e.target)||this.close()}onEatEvent(e){console.log("Popup.onEatEvent"),e.stopPropagation(),e.preventDefault()}};dg([nr({attribute:!1})],pg.prototype,"anchor",void 0),dg([nr({attribute:!1})],pg.prototype,"portal",void 0),dg([nr({type:String})],pg.prototype,"position",void 0),dg([nr({type:String})],pg.prototype,"align",void 0),dg([nr({type:String})],pg.prototype,"justify",void 0),dg([nr({type:Number})],pg.prototype,"positionX",void 0),dg([nr({type:Number})],pg.prototype,"positionY",void 0),dg([nr({type:Number})],pg.prototype,"offsetX",void 0),dg([nr({type:Number})],pg.prototype,"offsetY",void 0),dg([nr({type:Boolean})],pg.prototype,"keepVisible",void 0),dg([nr({type:Boolean})],pg.prototype,"modal",void 0),pg=dg([yr("ff-popup")],pg);var fg=pg,mg=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let gg=class extends vr{constructor(){super(...arguments),this.name="",this.index=0,this.text="",this.placeholder="",this.align="left",this.initialValue=""}get textArea(){return this.getElementsByTagName("textarea").item(0)}select(){const e=this.textArea;e&&e.select()}focus(){const e=this.textArea;e&&e.focus()}blur(){const e=this.textArea;e&&e.blur()}hasFocus(){return this.textArea===document.activeElement}firstConnected(){this.classList.add("ff-control","ff-text-edit")}shouldUpdate(e){return!this.hasFocus()&&super.shouldUpdate(e)}render(){return Gs`<textarea
            .value=${this.text} placeholder=${this.placeholder}
            @keydown=${this.onKeyDown} @change=${this.onChange} @input=${this.onInput}
            @focus=${this.onFocus} @blur=${this.onBlur}
            style="text-align: ${this.align};"></textarea>`}onKeyDown(e){const t=e.target;"Escape"===e.key&&(this.revert(t),t.blur())}onChange(e){e.stopPropagation(),e.preventDefault(),this.text=e.target.value,this.dispatchChangeEvent(this.text,!1)}onInput(e){e.stopPropagation(),e.preventDefault(),this.text=e.target.value,this.dispatchChangeEvent(this.text,!0)}onFocus(e){this.initialValue=e.target.value}onBlur(e){this.commit(e.target),this.requestUpdate()}revert(e){e.value=this.initialValue,this.dispatchChangeEvent(e.value,!1)}commit(e){this.initialValue=e.value,this.dispatchChangeEvent(e.value,!1)}dispatchChangeEvent(e,t){this.dispatchEvent(new CustomEvent("change",{detail:{text:e,isEditing:t}}))}};mg([nr({type:String})],gg.prototype,"name",void 0),mg([nr({type:Number})],gg.prototype,"index",void 0),mg([nr({type:String})],gg.prototype,"text",void 0),mg([nr({type:String})],gg.prototype,"placeholder",void 0),mg([nr({type:String})],gg.prototype,"align",void 0),gg=mg([yr("ff-text-edit")],gg);var vg,yg=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let bg=vg=class extends fg{constructor(e){super(),this.language=null,this.language=e,this.position="center",this.modal=!0,this.url=window.location.href}static show(e,t){const n=new vg(t);return e.appendChild(n),new Promise((e,t)=>{n.on("close",()=>e())})}close(){this.dispatchEvent(new CustomEvent("close")),this.remove()}firstConnected(){super.firstConnected(),this.classList.add("sv-share-menu")}render(){const e=encodeURIComponent(this.url),t=encodeURI("Smithsonian Voyager"),n=this.language,i=`http://twitter.com/share?text=${t}&url=${e}`,s="https://www.facebook.com/sharer/sharer.php?u="+e,r=`https://www.linkedin.com/shareArticle?url=${e}&mini=true&title=${t}`,o=`<iframe name="Smithsonian Voyager" src="${this.url}" width="800" height="450" allow="xr; xr-spatial-tracking; fullscreen"></iframe>`,a=`mailto:?subject=${t}&body=${e}`;return Gs`
        <div class="ff-flex-row">
            <div class="ff-flex-spacer ff-title">${n.getLocalizedString("Share Experience")}</div>
            <ff-button icon="close" transparent class="ff-close-button" title=${n.getLocalizedString("Close")} @click=${this.close}></ff-button>
        </div>
        <div class="ff-flex-row sv-share-buttons">
            <a href=${i} target="_blank" rel="noopener noreferrer"><ff-button class="sv-share-button-twitter" icon="twitter" title="Twitter"></ff-button></a>
            <a href=${s} target="_blank" rel="noopener noreferrer"><ff-button class="sv-share-button-facebook" icon="facebook" title="Facebook"></ff-button></a>
            <a href=${r} target="_blank" rel="noopener noreferrer"><ff-button class="sv-share-button-linkedin" icon="linkedin" title="LinkedIn"></ff-button></a>
            <a href=${a} target="_blank"><ff-button class="sv-share-button-email" icon="email" title=${n.getLocalizedString("Email")}></ff-button></a>
        </div>
        <div class="ff-title">${n.getLocalizedString("Embed Link")}</div>
        <div class="ff-flex-row sv-embed-link">
            <ff-text-edit text=${o}></ff-text-edit>
            <ff-button icon="copy" title=${n.getLocalizedString("Copy to Clipboard")} @click=${this.onClickCopy}></ff-button>
        </div>
        `}onClickCopy(){this.getElementsByTagName("ff-text-edit").item(0).select(),document.execCommand("copy")}};bg=vg=yg([yr("sv-share-menu")],bg);var xg=bg,_g=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let wg=class extends md{constructor(){super(...arguments),this.documentProps=new pp("value",this.onUpdate,this),this.shareButtonSelected=!1}get fullscreen(){return this.system.getMainComponent($)}get toolProvider(){return this.system.getMainComponent(xd)}get analytics(){return this.system.getMainComponent(Bl)}get arManager(){return this.system.getMainComponent(bu)}get sceneNode(){return this.system.getComponent(Hc)}firstConnected(){super.firstConnected(),this.classList.add("sv-main-menu")}connected(){super.connected(),this.fullscreen.outs.fullscreenActive.on("value",this.onUpdate,this),this.toolProvider.ins.visible.on("value",this.onUpdate,this),this.activeDocument.setup.language.outs.language.on("value",this.onUpdate,this)}disconnected(){this.activeDocument.setup.language.outs.language.off("value",this.onUpdate,this),this.toolProvider.ins.visible.off("value",this.onUpdate,this),this.fullscreen.outs.fullscreenActive.off("value",this.onUpdate,this),super.disconnected()}render(){const e=this.activeDocument;if(!e)return Gs``;const t=!!this.system.getComponent("CVStoryApplication",!0),n=e.setup,i=n.tours.outs.count.value>0,s=n.tours.ins.enabled.value,r=s&&!t,o=n.reader.ins.enabled.value,a=n.viewer.ins.annotationsVisible.value,l=this.fullscreen,c=l.outs.fullscreenAvailable.value,h=l.outs.fullscreenActive.value,u=n.interface.ins.tools.value,d=this.toolProvider.ins.visible.value,p=n.language,f=this.sceneNode.getGraphComponents($c),m=f[0]?f[0].derivatives.getByQuality(co.AR):[],g=this.arManager.outs.available.value&&m.length>0&&f.length>=1;return Gs`${g?Gs`<ff-button icon="ar" title=${p.getLocalizedString("Enter AR View")}
            @click=${this.onEnterAR}></ff-button>`:null}
        ${i?Gs`<ff-button icon="globe" title=${p.getLocalizedString("Interactive Tours")}
            ?selected=${s} @click=${this.onToggleTours}></ff-button>`:null}
        ${Gs`<ff-button icon="article" title=${p.getLocalizedString("Read more...")}
            ?selected=${o} ?disabled=${r} @click=${this.onToggleReader}></ff-button>`}
        ${Gs`<ff-button icon="comment" title=${p.getLocalizedString("Show/Hide Annotations")}
            ?selected=${a} ?disabled=${r} @click=${this.onToggleAnnotations}></ff-button>`}
        <ff-button icon="share" title=${p.getLocalizedString("Share Experience")}
            ?selected=${this.shareButtonSelected} @click=${this.onToggleShare}></ff-button>    
        ${c?Gs`<ff-button icon="expand" title=${p.getLocalizedString("Fullscreen")}
            ?selected=${h} @click=${this.onToggleFullscreen}></ff-button>`:null}
        ${u?Gs`<ff-button icon="tools" title=${p.getLocalizedString("Tools and Settings")}
            ?selected=${d} ?disabled=${r} @click=${this.onToggleTools}></ff-button>`:null}`}onToggleReader(){const e=this.activeDocument.setup.reader.ins;e.enabled.setValue(!e.enabled.value),this.analytics.sendProperty("Reader.Enabled",e.enabled.value)}onToggleTours(){const e=this.activeDocument.setup.tours.ins,t=this.activeDocument.setup.reader.ins;e.enabled.value?e.enabled.setValue(!1):(t.enabled.value&&t.enabled.setValue(!1),e.enabled.setValue(!0),e.tourIndex.setValue(-1)),this.analytics.sendProperty("Tours.Enabled",e.enabled.value)}onToggleAnnotations(){const e=this.toolProvider.ins,t=this.activeDocument.setup.viewer.ins;e.visible.value&&e.visible.setValue(!1),t.annotationsVisible.setValue(!t.annotationsVisible.value),this.analytics.sendProperty("Annotations.Visible",t.annotationsVisible.value)}onToggleShare(){this.shareButtonSelected||(this.shareButtonSelected=!0,this.requestUpdate(),xg.show(this,this.activeDocument.setup.language).then(()=>{this.shareButtonSelected=!1,this.requestUpdate()}),this.analytics.sendProperty("Menu.Share"))}onToggleFullscreen(){this.fullscreen.toggle(),this.analytics.sendProperty("Menu.Fullscreen")}onToggleTools(){const e=this.toolProvider.ins,t=this.activeDocument.setup.viewer.ins;t.annotationsVisible.value&&t.annotationsVisible.setValue(!1),e.visible.setValue(!e.visible.value),this.analytics.sendProperty("Tools.Visible",e.visible.value)}onEnterAR(){this.arManager.ins.enabled.setValue(!0)}onActiveDocument(e,t){if(e&&this.documentProps.off(),t){const e=t.setup;this.documentProps.on(e.interface.ins.tools,e.reader.ins.enabled,e.tours.ins.enabled,e.tours.outs.count,e.viewer.ins.annotationsVisible,this.toolProvider.ins.visible)}this.requestUpdate()}};wg=_g([yr("sv-main-menu")],wg);var Sg=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Mg=class extends fd{get toolProvider(){return this.system.getMainComponent(xd)}get language(){return this.system.getComponent(Fl)}firstConnected(){super.firstConnected(),this.classList.add("sv-bottom-bar-container","sv-transition","sv-tool-bar"),setTimeout(()=>this.classList.remove("sv-transition"),1)}connected(){super.connected(),this.toolProvider.on("active-component",this.onUpdate,this),this.language.outs.language.on("value",this.onUpdate,this)}disconnected(){this.language.outs.language.off("value",this.onUpdate,this),this.toolProvider.off("active-component",this.onUpdate,this),super.disconnected()}render(){const e=this.toolProvider.scopedComponents,t=this.toolProvider.activeComponent,n=this.language,i=e.map(e=>Gs`<ff-button class="sv-tool-button" transparent text=${n.getLocalizedString(e.text)} icon=${e.icon}
                ?selected=${e===t} @click=${t=>this.onSelectTool(e)}></ff-button>`);return Gs`<div class="sv-blue-bar">${t?t.createView():null}
            <div class="sv-section">
                <ff-button class="sv-section-lead" transparent icon="close" title=${n.getLocalizedString("Close Tools")} @click=${this.onClose}></ff-button>
                <div class="sv-tool-buttons">${i}</div>
                <sv-tool-menu-view .system=${this.system}></sv-tool-menu-view>
            </div></div>`}onSelectTool(e){this.toolProvider.activeComponent=e}onClose(e){this.dispatchEvent(new CustomEvent("close")),e.stopPropagation()}};Mg=Sg([yr("sv-tool-bar")],Mg);var Eg=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Tg=class extends md{firstConnected(){super.firstConnected(),this.classList.add("sv-bottom-bar-container","sv-tour-navigator","sv-transition"),setTimeout(()=>this.classList.remove("sv-transition"),1)}render(){const e=this.tours,t=this.language,n=e.activeTour;let i,s;if(e&&n){const n=e.outs.stepIndex.value+1,r=e.outs.stepCount.value;i=r>0?e.stepTitle:e.title,s=r>0?`${t.getLocalizedString("Step")} ${n} ${t.getLocalizedString("of")} ${r}`:t.getLocalizedString("No tour steps defined")}else i=t.getLocalizedString("No tour selected"),s="---";return Gs`<div class="sv-blue-bar"><div class="sv-section">
            <ff-button class="sv-section-lead" transparent icon="close" title=${t.getLocalizedString("Exit Tour")} ?disabled=${!n} @click=${this.onClickExit}></ff-button>
            <div class="ff-ellipsis sv-content">
                <div class="ff-ellipsis sv-title">${i}</div>
                <div class="ff-ellipsis sv-text">${s}</div>
            </div>
            <ff-button class="sv-section-trail" transparent icon="bars" title=${t.getLocalizedString("Show Tour Menu")} @click=${this.onClickMenu}></ff-button>
            <ff-button class="sv-section-trail" transparent icon="triangle-left" title=${t.getLocalizedString("Go Backward")} ?disabled=${!n} @click=${this.onClickPrevious}></ff-button>
            <ff-button class="sv-section-trail" transparent icon="triangle-right" title=${t.getLocalizedString("Go Forward")} ?disabled=${!n} @click=${this.onClickNext}></ff-button>
        </div></div>`}onClickExit(){this.tours.ins.enabled.setValue(!1)}onClickMenu(){this.tours.ins.tourIndex.setValue(-1)}onClickPrevious(){this.tours.ins.previous.set()}onClickNext(){this.tours.ins.next.set()}onActiveDocument(e,t){e&&(this.tours.outs.tourIndex.off("value",this.onUpdate,this),this.tours.outs.stepIndex.off("value",this.onUpdate,this),this.language.outs.language.off("value",this.onUpdate,this)),t&&(this.tours=t.setup.tours,this.language=t.setup.language,this.tours.outs.tourIndex.on("value",this.onUpdate,this),this.tours.outs.stepIndex.on("value",this.onUpdate,this),this.language.outs.language.on("value",this.onUpdate,this)),this.requestUpdate()}};Tg=Eg([yr("sv-tour-navigator")],Tg);var Cg=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Ag=class extends vr{firstConnected(){super.firstConnected(),this.classList.add("sv-document-overlay","sv-article","sv-tour-menu")}renderEntry(e,t){return Gs`<div class="sv-entry" @click=${e=>this.onClickTour(e,t)}>
            <h1>${Object.keys(e.titles).length>0?e.titles[Vi[this.activeLanguage]]:e.title}</h1>
            <p>${Object.keys(e.leads).length>0?e.leads[Vi[this.activeLanguage]]:e.lead}</p>
        </div>`}render(){const e=this.tours;return 0===e.length?Gs`<div class="sv-entry">
                <h1>No tours available.</h1>
            </div>`:Gs`<div class="ff-scroll-y">
            ${e.map((e,t)=>this.renderEntry(e,t))}
        </div>`}onClickTour(e,t){e.stopPropagation(),this.dispatchEvent(new CustomEvent("select",{detail:{index:t}}))}};Cg([nr({attribute:!1})],Ag.prototype,"tours",void 0),Cg([nr({attribute:!1})],Ag.prototype,"activeLanguage",void 0),Ag=Cg([yr("sv-tour-menu")],Ag);var Pg,Lg=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Rg=Pg=class extends fg{constructor(e){super(),this.language=null,this.language=e,this.position="center",this.modal=!0,this.url=window.location.href}static show(e,t){const n=new Pg(t);return e.appendChild(n),new Promise((e,t)=>{n.on("close",()=>e())})}close(){this.dispatchEvent(new CustomEvent("close")),this.remove()}firstConnected(){super.firstConnected(),this.classList.add("sv-language-menu")}renderEntry(e,t){return Gs`<div class="sv-entry" @click=${e=>this.onClickLanguage(e,t)} ?selected=${e.name===this.language.toString()}>
            ${e.name}
        </div>`}render(){const e=this.language;return Gs`
        <div class="ff-flex-row">
            <div class="ff-flex-spacer ff-title">${e.getLocalizedString("Set Language")}</div>
            <ff-button icon="close" transparent class="ff-close-button" title=${e.getLocalizedString("Close")} @click=${this.close}></ff-button>
        </div>
        <div class="ff-flex-row">
            <div class="ff-scroll-y">
                ${e.activeLanguages.map((e,t)=>this.renderEntry(e,t))}
            </div>
        </div>
        `}onClickLanguage(e,t){const n=this.language;e.stopPropagation(),n.ins.language.setValue(n.activeLanguages[t].id),this.close()}};Rg=Pg=Lg([yr("sv-language-menu")],Rg);var Ng=Rg,Dg=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Og=class extends md{get activeTags(){return this.viewer?this.viewer.ins.activeTags.value.split(",").map(e=>e.trim()).filter(e=>!!e):[]}get tagCloud(){return this.viewer?this.viewer.outs.tagCloud.value.split(",").map(e=>e.trim()).filter(e=>!!e):[]}firstConnected(){super.firstConnected(),this.classList.add("sv-bottom-bar-container","sv-tag-cloud","sv-transition"),setTimeout(()=>this.classList.remove("sv-transition"),1)}render(){const e=this.activeTags,t=this.tagCloud.map(t=>Gs`<ff-button class="sv-tag-button" transparent text=${t}
                ?selected=${e.indexOf(t)>=0}
                @click=${e=>this.onSelectTag(t)}></ff-button>`);return Gs`<div class="sv-blue-bar"><div class="sv-section">
                <ff-button class="sv-section-lead" transparent icon="close" title="Close Tag Menu" @click=${this.onClickClose}></ff-button>
                <div class="sv-tag-buttons">${t}</div>
        </div></div>`}onClickClose(){this.viewer.ins.annotationsVisible.setValue(!1)}onSelectTag(e){let t=this.activeTags;const n=this.viewer.ins.radioTags.value,i=t.indexOf(e);i>=0&&!n?t.splice(i,1):i<0&&(n?t=[e]:t.push(e)),this.viewer.ins.activeTags.setValue(t.join(", "))}onActiveDocument(e,t){e&&(this.viewer.ins.activeTags.off("value",this.onUpdate,this),this.viewer.outs.tagCloud.off("value",this.onUpdate,this)),t&&(this.viewer=t.setup.viewer,this.viewer.ins.activeTags.on("value",this.onUpdate,this),this.viewer.outs.tagCloud.on("value",this.onUpdate,this))}};Og=Dg([yr("sv-tag-cloud")],Og);var kg=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};let Ig=class extends md{constructor(){super(...arguments),this.documentProps=new pp("value",this.onUpdate,this)}get toolProvider(){return this.system.getMainComponent(xd)}firstConnected(){this.style.pointerEvents="none",this.setAttribute("pointer-events","none"),this.classList.add("sv-chrome-view")}connected(){super.connected(),this.toolProvider.ins.visible.on("value",this.onUpdate,this),this.activeDocument.setup.language.outs.language.on("value",this.onUpdate,this)}disconnected(){this.activeDocument.setup.language.outs.language.off("value",this.onUpdate,this),this.toolProvider.ins.visible.off("value",this.onUpdate,this),super.disconnected()}render(){const e=this.activeDocument;if(!e)return Gs``;const t=e.setup,n=t.interface.ins.visible.value,i=t.interface.ins.logo.value&&t.interface.isShowing(Wc.logo),s=t.interface.ins.menu.value&&t.interface.isShowing(Wc.menu),r=t.interface.ins.visibleElements.value&&t.interface.isShowing(Wc.title),o=t.reader.ins.enabled.value,a=t.tours.tours,l=t.tours.ins.enabled.value,c=t.tours.outs.tourIndex.value>=0,h=t.language,u=h.activeLanguages,d=h.outs.language.value,p=u.length>1&&t.interface.isShowing(Wc.language),f=!!this.system.getComponent("CVStoryApplication",!0)||!l,m=t.viewer.ins.annotationsVisible.value&&t.viewer.outs.tagCloud.value,g=!o&&this.toolProvider.ins.visible.value;if(!n)return Gs``;let v;return v=l?c?h.getLocalizedString("Tour")+": "+t.tours.outs.tourTitle.value:h.getLocalizedString("Interactive Tours"):e.outs.title.value||e.name||"Untitled Document",Gs`
            <div class="sv-chrome-header">
                ${s?Gs`<sv-main-menu .system=${this.system}></sv-main-menu>`:null}
                <div class="sv-top-bar">
                    ${r?Gs`<div class="ff-ellipsis sv-main-title">${v}<span class="ff-ellipsis"> </span></div>`:null}
                    ${i?Gs`<sv-logo></sv-logo>`:null}
                </div>
            </div>
            <div class="ff-flex-spacer"></div>
            ${l&&c?Gs`<sv-tour-navigator .system=${this.system}></sv-tour-navigator>`:null}
            ${l&&!c?Gs`<sv-tour-menu .tours=${a} .activeLanguage=${d} @select=${this.onSelectTour}></sv-tour-menu>`:null}
            ${m&&f?Gs`<sv-tag-cloud .system=${this.system}></sv-tag-cloud>`:null}
            ${g&&f?Gs`<div class="sv-tool-bar-container"><sv-tool-bar .system=${this.system} @close=${this.closeTools}></sv-tool-bar></div>`:null}
            <div class="sv-chrome-footer">
                <div class="sv-bottom-bar">
                    ${p?Gs`<div id="language" class="ff-ellipsis sv-language-display" @click=${this.openLanguageMenu}>${t.language.toString()}</div>`:null}
                </div>
            </div>`}onSelectTour(e){this.activeDocument.setup.tours.ins.tourIndex.setValue(e.detail.index)}openLanguageMenu(){const e=this.activeDocument.setup.language;e.ins.enabled.value||(e.ins.enabled.setValue(!0),Ng.show(this,this.activeDocument.setup.language).then(()=>{e.ins.enabled.setValue(!1)}))}closeTools(){this.toolProvider.ins.visible.setValue(!1)}onActiveDocument(e,t){if(e&&this.documentProps.off(),t){const e=t.setup;this.documentProps.on(t.outs.title,t.outs.assetPath,e.interface.ins.visible,e.interface.ins.logo,e.interface.ins.menu,e.viewer.ins.annotationsVisible,e.reader.ins.enabled,e.tours.ins.enabled,e.tours.outs.tourIndex)}this.requestUpdate()}};Ig=kg([yr("sv-chrome-view")],Ig);var zg=Ig,Ug=function(e,t,n,i){var s,r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};wr.add("globe",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"/></svg>`),wr.add("cog",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M444.788 291.1l42.616 24.599c4.867 2.809 7.126 8.618 5.459 13.985-11.07 35.642-29.97 67.842-54.689 94.586a12.016 12.016 0 0 1-14.832 2.254l-42.584-24.595a191.577 191.577 0 0 1-60.759 35.13v49.182a12.01 12.01 0 0 1-9.377 11.718c-34.956 7.85-72.499 8.256-109.219.007-5.49-1.233-9.403-6.096-9.403-11.723v-49.184a191.555 191.555 0 0 1-60.759-35.13l-42.584 24.595a12.016 12.016 0 0 1-14.832-2.254c-24.718-26.744-43.619-58.944-54.689-94.586-1.667-5.366.592-11.175 5.459-13.985L67.212 291.1a193.48 193.48 0 0 1 0-70.199l-42.616-24.599c-4.867-2.809-7.126-8.618-5.459-13.985 11.07-35.642 29.97-67.842 54.689-94.586a12.016 12.016 0 0 1 14.832-2.254l42.584 24.595a191.577 191.577 0 0 1 60.759-35.13V25.759a12.01 12.01 0 0 1 9.377-11.718c34.956-7.85 72.499-8.256 109.219-.007 5.49 1.233 9.403 6.096 9.403 11.723v49.184a191.555 191.555 0 0 1 60.759 35.13l42.584-24.595a12.016 12.016 0 0 1 14.832 2.254c24.718 26.744 43.619 58.944 54.689 94.586 1.667 5.366-.592 11.175-5.459 13.985L444.788 220.9a193.485 193.485 0 0 1 0 70.2zM336 256c0-44.112-35.888-80-80-80s-80 35.888-80 80 35.888 80 80 80 80-35.888 80-80z"/></svg>`),wr.add("eye",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M569.354 231.631C512.969 135.949 407.81 72 288 72 168.14 72 63.004 135.994 6.646 231.631a47.999 47.999 0 0 0 0 48.739C63.031 376.051 168.19 440 288 440c119.86 0 224.996-63.994 281.354-159.631a47.997 47.997 0 0 0 0-48.738zM288 392c-75.162 0-136-60.827-136-136 0-75.162 60.826-136 136-136 75.162 0 136 60.826 136 136 0 75.162-60.826 136-136 136zm104-136c0 57.438-46.562 104-104 104s-104-46.562-104-104c0-17.708 4.431-34.379 12.236-48.973l-.001.032c0 23.651 19.173 42.823 42.824 42.823s42.824-19.173 42.824-42.823c0-23.651-19.173-42.824-42.824-42.824l-.032.001C253.621 156.431 270.292 152 288 152c57.438 0 104 46.562 104 104z"/></svg>`),wr.add("palette",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M128 224c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.4-32-32-32zM418.6 58.1C359.2 9.3 281.3-10 204.6 5 104.9 24.4 24.7 104.2 5.1 203.7c-16.7 84.2 8.1 168.3 67.8 230.6 47.3 49.4 109.7 77.8 167.9 77.8 8.8 0 17.5-.6 26.1-2 24.2-3.7 44.6-18.7 56.1-41.1 12.3-24 12.3-52.7.2-76.6-6.1-12-5.5-26.2 1.8-38 7-11.8 18.7-18.4 32-18.4h72.2c46.4 0 82.8-35.7 82.8-81.3-.2-76.4-34.3-148.1-93.4-196.6zM429.2 288H357c-29.9 0-57.2 15.4-73 41.3-16 26.1-17.3 57.8-3.6 84.9 5.1 10.1 5.1 22.7-.2 32.9-2.6 5-8.7 13.7-20.6 15.6-49.3 7.7-108.9-16.6-152-61.6-48.8-50.9-69-119.4-55.4-188 15.9-80.6 80.8-145.3 161.6-161 62.6-12.3 126.1 3.5 174.3 43.1 48.1 39.5 75.7 97.6 75.9 159.6 0 18.6-15.3 33.2-34.8 33.2zM160 128c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.4-32-32-32zm96-32.1c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32c0-17.6-14.3-32-32-32zm96 32.1c-17.7 0-32 14.3-32 32s14.3 32 32 32 32-14.3 32-32-14.3-32-32-32z"/></svg>`),wr.add("comment",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z"/></svg>`),wr.add("article",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm64 236c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-64c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12v8zm0-72v8c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-8c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm96-114.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"/></svg>`),wr.add("document",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M288 248v28c0 6.6-5.4 12-12 12H108c-6.6 0-12-5.4-12-12v-28c0-6.6 5.4-12 12-12h168c6.6 0 12 5.4 12 12zm-12 72H108c-6.6 0-12 5.4-12 12v28c0 6.6 5.4 12 12 12h168c6.6 0 12-5.4 12-12v-28c0-6.6-5.4-12-12-12zm108-188.1V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V48C0 21.5 21.5 0 48 0h204.1C264.8 0 277 5.1 286 14.1L369.9 98c9 8.9 14.1 21.2 14.1 33.9zm-128-80V128h76.1L256 51.9zM336 464V176H232c-13.3 0-24-10.7-24-24V48H48v416h288z"/></svg>`),wr.add("share",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M352 320c-22.608 0-43.387 7.819-59.79 20.895l-102.486-64.054a96.551 96.551 0 0 0 0-41.683l102.486-64.054C308.613 184.181 329.392 192 352 192c53.019 0 96-42.981 96-96S405.019 0 352 0s-96 42.981-96 96c0 7.158.79 14.13 2.276 20.841L155.79 180.895C139.387 167.819 118.608 160 96 160c-53.019 0-96 42.981-96 96s42.981 96 96 96c22.608 0 43.387-7.819 59.79-20.895l102.486 64.054A96.301 96.301 0 0 0 256 416c0 53.019 42.981 96 96 96s96-42.981 96-96-42.981-96-96-96z"/></svg>`),wr.add("expand",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path d="M241,29V141.53a14,14,0,0,1-14,14h-18.7a14,14,0,0,1-14-14V61.74H114.45a14,14,0,0,1-14-14L100.3,29a14,14,0,0,1,14-14H226.89A14,14,0,0,1,241,29Z"/><path class="cls-1" d="M15,226.67V114.11a14,14,0,0,1,14-14h18.7a14,14,0,0,1,14,14V193.9h79.79a14,14,0,0,1,14,14l.12,18.74a14,14,0,0,1-14,14H29.07A14,14,0,0,1,15,226.67Z"/></svg>`),wr.add("zoom",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z"/></svg>`),wr.add("tools",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M501.1 395.7L384 278.6c-23.1-23.1-57.6-27.6-85.4-13.9L192 158.1V96L64 0 0 64l96 128h62.1l106.6 106.6c-13.6 27.8-9.2 62.3 13.9 85.4l117.1 117.1c14.6 14.6 38.2 14.6 52.7 0l52.7-52.7c14.5-14.6 14.5-38.2 0-52.7zM331.7 225c28.3 0 54.9 11 74.9 31l19.4 19.4c15.8-6.9 30.8-16.5 43.8-29.5 37.1-37.1 49.7-89.3 37.9-136.7-2.2-9-13.5-12.1-20.1-5.5l-74.4 74.4-67.9-11.3L334 98.9l74.4-74.4c6.6-6.6 3.4-17.9-5.7-20.2-47.4-11.7-99.6.9-136.6 37.9-28.5 28.5-41.9 66.1-41.2 103.6l82.1 82.1c8.1-1.9 16.5-2.9 24.7-2.9zm-103.9 82l-56.7-56.7L18.7 402.8c-25 25-25 65.5 0 90.5s65.5 25 90.5 0l123.6-123.6c-7.6-19.9-9.9-41.6-5-62.7zM64 472c-13.2 0-24-10.8-24-24 0-13.3 10.7-24 24-24s24 10.7 24 24c0 13.2-10.7 24-24 24z"/></svg>`),wr.add("environment",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path d="M219.81,14.75H36.19A21.19,21.19,0,0,0,15,35.94V220.06a21.19,21.19,0,0,0,21.19,21.19H219.81A21.19,21.19,0,0,0,241,220.06V35.94A21.19,21.19,0,0,0,219.81,14.75Zm-2.65,205.31H38.84a2.64,2.64,0,0,1-2.65-2.65V38.59a2.64,2.64,0,0,1,2.65-2.65H217.16a2.64,2.64,0,0,1,2.65,2.65V217.41A2.64,2.64,0,0,1,217.16,220.06ZM72.16,71.59A18.32,18.32,0,1,0,90.47,89.91,18.32,18.32,0,0,0,72.16,71.59ZM57.51,198.15H204V141.53l-40.06-40.06a5.49,5.49,0,0,0-7.77,0l-54.72,54.71L83.36,138.09a5.47,5.47,0,0,0-7.76,0L57.51,156.18Z"/></svg>`),wr.add("bulb",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M44.73 323.21c-7.65 4.42-10.28 14.2-5.86 21.86l8 13.86c4.42 7.65 14.21 10.28 21.86 5.86l93.26-53.84a207.865 207.865 0 0 1-26.83-39.93l-90.43 52.19zM112.46 168H16c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h100.21a210.423 210.423 0 0 1-3.75-48zm127.6 291.17c0 3.15.93 6.22 2.68 8.84l24.51 36.84c2.97 4.46 7.97 7.14 13.32 7.14h78.85c5.36 0 10.36-2.68 13.32-7.14l24.51-36.84c1.74-2.62 2.67-5.7 2.68-8.84l.05-43.18H240.02l.04 43.18zM44.73 60.78l78.98 45.6c5.37-15.29 12.97-29.48 21.64-42.93L68.73 19.21c-7.65-4.42-17.44-1.8-21.86 5.86l-8 13.86c-4.42 7.65-1.79 17.44 5.86 21.85zm550.54 0c7.65-4.42 10.28-14.2 5.86-21.86l-8-13.86c-4.42-7.65-14.21-10.28-21.86-5.86l-76.61 44.23c8.68 13.41 15.76 27.9 21.2 43.19l79.41-45.84zm0 262.43l-90.97-52.52c-7.33 14.23-15.8 27.88-26.36 40.21l93.33 53.88c7.65 4.42 17.44 1.8 21.86-5.86l8-13.86c4.42-7.64 1.79-17.43-5.86-21.85zM624 168h-96.41c.1 2.68.41 5.3.41 8 0 13.54-1.55 26.89-4.12 40H624c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16zM320 80c-52.94 0-96 43.06-96 96 0 8.84 7.16 16 16 16s16-7.16 16-16c0-35.3 28.72-64 64-64 8.84 0 16-7.16 16-16s-7.16-16-16-16zm0-80C217.72 0 144 82.97 144 176c0 44.37 16.45 84.85 43.56 115.78 16.64 18.99 42.74 58.8 52.42 92.16v.06h48v-.12c-.01-4.77-.72-9.51-2.15-14.07-5.59-17.81-22.82-64.77-62.17-109.67-20.53-23.43-31.52-53.14-31.61-84.14-.2-73.64 59.67-128 127.95-128 70.58 0 128 57.42 128 128 0 30.97-11.24 60.85-31.65 84.14-39.11 44.61-56.42 91.47-62.1 109.46a47.507 47.507 0 0 0-2.22 14.3v.1h48v-.05c9.68-33.37 35.78-73.18 52.42-92.16C479.55 260.85 496 220.37 496 176 496 78.8 417.2 0 320 0z"/></svg>`),wr.add("tape",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M624 432H362.3c52.1-41 85.7-104.5 85.7-176 0-123.7-100.3-224-224-224S0 132.3 0 256s100.3 224 224 224h400c8.8 0 16-7.2 16-16v-16c0-8.8-7.2-16-16-16zm-400 0c-97 0-176-79-176-176S127 80 224 80s176 79 176 176-79 176-176 176zm0-272c-53 0-96 43-96 96s43 96 96 96 96-43 96-96-43-96-96-96zm0 144c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48z"/></svg>`),wr.add("knife",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M566.28 88.57c12.96-12.5 12.96-32.76 0-45.25L531.07 9.37c-12.96-12.5-33.98-12.5-46.94 0L319.99 160 4.76 464.14c-8.25 7.96-5.38 22.16 5.53 25.69C53.72 503.86 102.37 512 150.51 512c75.83 0 150.42-20.19 201.49-69.35l104.4-100.04c12.95-12.41 13.17-33.05.49-45.73L448 288v-80L566.28 88.57zM496 64c8.84 0 16 7.16 16 16s-7.16 16-16 16-16-7.16-16-16 7.16-16 16-16zM318.71 408.07C281.24 444.14 221.5 464 150.51 464c-23.16 0-46.79-2.1-70.07-6.17L319.4 227.28l91.99 91.99-92.68 88.8zM432 160c-8.84 0-16-7.16-16-16s7.16-16 16-16 16 7.16 16 16-7.17 16-16 16z"/></svg>`),wr.add("bars",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg>`),wr.add("triangle-left",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path d="M191.33,31.38V224.62a15,15,0,0,1-25.64,10.62L69.07,138.62a15,15,0,0,1,0-21.24l96.62-96.62A15,15,0,0,1,191.33,31.38Z"/></svg>`),wr.add("triangle-right",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><path d="M64.67,224.62V31.38A15,15,0,0,1,90.31,20.76l96.62,96.62a15,15,0,0,1,0,21.24L90.31,235.24A15,15,0,0,1,64.67,224.62Z"/></svg>`),wr.add("twitter",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>`),wr.add("facebook",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 264 512"><path d="M76.7 512V283H0v-91h76.7v-71.7C76.7 42.4 124.3 0 193.8 0c33.3 0 61.9 2.5 70.2 3.6V85h-48.2c-37.8 0-45.1 18-45.1 44.3V192H256l-11.7 91h-73.6v229"/></svg>`),wr.add("instagram",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>`),wr.add("linkedin",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448.1 512"><path d="M100.3 448H7.4V148.9h92.9V448zM53.8 108.1C24.1 108.1 0 83.5 0 53.8S24.1 0 53.8 0s53.8 24.1 53.8 53.8-24.1 54.3-53.8 54.3zM448 448h-92.7V302.4c0-34.7-.7-79.2-48.3-79.2-48.3 0-55.7 37.7-55.7 76.7V448h-92.8V148.9h89.1v40.8h1.3c12.4-23.5 42.7-48.3 87.9-48.3 94 0 111.3 61.9 111.3 142.3V448h-.1z"/></svg>`),wr.add("email",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"/></svg>`),wr.add("copy",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg>`),wr.add("ar",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10.844874 7.2009368"><path d="M 4.1805699,5.4542117 H 2.4801904 L 2.2118585,6.5168507 H 1.1187593 L 2.6807334,0.68408928 h 1.296469 L 5.5391781,6.5168507 H 4.4460774 Z M 2.7513476,4.3720517 H 3.9065883 L 3.3303802,2.0514503 Z"/><path d="m 7.5355365,3.2703464 q 0.3417706,0 0.4886463,-0.1758024 0.1497018,-0.1758024 0.1497018,-0.5781942 0,-0.3984876 -0.1497018,-0.5703858 Q 7.8773071,1.7740658 7.5355365,1.7740658 H 7.0779585 V 3.2703464 Z M 7.0779585,4.309544 V 6.5168507 H 5.9905084 V 0.68408928 h 1.6608338 q 0.8332429,0 1.220205,0.38676692 0.3897887,0.3867669 0.3897887,1.2228084 0,0.5781942 -0.2033672,0.9493362 -0.200543,0.371142 -0.607278,0.5469444 0.2231388,0.070308 0.3982608,0.320355 0.1779472,0.2461266 0.358719,0.7500924 L 9.7980008,6.5168507 H 8.6399351 L 8.1258661,5.0674448 Q 7.970517,4.6298909 7.8095182,4.4697134 7.6513422,4.309544 7.3858347,4.309544 Z"/></svg>`),wr.add("device-move",Gs`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 119.4 57.7"><path d="M47.4,20.7h-34c-0.2,0-0.4-0.1-0.5-0.3l-0.1-0.2l0.1-0.3l9-19.5C21.9,0.2,22.1,0,22.3,0h24.5v1H22.6L14,19.7h33.4V20.7z"/><path d="M103,20.7H71v-1h31.6L95,1H46.8V0h48.3c0.3,0,0.6,0.2,0.7,0.5l7.8,19.2c0.1,0.2,0.1,0.5-0.1,0.7C103.5,20.6,103.2,20.7,103,20.7z M94.9,0.9L94.9,0.9z"/><path d="M49,2.9c-1.1,0-2,0.9-2,2v40c0,1.1,0.9,2,2,2h20c1.1,0,2-0.9,2-2v-40c0-1.1-0.9-2-2-2L49,2.9z M49,3.9h3.6l0,0h0l0,0l0,0l0,0l0,0l0,0v0l0,0l0,0l0,0l0,0v0.5c0,0.6,0.4,1,1,1H64c0.6,0,1-0.4,1-1v0l0,0V4.3c0,0,0,0,0-0.1l0,0l0,0l0,0l0,0l0,0l0,0l0,0l0,0l0,0l0,0l0,0h4c0.6,0,1,0.4,1,1v40c0,0.6-0.4,1-1,1H49c-0.6,0-1-0.4-1-1l0-40.2c0.1-0.5,0-0.8,0.4-1.1C48.5,4,48.8,3.9,49,3.9z"/><path d="M53.3,43.9h11.5c0.3,0,0.6,0.2,0.6,0.5c0,0.3-0.3,0.5-0.6,0.5H53.3c-0.3,0-0.6-0.2-0.6-0.5C52.7,44.1,53,43.8,53.3,43.9z"/><path d="M76,37.8c-0.7,0-1.3,0-2-0.1l0.1-1c1.6,0.2,10,0.7,15.7-5.5c1.8-2,3.1-4.4,3.8-7l1,0.3c-0.7,2.8-2.1,5.3-4,7.5C85.8,37,79.3,37.8,76,37.8z"/><polygon points="96.9,28.6 96,29 93.8,24.6 89.5,27.1 89,26.2 94.3,23.2"/><path d="M42.1,37.4c-3.4,0-9.9-0.8-14.5-6c-1.9-2.1-3.3-4.7-4-7.5l1-0.3c0.7,2.6,1.9,5,3.7,7.1c5.6,6.3,14,5.7,15.7,5.5l0.1,1C43.4,37.4,42.8,37.4,42.1,37.4z"/><polygon points="29,25.8 28.5,26.6 24.3,24.2 22.1,28.6 21.2,28.2 23.8,22.8"/></svg>`);let Fg=class extends vr{constructor(e){super(),this.application=null,e&&(this.application=e)}get fullscreen(){return this.application.system.getMainComponent($)}get arManager(){return this.application.system.getMainComponent(bu)}firstConnected(){if(super.firstConnected(),!this.application){const e={root:this.getAttribute("root"),dracoRoot:this.getAttribute("dracoRoot"),resourceRoot:this.getAttribute("resourceRoot"),document:this.getAttribute("document"),model:this.getAttribute("model"),geometry:this.getAttribute("geometry"),texture:this.getAttribute("texture"),quality:this.getAttribute("quality"),uiMode:this.getAttribute("uiMode")};this.application=new dp(null,e)}this.attachShadow({mode:"open"});const e=this.shadowRoot;this.arManager.shadowRoot=e;var t=document.createElement("style");t.innerText='/*! normalize.css v8.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:normal;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:0.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace, monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace, monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:0.35em 0.75em 0.625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px}[type="search"]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}.ff-fullsize{position:absolute;left:0;right:0;top:0;bottom:0;box-sizing:border-box}.ff-container{position:absolute;left:0;right:0;top:0;bottom:0;box-sizing:border-box;overflow:hidden}.ff-fullsize{position:absolute;left:0;right:0;top:0;bottom:0;box-sizing:border-box}.ff-caret-down{width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-bottom:5px solid #a0a0a0;transform:rotate(180deg);transition:transform 0.05s}.ff-caret-up{width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-bottom:5px solid #a0a0a0;transform:rotate(0deg);transition:transform 0.05s}.ff-caret-right{width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-bottom:5px solid #a0a0a0;transform:rotate(90deg);transition:transform 0.05s}.ff-caret-left{width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-bottom:5px solid #a0a0a0;transform:rotate(270deg);transition:transform 0.05s}html{color:#c8c8c8}button,input{display:block;padding:0;margin:0;border:none;background-color:inherit;color:inherit;font-size:inherit;cursor:inherit}*:focus{outline:1px solid #0089bf;outline-offset:0}.ff-fullscreen{position:fixed;left:0;right:0;top:0;bottom:0}.ff-noselect{user-select:none;-moz-user-select:none;-webkit-user-select:none}.ff-off{user-select:none;-moz-user-select:none;-webkit-user-select:none;pointer-events:none}.ff-on{user-select:auto;-webkit-user-select:none;pointer-events:auto}.ff-focusable{tab-index:0}.ff-flex-row{display:flex}.ff-flex-column{display:flex;flex-direction:column}.ff-flex-wrap{flex-wrap:wrap}.ff-flex-centered{align-items:center}.ff-flex-item-fixed{flex:0 0 auto;position:relative}.ff-flex-item-stretch,.ff-flex-spacer{flex:1 1 auto;position:relative}.ff-scroll-y{position:absolute;left:0;right:0;top:0;bottom:0;box-sizing:border-box;overflow-y:auto}.ff-position-above{position:absolute;bottom:0}.ff-position-below{position:absolute;top:100%}.ff-position-left{position:absolute;right:0}.ff-position-right{position:absolute;left:100%}.ff-position-above.ff-align-left,.ff-position-below.ff-align-left{left:0}.ff-position-above.ff-align-right,.ff-position-below.ff-align-right{right:0}.ff-position-left.ff-align-top,.ff-position-right.ff-align-top{top:0}.ff-position-left.ff-align-bottom,.ff-position-right.ff-align-bottom{bottom:0}.ff-ellipsis{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.ff-placeholder{flex:1 1 auto;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.ff-splitter-section{flex:1 1 auto;position:relative;box-sizing:border-box;overflow:hidden}.ff-splitter[direction="vertical"]+.ff-splitter-section{border-top:2px solid #1b1b1b}.ff-splitter:not([direction="vertical"])+.ff-splitter-section{border-left:2px solid #1b1b1b}.ff-frame{padding:4px}.ff-frame .ff-control{margin:4px}.ff-icon{display:inline-block;position:relative;height:1rem;fill:#a0a0a0}.ff-icon svg{width:inherit;height:inherit}.ff-button{cursor:pointer}.ff-button[vertical]{flex-direction:column}.ff-button.ff-inline .ff-icon+.ff-text{padding-left:0.5em}.ff-button.ff-inline .ff-icon{display:inline}.ff-button.ff-inline .ff-text{display:inline}.ff-button.ff-transparent{position:relative;display:flex;justify-content:center;align-items:center;flex:0 1 auto;flex-wrap:wrap;padding:5px;background:transparent;fill:#a0a0a0;transition:fill 0.2s}.ff-button.ff-transparent:hover,.ff-button.ff-transparent:focus{fill:#c8c8c8}.ff-button.ff-transparent[selected]{fill:#c8c8c8}.ff-button.ff-transparent>.ff-text{margin:3px;white-space:nowrap}.ff-button.ff-transparent>.ff-icon{margin:3px;height:1.3em}.ff-button.ff-transparent>.ff-caret-down{margin:3px}.ff-button.ff-transparent.ff-disabled{color:gray;fill:#606060;user-select:none;pointer-events:none}.ff-button.ff-control{position:relative;display:flex;justify-content:center;align-items:center;flex:1 1 auto;flex-wrap:wrap;padding:5px;background:#4e4e4e;transition:background-color 0.2s}.ff-button.ff-control:hover,.ff-button.ff-control:focus{background-color:#676767}.ff-button.ff-control[selected]{background-color:#0089bf}.ff-button.ff-control[selected]:hover,.ff-button.ff-control[selected]:focus{background-color:#00a6e8}.ff-button.ff-control>.ff-text{margin:3px;white-space:nowrap}.ff-button.ff-control>.ff-icon{margin:3px;height:1.3em}.ff-button.ff-control>.ff-caret-down{margin:3px}.ff-button.ff-control.ff-disabled{color:gray;fill:#606060;user-select:none;pointer-events:none}.ff-button.ff-control.ff-disabled>.ff-icon{fill:#606060}.ff-menu{background-color:#4e4e4e;z-index:100;display:flex;flex-direction:column}.ff-menu .ff-divider{height:1px;padding:0;background:#a0a0a0}.ff-menu .ff-button{justify-content:flex-start;margin:0;padding:4px 4px}.ff-menu .ff-button .ff-icon{height:1.2em;width:2.2em;margin-right:4px}.ff-dropdown .ff-menu{min-width:100%;margin-top:3px}.ff-modal-plane{position:fixed;left:0;right:0;top:0;bottom:0;background-color:rgba(0,0,0,0.6);opacity:0;transition:opacity .3s;z-index:990;pointer-events:auto}.ff-modal-plane.ff-transition{opacity:1}ff-dialog{box-sizing:border-box;background:#343434;border:1px solid #4e4e4e;box-shadow:3px 3px 24px rgba(0,0,0,0.4)}ff-title-bar{background:#1b1b1b;padding:2px}ff-title-bar .ff-text{flex:1 1 auto;padding-right:8px}ff-title-bar .ff-icon{padding:2px}ff-popup-button .ff-content{transition:opacity .15s}.ff-line-edit{display:block;overflow:hidden;background-color:#1b1b1b;min-height:1.2em}.ff-line-edit input{padding:2px}.ff-text-edit{box-sizing:border-box;flex:1 1 auto;display:flex;background-color:#1b1b1b}.ff-text-edit textarea{display:block;box-sizing:border-box;width:100%;padding:2px;resize:none;background:transparent;color:inherit;border:none}.ff-color-edit{font-size:0.8rem}.ff-color-edit .ff-control{margin:0}.ff-color-edit .ff-slider-controls{align-items:stretch;flex:1 1 auto}.ff-color-edit .ff-numeric-controls{flex:0 0 auto;align-items:center;margin-top:6px}.ff-color-edit .ff-text{color:#a0a0a0;margin:0 3px}.ff-color-edit .ff-line-edit{flex:4 5 auto}.ff-color-edit .ff-line-edit.ff-wide{flex:5 4 auto}.ff-color-edit .ff-knob{margin:-2px 0 0 -2px;border:2px solid white;box-shadow:0 0 5px rgba(0,0,0,0.5)}.ff-color-edit .ff-vector-slider{flex:1 0 auto;padding:0 10px 10px 0;background-image:linear-gradient(to bottom, transparent, black),linear-gradient(to right, white, red)}.ff-color-edit .ff-vector-slider .ff-knob{width:10px;height:10px}.ff-color-edit .ff-linear-slider{flex:0 0 24px;margin-left:6px;padding-bottom:10px}.ff-color-edit .ff-linear-slider .ff-knob{width:100%;height:10px}.ff-color-edit .ff-hue-slider{background:linear-gradient(to bottom, red, #ff0, lime, cyan, blue, #f0f, red)}.ff-color-edit .ff-alpha-slider{color:#4e4e4e}.ff-quad-splitter .ff-left{box-sizing:border-box;border-right:1px solid #343434}.ff-quad-splitter .ff-top{box-sizing:border-box;border-bottom:1px solid #343434}#ff-notification-stack{position:fixed;z-index:100;bottom:0;right:0;width:30%;min-width:250px;max-width:500px}.ff-notification{position:relative;left:0;display:flex;margin:8px;padding:4px;background:#4e4e4e;box-shadow:0 0 20px rgba(0,0,0,0.35)}.ff-notification.ff-info>.ff-icon{fill:#73adff}.ff-notification.ff-success>.ff-icon{fill:#8ae65c}.ff-notification.ff-warning>.ff-icon{fill:#e6a345}.ff-notification.ff-error>.ff-icon{fill:#e64545}.ff-notification>.ff-icon{height:2em;padding:8px}.ff-notification.ff-out{transition:left 0.5s ease-in;left:100%}.ff-notification .ff-text{flex:1;padding:8px;text-overflow:ellipsis;overflow:hidden}.ff-notification .ff-button{flex:0;padding:8px}.ff-message-box{position:relative;min-width:350px;max-width:450px;width:90%;padding:16px;background:#343434;box-shadow:0 0 20px rgba(0,0,0,0.35);opacity:0;transition:opacity .15s}.ff-message-box.ff-transition{opacity:1}.ff-message-box .ff-title{align-items:flex-start}.ff-message-box .ff-title .ff-type-icon{margin:0 16px 0 0;height:2.5em}.ff-message-box .ff-title .ff-type-icon[name="prompt"]{fill:#e6cf5c}.ff-message-box .ff-title .ff-type-icon[name="info"]{fill:#73adff}.ff-message-box .ff-title .ff-type-icon[name="warning"]{fill:#e6a345}.ff-message-box .ff-title .ff-type-icon[name="error"]{fill:#e64545}.ff-message-box .ff-title .ff-content{flex:1 1 auto;margin:0 0 2em 0}.ff-message-box .ff-title .ff-caption{font-size:1.5em}.ff-message-box .ff-title .ff-text{margin:2em 0 1em 0}.ff-message-box .ff-title .ff-line-edit{margin:0 0 1em 0}.ff-message-box .ff-title .ff-line-edit input{padding:4px}.ff-message-box .ff-title .ff-close-button{margin:0 0 0 16px;padding:0}.ff-message-box .ff-button+.ff-button{margin-left:8px}.ff-popup-options{box-sizing:border-box;background:#343434;border:1px solid #4e4e4e;box-shadow:3px 3px 24px rgba(0,0,0,0.4);min-width:6rem}.ff-popup-options button{padding:4px 8px;text-align:start;user-select:none}.ff-popup-options button+button{margin-top:1px}.ff-popup-options button:hover{background-color:#4e4e4e}.ff-popup-options button:focus{outline:none;background-color:#0089bf}.ff-list{flex:1 1 auto;background-color:#272727}.ff-list .ff-list-item{cursor:pointer;user-select:none;padding:2px}.ff-list .ff-list-item:hover{background-color:#343434}.ff-list .ff-list-item[selected]{background-color:#0089bf}.ff-list .ff-list-item+.ff-list-item{border-top:1px solid #343434}.ff-table{position:relative;box-sizing:border-box;width:100%}.ff-table table{box-sizing:border-box;width:100%;table-layout:fixed;border-collapse:collapse;border-spacing:0}.ff-table tr[selected]{background-color:#0089bf}.ff-table th,.ff-table td{padding:4px}.ff-table th{background-color:#1b1b1b;color:#a0a0a0;text-align:start}.ff-table .ff-table-sort-icon{height:0.8em;margin-left:4px;color:#a0a0a0}.ff-tree{position:relative;overflow-y:auto}.ff-tree .ff-tree-node-container{margin-left:-501px;border-top:1px solid #3e3e3e;border-bottom:1px solid #3e3e3e;margin-bottom:-1px}.ff-tree .ff-tree-node{margin-left:500px}.ff-tree .ff-tree-node.ff-inner{background-color:#2f2f2f}.ff-tree .ff-tree-node.ff-leaf{background-color:#3c3c3c}.ff-tree .ff-tree-node.ff-root{background-color:#272727}.ff-tree .ff-tree-node[selected]{background-color:#0089bf}.ff-tree .ff-tree-node .ff-header{position:relative;cursor:pointer;padding-left:14px}.ff-tree .ff-tree-node .ff-header .ff-text{user-select:none}.ff-tree .ff-tree-node.ff-drop-target>.ff-header{outline:1px dashed #0089bf}.ff-tree .ff-tree-node.ff-inner[expanded]>.ff-header:before{content:\'\';position:absolute;top:0.6em;left:3px;width:0;height:0;border-left:4px solid transparent;border-right:4px solid transparent;border-bottom:4px solid #a0a0a0;transform:rotate(180deg);transition:transform 0.05s}.ff-tree .ff-tree-node.ff-inner:not([expanded])>.ff-header:before{content:\'\';position:absolute;top:0.6em;left:3px;width:0;height:0;border-left:4px solid transparent;border-right:4px solid transparent;border-bottom:4px solid #a0a0a0;transform:rotate(90deg);transition:transform 0.05s}.ff-tree .ff-tree-node.ff-leaf .ff-header{cursor:default}.ff-tree .ff-tree-node .ff-content{margin-left:10px}.ff-tree .ff-tree-node:not([expanded])>.ff-content{display:none}ff-tab-container{background:#343434}ff-tab-container,ff-dock-stack{background:#272727;border:1px solid #1b1b1b}ff-tab-container header,ff-dock-stack header{background:#1b1b1b}ff-tab-header,ff-dock-panel-header{background:#1b1b1b;color:#c8c8c8;padding:1px 3px 2px 2px}ff-tab-header[active],ff-dock-panel-header[active]{background:linear-gradient(#626262, #343434);color:#c8c8c8}ff-tab-header label,ff-dock-panel-header label{pointer-events:none}ff-tab-header .ff-text,ff-dock-panel-header .ff-text{padding:0 1px}ff-tab-header .ff-icon,ff-dock-panel-header .ff-icon{top:1px;height:0.8rem;padding:0 1px}.ff-dock-drop-marker{box-sizing:border-box;background:rgba(0,137,191,0.3);border:1px solid #0089bf}.ff-viewport-overlay{padding:6px;font-size:0.75rem}.ff-viewport-overlay .ff-row{display:flex;justify-content:space-between}.ff-viewport-overlay .ff-labels{display:flex;flex-direction:column}.ff-viewport-overlay .ff-top-left,.ff-viewport-overlay .ff-bottom-left{align-items:flex-start}.ff-viewport-overlay .ff-top-center,.ff-viewport-overlay .ff-bottom-center{align-items:center}.ff-viewport-overlay .ff-top-right,.ff-viewport-overlay .ff-bottom-right{align-items:flex-end}.ff-viewport-overlay .ff-label-box{box-sizing:border-box;padding:1px 8px 2px 8px;background:rgba(0,0,0,0.5);border-radius:2em}.sv-article h1{margin:0.3em 0;font-family:"Amiri", serif;font-size:2.3em;font-weight:normal;color:#e8e8e8}.sv-article h1:before{content:"";position:absolute;top:0;left:0;width:75px;height:5px;background-color:#0089bf}.sv-article p,.sv-article h2,.sv-article h3,.sv-article h4,.sv-article h5,.sv-article h6,.sv-article ul,.sv-article ol,.sv-article li{font-family:"Hind Siliguri", sans-serif;color:#c8c8c8}.sv-article h2,.sv-article h3,.sv-article h4,.sv-article h5,.sv-article h6{font-size:1.3em;margin:1.2em 0 0.8em 0}.sv-article p,.sv-article ul,.sv-article ol{font-size:1.15em;margin:0.8em 0}.sv-article p{line-height:1.55em}.sv-article ul{padding-left:0.5em;list-style:square inside}.sv-article ol{padding-left:0.5em;list-style:decimal inside}.sv-article a:link,.sv-article a:visited,.sv-article a:hover,.sv-article a:active{color:#0089bf}.sv-article img{max-width:100%}.sv-content-view{font-family:"Segoe UI","HelveticaNeue","Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:400;font-size:0.85rem;line-height:1.35;color:#c8c8c8;background-color:#343434;position:absolute;left:0;right:0;top:0;bottom:0;box-sizing:border-box;overflow:hidden;user-select:none;-moz-user-select:none;-webkit-user-select:none}.sv-logo{flex:0 50 180px;min-width:40px;display:flex;flex-wrap:wrap;align-items:center;justify-content:flex-end;overflow:hidden;height:40px;user-select:none}.sv-logo .sv-short{flex-grow:1;width:0;max-width:40px}.sv-logo .sv-full{flex:1 0 180px;display:flex}.sv-logo .sv-full .sv-sunburst{flex:0 0 14%}.sv-logo .sv-full .sv-smithsonian{flex:0 0 83%;margin-left:3%}@keyframes spin{100%{transform:rotate(360deg)}}.sv-spinner{position:absolute;left:0;right:0;top:0;bottom:0;box-sizing:border-box;display:flex;justify-content:center;align-items:center;pointer-events:none}.sv-spinner-wheel{height:120px;width:120px;animation:spin 5s linear infinite}*{scrollbar-color:#676767 #1b1b1b;scrollbar-width:thin}* ::-webkit-scrollbar{width:8px}* ::-webkit-scrollbar-track{background-color:#1b1b1b}* ::-webkit-scrollbar-thumb{background-color:#676767}.sv-content-only .sv-scene-view,.sv-content-stack .sv-scene-view{position:absolute;left:0;right:0;top:0;bottom:0;box-sizing:border-box}.sv-reader-container{overflow-y:auto}.sv-content-stack .sv-reader-container{position:absolute;left:0;right:0;top:0;bottom:0;box-sizing:border-box;margin-top:52px}.sv-content-stack .sv-reader-view{pointer-events:auto;display:flex;justify-content:center}.sv-content-stack .sv-reader-view .sv-left{flex:0 0 52px}.sv-content-stack .sv-reader-view .sv-article{flex:0 2 720px;background-color:rgba(27,34,38,0.5);padding-bottom:35px}.sv-content-stack .sv-reader-view .sv-right{flex:0 3 16px;background-color:rgba(27,34,38,0.5)}.sv-content-split{display:flex}.sv-content-split .sv-reader-container{position:absolute;left:0;right:0;top:0;bottom:0;box-sizing:border-box;margin-top:52px}.sv-content-split .sv-scene-view{flex:1 1 60%}.sv-content-split .sv-reader-view{pointer-events:auto;flex:1 1 40%;padding:0 20px}.sv-content-split .sv-reader-view .sv-left{flex:0 0 52px}.sv-content-split .sv-reader-view .sv-article{flex:0 2 720px;background-color:rgba(27,34,38,0.5);padding-bottom:35px;padding-right:16px}.sv-content-split .sv-reader-view .sv-right{flex:0 3 16px;background-color:rgba(27,34,38,0.5)}.sv-article{position:relative;padding:5px 0 0 16px}.sv-scene-view{position:absolute;left:0;right:0;top:0;bottom:0;box-sizing:border-box;overflow:hidden}.sv-scene-view.sv-blur{filter:brightness(60%) blur(5px);transition:filter 0.5s}.sv-annotation{box-sizing:border-box;position:absolute;z-index:1;user-select:none;-moz-user-select:none;-webkit-user-select:none}.sv-annotation-img{max-width:100%}.sv-circle-annotation{width:16%;min-width:160px;max-width:260px;padding:4px 8px;background-color:rgba(0,0,0,0.7);border-radius:4px}.sv-circle-annotation.sv-align-right{transform:translateX(-100%)}.sv-circle-annotation.sv-align-bottom{transform:translateY(-100%)}.sv-circle-annotation .sv-title{padding:0 0 2px 0;font-size:0.85rem;font-weight:bold}.sv-circle-annotation p{font-family:"Segoe UI","HelveticaNeue","Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:400;font-size:0.75rem;line-height:1.35;color:#c8c8c8;margin:0.5em 0}.sv-circle-annotation .ff-button{background:rgba(0,0,0,0.01)}.sv-circle-annotation .ff-button .ff-icon{fill:#a0a0a0}.sv-circle-annotation .ff-button:hover{text-decoration:underline}.sv-circle-annotation .sv-content{overflow:hidden;overflow-wrap:break-word}.sv-pin-annotation{padding:0 4px;background-color:rgba(0,0,0,0.5);color:#c8c8c8;transform:translate(-50%, -100%)}.sv-standard-annotation,.sv-extended-annotation{max-width:28%;padding:0 4px;background-color:rgba(0,0,0,0.5);color:#c8c8c8;pointer-events:auto}.sv-standard-annotation.sv-expanded,.sv-extended-annotation.sv-expanded{width:20%;min-width:180px;background-color:rgba(0,0,0,0.8)}.sv-standard-annotation.sv-q0,.sv-extended-annotation.sv-q0{transform:translate(0, -100%);border-bottom-style:solid;border-bottom-width:1px;text-align:left}.sv-standard-annotation.sv-q1,.sv-extended-annotation.sv-q1{transform:translate(-100%, -100%);border-bottom-style:solid;border-bottom-width:1px;text-align:right}.sv-standard-annotation.sv-q2,.sv-extended-annotation.sv-q2{transform:translate(-100%, 0);border-top-style:solid;border-top-width:1px;text-align:right}.sv-standard-annotation.sv-q3,.sv-extended-annotation.sv-q3{transform:translate(0, 0);border-top-style:solid;border-top-width:1px;text-align:left}.sv-standard-annotation.sv-static-width,.sv-extended-annotation.sv-static-width{width:fit-content}.sv-standard-annotation .sv-title,.sv-extended-annotation .sv-title{padding:1px 0 2px 0;font-size:0.85rem;font-weight:bold}.sv-standard-annotation .sv-content,.sv-extended-annotation .sv-content{padding:2px 0;font-size:0.8rem;height:0;overflow:hidden;overflow-wrap:break-word;transition:height 0.2s}.sv-standard-annotation p,.sv-extended-annotation p{font-family:"Segoe UI","HelveticaNeue","Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:400;font-size:0.75rem;line-height:1.35;color:#c8c8c8;margin:0.5em 0}.sv-standard-annotation .ff-button,.sv-extended-annotation .ff-button{background:rgba(0,0,0,0.01)}.sv-standard-annotation .ff-button .ff-icon,.sv-extended-annotation .ff-button .ff-icon{fill:#a0a0a0}.sv-standard-annotation .ff-button:hover,.sv-extended-annotation .ff-button:hover{text-decoration:underline}.sv-extended-annotation .sv-title{cursor:pointer}.sv-standard-annotation{pointer-events:none}.sv-ar-prompt{flex:1 1 auto;display:flex;flex-direction:column;align-items:center;text-align:center;border-radius:20px;margin:30% 0 0 0;overflow:hidden;background-color:rgba(54,61,64,0.6)}.sv-ar-prompt .sv-content{flex:1;width:100%;margin:10px 10px;text-align:center;-webkit-user-select:none;-ms-user-select:none;user-select:none}.sv-ar-prompt .sv-content .sv-ar-icon{height:10em}.sv-ar-menu{display:flex;position:absolute;bottom:0px;flex-direction:row;margin:0 0 6px 6px}.sv-ar-menu>.ff-button{box-sizing:border-box;width:38px;height:38px;margin:0 0 2px 2px;background-color:rgba(74,82,87,0.5);border-radius:20px;font-size:17px;transition:all .15s;pointer-events:auto}.sv-ar-menu>.ff-button:hover,.sv-ar-menu>.ff-button:focus{outline:none;background-color:rgba(74,82,87,0.5);fill:#c8c8c8}.sv-ar-menu>.ff-button[selected]{background-color:#0089bf;color:#f0f0f0}.sv-ar-menu>.ff-button[selected]>.ff-icon{filter:drop-shadow(1px 1px 6px #00648c);fill:#c8c8c8}.sv-ar-menu>.ff-button[selected]:hover,.sv-ar-menu>.ff-button[selected]:focus{background-color:#00a6e8}.sv-chrome-view{font-family:"Segoe UI","HelveticaNeue","Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:400;font-size:0.85rem;line-height:1.35;color:#c8c8c8;position:absolute;left:0;right:0;top:0;bottom:0;box-sizing:border-box;overflow:hidden;display:flex;flex-direction:column;background:linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.15) 10%, transparent 25%);z-index:1}.sv-chrome-view .ff-button{flex:0 1 auto;box-sizing:border-box}.sv-chrome-view .ff-button:hover,.sv-chrome-view .ff-button:focus{outline:none}.sv-chrome-view .ff-button:hover>.ff-icon,.sv-chrome-view .ff-button:focus>.ff-icon{fill:#c8c8c8}.sv-chrome-view .ff-button[selected]{background-color:#0089bf}.sv-chrome-view .ff-button[selected][disabled]{background-color:#4e4e4e}.sv-chrome-view .ff-button[selected]>.ff-icon{filter:drop-shadow(1px 1px 6px #00648c);fill:#c8c8c8}.sv-chrome-header{display:flex;align-items:flex-start}.sv-chrome-header .sv-top-bar{flex:1 1 auto;display:flex;align-items:flex-start;height:40px;margin:9px 9px 0 0;overflow:hidden}.sv-chrome-header .sv-main-title{flex:1 1 auto;margin:6px 8px;font-family:"Hind Siliguri", sans-serif;font-weight:normal;font-size:1.2rem;white-space:pre;color:#e8e8e8;user-select:none;-moz-user-select:none;-webkit-user-select:none}.sv-chrome-header .sv-main-title span{color:transparent}.sv-chrome-footer{display:block;position:absolute;bottom:0;right:0;z-index:-1}.sv-chrome-footer .sv-bottom-bar{flex:1 1 auto;display:flex;align-items:flex-end;text-align:right;overflow:hidden}.sv-chrome-footer .sv-language-display{flex:1 1 auto;margin:6px 8px;font-family:"Hind Siliguri", sans-serif;font-weight:normal;font-size:1.0rem;white-space:pre;color:#e8e8e8;pointer-events:auto;background:rgba(31,36,38,0.8);border-radius:4px;padding:4px 6px;user-select:none;-moz-user-select:none;-webkit-user-select:none}.sv-chrome-footer .sv-language-display:hover,.sv-chrome-footer .sv-language-display:focus{outline:none;background-color:rgba(74,82,87,0.5);fill:#c8c8c8}.sv-chrome-footer .sv-language-display span{color:transparent}.sv-main-menu{display:flex;flex-direction:column;margin:6px 0 0 6px}.sv-main-menu>.ff-button{box-sizing:border-box;width:38px;height:38px;margin:2px 0;background-color:rgba(31,36,38,0.8);border-radius:20px;font-size:17px;transition:all .15s;pointer-events:auto}.sv-main-menu>.ff-button:hover,.sv-main-menu>.ff-button:focus{outline:none;background-color:rgba(74,82,87,0.5);fill:#c8c8c8}.sv-main-menu>.ff-button[selected]{background-color:#0089bf;color:#f0f0f0}.sv-main-menu>.ff-button[selected]>.ff-icon{filter:drop-shadow(1px 1px 6px #00648c);fill:#c8c8c8}.sv-main-menu>.ff-button[selected]:hover,.sv-main-menu>.ff-button[selected]:focus{background-color:#00a6e8}.sv-share-menu{position:relative;width:450px;max-width:85%;padding:8px;background:#343434;box-shadow:0 0 20px rgba(0,0,0,0.35);pointer-events:auto}.sv-share-menu .ff-title{margin:0.5em 0 1em 0}.sv-share-menu .ff-button{flex:0 0 auto}.sv-share-menu .ff-text-edit{height:6.5em}.sv-share-menu .sv-share-buttons .ff-button{width:48px;height:48px;border-radius:48px;margin:0 1em 1em 0;padding:0}.sv-share-menu .sv-share-buttons .ff-button .ff-icon{height:30px;fill:#f0f0f0}.sv-share-menu .sv-share-button-twitter{background-color:#00aced}.sv-share-menu .sv-share-button-twitter:hover{background-color:#21c2ff}.sv-share-menu .sv-share-button-facebook{background-color:#3c5a99}.sv-share-menu .sv-share-button-facebook:hover{background-color:#4e71ba}.sv-share-menu .sv-share-button-linkedin{background-color:#0077B5}.sv-share-menu .sv-share-button-linkedin:hover{background-color:#0099e8}.sv-share-menu .sv-share-button-email{background-color:#d28842}.sv-share-menu .sv-share-button-email:hover{background-color:#dca26b}.sv-document-overlay{position:absolute;left:52px;top:52px;right:6px;bottom:0;pointer-events:auto}.sv-tour-menu .sv-article,.sv-reader-view .sv-article{position:relative}.sv-tour-menu .sv-article .sv-nav-button,.sv-reader-view .sv-article .sv-nav-button{float:right;margin:1em 0.5em;padding:2px}.sv-tour-menu .sv-article .sv-nav-button .ff-icon,.sv-reader-view .sv-article .sv-nav-button .ff-icon{height:1.5em}.sv-tour-menu .sv-entry,.sv-reader-view .sv-entry{position:relative;cursor:pointer;padding:5px 0 5px 15px;margin-bottom:16px;max-width:960px;background-color:rgba(27,34,38,0.5)}.sv-tour-menu .sv-entry:hover,.sv-reader-view .sv-entry:hover{background-color:rgba(51,59,64,0.5)}.sv-language-menu{position:relative;width:225px;max-width:85%;height:200px;max-height:85%;padding:8px;background:#343434;box-shadow:0 0 20px rgba(0,0,0,0.35);pointer-events:auto}.sv-language-menu .ff-title{margin:0.3em 0 0.3em 0}.sv-language-menu .ff-button{flex:0 0 auto}.sv-language-menu .ff-scroll-y{top:50px}.sv-language-menu .sv-entry{position:relative;cursor:pointer;padding:5px 0 5px 15px;margin-bottom:2px;max-width:960px;background-color:rgba(27,34,38,0.5);user-select:none;-moz-user-select:none;-webkit-user-select:none}.sv-language-menu .sv-entry:hover{background-color:rgba(51,59,64,0.5)}.sv-language-menu .sv-entry[selected]{background-color:#0089bf;color:#f0f0f0}.sv-language-menu .sv-entry[selected]>.ff-icon{filter:drop-shadow(1px 1px 6px #00648c);fill:#c8c8c8}.sv-language-menu .sv-entry[selected]:hover,.sv-language-menu .sv-entry[selected]:focus{background-color:#00a6e8}.sv-bottom-bar-container{position:relative;display:flex;justify-content:center;transition:transform .3s ease-out,opacity .15s ease-out}.sv-bottom-bar-container.sv-transition{transform:translateY(40px);opacity:0}.sv-bottom-bar-container .ff-button{transition:all .15s}.sv-blue-bar{flex:0 1 960px;display:flex;flex-direction:column;background-color:rgba(5,7,8,0.85);border-left:1px solid rgba(0,137,191,0.5);border-right:1px solid rgba(0,137,191,0.5);margin:0 -1px 0 -1px;min-width:0px;pointer-events:auto;user-select:none;-moz-user-select:none;-webkit-user-select:none}.sv-blue-bar .sv-group{display:flex;flex-direction:column}.sv-blue-bar .sv-section{position:relative;display:flex;flex-direction:row;border-top:1px solid rgba(0,137,191,0.5)}.sv-blue-bar .sv-section-lead,.sv-blue-bar .sv-section-trail{flex:0 0 auto;padding:6px;width:38px}.sv-blue-bar .sv-section-lead:hover,.sv-blue-bar .sv-section-trail:hover{background-color:rgba(74,82,87,0.5)}.sv-blue-bar .sv-section-lead{border-right:1px solid rgba(0,137,191,0.5)}.sv-blue-bar .sv-section-trail{border-left:1px solid rgba(0,137,191,0.5)}.sv-blue-bar .sv-transparent-button{flex:0 1 auto;padding:6px;border-radius:2px}.sv-blue-bar .sv-transparent-button .ff-text{margin:1px 2px}.sv-blue-bar .sv-transparent-button .ff-icon{height:22px;margin:1px 2px}.sv-tour-navigator{color:#c8c8c8}.sv-tour-navigator .sv-content{flex:1;margin:2px 8px;text-align:center}.sv-tour-navigator .sv-title{font-size:1.1em}.sv-tour-navigator .sv-text{font-size:0.9em}.sv-target-navigator .sv-content{flex:1;margin:2px 8px;text-align:center}.sv-target-navigator .sv-title{font-size:1.1em}.sv-tag-cloud .sv-tag-buttons{flex:1 1 auto;display:flex;flex-wrap:wrap;justify-content:center;margin:4px}.sv-tag-cloud .sv-tag-button{flex:0 1 auto;margin:3px 3px;padding:2px 4px;background-color:rgba(31,36,38,0.8);border-radius:3px;font-size:0.75rem}.sv-tag-cloud .sv-tag-button:hover{background-color:rgba(74,82,87,0.5)}.sv-tag-cloud .sv-tag-button[selected]{background-color:#0089bf}.sv-tag-cloud .sv-tag-button .ff-text{margin:1px 2px}.sv-tag-cloud .sv-tag-button .ff-icon{height:22px;margin:1px 2px}.sv-tool-bar{color:#c8c8c8}.sv-tool-bar .sv-tool-buttons{flex:1 1 auto;display:flex;justify-content:center;margin:4px}.sv-tool-bar .sv-tool-button{flex:0 1 auto;margin:2px;padding:1px 2px;border-radius:3px;font-size:0.75rem}.sv-tool-bar .sv-tool-button .ff-text{margin:1px 2px}.sv-tool-bar .sv-tool-button .ff-icon{height:22px;margin:1px 2px}.sv-tool-controls{flex:1 1 auto;display:flex;justify-content:center;align-items:center;font-size:0.75rem}.sv-tool-controls .sv-property-view{flex:0 1 auto;align-self:start;display:flex;flex-direction:column;margin:4px}.sv-tool-controls .sv-property-view label{height:1.25em}.sv-tool-controls .sv-property-view.sv-nogap{margin:4px 0 !important}.sv-tool-controls .sv-property-slider{flex:0 2 180px}.sv-tool-controls .sv-property-slider .ff-linear-slider{height:6px;margin:12px 2px;padding-right:16px;border-radius:2px;background-color:#4e4e4e}.sv-tool-controls .sv-property-slider .ff-linear-slider .ff-knob{width:16px;height:26px;margin:-10px 0 0 0;border-radius:2px;background-color:#0089bf;box-shadow:0 0 6px black}.sv-tool-controls .sv-property-color>.ff-button{width:28px;box-sizing:border-box;border:1px solid #343434}.sv-tool-controls .sv-property-color .ff-color-edit{position:absolute;width:200px;height:180px;right:8px;top:-188px}.sv-tool-controls .sv-options{display:flex}.sv-tool-controls .ff-label{margin:2px}.sv-tool-controls .ff-string{flex:0 1 auto;height:26px;margin:2px;font-size:1rem}.sv-tool-controls .ff-button{height:26px;margin:2px;padding:0 4px;background:#343434;border-radius:2px}.sv-view-tool-view .sv-options,.sv-render-tool-view .sv-options,.sv-light-tool-view .sv-options{flex-wrap:wrap}.sv-tape-tool-view .sv-tool-controls,.sv-slice-tool-view .sv-tool-controls,.sv-environment-tool-view .sv-tool-controls{flex-wrap:wrap}\n',e.appendChild(t);const n=this.application.system;e.appendChild(new og(n)),e.appendChild(new zg(n));const i=document.createElement("div");i.setAttribute("id",Pr.stackId),e.appendChild(i),Pr.shadowRootNode=e}connected(){this.fullscreen.fullscreenElement=this}disconnected(){this.fullscreen.fullscreenElement=null}toggleAnnotations(){this.application&&this.application.toggleAnnotations()}toggleReader(){this.application&&this.application.toggleReader()}toggleTours(){this.application&&this.application.toggleTours()}toggleTools(){this.application&&this.application.toggleTools()}enableAR(){this.application&&this.application.enableAR()}getArticles(){if(this.application){return this.application.getArticles()}}getCameraOrbit(){if(this.application){return this.application.getCameraOrbit()}}setCameraOrbit(e,t){this.application&&this.application.setCameraOrbit(e,t)}setBackgroundColor(e,t){this.application&&this.application.setBackgroundColor(e,t||null)}setBackgroundStyle(e){this.application&&this.application.setBackgroundStyle(e)}};Fg=Ug([yr("voyager-explorer")],Fg);var Vg=t.default=Fg}]);